<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Power Analysis | Statistical Tools for Causal Inference</title>
  <meta name="description" content="This is an open source collaborative book." />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Power Analysis | Statistical Tools for Causal Inference" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is an open source collaborative book." />
  <meta name="github-repo" content="chabefer/STCI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Power Analysis | Statistical Tools for Causal Inference" />
  
  <meta name="twitter:description" content="This is an open source collaborative book." />
  

<meta name="author" content="Sylvain Chabé-Ferret" />


<meta name="date" content="2023-09-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="threats.html"/>
<link rel="next" href="sec:placebo.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
$$
\newcommand{\uns}[1]{\mathbf{1}[#1]}
\newcommand{\esp}[1]{\mathbf{E}[#1]}
\newcommand{\hatesp}[1]{\hat{\mathbf{E}}[ #1 ]}
\newcommand{\espE}{\mathbf{E}}
\newcommand{\Ind}{\perp\kern-5pt\perp}
\newcommand{\var}[1]{\mathbf{V}[ #1 ]}
\newcommand{\hatvar}[1]{\hat{\mathbf{V}}[ #1 ]}
\newcommand{\cov}[1]{\mathbf{C}[ #1 ]}
\newcommand{\plim}[1]{\text{plim}_{ #1 \rightarrow \infty}}
\newcommand{\plims}{\text{plim}}
\newcommand{\distr}{\stackrel{d}{\rightarrow}}
\newcommand{\partder}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\partdersq}[2]{\frac{\partial^2 #1}{\partial #2^2}}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\asym}{Asym}
$$


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Tools for Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>I Fundamental Problems of Inference</b></span></li>
<li class="chapter" data-level="" data-path="introduction-the-two-fundamental-problems-of-inference.html"><a href="introduction-the-two-fundamental-problems-of-inference.html"><i class="fa fa-check"></i>Introduction: the Two Fundamental Problems of Inference</a></li>
<li class="chapter" data-level="1" data-path="FPCI.html"><a href="FPCI.html"><i class="fa fa-check"></i><b>1</b> Fundamental Problem of Causal Inference</a>
<ul>
<li class="chapter" data-level="1.1" data-path="FPCI.html"><a href="FPCI.html#rubin-causal-model"><i class="fa fa-check"></i><b>1.1</b> Rubin Causal Model</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="FPCI.html"><a href="FPCI.html#treatment-allocation-rule"><i class="fa fa-check"></i><b>1.1.1</b> Treatment allocation rule</a></li>
<li class="chapter" data-level="1.1.2" data-path="FPCI.html"><a href="FPCI.html#potential-outcomes"><i class="fa fa-check"></i><b>1.1.2</b> Potential outcomes</a></li>
<li class="chapter" data-level="1.1.3" data-path="FPCI.html"><a href="FPCI.html#switching-equation"><i class="fa fa-check"></i><b>1.1.3</b> Switching equation</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="FPCI.html"><a href="FPCI.html#treatment-effects"><i class="fa fa-check"></i><b>1.2</b> Treatment effects</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="FPCI.html"><a href="FPCI.html#individual-level-treatment-effects"><i class="fa fa-check"></i><b>1.2.1</b> Individual level treatment effects</a></li>
<li class="chapter" data-level="1.2.2" data-path="FPCI.html"><a href="FPCI.html#average-treatment-effect-on-the-treated"><i class="fa fa-check"></i><b>1.2.2</b> Average treatment effect on the treated</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="FPCI.html"><a href="FPCI.html#fundamental-problem-of-causal-inference"><i class="fa fa-check"></i><b>1.3</b> Fundamental problem of causal inference</a></li>
<li class="chapter" data-level="1.4" data-path="FPCI.html"><a href="FPCI.html#intuitive-estimators-confounding-factors-and-selection-bias"><i class="fa fa-check"></i><b>1.4</b> Intuitive estimators, confounding factors and selection bias</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="FPCI.html"><a href="FPCI.html#withwithout-comparison-selection-bias-and-cross-sectional-confounders"><i class="fa fa-check"></i><b>1.4.1</b> With/Without comparison, selection bias and cross-sectional confounders</a></li>
<li class="chapter" data-level="1.4.2" data-path="FPCI.html"><a href="FPCI.html#the-beforeafter-comparison-temporal-confounders-and-time-trend-bias"><i class="fa fa-check"></i><b>1.4.2</b> The before/after comparison, temporal confounders and time trend bias</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="FPSI.html"><a href="FPSI.html"><i class="fa fa-check"></i><b>2</b> Fundamental Problem of Statistical Inference</a>
<ul>
<li class="chapter" data-level="2.1" data-path="FPSI.html"><a href="FPSI.html#sec:sampnoise"><i class="fa fa-check"></i><b>2.1</b> What is sampling noise? Definition and illustration</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="FPSI.html"><a href="FPSI.html#sec:definitionnoise"><i class="fa fa-check"></i><b>2.1.1</b> Sampling noise, a definition</a></li>
<li class="chapter" data-level="2.1.2" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisepop"><i class="fa fa-check"></i><b>2.1.2</b> Sampling noise for the population treatment effect</a></li>
<li class="chapter" data-level="2.1.3" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisesamp"><i class="fa fa-check"></i><b>2.1.3</b> Sampling noise for the sample treatment effect</a></li>
<li class="chapter" data-level="2.1.4" data-path="FPSI.html"><a href="FPSI.html#sec:confinterv"><i class="fa fa-check"></i><b>2.1.4</b> Building confidence intervals from estimates of sampling noise</a></li>
<li class="chapter" data-level="2.1.5" data-path="FPSI.html"><a href="FPSI.html#reporting-sampling-noise-a-proposal"><i class="fa fa-check"></i><b>2.1.5</b> Reporting sampling noise: a proposal</a></li>
<li class="chapter" data-level="2.1.6" data-path="FPSI.html"><a href="FPSI.html#sec:effectsize"><i class="fa fa-check"></i><b>2.1.6</b> Using effect sizes to normalize the reporting of treatment effects and their precision</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="FPSI.html"><a href="FPSI.html#sec:estimsampnoise"><i class="fa fa-check"></i><b>2.2</b> Estimating sampling noise</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="FPSI.html"><a href="FPSI.html#sec:assumptions"><i class="fa fa-check"></i><b>2.2.1</b> Assumptions</a></li>
<li class="chapter" data-level="2.2.2" data-path="FPSI.html"><a href="FPSI.html#sec:cheb"><i class="fa fa-check"></i><b>2.2.2</b> Using Chebyshev’s inequality</a></li>
<li class="chapter" data-level="2.2.3" data-path="FPSI.html"><a href="FPSI.html#sec:CLT"><i class="fa fa-check"></i><b>2.2.3</b> Using the Central Limit Theorem</a></li>
<li class="chapter" data-level="2.2.4" data-path="FPSI.html"><a href="FPSI.html#sec:resamp"><i class="fa fa-check"></i><b>2.2.4</b> Using resampling methods</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Methods of Causal Inference</b></span></li>
<li class="chapter" data-level="3" data-path="RCT.html"><a href="RCT.html"><i class="fa fa-check"></i><b>3</b> Randomized Controlled Trials</a>
<ul>
<li class="chapter" data-level="3.1" data-path="RCT.html"><a href="RCT.html#sec:design1"><i class="fa fa-check"></i><b>3.1</b> Brute Force Design</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="RCT.html"><a href="RCT.html#identification"><i class="fa fa-check"></i><b>3.1.1</b> Identification</a></li>
<li class="chapter" data-level="3.1.2" data-path="RCT.html"><a href="RCT.html#estimating-ate"><i class="fa fa-check"></i><b>3.1.2</b> Estimating ATE</a></li>
<li class="chapter" data-level="3.1.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise"><i class="fa fa-check"></i><b>3.1.3</b> Estimating Sampling Noise</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="RCT.html"><a href="RCT.html#sec:design2"><i class="fa fa-check"></i><b>3.2</b> Self-Selection design</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="RCT.html"><a href="RCT.html#identification-1"><i class="fa fa-check"></i><b>3.2.1</b> Identification</a></li>
<li class="chapter" data-level="3.2.2" data-path="RCT.html"><a href="RCT.html#estimating-tt"><i class="fa fa-check"></i><b>3.2.2</b> Estimating TT</a></li>
<li class="chapter" data-level="3.2.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-1"><i class="fa fa-check"></i><b>3.2.3</b> Estimating Sampling Noise</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="RCT.html"><a href="RCT.html#sec:design3"><i class="fa fa-check"></i><b>3.3</b> Eligibility design</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="RCT.html"><a href="RCT.html#identification-2"><i class="fa fa-check"></i><b>3.3.1</b> Identification</a></li>
<li class="chapter" data-level="3.3.2" data-path="RCT.html"><a href="RCT.html#estimating-the-ite-and-the-tt"><i class="fa fa-check"></i><b>3.3.2</b> Estimating the ITE and the TT</a></li>
<li class="chapter" data-level="3.3.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-2"><i class="fa fa-check"></i><b>3.3.3</b> Estimating sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="RCT.html"><a href="RCT.html#sec:design4"><i class="fa fa-check"></i><b>3.4</b> Encouragement Design</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="RCT.html"><a href="RCT.html#identification-3"><i class="fa fa-check"></i><b>3.4.1</b> Identification</a></li>
<li class="chapter" data-level="3.4.2" data-path="RCT.html"><a href="RCT.html#IVRCT"><i class="fa fa-check"></i><b>3.4.2</b> Estimating the Local Average Treatment Effect and the Intention to Treat Effect</a></li>
<li class="chapter" data-level="3.4.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-3"><i class="fa fa-check"></i><b>3.4.3</b> Estimating sampling noise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="NE.html"><a href="NE.html"><i class="fa fa-check"></i><b>4</b> Natural Experiments</a>
<ul>
<li class="chapter" data-level="4.1" data-path="NE.html"><a href="NE.html#instrumental-variables"><i class="fa fa-check"></i><b>4.1</b> Instrumental Variables</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="NE.html"><a href="NE.html#an-example-where-monotonicity-does-not-hold"><i class="fa fa-check"></i><b>4.1.1</b> An example where Monotonicity does not hold</a></li>
<li class="chapter" data-level="4.1.2" data-path="NE.html"><a href="NE.html#identification-4"><i class="fa fa-check"></i><b>4.1.2</b> Identification</a></li>
<li class="chapter" data-level="4.1.3" data-path="NE.html"><a href="NE.html#estimation"><i class="fa fa-check"></i><b>4.1.3</b> Estimation</a></li>
<li class="chapter" data-level="4.1.4" data-path="NE.html"><a href="NE.html#estimation-of-sampling-noise"><i class="fa fa-check"></i><b>4.1.4</b> Estimation of sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="NE.html"><a href="NE.html#regression-discontinuity-designs"><i class="fa fa-check"></i><b>4.2</b> Regression Discontinuity Designs</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="NE.html"><a href="NE.html#sharp-regression-discontinuity-designs"><i class="fa fa-check"></i><b>4.2.1</b> Sharp Regression Discontinuity Designs</a></li>
<li class="chapter" data-level="4.2.2" data-path="NE.html"><a href="NE.html#fuzzy-regression-discontinuity-designs"><i class="fa fa-check"></i><b>4.2.2</b> Fuzzy Regression Discontinuity Designs</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="NE.html"><a href="NE.html#DID"><i class="fa fa-check"></i><b>4.3</b> Difference In Differences</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="NE.html"><a href="NE.html#sec:DIDbasic"><i class="fa fa-check"></i><b>4.3.1</b> Difference In Differences with two time periods</a></li>
<li class="chapter" data-level="4.3.2" data-path="NE.html"><a href="NE.html#sec:DIDr"><i class="fa fa-check"></i><b>4.3.2</b> Reverse Difference In Differences designs with two time periods</a></li>
<li class="chapter" data-level="4.3.3" data-path="NE.html"><a href="NE.html#difference-in-differences-with-multiple-time-periods"><i class="fa fa-check"></i><b>4.3.3</b> Difference In Differences with multiple time periods</a></li>
<li class="chapter" data-level="4.3.4" data-path="NE.html"><a href="NE.html#difference-in-differences-with-instrumental-variables"><i class="fa fa-check"></i><b>4.3.4</b> Difference In Differences with Instrumental Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="OM.html"><a href="OM.html"><i class="fa fa-check"></i><b>5</b> Observational Methods</a>
<ul>
<li class="chapter" data-level="5.1" data-path="OM.html"><a href="OM.html#parametric-methods"><i class="fa fa-check"></i><b>5.1</b> Parametric methods</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="OM.html"><a href="OM.html#assuming-espy_i0x_i-is-known"><i class="fa fa-check"></i><b>5.1.1</b> Assuming <span class="math inline">\(\esp{Y_i^0|X_i}\)</span> is known</a></li>
<li class="chapter" data-level="5.1.2" data-path="OM.html"><a href="OM.html#assuming-espy_i1x_i-is-known"><i class="fa fa-check"></i><b>5.1.2</b> Assuming <span class="math inline">\(\esp{Y_i^1|X_i}\)</span> is known</a></li>
<li class="chapter" data-level="5.1.3" data-path="OM.html"><a href="OM.html#BiasOLS"><i class="fa fa-check"></i><b>5.1.3</b> Properties of the OLS estimator under Conditional Independence</a></li>
<li class="chapter" data-level="5.1.4" data-path="OM.html"><a href="OM.html#problems-with-parametric-methods"><i class="fa fa-check"></i><b>5.1.4</b> Problems with parametric methods</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="OM.html"><a href="OM.html#nonparametric-methods"><i class="fa fa-check"></i><b>5.2</b> Nonparametric methods</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="OM.html"><a href="OM.html#identification-12"><i class="fa fa-check"></i><b>5.2.1</b> Identification</a></li>
<li class="chapter" data-level="5.2.2" data-path="OM.html"><a href="OM.html#estimation-8"><i class="fa fa-check"></i><b>5.2.2</b> Estimation</a></li>
<li class="chapter" data-level="5.2.3" data-path="OM.html"><a href="OM.html#estimating-precision-2"><i class="fa fa-check"></i><b>5.2.3</b> Estimating precision</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="OM.html"><a href="OM.html#imputation-methods"><i class="fa fa-check"></i><b>5.3</b> Imputation methods</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="threats.html"><a href="threats.html"><i class="fa fa-check"></i><b>6</b> Threats to the validity of Causal Inference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="threats.html"><a href="threats.html#threats-to-internal-validity"><i class="fa fa-check"></i><b>6.1</b> Threats to internal validity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="threats.html"><a href="threats.html#survey-bias"><i class="fa fa-check"></i><b>6.1.1</b> Survey bias</a></li>
<li class="chapter" data-level="6.1.2" data-path="threats.html"><a href="threats.html#experimenter-bias"><i class="fa fa-check"></i><b>6.1.2</b> Experimenter bias</a></li>
<li class="chapter" data-level="6.1.3" data-path="threats.html"><a href="threats.html#substitution-bias"><i class="fa fa-check"></i><b>6.1.3</b> Substitution bias</a></li>
<li class="chapter" data-level="6.1.4" data-path="threats.html"><a href="threats.html#diffusion-bias"><i class="fa fa-check"></i><b>6.1.4</b> Diffusion bias</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="threats.html"><a href="threats.html#threats-to-the-measurement-of-precision"><i class="fa fa-check"></i><b>6.2</b> Threats to the measurement of precision</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="threats.html"><a href="threats.html#insufficient-precision"><i class="fa fa-check"></i><b>6.2.1</b> Insufficient precision</a></li>
<li class="chapter" data-level="6.2.2" data-path="threats.html"><a href="threats.html#clustering"><i class="fa fa-check"></i><b>6.2.2</b> Clustering</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="threats.html"><a href="threats.html#threats-to-external-validity"><i class="fa fa-check"></i><b>6.3</b> Threats to external validity</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="threats.html"><a href="threats.html#randomization-bias"><i class="fa fa-check"></i><b>6.3.1</b> Randomization bias</a></li>
<li class="chapter" data-level="6.3.2" data-path="threats.html"><a href="threats.html#equilibrium-effects"><i class="fa fa-check"></i><b>6.3.2</b> Equilibrium effects</a></li>
<li class="chapter" data-level="6.3.3" data-path="threats.html"><a href="threats.html#context-effects"><i class="fa fa-check"></i><b>6.3.3</b> Context effects</a></li>
<li class="chapter" data-level="6.3.4" data-path="threats.html"><a href="threats.html#site-selection-bias"><i class="fa fa-check"></i><b>6.3.4</b> Site selection bias</a></li>
<li class="chapter" data-level="6.3.5" data-path="threats.html"><a href="threats.html#publication-bias"><i class="fa fa-check"></i><b>6.3.5</b> Publication bias</a></li>
<li class="chapter" data-level="6.3.6" data-path="threats.html"><a href="threats.html#ethical-and-political-issues"><i class="fa fa-check"></i><b>6.3.6</b> Ethical and political issues</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Additional Topics</b></span></li>
<li class="chapter" data-level="7" data-path="Power.html"><a href="Power.html"><i class="fa fa-check"></i><b>7</b> Power Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Power.html"><a href="Power.html#basics-of-traditional-power-analysis-using-test-statistics"><i class="fa fa-check"></i><b>7.1</b> Basics of traditional power analysis using test statistics</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="Power.html"><a href="Power.html#power"><i class="fa fa-check"></i><b>7.1.1</b> Power</a></li>
<li class="chapter" data-level="7.1.2" data-path="Power.html"><a href="Power.html#minimum-detectable-effect"><i class="fa fa-check"></i><b>7.1.2</b> Minimum Detectable Effect</a></li>
<li class="chapter" data-level="7.1.3" data-path="Power.html"><a href="Power.html#minimum-required-sample-size"><i class="fa fa-check"></i><b>7.1.3</b> Minimum Required Sample Size</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="Power.html"><a href="Power.html#traditional-power-analysis-in-practice"><i class="fa fa-check"></i><b>7.2</b> Traditional power analysis in practice</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="Power.html"><a href="Power.html#power-analysis-for-randomized-controlled-trials"><i class="fa fa-check"></i><b>7.2.1</b> Power Analysis for Randomized Controlled Trials</a></li>
<li class="chapter" data-level="7.2.2" data-path="Power.html"><a href="Power.html#power-analysis-for-natural-experiments"><i class="fa fa-check"></i><b>7.2.2</b> Power Analysis for Natural Experiments</a></li>
<li class="chapter" data-level="7.2.3" data-path="Power.html"><a href="Power.html#power-analysis-for-observational-methods"><i class="fa fa-check"></i><b>7.2.3</b> Power Analysis for Observational Methods</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="Power.html"><a href="Power.html#limitations-of-and-alternatives-to-traditional-power-analysis"><i class="fa fa-check"></i><b>7.3</b> Limitations of and alternatives to traditional power analysis</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="Power.html"><a href="Power.html#limitations-of-traditional-power-analysis"><i class="fa fa-check"></i><b>7.3.1</b> Limitations of traditional power analysis</a></li>
<li class="chapter" data-level="7.3.2" data-path="Power.html"><a href="Power.html#an-alternative-to-traditional-power-analysis"><i class="fa fa-check"></i><b>7.3.2</b> An alternative to traditional power analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sec:placebo.html"><a href="sec:placebo.html"><i class="fa fa-check"></i><b>8</b> Placebo Tests</a></li>
<li class="chapter" data-level="9" data-path="cluster.html"><a href="cluster.html"><i class="fa fa-check"></i><b>9</b> Clustering</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cluster.html"><a href="cluster.html#ClusterRCT"><i class="fa fa-check"></i><b>9.1</b> Clustering in Randomized Controlled Trials</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="cluster.html"><a href="cluster.html#an-example"><i class="fa fa-check"></i><b>9.1.1</b> An example</a></li>
<li class="chapter" data-level="9.1.2" data-path="cluster.html"><a href="cluster.html#design-effect"><i class="fa fa-check"></i><b>9.1.2</b> Design effect</a></li>
<li class="chapter" data-level="9.1.3" data-path="cluster.html"><a href="cluster.html#estimating-sampling-noise-accounting-for-clustering"><i class="fa fa-check"></i><b>9.1.3</b> Estimating sampling noise accounting for clustering</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="cluster.html"><a href="cluster.html#clustering-in-panel-data"><i class="fa fa-check"></i><b>9.2</b> Clustering in panel data</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="cluster.html"><a href="cluster.html#an-example-1"><i class="fa fa-check"></i><b>9.2.1</b> An example</a></li>
<li class="chapter" data-level="9.2.2" data-path="cluster.html"><a href="cluster.html#design-effect-in-panel-data"><i class="fa fa-check"></i><b>9.2.2</b> Design effect in panel data</a></li>
<li class="chapter" data-level="9.2.3" data-path="cluster.html"><a href="cluster.html#estimating-sampling-noise-in-panel-data-with-autocorrelated-error-terms"><i class="fa fa-check"></i><b>9.2.3</b> Estimating sampling noise in panel data with autocorrelated error terms</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cluster.html"><a href="cluster.html#spatial-correlation"><i class="fa fa-check"></i><b>9.3</b> Spatial correlation</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="cluster.html"><a href="cluster.html#an-example-2"><i class="fa fa-check"></i><b>9.3.1</b> An example</a></li>
<li class="chapter" data-level="9.3.2" data-path="cluster.html"><a href="cluster.html#design-effect-in-spatially-autocorrelated-data"><i class="fa fa-check"></i><b>9.3.2</b> Design effect in spatially autocorrelated data</a></li>
<li class="chapter" data-level="9.3.3" data-path="cluster.html"><a href="cluster.html#estimating-sampling-noise-with-spatially-autocorrelated-data"><i class="fa fa-check"></i><b>9.3.3</b> Estimating sampling noise with spatially autocorrelated data</a></li>
<li class="chapter" data-level="9.3.4" data-path="cluster.html"><a href="cluster.html#testing-for-spatial-autocorrelation"><i class="fa fa-check"></i><b>9.3.4</b> Testing for spatial autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="cluster.html"><a href="cluster.html#clustering-on-a-network"><i class="fa fa-check"></i><b>9.4</b> Clustering on a network</a></li>
<li class="chapter" data-level="9.5" data-path="cluster.html"><a href="cluster.html#multi-way-clustering"><i class="fa fa-check"></i><b>9.5</b> Multi-way clustering</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="cluster.html"><a href="cluster.html#at-which-level-should-we-cluster"><i class="fa fa-check"></i><b>9.5.1</b> At which level should we cluster?</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="cluster.html"><a href="cluster.html#what-to-do-when-there-are-few-clusters"><i class="fa fa-check"></i><b>9.6</b> What to do when there are few clusters?</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="cluster.html"><a href="cluster.html#aggregation"><i class="fa fa-check"></i><b>9.6.1</b> Aggregation</a></li>
<li class="chapter" data-level="9.6.2" data-path="cluster.html"><a href="cluster.html#permutation-tests"><i class="fa fa-check"></i><b>9.6.2</b> Permutation tests</a></li>
<li class="chapter" data-level="9.6.3" data-path="cluster.html"><a href="cluster.html#wild-bootstrap"><i class="fa fa-check"></i><b>9.6.3</b> Wild bootstrap</a></li>
<li class="chapter" data-level="9.6.4" data-path="cluster.html"><a href="cluster.html#ibragimov-and-muller-2010-group-based-inference"><i class="fa fa-check"></i><b>9.6.4</b> Ibragimov and Muller (2010) group-based inference</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="cluster.html"><a href="cluster.html#CLTDD"><i class="fa fa-check"></i><b>9.7</b> Central Limit Theorems for Dependent Data</a></li>
<li class="chapter" data-level="9.8" data-path="cluster.html"><a href="cluster.html#DesignBasedClusters"><i class="fa fa-check"></i><b>9.8</b> Sampling-based and design-based approaches to clustering</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="LaLonde.html"><a href="LaLonde.html"><i class="fa fa-check"></i><b>10</b> LaLonde Tests</a></li>
<li class="chapter" data-level="11" data-path="Diffusion.html"><a href="Diffusion.html"><i class="fa fa-check"></i><b>11</b> Diffusion effects</a></li>
<li class="chapter" data-level="12" data-path="Distribution.html"><a href="Distribution.html"><i class="fa fa-check"></i><b>12</b> Distributional effects</a></li>
<li class="chapter" data-level="13" data-path="meta.html"><a href="meta.html"><i class="fa fa-check"></i><b>13</b> Meta-analysis and Publication Bias</a>
<ul>
<li class="chapter" data-level="13.1" data-path="meta.html"><a href="meta.html#meta-analysis"><i class="fa fa-check"></i><b>13.1</b> Meta-analysis</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="meta.html"><a href="meta.html#basic-setting"><i class="fa fa-check"></i><b>13.1.1</b> Basic setting</a></li>
<li class="chapter" data-level="13.1.2" data-path="meta.html"><a href="meta.html#why-vote-counting-does-not-work"><i class="fa fa-check"></i><b>13.1.2</b> Why vote-counting does not work</a></li>
<li class="chapter" data-level="13.1.3" data-path="meta.html"><a href="meta.html#MetaWA"><i class="fa fa-check"></i><b>13.1.3</b> Meta-analysis when treatment effects are homogeneous: the fixed effects approach</a></li>
<li class="chapter" data-level="13.1.4" data-path="meta.html"><a href="meta.html#meta-analysis-when-treatment-effects-are-heterogeneous-the-random-effects-approach"><i class="fa fa-check"></i><b>13.1.4</b> Meta-analysis when treatment effects are heterogeneous: the random effects approach</a></li>
<li class="chapter" data-level="13.1.5" data-path="meta.html"><a href="meta.html#meta-regression"><i class="fa fa-check"></i><b>13.1.5</b> Meta-regression</a></li>
<li class="chapter" data-level="13.1.6" data-path="meta.html"><a href="meta.html#constantly-updated-meta-analysis"><i class="fa fa-check"></i><b>13.1.6</b> Constantly updated meta-analysis</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="meta.html"><a href="meta.html#publication-bias-and-site-selection-bias"><i class="fa fa-check"></i><b>13.2</b> Publication bias and site selection bias</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="meta.html"><a href="meta.html#sources-of-publication-bias-and-of-site-selection-bias-and-questionable-research-practices"><i class="fa fa-check"></i><b>13.2.1</b> Sources of publication bias and of site selection bias and Questionable Research Practices</a></li>
<li class="chapter" data-level="13.2.2" data-path="meta.html"><a href="meta.html#detection-of-and-correction-for-publication-bias"><i class="fa fa-check"></i><b>13.2.2</b> Detection of and correction for publication bias</a></li>
<li class="chapter" data-level="13.2.3" data-path="meta.html"><a href="meta.html#getting-rid-of-publication-bias-registered-reports-and-pre-analysis-plans"><i class="fa fa-check"></i><b>13.2.3</b> Getting rid of publication bias: registered reports and pre-analysis plans</a></li>
<li class="chapter" data-level="13.2.4" data-path="meta.html"><a href="meta.html#detection-of-and-correction-for-site-selection-bias"><i class="fa fa-check"></i><b>13.2.4</b> Detection of and correction for site selection bias</a></li>
<li class="chapter" data-level="13.2.5" data-path="meta.html"><a href="meta.html#vote-counting-and-publication-bias"><i class="fa fa-check"></i><b>13.2.5</b> Vote counting and publication bias</a></li>
<li class="chapter" data-level="13.2.6" data-path="meta.html"><a href="meta.html#the-value-of-a-statistically-significant-result"><i class="fa fa-check"></i><b>13.2.6</b> The value of a statistically significant result</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="Bounds.html"><a href="Bounds.html"><i class="fa fa-check"></i><b>14</b> Bounds</a></li>
<li class="chapter" data-level="15" data-path="mediation-analysis.html"><a href="mediation-analysis.html"><i class="fa fa-check"></i><b>15</b> Mediation Analysis</a>
<ul>
<li class="chapter" data-level="15.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-a-framework"><i class="fa fa-check"></i><b>15.1</b> Mediation analysis: a framework</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#defining-mediated-and-unmediated-treatment-effects"><i class="fa fa-check"></i><b>15.1.1</b> Defining mediated and unmediated treatment effects</a></li>
<li class="chapter" data-level="15.1.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#decomposing-mediated-and-unmediated-effects"><i class="fa fa-check"></i><b>15.1.2</b> Decomposing mediated and unmediated effects</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#the-fundamental-problem-of-mediation-analysis"><i class="fa fa-check"></i><b>15.2</b> The Fundamental Problem of Mediation Analysis</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#the-fundamental-problem-of-mediation-analysis-1"><i class="fa fa-check"></i><b>15.2.1</b> The Fundamental Problem of Mediation Analysis</a></li>
<li class="chapter" data-level="15.2.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#biases-of-intuitive-comparisons"><i class="fa fa-check"></i><b>15.2.2</b> Biases of Intuitive Comparisons</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-experimental-data"><i class="fa fa-check"></i><b>15.3</b> Mediation analysis with experimental data</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-in-the-parallel-design"><i class="fa fa-check"></i><b>15.3.1</b> Mediation analysis in the Parallel design</a></li>
<li class="chapter" data-level="15.3.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-in-the-sequential-self-selection-design"><i class="fa fa-check"></i><b>15.3.2</b> Mediation analysis in the Sequential Self-Selection design</a></li>
<li class="chapter" data-level="15.3.3" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-in-the-crossover-design"><i class="fa fa-check"></i><b>15.3.3</b> Mediation analysis in the Crossover design</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-under-unconfoundedness"><i class="fa fa-check"></i><b>15.4</b> Mediation analysis under unconfoundedness</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#non-parametric-identification-under-sequential-ignorability"><i class="fa fa-check"></i><b>15.4.1</b> Non-parametric identification under sequential ignorability</a></li>
<li class="chapter" data-level="15.4.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-under-sequential-ignorability-in-linear-models"><i class="fa fa-check"></i><b>15.4.2</b> Mediation analysis under sequential ignorability in linear models</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-panel-data"><i class="fa fa-check"></i><b>15.5</b> Mediation analysis with panel data</a></li>
<li class="chapter" data-level="15.6" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-instruments"><i class="fa fa-check"></i><b>15.6</b> Mediation analysis with instruments</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="proofs.html"><a href="proofs.html"><i class="fa fa-check"></i><b>A</b> Proofs</a>
<ul>
<li class="chapter" data-level="A.1" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-reffpsi"><i class="fa fa-check"></i><b>A.1</b> Proofs of results in Chapter @ref(FPSI)</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="proofs.html"><a href="proofs.html#proofcheb"><i class="fa fa-check"></i><b>A.1.1</b> Proof of Theorem @ref(thm:uppsampnoise)</a></li>
<li class="chapter" data-level="A.1.2" data-path="proofs.html"><a href="proofs.html#proofCLT"><i class="fa fa-check"></i><b>A.1.2</b> Proof of Theorem @ref(thm:asympnoiseWW)</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refrct"><i class="fa fa-check"></i><b>A.2</b> Proofs of results in Chapter @ref(RCT)</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="proofs.html"><a href="proofs.html#proofIdentLATE"><i class="fa fa-check"></i><b>A.2.1</b> Proof of Theorem @ref(thm:IdentLATE)</a></li>
<li class="chapter" data-level="A.2.2" data-path="proofs.html"><a href="proofs.html#proofWaldIV"><i class="fa fa-check"></i><b>A.2.2</b> Proof of Theorem @ref(thm:WaldIV)</a></li>
<li class="chapter" data-level="A.2.3" data-path="proofs.html"><a href="proofs.html#ProofAsymWald"><i class="fa fa-check"></i><b>A.2.3</b> Proof of Theorem @ref(thm:asymWald)</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refne"><i class="fa fa-check"></i><b>A.3</b> Proofs of results in Chapter @ref(NE)</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="proofs.html"><a href="proofs.html#proofEstimDID"><i class="fa fa-check"></i><b>A.3.1</b> Proof of Theorem @ref(thm:EstimDID)</a></li>
<li class="chapter" data-level="A.3.2" data-path="proofs.html"><a href="proofs.html#proofasympnoiseDIDCross"><i class="fa fa-check"></i><b>A.3.2</b> Proof of Theorem @ref(thm:asympnoiseDIDCross)</a></li>
<li class="chapter" data-level="A.3.3" data-path="proofs.html"><a href="proofs.html#proofEquivDIDSApop"><i class="fa fa-check"></i><b>A.3.3</b> Proof of Theorem @ref(thm:EquivDIDSApop)</a></li>
<li class="chapter" data-level="A.3.4" data-path="proofs.html"><a href="proofs.html#proofEquivDIDSAsamp"><i class="fa fa-check"></i><b>A.3.4</b> Proof of Theorem @ref(thm:EquivDIDSAsamp)</a></li>
<li class="chapter" data-level="A.3.5" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSACross"><i class="fa fa-check"></i><b>A.3.5</b> Proof of Theorem @ref(thm:asympnoiseSACross)</a></li>
<li class="chapter" data-level="A.3.6" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSATTCross"><i class="fa fa-check"></i><b>A.3.6</b> Proof of Theorem @ref(thm:asympnoiseSATTCross)</a></li>
<li class="chapter" data-level="A.3.7" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSAPanel"><i class="fa fa-check"></i><b>A.3.7</b> Proof of Theorem @ref(thm:asympnoiseSAPanel)</a></li>
<li class="chapter" data-level="A.3.8" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSATTPanel"><i class="fa fa-check"></i><b>A.3.8</b> Proof of Theorem @ref(thm:asympnoiseSATTPanel)</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refom"><i class="fa fa-check"></i><b>A.4</b> Proofs of results in Chapter @ref(OM)</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="proofs.html"><a href="proofs.html#proofAsympWWOLS10"><i class="fa fa-check"></i><b>A.4.1</b> Proof of Theorem @ref(thm:AsympWWOLS10)</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refcluster"><i class="fa fa-check"></i><b>A.5</b> Proofs of results in Chapter @ref(cluster)</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="proofs.html"><a href="proofs.html#proofVarWWClus"><i class="fa fa-check"></i><b>A.5.1</b> Proof of Theorem @ref(thm:VarWWClus)</a></li>
<li class="chapter" data-level="A.5.2" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSATTPanelAR1"><i class="fa fa-check"></i><b>A.5.2</b> Proof of Theorem @ref(thm:asympnoiseSATTPanelAR1)</a></li>
<li class="chapter" data-level="A.5.3" data-path="proofs.html"><a href="proofs.html#proofVarWWSpatial"><i class="fa fa-check"></i><b>A.5.3</b> Proof of Theorem @ref(thm:VarWWSpatial)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Tools for Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Power" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Power Analysis<a href="Power.html#Power" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter, we are going to study how to choose the size of our sample and how to gauge the size of sampling noise before conducting a study.
This is important because we might decide not to conduct a study if it is not going to bring us precise enough information on the impact in view of its anticipated size.</p>
<p>In practice, there are two ways to run a power analysis:</p>
<ol style="list-style-type: decimal">
<li>Using test statistics (power study per se)</li>
<li>Gauging sampling noise or choosing sample size to reach a given sampling noise</li>
</ol>
<p>Let me first start by describing the usual approach before moving to my more personal proposal.</p>
<div id="basics-of-traditional-power-analysis-using-test-statistics" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Basics of traditional power analysis using test statistics<a href="Power.html#basics-of-traditional-power-analysis-using-test-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Traditional power analysis is based on test-statistics and p-values.
Intuitively, the approach to power analysis based on test statistics computes the sample size required so that a test of a given size <span class="math inline">\(\alpha\)</span> (in general <span class="math inline">\(\alpha=0.05\)</span>) can reject the null of a true effect <span class="math inline">\(\beta_A\)</span> in a pre-specified proportion of samples <span class="math inline">\(\kappa\)</span> (in general <span class="math inline">\(\kappa=0.8\)</span>).
<span class="math inline">\(\kappa\)</span> is called the <strong>power</strong> of the test and <span class="math inline">\(\beta_A\)</span> the <strong>Minimum Detectable Effect</strong> (MDE).
Let’s define these quantities more formally:
Here, we first define power, then minimum detectable effect then the minimum required sample size.</p>
<div id="power" class="section level3 hasAnchor" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Power<a href="Power.html#power" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="definition">
<p><span id="def:power" class="definition"><strong>Definition 7.1  (Power) </strong></span>Power <span class="math inline">\(\kappa\)</span> is the probability of rejecting the null hypothesis of a negative or null (for a one-sided test) or null (for a two-sided test) average treatment effect when the true effect is of at least <span class="math inline">\(\beta_A\)</span> applying a test of size <span class="math inline">\(\alpha\)</span> to an estimator <span class="math inline">\(\hat{E}\)</span> with a sample of size <span class="math inline">\(N\)</span>. <span class="math inline">\(\beta_A\)</span> is called the Minimum Detectable Effect (MDE).</p>
<ul>
<li>for a One-Sided Test: <span class="math inline">\(H_0\)</span>: <span class="math inline">\(E\leq0\)</span>  <span class="math inline">\(H_A\)</span>: <span class="math inline">\(E=\beta_A&gt;0\)</span></li>
<li>For a Two-Sided Test: <span class="math inline">\(H_0\)</span>: <span class="math inline">\(E=0\)</span>  <span class="math inline">\(H_A\)</span>: <span class="math inline">\(E=\beta_A\neq0\)</span></li>
</ul>
</div>
<p>Now, if we can assume that the distribution of our estimator <span class="math inline">\(\hat{E}\)</span> can be well approximated by a normal distribution (which is the case of most estimators we have seen so far) and that moreover they are <span class="math inline">\(\sqrt{N}\)</span>-consistent (that is that their variance is of the same magnitude as <span class="math inline">\(\sqrt{N}\)</span>), we can derive useful formulae for the power parameter, the MDE and the minimum sample size.
Let’s first state our assumption:</p>
<div class="hypothesis">
<p><span id="hyp:AsymNE" class="hypothesis"><strong>Hypothesis 7.1  (Asymptotically Normal Estimator) </strong></span>We assume that the estimator <span class="math inline">\(\hat{E}\)</span> is such that there exists a constant (independent of <span class="math inline">\(N\)</span>) <span class="math inline">\(C(\hat{E})\)</span> such that:</p>
<p><span class="math display">\[\begin{align*}
  \lim_{N\rightarrow\infty}\Pr\left(\frac{\hat{E}-E}{\sqrt{\var{\hat{E}}}}\leq u\right) &amp; = \Phi\left(u\right),
\end{align*}\]</span></p>
<p>with <span class="math inline">\(\var{\hat{E}}=\frac{C(\hat{E})}{N}\)</span>.</p>
</div>
<p>Equipped with Assumption <a href="Power.html#hyp:AsymNE">7.1</a>, we can now derive a closed-form formula for power <span class="math inline">\(\kappa\)</span>:</p>
<div class="theorem">
<p><span id="thm:PowerE" class="theorem"><strong>Theorem 7.1  (Power with an Asymptotically Normal Estimator) </strong></span>With <span class="math inline">\(\hat{E}\)</span> complying with Assumption <a href="Power.html#hyp:AsymNE">7.1</a>, and with <span class="math inline">\(\beta_A&gt;0\)</span>, we have:</p>
</div>
<ul>
<li>For a One-Sided Test: <span class="math inline">\(H_0\)</span>: <span class="math inline">\(E\leq0\)</span>  <span class="math inline">\(H_A\)</span>: <span class="math inline">\(E=\beta_A&gt;0\)</span></li>
</ul>
<p><span class="math display">\[\begin{align*}
  \kappa_{\text{oneside}} &amp; = \Phi\left(\frac{\beta_A}{\sqrt{\var{\hat{E}}}}-\Phi^{-1}\left(1-\alpha\right)\right),
\end{align*}\]</span></p>
<ul>
<li>For a Two-Sided Test: <span class="math inline">\(H_0\)</span>: <span class="math inline">\(E=0\)</span>  <span class="math inline">\(H_A\)</span>: <span class="math inline">\(E=\beta_A\neq0\)</span></li>
</ul>
<p><span class="math display">\[\begin{align*}
  \kappa_{\text{twoside}} &amp; \approx \Phi\left(\frac{\beta_A}{\sqrt{\var{\hat{E}}}}-\Phi^{-1}\left(1-\frac{\alpha}{2}\right)\right).
\end{align*}\]</span></p>
<div class="proof">
<p><span id="unlabeled-div-194" class="proof"><em>Proof</em>. </span>Let us start with a one-sided test first.
We want to build a test statistic <span class="math inline">\(t\)</span> such that, under <span class="math inline">\(H_0\)</span>, <span class="math inline">\(\Pr(\hat{E}\geq t)=\alpha\)</span>.
Under <span class="math inline">\(H_0\)</span> and using Assumption <a href="Power.html#hyp:AsymNE">7.1</a>, we have:</p>
<p><span class="math display">\[\begin{align*}
 \Pr(\hat{E}\geq t) &amp; = \Pr\left(\frac{\hat{E}-0}{\sqrt{\var{\hat{E}}}}\geq\frac{t-0}{\sqrt{\var{\hat{E}}}}\right) 
                      \approx 1-\Phi\left(\frac{t}{\sqrt{\var{\hat{E}}}}\right) 
\end{align*}\]</span></p>
<p>As a consequence of <span class="math inline">\(\Pr(\hat{E}\geq t)=\alpha\)</span>, we have:</p>
<p><span class="math display">\[\begin{align*}    
 t &amp; \approx\Phi^{-1}\left(1-\alpha\right)\sqrt{\var{\hat{E}}}.
\end{align*}\]</span></p>
<p>Power is <span class="math inline">\(\Pr(\hat{E}\geq t)\)</span> under <span class="math inline">\(H_A\)</span>.
Using Assumption <a href="Power.html#hyp:AsymNE">7.1</a> again:</p>
<p><span class="math display">\[\begin{align*}
 \Pr(\hat{E}\geq t) &amp; = \Pr\left(\frac{\hat{E}-\beta_A}{\sqrt{\var{\hat{E}}}}\geq\frac{t-\beta_A}{\sqrt{\var{\hat{E}}}}\right)
                    \approx 1-\Phi\left(\frac{t-\beta_A}{\sqrt{\var{\hat{E}}}}\right) 
                    = \Phi\left(\frac{\beta_A-t}{\sqrt{\var{\hat{E}}}}\right),
\end{align*}\]</span></p>
<p>which proves the first part of the result.</p>
<p>With a two-sided test, we want a test statistic <span class="math inline">\(t\)</span> such that, under <span class="math inline">\(H_0\)</span>, <span class="math inline">\(\Pr(\hat{E}\leq -t\lor\hat{E}\geq t)=\alpha\)</span>.
Because the events are disjoint, under <span class="math inline">\(H_0\)</span> and using Assumption <a href="Power.html#hyp:AsymNE">7.1</a>, we have:</p>
<p><span class="math display">\[\begin{align*}
\Pr(\hat{E}\leq -t\lor\hat{E}\geq t) &amp; = \Pr(\hat{E}\leq -t) + \Pr(\hat{E}\geq t) \\
                                      &amp; = \Pr\left(\frac{\hat{E}-0}{\sqrt{\var{\hat{E}}}}\leq\frac{-t-0}{\sqrt{\var{\hat{E}}}}\right)+ \Pr\left(\frac{\hat{E}-0}{\sqrt{\var{\hat{E}}}}\geq\frac{t-0}{\sqrt{\var{\hat{E}}}}\right) \\
                                      &amp; \approx \Phi\left(-\frac{t}{\sqrt{\var{\hat{E}}}}\right) + 1-\Phi\left(\frac{t}{\sqrt{\var{\hat{E}}}}\right)\\
                                      &amp; = 2\left(1-\Phi\left(\frac{t}{\sqrt{\var{\hat{E}}}}\right)\right), 
\end{align*}\]</span></p>
<p>where the last equality uses the symmetry of the normal distribution.
As a consequence of <span class="math inline">\(\Pr(\hat{E}\leq -t\lor\hat{E}\geq t)=\alpha\)</span>, we have:</p>
<p><span class="math display">\[\begin{align*}    
 t &amp; \approx\Phi^{-1}\left(1-\frac{\alpha}{2}\right)\sqrt{\var{\hat{E}}}.
\end{align*}\]</span></p>
<p>Power is <span class="math inline">\(\Pr(\hat{E}\leq -t\lor\hat{E}\geq t)\)</span> under <span class="math inline">\(H_A\)</span>.
Using Assumption <a href="Power.html#hyp:AsymNE">7.1</a> and the fact that the two events are disjoint again:</p>
<p><span class="math display">\[\begin{align*}
\Pr(\hat{E}\leq -t\lor\hat{E}\geq t)  &amp; = \Pr(\hat{E}\leq -t) + \Pr(\hat{E}\geq t) \\
                                      &amp; = \Pr\left(\frac{\hat{E}-\beta_A}{\sqrt{\var{\hat{E}}}}\leq\frac{-t-\beta_A}{\sqrt{\var{\hat{E}}}}\right)
                                        + \Pr\left(\frac{\hat{E}-\beta_A}{\sqrt{\var{\hat{E}}}}\geq\frac{t-\beta_A}{\sqrt{\var{\hat{E}}}}\right) \\
                                      &amp; \approx \Phi\left(\frac{-t-\beta_A}{\sqrt{\var{\hat{E}}}}\right) 
                                        +  \Phi\left(\frac{t-\beta_A}{\sqrt{\var{\hat{E}}}}\right). 
\end{align*}\]</span></p>
<p>When <span class="math inline">\(\beta_A\)</span> is positive, the first part of the power formula is negligible with respect to the second part.
Hence the result.</p>
</div>
<div class="example">
<p><span id="exm:unnamed-chunk-334" class="example"><strong>Example 7.1  </strong></span>Let us see how these notions work in our example.</p>
</div>
<p>Let us first write functions to compute the power according to Theorem <a href="Power.html#thm:PowerE">7.1</a>:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="Power.html#cb299-1" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="cf">function</span>(betaA,alpha,varE){</span>
<span id="cb299-2"><a href="Power.html#cb299-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">pnorm</span>(betaA<span class="sc">/</span><span class="fu">sqrt</span>(varE)<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)))</span>
<span id="cb299-3"><a href="Power.html#cb299-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb299-4"><a href="Power.html#cb299-4" aria-hidden="true" tabindex="-1"></a>power.twoside <span class="ot">&lt;-</span> <span class="cf">function</span>(betaA,alpha,varE){</span>
<span id="cb299-5"><a href="Power.html#cb299-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">pnorm</span>(<span class="sc">-</span>betaA<span class="sc">/</span><span class="fu">sqrt</span>(varE)<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>))<span class="sc">+</span><span class="fu">pnorm</span>(betaA<span class="sc">/</span><span class="fu">sqrt</span>(varE)<span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)))</span>
<span id="cb299-6"><a href="Power.html#cb299-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let us now choose values for the parameters.
For the variance, we are going to choose the Monte Carlo estimate of the variance of the WW estimator in a Brute Force design that we have studied in Chapter <a href="RCT.html#RCT">3</a> and <span class="math inline">\(\beta_A=0.2\)</span>.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="Power.html#cb300-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>)</span>
<span id="cb300-2"><a href="Power.html#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;theta&quot;</span>,<span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,<span class="st">&quot;delta&quot;</span>,<span class="st">&quot;baralpha&quot;</span>)</span>
<span id="cb300-3"><a href="Power.html#cb300-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb300-4"><a href="Power.html#cb300-4" aria-hidden="true" tabindex="-1"></a>betaA <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb300-5"><a href="Power.html#cb300-5" aria-hidden="true" tabindex="-1"></a>varE <span class="ot">&lt;-</span> <span class="fu">var</span>(simuls.brute.force.ww[[<span class="st">&#39;1000&#39;</span>]][,<span class="st">&#39;WW&#39;</span>])</span></code></pre></div>
<p>Let us first plot the distributions under the null and under the alternative hypothesis:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="Power.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(simuls.brute.force.ww[[<span class="st">&#39;1000&#39;</span>]][,<span class="st">&#39;WW&#39;</span>]<span class="sc">-</span><span class="fu">delta.y.ate</span>(param)<span class="sc">+</span>betaA,<span class="at">breaks=</span><span class="dv">30</span>,<span class="at">main=</span><span class="st">&#39;N=1000&#39;</span>,<span class="at">xlab=</span><span class="fu">expression</span>(<span class="fu">hat</span>(Delta<span class="sc">^</span>yWW)),<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.15</span>,<span class="fl">0.55</span>),<span class="at">probability=</span>T)</span>
<span id="cb301-2"><a href="Power.html#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span>betaA, <span class="at">sd=</span><span class="fu">sqrt</span>(varE)),<span class="at">col=</span><span class="st">&quot;darkblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb301-3"><a href="Power.html#cb301-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(varE)),<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb301-4"><a href="Power.html#cb301-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>betaA,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb301-5"><a href="Power.html#cb301-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb301-6"><a href="Power.html#cb301-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="at">col=</span><span class="st">&quot;green&quot;</span>,<span class="at">lty=</span>lty.unobs)</span>
<span id="cb301-7"><a href="Power.html#cb301-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="at">col=</span><span class="st">&quot;green&quot;</span>,<span class="at">lty=</span>lty.unobs)</span>
<span id="cb301-8"><a href="Power.html#cb301-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>,<span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb301-9"><a href="Power.html#cb301-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(varE)),<span class="at">y=</span><span class="fu">c</span>(adj<span class="sc">+</span><span class="dv">3</span>,adj<span class="sc">+</span><span class="dv">4</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&#39;t_oneside&#39;</span>,<span class="st">&#39;t_twoside&#39;</span>),<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;green&#39;</span>,<span class="st">&#39;green&#39;</span>),<span class="at">lty=</span><span class="fu">c</span>(lty.obs,lty.unobs))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PowerPlot"></span>
<img src="STCI_files/figure-html/PowerPlot-1.png" alt="Power with $\beta_A=0.2$" width="65%" />
<p class="caption">
Figure 7.1: Power with <span class="math inline">\(\beta_A=0.2\)</span>
</p>
</div>
<p>Figure <a href="Power.html#fig:PowerPlot">7.1</a> shows the distribution of <span class="math inline">\(\hat{E}\)</span> under the null in green and the distribution under the alternativein blue.
In black is the distribution stemming from the Monte Carlo simulations recentered at <span class="math inline">\(\beta_A=0.2\)</span>.
All of these distributions have the same shape (they are normal with variance 0.003) and differ only by their mean.</p>
<p>Under the null of no effect, <span class="math inline">\(\hat{E}\)</span> would be distributed as the green curve, centered at <span class="math inline">\(0\)</span>.
The green continuous vertical line materializes the threshold <span class="math inline">\(t_{\text{oneside}}=\Phi^{-1}\left(1-\alpha\right)\sqrt{\var{\hat{E}}}\)</span> of the one-sided test (as defined in the proof of Theorem <a href="Power.html#fig:PowerPlot">7.1</a>).
The green discontinuous vertical lines materialize the thresholds <span class="math inline">\(t_{\text{twoside}}=\pm\Phi^{-1}\left(1-\frac{\alpha}{2}\right)\sqrt{\var{\hat{E}}}\)</span> of the two-sided test (as defined in the proof of Theorem <a href="Power.html#fig:PowerPlot">7.1</a>).</p>
<p>We are more accustomed to seeing these thresholds standardized by <span class="math inline">\(\sqrt{\var{\hat{E}}}\)</span>.
I find it simpler to visualize their nonstandardized versions.
It enables to position the test statistics on the actual distribution of <span class="math inline">\(\hat{E}\)</span> and to compare their values with the values of the parameter estimates.
Note that you can easily go back between the classical standardized thresholds for the test statistics and the nonstandardized ones by dividing and multiplying by <span class="math inline">\(\sqrt{\var{\hat{E}}}\)</span>.
As a result, we find that the standardized threshold for the one sided test, <span class="math inline">\(\frac{t_{\text{oneside}}}{\sqrt{\var{\hat{E}}}}=\Phi^{-1}\left(1-\alpha\right)\)</span>, is equal to 1.64, for <span class="math inline">\(\alpha=\)</span> 0.05.
For the two-sided test, the absolute value of the standardized threshold is equal to <span class="math inline">\(\left|\frac{t_{\text{twoside}}}{\sqrt{\var{\hat{E}}}}\right|=\Phi^{-1}\left(1-\frac{\alpha}{2}\right)\)</span>, which is equal to 1.96, for <span class="math inline">\(\alpha=\)</span> 0.05.
You probably already know these threshold values, especially the second one, as the classical threshold for 5% statistical significance in t-tests for the null of an estimated parameter being zero.</p>
<p>What we are doing here is express the thresholds of the test statistics as multiples of the standard error of the estimated parameter.
For a one-sided test, we consider as statistically significant an estimated effect that is 1.64 times larger than its standard error, and for a two-sided test, an estimated effect whose larger in absolute value than 1.96 its standard error.
Because the distribution of <span class="math inline">\(\hat{E}\)</span> is normal, under Assumption <a href="Power.html#hyp:AsymNE">7.1</a>, the probability that the value of <span class="math inline">\(\hat{E}\)</span> falls above these thresholds under the null is equal to <span class="math inline">\(\alpha=\)</span> 0.05.
More precisely, for the one sided test, the probability that <span class="math inline">\(\hat{E}\)</span> falls above <span class="math inline">\(t_{\text{oneside}}\)</span> under the null is 5%.
For the two-sided test, it is the probability that <span class="math inline">\(\hat{E}\)</span> falls above <span class="math inline">\(t_{\text{twoside}}\)</span> or below <span class="math inline">\(-t_{\text{twoside}}\)</span> under the null that is equal to 5%.
Or, stated otherwise, it is the probability that <span class="math inline">\(|\hat{E}|&gt;t_{\text{twoside}}\)</span> which is equal to 5% under the null for the two-sided test.
In practice, with our current choice of parameter values (especially the variance of <span class="math inline">\(\hat{E}\)</span>), we have <span class="math inline">\(t_{\text{oneside}}=\)</span> 0.09 and <span class="math inline">\(t_{\text{twoside}}=\)</span> 0.11.<br />
If the estimated treatment effect falls above these threshold values, a one-sided and a two-sided test respectively will find that these effects are statistically significantly different from zero at 5%.</p>
<p>Power computation does not stop there.
It asks the following question: if the true value of <span class="math inline">\(E\)</span> is actually <span class="math inline">\(E=\beta_A\)</span>, what is the probability that our estimator <span class="math inline">\(\hat{E}\)</span> will fall above <span class="math inline">\(t_{\text{oneside}}\)</span> or <span class="math inline">\(t_{\text{twoside}}\)</span>?</p>
<p>Before going further, note that if <span class="math inline">\(\beta_A&gt;0\)</span> and <span class="math inline">\(\var{\hat{E}}\)</span> is not too large, the probability that <span class="math inline">\(\hat{E}\)</span> falls below <span class="math inline">\(-t_{\text{twoside}}\)</span> under the alternative hypothesis is negligible.
It is materialized on Figure <a href="Power.html#fig:PowerPlot">7.1</a> as the area under the the portion of the blue curve below the lower discontinuous vertical green line positioned at <span class="math inline">\(-t_{\text{twoside}}=\)</span> -0.11.
It is obviously very small.
We know from Assumption <a href="Power.html#hyp:AsymNE">7.1</a> that this probability is equal to <span class="math inline">\(\Pr(\hat{E}\leq -t_{\text{twoside}})=\Phi\left(\frac{-t_{\text{twoside}}-\beta_A}{\sqrt{\var{\hat{E}}}}\right)=\)</span> 1.2224593^{-8}.</p>
<p>So now, what is the probability that <span class="math inline">\(\hat{E}\)</span> falls above <span class="math inline">\(t_{\text{oneside}}\)</span> or <span class="math inline">\(t_{\text{twoside}}\)</span> under the assumption that <span class="math inline">\(E=\beta_A&gt;0\)</span>?
Intuitively, it is the area under the portion of the blue curve which is above the continuous green vertical line positioned at <span class="math inline">\(t_{\text{oneside}}=\)</span> 0.09 or above the discontinuous green vertical line positioned at <span class="math inline">\(t_{\text{twoside}}=\)</span> 0.11.
Because we know that <span class="math inline">\(\hat{E}\)</span> follows a normal with mean <span class="math inline">\(\beta_A\)</span> and variance <span class="math inline">\(\var{\hat{E}}\)</span> under the alternative, we can compute these quantities as equal to <span class="math inline">\(\kappa_{t}=1-\Phi\left(\frac{t-\beta_A}{\sqrt{\var{\hat{E}}}}\right)=\Phi\left(\frac{\beta_A-t}{\sqrt{\var{\hat{E}}}}\right)\)</span>, for <span class="math inline">\(t\in\left\{\text{oneside},\text{twoside}\right\}\)</span>.
Note that using the formulae for <span class="math inline">\(t_{\text{oneside}}\)</span> and <span class="math inline">\(t_{\text{twoside}}\)</span> yields the results in Theorem <a href="Power.html#thm:PowerE">7.1</a>.
In practice, we have <span class="math inline">\(\kappa_{\text{oneside}}=\)</span> 0.98 and <span class="math inline">\(\kappa_{\text{twoside}}=\)</span> 0.95.</p>
<p>What would happen to power if <span class="math inline">\(\beta_A\)</span> was lower?
For example, what if <span class="math inline">\(\beta_A=0.1\)</span>?</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="Power.html#cb302-1" aria-hidden="true" tabindex="-1"></a>betaA <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb302-2"><a href="Power.html#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(simuls.brute.force.ww[[<span class="st">&#39;1000&#39;</span>]][,<span class="st">&#39;WW&#39;</span>]<span class="sc">-</span><span class="fu">delta.y.ate</span>(param)<span class="sc">+</span>betaA,<span class="at">breaks=</span><span class="dv">30</span>,<span class="at">main=</span><span class="st">&#39;N=1000&#39;</span>,<span class="at">xlab=</span><span class="fu">expression</span>(<span class="fu">hat</span>(Delta<span class="sc">^</span>yWW)),<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.15</span>,<span class="fl">0.55</span>),<span class="at">probability=</span>T)</span>
<span id="cb302-3"><a href="Power.html#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span>betaA, <span class="at">sd=</span><span class="fu">sqrt</span>(varE)),<span class="at">col=</span><span class="st">&quot;darkblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb302-4"><a href="Power.html#cb302-4" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(varE)),<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb302-5"><a href="Power.html#cb302-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>betaA,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb302-6"><a href="Power.html#cb302-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb302-7"><a href="Power.html#cb302-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="at">col=</span><span class="st">&quot;green&quot;</span>,<span class="at">lty=</span>lty.unobs)</span>
<span id="cb302-8"><a href="Power.html#cb302-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="at">col=</span><span class="st">&quot;green&quot;</span>,<span class="at">lty=</span>lty.unobs)</span>
<span id="cb302-9"><a href="Power.html#cb302-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>,<span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb302-10"><a href="Power.html#cb302-10" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(varE)),<span class="at">y=</span><span class="fu">c</span>(adj<span class="sc">+</span><span class="dv">3</span>,adj<span class="sc">+</span><span class="dv">4</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&#39;t_oneside&#39;</span>,<span class="st">&#39;t_twoside&#39;</span>),<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;green&#39;</span>,<span class="st">&#39;green&#39;</span>),<span class="at">lty=</span><span class="fu">c</span>(lty.obs,lty.unobs))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PowerPlot01"></span>
<img src="STCI_files/figure-html/PowerPlot01-1.png" alt="Power with $\beta_A=0.1$" width="65%" />
<p class="caption">
Figure 7.2: Power with <span class="math inline">\(\beta_A=0.1\)</span>
</p>
</div>
<p>Figure <a href="Power.html#fig:PowerPlot01">7.2</a> shows what would happen with <span class="math inline">\(\beta_A=0.1\)</span>.
It becomes much harder to tell the green curve from the blue curve.
As a consequence, power decreases, since the portion of the blue curve located below the thresholds increases.
It is a consequence less likely that a t-test will reject the assumption that the treatment effect is zero, even when it is not zero but equal to <span class="math inline">\(0.1\)</span>.
How less likely?
Well, power is now equal to <span class="math inline">\(\kappa_{\text{oneside}}=\)</span> 0.57 and <span class="math inline">\(\kappa_{\text{twoside}}=\)</span> 0.44.</p>
<p>What would happen now if our estimator was way more precise?
For example, what would happen if we could reach the precision of the With/Without estimator with a sample size of <span class="math inline">\(N=10000\)</span> instead of <span class="math inline">\(N=1000\)</span> as we have assumed up to now?</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="Power.html#cb303-1" aria-hidden="true" tabindex="-1"></a>betaA <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb303-2"><a href="Power.html#cb303-2" aria-hidden="true" tabindex="-1"></a>varE<span class="fl">.10000</span> <span class="ot">&lt;-</span> <span class="fu">var</span>(simuls.brute.force.ww[[<span class="st">&#39;10000&#39;</span>]][,<span class="st">&#39;WW&#39;</span>])</span>
<span id="cb303-3"><a href="Power.html#cb303-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-4"><a href="Power.html#cb303-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(simuls.brute.force.ww[[<span class="st">&#39;10000&#39;</span>]][,<span class="st">&#39;WW&#39;</span>]<span class="sc">-</span><span class="fu">delta.y.ate</span>(param)<span class="sc">+</span>betaA,<span class="at">breaks=</span><span class="dv">30</span>,<span class="at">main=</span><span class="st">&#39;N=10000&#39;</span>,<span class="at">xlab=</span><span class="fu">expression</span>(<span class="fu">hat</span>(Delta<span class="sc">^</span>yWW)),<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.15</span>,<span class="fl">0.55</span>),<span class="at">probability=</span>T)</span>
<span id="cb303-5"><a href="Power.html#cb303-5" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span>betaA, <span class="at">sd=</span><span class="fu">sqrt</span>(varE)),<span class="at">col=</span><span class="st">&quot;darkblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb303-6"><a href="Power.html#cb303-6" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span>betaA, <span class="at">sd=</span><span class="fu">sqrt</span>(varE<span class="fl">.10000</span>)),<span class="at">col=</span><span class="st">&quot;darkblue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb303-7"><a href="Power.html#cb303-7" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(varE)),<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb303-8"><a href="Power.html#cb303-8" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(varE<span class="fl">.10000</span>)),<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb303-9"><a href="Power.html#cb303-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>betaA,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb303-10"><a href="Power.html#cb303-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb303-11"><a href="Power.html#cb303-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="at">col=</span><span class="st">&quot;green&quot;</span>,<span class="at">lty=</span>lty.unobs)</span>
<span id="cb303-12"><a href="Power.html#cb303-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="at">col=</span><span class="st">&quot;green&quot;</span>,<span class="at">lty=</span>lty.unobs)</span>
<span id="cb303-13"><a href="Power.html#cb303-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="fu">sqrt</span>(varE<span class="fl">.10000</span>),<span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb303-14"><a href="Power.html#cb303-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(varE<span class="fl">.10000</span>),<span class="at">col=</span><span class="st">&quot;green&quot;</span>,<span class="at">lty=</span>lty.unobs)</span>
<span id="cb303-15"><a href="Power.html#cb303-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="sc">-</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(varE<span class="fl">.10000</span>),<span class="at">col=</span><span class="st">&quot;green&quot;</span>,<span class="at">lty=</span>lty.unobs)</span>
<span id="cb303-16"><a href="Power.html#cb303-16" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>,<span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb303-17"><a href="Power.html#cb303-17" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="fu">sqrt</span>(varE),<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(varE)),<span class="at">y=</span><span class="fu">c</span>(adj<span class="sc">+</span><span class="dv">3</span>,adj<span class="sc">+</span><span class="dv">4</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&#39;t_oneside&#39;</span>,<span class="st">&#39;t_twoside&#39;</span>),<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;green&#39;</span>,<span class="st">&#39;green&#39;</span>),<span class="at">lty=</span><span class="fu">c</span>(lty.obs,lty.unobs))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PowerPlot10000"></span>
<img src="STCI_files/figure-html/PowerPlot10000-1.png" alt="Power with $N=10000$" width="65%" />
<p class="caption">
Figure 7.3: Power with <span class="math inline">\(N=10000\)</span>
</p>
</div>
<p>Figure <a href="Power.html#fig:PowerPlot10000">7.3</a> shows what would happen with <span class="math inline">\(\beta_A=0.2\)</span> and <span class="math inline">\(N=10000\)</span>.
There are two effects of increased precision on power.
First, the blue curve is thinner, which means that less of its area lies before the thresholds of the test statisics.
Second, the green curve is also thinner, which means that the threshold are smaller.
With <span class="math inline">\(N=10000\)</span>, <span class="math inline">\(t_{\text{oneside}}=\)</span> 0.029 and <span class="math inline">\(t_{\text{twoside}}=\)</span> 0.034.<br />
As a consequence, power increases sharply with <span class="math inline">\(N=10000\)</span>.
For <span class="math inline">\(\beta_A=0.2\)</span>, power is now <span class="math inline">\(\kappa_{\text{oneside}}=\)</span> 1 and <span class="math inline">\(\kappa_{\text{twoside}}=\)</span> 1.
For <span class="math inline">\(\beta_A=0.1\)</span>, power is now <span class="math inline">\(\kappa_{\text{oneside}}=\)</span> 1 and <span class="math inline">\(\kappa_{\text{twoside}}=\)</span> 1.</p>
<p>Finally, let us see how power changes with <span class="math inline">\(\var{\hat{E}}\)</span> (through sample size), <span class="math inline">\(\beta_A\)</span> and <span class="math inline">\(\alpha\)</span>.
Let us first run some simulations:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="Power.html#cb304-1" aria-hidden="true" tabindex="-1"></a>varE.N <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">var</span>(simuls.brute.force.ww[[<span class="st">&#39;100&#39;</span>]][,<span class="st">&#39;WW&#39;</span>]),<span class="fu">var</span>(simuls.brute.force.ww[[<span class="st">&#39;1000&#39;</span>]][,<span class="st">&#39;WW&#39;</span>]),<span class="fu">var</span>(simuls.brute.force.ww[[<span class="st">&#39;10000&#39;</span>]][,<span class="st">&#39;WW&#39;</span>]),<span class="fu">var</span>(simuls.brute.force.ww[[<span class="dv">4</span>]][,<span class="st">&#39;WW&#39;</span>]))</span>
<span id="cb304-2"><a href="Power.html#cb304-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-3"><a href="Power.html#cb304-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb304-4"><a href="Power.html#cb304-4" aria-hidden="true" tabindex="-1"></a>betaA <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb304-5"><a href="Power.html#cb304-5" aria-hidden="true" tabindex="-1"></a>power.N.<span class="fl">05.02</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(varE.N,power,<span class="at">alpha=</span>alpha,<span class="at">betaA=</span>betaA)</span>
<span id="cb304-6"><a href="Power.html#cb304-6" aria-hidden="true" tabindex="-1"></a>power.N.twoside.<span class="fl">05.02</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(varE.N,power.twoside,<span class="at">alpha=</span>alpha,<span class="at">betaA=</span>betaA)</span>
<span id="cb304-7"><a href="Power.html#cb304-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-8"><a href="Power.html#cb304-8" aria-hidden="true" tabindex="-1"></a>betaA <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb304-9"><a href="Power.html#cb304-9" aria-hidden="true" tabindex="-1"></a>power.N.<span class="fl">05.01</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(varE.N,power,<span class="at">alpha=</span>alpha,<span class="at">betaA=</span>betaA)</span>
<span id="cb304-10"><a href="Power.html#cb304-10" aria-hidden="true" tabindex="-1"></a>power.N.twoside.<span class="fl">05.01</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(varE.N,power.twoside,<span class="at">alpha=</span>alpha,<span class="at">betaA=</span>betaA)</span>
<span id="cb304-11"><a href="Power.html#cb304-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-12"><a href="Power.html#cb304-12" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb304-13"><a href="Power.html#cb304-13" aria-hidden="true" tabindex="-1"></a>power.N.<span class="fl">01.01</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(varE.N,power,<span class="at">alpha=</span>alpha,<span class="at">betaA=</span>betaA)</span>
<span id="cb304-14"><a href="Power.html#cb304-14" aria-hidden="true" tabindex="-1"></a>power.N.twoside.<span class="fl">01.01</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(varE.N,power.twoside,<span class="at">alpha=</span>alpha,<span class="at">betaA=</span>betaA)</span>
<span id="cb304-15"><a href="Power.html#cb304-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-16"><a href="Power.html#cb304-16" aria-hidden="true" tabindex="-1"></a>betaA <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb304-17"><a href="Power.html#cb304-17" aria-hidden="true" tabindex="-1"></a>power.N.<span class="fl">01.02</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(varE.N,power,<span class="at">alpha=</span>alpha,<span class="at">betaA=</span>betaA)</span>
<span id="cb304-18"><a href="Power.html#cb304-18" aria-hidden="true" tabindex="-1"></a>power.N.twoside.<span class="fl">01.02</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(varE.N,power.twoside,<span class="at">alpha=</span>alpha,<span class="at">betaA=</span>betaA)</span>
<span id="cb304-19"><a href="Power.html#cb304-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-20"><a href="Power.html#cb304-20" aria-hidden="true" tabindex="-1"></a>N.sample <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">1000</span>,<span class="dv">10000</span>,<span class="dv">100000</span>)</span>
<span id="cb304-21"><a href="Power.html#cb304-21" aria-hidden="true" tabindex="-1"></a>power.sample <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;N&quot;</span><span class="ot">=</span><span class="fu">rep</span>(N.sample,<span class="dv">8</span>),<span class="st">&quot;Power&quot;</span><span class="ot">=</span><span class="fu">c</span>(power.N.<span class="fl">05.02</span>,power.N.twoside.<span class="fl">05.02</span>,power.N.<span class="fl">05.01</span>,power.N.twoside.<span class="fl">05.01</span>,power.N.<span class="fl">01.01</span>,power.N.twoside.<span class="fl">01.01</span>,power.N.<span class="fl">01.02</span>,power.N.twoside.<span class="fl">01.02</span>))</span>
<span id="cb304-22"><a href="Power.html#cb304-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(power.sample) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;N&#39;</span>,<span class="st">&#39;Power&#39;</span>)</span>
<span id="cb304-23"><a href="Power.html#cb304-23" aria-hidden="true" tabindex="-1"></a>power.sample<span class="sc">$</span>Test <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&#39;One-sided&#39;</span>,<span class="fu">length</span>(N.sample)),<span class="fu">rep</span>(<span class="st">&#39;Two-sided&#39;</span>,<span class="fu">length</span>(N.sample))),<span class="dv">4</span>)</span>
<span id="cb304-24"><a href="Power.html#cb304-24" aria-hidden="true" tabindex="-1"></a>power.sample<span class="sc">$</span>betaA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">0.2</span>,<span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(N.sample)),<span class="fu">rep</span>(<span class="fl">0.1</span>,<span class="dv">4</span><span class="sc">*</span><span class="fu">length</span>(N.sample)),<span class="fu">rep</span>(<span class="fl">0.2</span>,<span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(N.sample)))</span>
<span id="cb304-25"><a href="Power.html#cb304-25" aria-hidden="true" tabindex="-1"></a>power.sample<span class="sc">$</span>alpha <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">0.05</span>,<span class="dv">4</span><span class="sc">*</span><span class="fu">length</span>(N.sample)),<span class="fu">rep</span>(<span class="fl">0.01</span>,<span class="dv">4</span><span class="sc">*</span><span class="fu">length</span>(N.sample)))</span></code></pre></div>
<p>Let us now plot the resulting estimates:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="Power.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(power.sample, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.factor</span>(N), <span class="at">y=</span>Power, <span class="at">fill=</span>Test)) <span class="sc">+</span></span>
<span id="cb305-2"><a href="Power.html#cb305-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb305-3"><a href="Power.html#cb305-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Sample Size&quot;</span>) <span class="sc">+</span></span>
<span id="cb305-4"><a href="Power.html#cb305-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb305-5"><a href="Power.html#cb305-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(betaA<span class="sc">~</span>alpha)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PowerPlotFull"></span>
<img src="STCI_files/figure-html/PowerPlotFull-1.png" alt="Power and Sample Size as a function of $\alpha$ (left vs right) and $\beta_A$ (top vs bottom)" width="65%" />
<p class="caption">
Figure 7.4: Power and Sample Size as a function of <span class="math inline">\(\alpha\)</span> (left vs right) and <span class="math inline">\(\beta_A\)</span> (top vs bottom)
</p>
</div>
<p>Figure <a href="Power.html#fig:PowerPlotFull">7.4</a> shows that sample size is a key determinant of power, but that <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta_A\)</span> are as well.
For example, with <span class="math inline">\(\beta_A=0.1\)</span> and <span class="math inline">\(\alpha=0.01\)</span>, <span class="math inline">\(N=1000\)</span> has low power (around <span class="math inline">\(0.25\)</span>).
Moving to sample size <span class="math inline">\(N=10000\)</span> would ensure very effective power, but let us keep <span class="math inline">\(N=1000\)</span> for now.
We can see that simply increasing <span class="math inline">\(\alpha\)</span> to <span class="math inline">\(0.05\)</span> increases power to around <span class="math inline">\(0.5\)</span>.
But it is increasing <span class="math inline">\(\beta_A\)</span> to <span class="math inline">\(0.2\)</span> that has the strongest effect: power is now around <span class="math inline">\(0.9\)</span>, whatever <span class="math inline">\(\alpha\)</span>.
As a consequence, choosing <span class="math inline">\(\beta_A\)</span> correctly is key to ensure a correct power analysis.</p>
</div>
<div id="minimum-detectable-effect" class="section level3 hasAnchor" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Minimum Detectable Effect<a href="Power.html#minimum-detectable-effect" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In general power analysis does not stop after computing power.
We also might want to compute the Minimum Detectable Effect (or MDE) that we can detect with a sample of size <span class="math inline">\(N\)</span> and a (one- or two-sided) test of size <span class="math inline">\(\alpha\)</span> with power <span class="math inline">\(\kappa\)</span>.
The following theorem enables us to do just that:</p>
<div class="theorem">
<p><span id="thm:MDE" class="theorem"><strong>Theorem 7.2  (Minimum Detectable Effect with an Asymptotically Normal Estimator) </strong></span>With <span class="math inline">\(\hat{E}\)</span> complying with Assumption <a href="Power.html#hyp:AsymNE">7.1</a>, the Minimum Detectable Effect of a one- or two-sided test is:</p>
</div>
<ul>
<li>For a One-Sided Test: <span class="math inline">\(H_0\)</span>: <span class="math inline">\(E\leq0\)</span>  <span class="math inline">\(H_A\)</span>: <span class="math inline">\(E=\beta_A&gt;0\)</span></li>
</ul>
<p><span class="math display">\[\begin{align*}
  \beta_A^{\text{oneside}} &amp; = \left(\Phi^{-1}\left(\kappa\right)+\Phi^{-1}\left(1-\alpha\right)\right)\sqrt{\var{\hat{E}}},
\end{align*}\]</span></p>
<ul>
<li>For a Two-Sided Test: <span class="math inline">\(H_0\)</span>: <span class="math inline">\(E=0\)</span>  <span class="math inline">\(H_A\)</span>: <span class="math inline">\(E=\beta_A\neq0\)</span></li>
</ul>
<p><span class="math display">\[\begin{align*}
  \beta_A^{\text{twoside}} &amp; \approx \left(\Phi^{-1}\left(\kappa\right)+\Phi^{-1}\left(1-\frac{\alpha}{2}\right)\right)\sqrt{\var{\hat{E}}}.
\end{align*}\]</span></p>
<div class="proof">
<p><span id="unlabeled-div-195" class="proof"><em>Proof</em>. </span>Using Theorem <a href="Power.html#thm:PowerE">7.1</a>, inverting the power formula yields the result.</p>
</div>
<p>With Theorem <a href="Power.html#thm:MDE">7.2</a>, we have a way to compute the MDE for a wide range of applications, as long as we know <span class="math inline">\(\var{\hat{E}}\)</span> and that we have choosen properly <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\kappa\)</span>.
In most applications, researchers choose <span class="math inline">\(\alpha=0.05\)</span> and <span class="math inline">\(\kappa=0.8\)</span>, so that they compute the effect that they have 80% chance to detect with a test of size 5%.</p>
<div class="example">
<p><span id="exm:unnamed-chunk-336" class="example"><strong>Example 7.2  </strong></span>In our example, we can try to see what the MDE looks for various sample sizes.
Let us first write functions to compute the MDE:</p>
</div>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="Power.html#cb306-1" aria-hidden="true" tabindex="-1"></a>MDE.var <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha,kappa,varE,oneside){</span>
<span id="cb306-2"><a href="Power.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (oneside<span class="sc">==</span><span class="cn">TRUE</span>){</span>
<span id="cb306-3"><a href="Power.html#cb306-3" aria-hidden="true" tabindex="-1"></a>    MDE <span class="ot">&lt;-</span> (<span class="fu">qnorm</span>(kappa)<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha))<span class="sc">*</span><span class="fu">sqrt</span>(varE)</span>
<span id="cb306-4"><a href="Power.html#cb306-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb306-5"><a href="Power.html#cb306-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (oneside<span class="sc">==</span><span class="cn">FALSE</span>){</span>
<span id="cb306-6"><a href="Power.html#cb306-6" aria-hidden="true" tabindex="-1"></a>    MDE <span class="ot">&lt;-</span> (<span class="fu">qnorm</span>(kappa)<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>))<span class="sc">*</span><span class="fu">sqrt</span>(varE)</span>
<span id="cb306-7"><a href="Power.html#cb306-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb306-8"><a href="Power.html#cb306-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(MDE)</span>
<span id="cb306-9"><a href="Power.html#cb306-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb306-10"><a href="Power.html#cb306-10" aria-hidden="true" tabindex="-1"></a>MDE <span class="ot">&lt;-</span> <span class="cf">function</span>(N,alpha,kappa,CE,oneside){</span>
<span id="cb306-11"><a href="Power.html#cb306-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (oneside<span class="sc">==</span><span class="cn">TRUE</span>){</span>
<span id="cb306-12"><a href="Power.html#cb306-12" aria-hidden="true" tabindex="-1"></a>    MDE <span class="ot">&lt;-</span> (<span class="fu">qnorm</span>(kappa)<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha))<span class="sc">*</span><span class="fu">sqrt</span>(CE<span class="sc">/</span>N)</span>
<span id="cb306-13"><a href="Power.html#cb306-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb306-14"><a href="Power.html#cb306-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (oneside<span class="sc">==</span><span class="cn">FALSE</span>){</span>
<span id="cb306-15"><a href="Power.html#cb306-15" aria-hidden="true" tabindex="-1"></a>    MDE <span class="ot">&lt;-</span> (<span class="fu">qnorm</span>(kappa)<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>))<span class="sc">*</span><span class="fu">sqrt</span>(CE<span class="sc">/</span>N)</span>
<span id="cb306-16"><a href="Power.html#cb306-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb306-17"><a href="Power.html#cb306-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(MDE)</span>
<span id="cb306-18"><a href="Power.html#cb306-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb306-19"><a href="Power.html#cb306-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-20"><a href="Power.html#cb306-20" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb306-21"><a href="Power.html#cb306-21" aria-hidden="true" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb306-22"><a href="Power.html#cb306-22" aria-hidden="true" tabindex="-1"></a>MDE.N.oneside <span class="ot">&lt;-</span> <span class="fu">sapply</span>(varE.N,MDE.var,<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">TRUE</span>)</span>
<span id="cb306-23"><a href="Power.html#cb306-23" aria-hidden="true" tabindex="-1"></a>MDE.N.twoside <span class="ot">&lt;-</span> <span class="fu">sapply</span>(varE.N,MDE.var,<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)</span>
<span id="cb306-24"><a href="Power.html#cb306-24" aria-hidden="true" tabindex="-1"></a>power.sample<span class="sc">$</span>MDE <span class="ot">&lt;-</span> <span class="fu">c</span>(MDE.N.oneside,MDE.N.twoside)</span></code></pre></div>
<p>Let us now plot the results:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="Power.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(power.sample, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.factor</span>(N), <span class="at">y=</span>MDE,<span class="at">fill=</span>Test)) <span class="sc">+</span></span>
<span id="cb307-2"><a href="Power.html#cb307-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb307-3"><a href="Power.html#cb307-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Sample Size&quot;</span>) <span class="sc">+</span></span>
<span id="cb307-4"><a href="Power.html#cb307-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PlotMDE"></span>
<img src="STCI_files/figure-html/PlotMDE-1.png" alt="MDE and Sample Size" width="65%" />
<p class="caption">
Figure 7.5: MDE and Sample Size
</p>
</div>
<p>Figure <a href="Power.html#fig:PlotMDE">7.5</a> shows that, with <span class="math inline">\(\alpha=\)</span> 0.05 and <span class="math inline">\(\kappa=\)</span> 0.8 and a two-sided test, we can detect a minimum effect of 0.5 with <span class="math inline">\(N=\)</span> 100, whereas the MDE decreases to 0.15 with <span class="math inline">\(N=\)</span> 1000 and even further to 0.05 with <span class="math inline">\(N=\)</span> 10^{4} and 0.02 with <span class="math inline">\(N=\)</span> 10^{5}.</p>
</div>
<div id="minimum-required-sample-size" class="section level3 hasAnchor" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> Minimum Required Sample Size<a href="Power.html#minimum-required-sample-size" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, we can also estimate the minimum sample size required to estimate an effect with given size and power.
The following theorem shows how:</p>
<div class="theorem">
<p><span id="thm:MDEN" class="theorem"><strong>Theorem 7.3  (Minimum Required Sample Size with an Asymptotically Normal Estimator) </strong></span>With <span class="math inline">\(\hat{E}\)</span> complying with Assumption <a href="Power.html#hyp:AsymNE">7.1</a>, the Minimum Required Sample Size to estimate an effect <span class="math inline">\(\beta_A\)</span> with a one- or two-sided test is:</p>
</div>
<ul>
<li>For a One-Sided Test: <span class="math inline">\(H_0\)</span>: <span class="math inline">\(E\leq0\)</span>  <span class="math inline">\(H_A\)</span>: <span class="math inline">\(E=\beta_A&gt;0\)</span></li>
</ul>
<p><span class="math display">\[\begin{align*}
  N_{\text{oneside}} &amp; = \left(\Phi^{-1}\left(\kappa\right)+\Phi^{-1}\left(1-\alpha\right)\right)^2\frac{C(\hat{E})}{\beta_A^2},
\end{align*}\]</span></p>
<ul>
<li>For a Two-Sided Test: <span class="math inline">\(H_0\)</span>: <span class="math inline">\(E=0\)</span>  <span class="math inline">\(H_A\)</span>: <span class="math inline">\(E=\beta_A\neq0\)</span></li>
</ul>
<p><span class="math display">\[\begin{align*}
  N_{\text{twoside}} &amp; = \left(\Phi^{-1}\left(\kappa\right)+\Phi^{-1}\left(1-\frac{\alpha}{2}\right)\right)^2\frac{C(\hat{E})}{\beta_A^2}.
\end{align*}\]</span></p>
<div class="proof">
<p><span id="unlabeled-div-196" class="proof"><em>Proof</em>. </span>Using Theorem <a href="Power.html#thm:MDE">7.2</a>, and inverting the formula for MDE yields the result.</p>
</div>
<div class="example">
<p><span id="exm:unnamed-chunk-338" class="example"><strong>Example 7.3  </strong></span>Let us see how this works in our example.
Let us first write a function to compute the required formulae and then set up <span class="math inline">\(C(\hat{E})\)</span> and finally the minimum reauired sample size for a given treatment effect:</p>
</div>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="Power.html#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># formula </span></span>
<span id="cb308-2"><a href="Power.html#cb308-2" aria-hidden="true" tabindex="-1"></a>sample.size <span class="ot">&lt;-</span> <span class="cf">function</span>(betaA,alpha,kappa,CE,oneside){</span>
<span id="cb308-3"><a href="Power.html#cb308-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (oneside<span class="sc">==</span><span class="cn">TRUE</span>){</span>
<span id="cb308-4"><a href="Power.html#cb308-4" aria-hidden="true" tabindex="-1"></a>    N <span class="ot">&lt;-</span> (<span class="fu">qnorm</span>(kappa)<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha))<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(CE<span class="sc">/</span>(betaA<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb308-5"><a href="Power.html#cb308-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb308-6"><a href="Power.html#cb308-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (oneside<span class="sc">==</span><span class="cn">FALSE</span>){</span>
<span id="cb308-7"><a href="Power.html#cb308-7" aria-hidden="true" tabindex="-1"></a>    N <span class="ot">&lt;-</span> (<span class="fu">qnorm</span>(kappa)<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>))<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(CE<span class="sc">/</span>(betaA<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb308-8"><a href="Power.html#cb308-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb308-9"><a href="Power.html#cb308-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">round</span>(N))</span>
<span id="cb308-10"><a href="Power.html#cb308-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb308-11"><a href="Power.html#cb308-11" aria-hidden="true" tabindex="-1"></a><span class="co"># C(E)</span></span>
<span id="cb308-12"><a href="Power.html#cb308-12" aria-hidden="true" tabindex="-1"></a>C.E.N <span class="ot">&lt;-</span> varE.N<span class="sc">*</span>N.sample</span>
<span id="cb308-13"><a href="Power.html#cb308-13" aria-hidden="true" tabindex="-1"></a><span class="co"># choose set of MDEs</span></span>
<span id="cb308-14"><a href="Power.html#cb308-14" aria-hidden="true" tabindex="-1"></a>MDE.set <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.5</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>,<span class="fl">0.02</span>)</span>
<span id="cb308-15"><a href="Power.html#cb308-15" aria-hidden="true" tabindex="-1"></a><span class="co"># compute set of MDEs for a given C(E) (let&#39;s choose the one for 1000)</span></span>
<span id="cb308-16"><a href="Power.html#cb308-16" aria-hidden="true" tabindex="-1"></a>N.mini.oneside <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MDE.set,sample.size,<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">CE=</span>C.E.N[[<span class="dv">2</span>]],<span class="at">oneside=</span><span class="cn">TRUE</span>)</span>
<span id="cb308-17"><a href="Power.html#cb308-17" aria-hidden="true" tabindex="-1"></a>N.mini.twoside <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MDE.set,sample.size,<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">CE=</span>C.E.N[[<span class="dv">2</span>]],<span class="at">oneside=</span><span class="cn">FALSE</span>)</span>
<span id="cb308-18"><a href="Power.html#cb308-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frame</span></span>
<span id="cb308-19"><a href="Power.html#cb308-19" aria-hidden="true" tabindex="-1"></a>MDE.N.sample <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;betaA&quot;</span><span class="ot">=</span><span class="fu">rep</span>(MDE.set,<span class="dv">2</span>),<span class="st">&quot;N&quot;</span><span class="ot">=</span><span class="fu">c</span>(N.mini.oneside,N.mini.twoside),<span class="st">&quot;Test&quot;</span><span class="ot">=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&#39;One-sided&#39;</span>,<span class="fu">length</span>(MDE.set)),<span class="fu">rep</span>(<span class="st">&#39;Two-sided&#39;</span>,<span class="fu">length</span>(MDE.set)))))</span></code></pre></div>
<p>Let us now plot the results:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="Power.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(MDE.N.sample, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.factor</span>(betaA), <span class="at">y=</span>N,<span class="at">fill=</span>Test)) <span class="sc">+</span></span>
<span id="cb309-2"><a href="Power.html#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb309-3"><a href="Power.html#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;betaA&quot;</span>) <span class="sc">+</span></span>
<span id="cb309-4"><a href="Power.html#cb309-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Sample size (log scale)&quot;</span>)<span class="sc">+</span></span>
<span id="cb309-5"><a href="Power.html#cb309-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">yscale</span>(<span class="st">&quot;log10&quot;</span>,<span class="at">.format=</span><span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb309-6"><a href="Power.html#cb309-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PlotMiniN"></span>
<img src="STCI_files/figure-html/PlotMiniN-1.png" alt="Minimum required sample size" width="65%" />
<p class="caption">
Figure 7.6: Minimum required sample size
</p>
</div>
<p>Figure <a href="Power.html#fig:PlotMiniN">7.6</a> shows that Minimum Required Sample Size increases very fast as <span class="math inline">\(\beta_A\)</span>, the minimum effect to detect, decreases.
For <span class="math inline">\(\beta_A=\)</span> 1, the Minimum Required Sample Size is equal to 24.
For <span class="math inline">\(\beta_A=\)</span> 0.5, the Minimum Required Sample Size is equal to 96.
For <span class="math inline">\(\beta_A=\)</span> 0.2, the Minimum Required Sample Size is equal to 600.
For <span class="math inline">\(\beta_A=\)</span> 0.1, the Minimum Required Sample Size is equal to 2400.
For <span class="math inline">\(\beta_A=\)</span> 0.02, the Minimum Required Sample Size is equal to 5.9988^{4}.</p>
</div>
</div>
<div id="traditional-power-analysis-in-practice" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Traditional power analysis in practice<a href="Power.html#traditional-power-analysis-in-practice" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the previous section, we have covered the basics of power analysis.
In order to implement it in practice, we still need an estimate of <span class="math inline">\(\var{\hat{E}}\)</span> or of <span class="math inline">\(C(\hat{E})\)</span>.
When we want to compute power after we have estimated an effect, both of these quantities can easily be recovered from most estimators we have covered in this book.
One problem, though, is when we want to conduct a power analysis before running a study (for example, before collecting the data).
There, we need a way to find a reasonable estimate of <span class="math inline">\(\var{\hat{E}}\)</span> and <span class="math inline">\(C(\hat{E})\)</span>.
We are going to see several ways of doing that, but basically, we need prior information on the properties of our outcomes and covariates.
They can come from baseline data or from data take in a similar population as our target population.
Sometimes, we have to make strong assumptions to move the results from one population to our target population.
Let’s examine in practice how to do that, in the context of all the econometric methods we have studied so far.</p>
<div id="power-analysis-for-randomized-controlled-trials" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Power Analysis for Randomized Controlled Trials<a href="Power.html#power-analysis-for-randomized-controlled-trials" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are going to decompose what needs to be done for each of the four RCT designs we have studied in Section <a href="RCT.html#RCT">3</a>.</p>
<div id="power-analysis-for-brute-force-designs" class="section level4 hasAnchor" number="7.2.1.1">
<h4><span class="header-section-number">7.2.1.1</span> Power Analysis for Brute Force Designs<a href="Power.html#power-analysis-for-brute-force-designs" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For Brute Force designs, the mosts straightforward way to do a power analysis is to rely on the CLT-based approximation for the precision of our estimator.
Using Theorem <a href="FPSI.html#thm:asympnoiseWW">2.5</a> and especially Lemma <a href="proofs.html#lem:asymWW">A.5</a>, we have, in a Brute Force design:</p>
<p><span class="math display">\[\begin{align*}
\var{\hat{\Delta}^Y_{WW^{BF}}} &amp; \approx \frac{1}{N}\left(\frac{\var{Y_i^1|R_i=1}}{\Pr(R_i=1)}+\frac{\var{Y_i^0|R_i=0}}{1-\Pr(R_i=1)}\right).
\end{align*}\]</span></p>
<p>We can see that Assumption <a href="Power.html#hyp:AsymNE">7.1</a> is valid for this estimator.</p>
<p>In order to compute <span class="math inline">\(\var{\hat{\Delta}^Y_{WW}}\)</span> of <span class="math inline">\(C(\hat{\Delta}^Y_{WW})\)</span>, we need to come up with reasonable estimates of <span class="math inline">\(\var{Y_i^1|R_i=1}\)</span> and <span class="math inline">\(\var{Y_i^0|R_i=0}\)</span>.
The problem is that these quantities will only be revealed after the treatment has been given.
It is fine for ex-post power analysis but is not feasible for ex-ante power analysis.</p>
<p>One way around this issue is to use an estimate of the variance of <span class="math inline">\(Y_i\)</span> in a related or similar sample to benchmark our formula.
In our case, we can use the variance of <span class="math inline">\(Y_i^B\)</span>, outcomes observed in the period before the treatment is taken, as a source of estimates.
Since we cannot know who will get the treatment and who will not, we are going to use the same benchmark for both (<span class="math inline">\(\var{Y_i^B}\)</span>).
This is not perfect but this is what we have.
As a result, our estimate of <span class="math inline">\(C(\hat{\Delta}^Y_{WW})\)</span> in the brute force design is:</p>
<p><span class="math display">\[\begin{align*}
\hat{C}(\hat{\Delta}^Y_{WW^{BF}}) &amp; = \frac{\var{Y_i^B}}{p(1-p)},
\end{align*}\]</span></p>
<p>where <span class="math inline">\(p\)</span> is the proportion of individuals in our sample who will be allocated to the treatment.</p>
<div class="example">
<p><span id="exm:unnamed-chunk-339" class="example"><strong>Example 7.4  </strong></span>Let us see how this formula works out in our example.
First, we need to generate a sample:</p>
</div>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="Power.html#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb310-2"><a href="Power.html#cb310-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb310-3"><a href="Power.html#cb310-3" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))</span>
<span id="cb310-4"><a href="Power.html#cb310-4" aria-hidden="true" tabindex="-1"></a>UB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb310-5"><a href="Power.html#cb310-5" aria-hidden="true" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UB </span>
<span id="cb310-6"><a href="Power.html#cb310-6" aria-hidden="true" tabindex="-1"></a>YB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yB)</span>
<span id="cb310-7"><a href="Power.html#cb310-7" aria-hidden="true" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb310-8"><a href="Power.html#cb310-8" aria-hidden="true" tabindex="-1"></a>Ds[YB<span class="sc">&lt;=</span>param[<span class="st">&quot;barY&quot;</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb310-9"><a href="Power.html#cb310-9" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb310-10"><a href="Power.html#cb310-10" aria-hidden="true" tabindex="-1"></a>eta<span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]))</span>
<span id="cb310-11"><a href="Power.html#cb310-11" aria-hidden="true" tabindex="-1"></a>U0 <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilon</span>
<span id="cb310-12"><a href="Power.html#cb310-12" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0 <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb310-13"><a href="Power.html#cb310-13" aria-hidden="true" tabindex="-1"></a>alpha.i <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta</span>
<span id="cb310-14"><a href="Power.html#cb310-14" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y0<span class="sc">+</span>alpha.i</span>
<span id="cb310-15"><a href="Power.html#cb310-15" aria-hidden="true" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y0)</span>
<span id="cb310-16"><a href="Power.html#cb310-16" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y1)</span>
<span id="cb310-17"><a href="Power.html#cb310-17" aria-hidden="true" tabindex="-1"></a><span class="co"># randomized allocation of 50% of individuals</span></span>
<span id="cb310-18"><a href="Power.html#cb310-18" aria-hidden="true" tabindex="-1"></a>Rs <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb310-19"><a href="Power.html#cb310-19" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Rs<span class="sc">&lt;=</span>.<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb310-20"><a href="Power.html#cb310-20" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y1<span class="sc">*</span>R<span class="sc">+</span>y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>R)</span>
<span id="cb310-21"><a href="Power.html#cb310-21" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y1<span class="sc">*</span>R<span class="sc">+</span>Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>R)</span></code></pre></div>
<p>Let us now compute the minimum detectable effect for various sample sizes and proportions of treated individuals, using <span class="math inline">\(\hatvar{y^B_i}=\)</span> 0.78 as an estimate of <span class="math inline">\(\hatvar{y_i^1|R_i=1}=\)</span> 0.85 and <span class="math inline">\(\hatvar{y_i^0|R_i=0}=\)</span> 0.78.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="Power.html#cb311-1" aria-hidden="true" tabindex="-1"></a>CE.BF.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,varYb){</span>
<span id="cb311-2"><a href="Power.html#cb311-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(varYb<span class="sc">/</span>(p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p)))</span>
<span id="cb311-3"><a href="Power.html#cb311-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb311-4"><a href="Power.html#cb311-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-5"><a href="Power.html#cb311-5" aria-hidden="true" tabindex="-1"></a>MDE.BF.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,varYb,...){</span>
<span id="cb311-6"><a href="Power.html#cb311-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">MDE</span>(<span class="at">CE=</span><span class="fu">CE.BF.fun</span>(<span class="at">p=</span>p,<span class="at">varYb=</span>varYb),...))</span>
<span id="cb311-7"><a href="Power.html#cb311-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let us finally check what Minimum Detectable Effect looks like as a function of <span class="math inline">\(p\)</span> and of sample size.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="Power.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb312-2"><a href="Power.html#cb312-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb312-3"><a href="Power.html#cb312-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb312-4"><a href="Power.html#cb312-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100&quot;</span>),<span class="at">fun=</span>MDE.BF.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100</span>,<span class="at">varYb=</span><span class="fu">var</span>(yB),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb312-5"><a href="Power.html#cb312-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;1000&quot;</span>),<span class="at">fun=</span>MDE.BF.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">1000</span>,<span class="at">varYb=</span><span class="fu">var</span>(yB),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb312-6"><a href="Power.html#cb312-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;10000&quot;</span>),<span class="at">fun=</span>MDE.BF.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">10000</span>,<span class="at">varYb=</span><span class="fu">var</span>(yB),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb312-7"><a href="Power.html#cb312-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100000&quot;</span>),<span class="at">fun=</span>MDE.BF.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100000</span>,<span class="at">varYb=</span><span class="fu">var</span>(yB),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb312-8"><a href="Power.html#cb312-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;N&quot;</span>) <span class="sc">+</span></span>
<span id="cb312-9"><a href="Power.html#cb312-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;MDE&quot;</span>) <span class="sc">+</span></span>
<span id="cb312-10"><a href="Power.html#cb312-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;p&quot;</span>) <span class="sc">+</span></span>
<span id="cb312-11"><a href="Power.html#cb312-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MDEBFPlot"></span>
<img src="STCI_files/figure-html/MDEBFPlot-1.png" alt="Minimum detectable effect for the Brute Force design" width="65%" />
<p class="caption">
Figure 7.7: Minimum detectable effect for the Brute Force design
</p>
</div>
<p>As figure <a href="Power.html#fig:MDEBFPlot">7.7</a> shows, the Minimum Detectable Effect is minimized, for a given sample size, at <span class="math inline">\(p=0.5\)</span>.
This makes sense since it is where we get the most precision out of our treated and control samples.
This results depends crucially on the fact that we have assumed no heteroskedasticity (<em>i.e.</em> that we have assumed that the variance of outcomes does not change with treatment status).
We also can see that MDE decreases with sample size, but slower than proportionally.
Again, it makes sense, since power and MDE depend on the square root of sample size.</p>
<p>With a sample size of <span class="math inline">\(N=100\)</span>, we now reach a MDE of 0.5.<br />
With a sample size of <span class="math inline">\(N=1000\)</span>, we now reach a MDE of 0.16.<br />
With a sample size of <span class="math inline">\(N=10000\)</span>, we now reach a MDE of 0.05.<br />
With a sample size of <span class="math inline">\(N=100000\)</span>, we now reach a MDE of 0.02.</p>
</div>
<div id="power-analysis-for-self-selection-designs" class="section level4 hasAnchor" number="7.2.1.2">
<h4><span class="header-section-number">7.2.1.2</span> Power Analysis for Self-Selection Designs<a href="Power.html#power-analysis-for-self-selection-designs" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For self-selection designs, the approach is similar to that of brute force designs, except that, since randomization occurs after self-selection, you have to make a guess on the proportion of people who will take the treatment.
We have:</p>
<p><span class="math display">\[\begin{align*}
\var{\hat{\Delta}^Y_{WW^{SS}}} &amp; \approx \frac{1}{N}\frac{1}{\Pr(D_i=1)}\left(\frac{\var{Y_i^1|D_i=1,R_i=1}}{\Pr(R_i=1|D_i=1)}+\frac{\var{Y_i^0|D_i=1,R_i=0}}{1-\Pr(R_i=1|D_i=1)}\right),
\end{align*}\]</span></p>
<p>with <span class="math inline">\(N\)</span> the total number of individuals in the sample, including the inegilible individuals and the individuals who do not self-select into the program.
Estimates of the MDE and of the Minimum Required Sample Size can be expressed in terms of <span class="math inline">\(N\)</span> or of <span class="math inline">\(N^D=N\Pr(D_i=1)\)</span>, the number of individuals who self-select into the program and among which randomization is run.</p>
<p>The estimates we need to compute these quantities are more complex than with brute force designs: we need <span class="math inline">\(\Pr(D_i=1)\)</span>, but also variances conditional on <span class="math inline">\(D_i=1\)</span>.
If the program was operating before randomization, we can have some pretty good ideas of these numbers.
Otherwise, we have to use either surveys on intentions to participate, or evidence from similar programs, or at least try to enforce the eligibility criteria as much as we can.</p>
<div class="example">
<p><span id="exm:unnamed-chunk-340" class="example"><strong>Example 7.5  </strong></span>Let’s see how we can make this work in our example.</p>
</div>
<p>Let us first update our parameters for modelling self-selection, as we did in Chapter <a href="RCT.html#RCT">3</a>:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="Power.html#cb313-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(param,<span class="sc">-</span><span class="fl">6.25</span>,<span class="fl">0.9</span>,<span class="fl">0.5</span>)</span>
<span id="cb313-2"><a href="Power.html#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;theta&quot;</span>,<span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,<span class="st">&quot;delta&quot;</span>,<span class="st">&quot;baralpha&quot;</span>,<span class="st">&quot;barc&quot;</span>,<span class="st">&quot;gamma&quot;</span>,<span class="st">&quot;sigma2V&quot;</span>)</span></code></pre></div>
<p>and let’s generate a new dataset:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="Power.html#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb314-2"><a href="Power.html#cb314-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb314-3"><a href="Power.html#cb314-3" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))</span>
<span id="cb314-4"><a href="Power.html#cb314-4" aria-hidden="true" tabindex="-1"></a>UB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb314-5"><a href="Power.html#cb314-5" aria-hidden="true" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UB </span>
<span id="cb314-6"><a href="Power.html#cb314-6" aria-hidden="true" tabindex="-1"></a>YB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yB)</span>
<span id="cb314-7"><a href="Power.html#cb314-7" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(YB<span class="sc">&lt;=</span>param[<span class="st">&quot;barY&quot;</span>],<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb314-8"><a href="Power.html#cb314-8" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,param[<span class="st">&quot;sigma2V&quot;</span>])</span>
<span id="cb314-9"><a href="Power.html#cb314-9" aria-hidden="true" tabindex="-1"></a>Dstar <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;barmu&quot;</span>]<span class="sc">-</span>param[<span class="st">&quot;barc&quot;</span>]<span class="sc">-</span>param[<span class="st">&quot;gamma&quot;</span>]<span class="sc">*</span>mu<span class="sc">-</span>V</span>
<span id="cb314-10"><a href="Power.html#cb314-10" aria-hidden="true" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Dstar<span class="sc">&gt;=</span><span class="dv">0</span> <span class="sc">&amp;</span> E<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb314-11"><a href="Power.html#cb314-11" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb314-12"><a href="Power.html#cb314-12" aria-hidden="true" tabindex="-1"></a>eta<span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]))</span>
<span id="cb314-13"><a href="Power.html#cb314-13" aria-hidden="true" tabindex="-1"></a>U0 <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilon</span>
<span id="cb314-14"><a href="Power.html#cb314-14" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0 <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb314-15"><a href="Power.html#cb314-15" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta</span>
<span id="cb314-16"><a href="Power.html#cb314-16" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y0<span class="sc">+</span>alpha</span>
<span id="cb314-17"><a href="Power.html#cb314-17" aria-hidden="true" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y0)</span>
<span id="cb314-18"><a href="Power.html#cb314-18" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y1)</span>
<span id="cb314-19"><a href="Power.html#cb314-19" aria-hidden="true" tabindex="-1"></a><span class="co">#random allocation among self-selected</span></span>
<span id="cb314-20"><a href="Power.html#cb314-20" aria-hidden="true" tabindex="-1"></a>Rs <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb314-21"><a href="Power.html#cb314-21" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Rs<span class="sc">&lt;=</span>.<span class="dv">5</span> <span class="sc">&amp;</span> Ds<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb314-22"><a href="Power.html#cb314-22" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y1<span class="sc">*</span>R<span class="sc">+</span>y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>R)</span>
<span id="cb314-23"><a href="Power.html#cb314-23" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y1<span class="sc">*</span>R<span class="sc">+</span>Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>R)</span>
<span id="cb314-24"><a href="Power.html#cb314-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-25"><a href="Power.html#cb314-25" aria-hidden="true" tabindex="-1"></a><span class="co"># computing application rate</span></span>
<span id="cb314-26"><a href="Power.html#cb314-26" aria-hidden="true" tabindex="-1"></a>pDhat <span class="ot">&lt;-</span> <span class="fu">mean</span>(Ds)</span></code></pre></div>
<p>We are going to assume that all conditional variances are equal to the pre-treatment variance: we use <span class="math inline">\(\hatvar{y^B_i}=\)</span> 0.78 as an estimate of <span class="math inline">\(\hatvar{y_i^1|D_i=1,R_i=1}=\)</span> 0.3 and <span class="math inline">\(\hatvar{y_i^0|D_i=1,R_i=0}=\)</span> 0.23.
This is obviously not a great choice since people with <span class="math inline">\(D_i=1\)</span> have lower variance in outcomes than the overall population.
What happens if we choose instead <span class="math inline">\(\hatvar{y^B_i|y^B_i\leq\bar{y}}\)</span>.
Well, <span class="math inline">\(\hatvar{y^B_i|y^B_i\leq\bar{y}}=\)</span> 0.18, which is a much better guess.
So trying to approximate the selection process (at least enforcing the eligibility criteria) is a good idea when doing a power analysis for self-selection designs.</p>
<p>We are going to use:</p>
<p><span class="math display">\[\begin{align*}
\hat{C}(\hat{\Delta}^Y_{WW^{SS}}) &amp; = \frac{1}{\Pr(D_i=1)}\frac{\hatvar{y^B_i|y^B_i\leq\bar{y}}}{p(1-p)},
\end{align*}\]</span></p>
<p>with <span class="math inline">\(p\)</span> the proportion of applicants randomized into the program.</p>
<p>Let’s write a function to compute the MDE in self-selection designs:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="Power.html#cb315-1" aria-hidden="true" tabindex="-1"></a>CE.SS.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,varYb,pD){</span>
<span id="cb315-2"><a href="Power.html#cb315-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">var</span>(yB)<span class="sc">/</span>(pD<span class="sc">*</span>p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p)))</span>
<span id="cb315-3"><a href="Power.html#cb315-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb315-4"><a href="Power.html#cb315-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-5"><a href="Power.html#cb315-5" aria-hidden="true" tabindex="-1"></a>MDE.SS.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,varYb,pD,...){</span>
<span id="cb315-6"><a href="Power.html#cb315-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">MDE</span>(<span class="at">CE=</span><span class="fu">CE.SS.fun</span>(<span class="at">p=</span>p,<span class="at">varYb=</span>varYb,<span class="at">pD=</span>pD),...))</span>
<span id="cb315-7"><a href="Power.html#cb315-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb315-8"><a href="Power.html#cb315-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-9"><a href="Power.html#cb315-9" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb315-10"><a href="Power.html#cb315-10" aria-hidden="true" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="fl">0.8</span></span></code></pre></div>
<p>Let us finally check what Minimum Detectable Effect looks like as a function of <span class="math inline">\(p\)</span> and of sample size.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="Power.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total sample size (including ineligibles and non applicants)</span></span>
<span id="cb316-2"><a href="Power.html#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb316-3"><a href="Power.html#cb316-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb316-4"><a href="Power.html#cb316-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb316-5"><a href="Power.html#cb316-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100&quot;</span>),<span class="at">fun=</span>MDE.SS.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100</span>,<span class="at">pD=</span>pDhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb316-6"><a href="Power.html#cb316-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;1000&quot;</span>),<span class="at">fun=</span>MDE.SS.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">1000</span>,<span class="at">pD=</span>pDhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb316-7"><a href="Power.html#cb316-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;10000&quot;</span>),<span class="at">fun=</span>MDE.SS.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">10000</span>,<span class="at">pD=</span>pDhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb316-8"><a href="Power.html#cb316-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100000&quot;</span>),<span class="at">fun=</span>MDE.SS.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100000</span>,<span class="at">pD=</span>pDhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb316-9"><a href="Power.html#cb316-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;N&quot;</span>) <span class="sc">+</span></span>
<span id="cb316-10"><a href="Power.html#cb316-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;MDE&quot;</span>) <span class="sc">+</span></span>
<span id="cb316-11"><a href="Power.html#cb316-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;p&quot;</span>) <span class="sc">+</span></span>
<span id="cb316-12"><a href="Power.html#cb316-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb316-13"><a href="Power.html#cb316-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-14"><a href="Power.html#cb316-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Applicants sample size</span></span>
<span id="cb316-15"><a href="Power.html#cb316-15" aria-hidden="true" tabindex="-1"></a>pDhat <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb316-16"><a href="Power.html#cb316-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb316-17"><a href="Power.html#cb316-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb316-18"><a href="Power.html#cb316-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb316-19"><a href="Power.html#cb316-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100&quot;</span>),<span class="at">fun=</span>MDE.SS.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100</span>,<span class="at">pD=</span>pDhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb316-20"><a href="Power.html#cb316-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;1000&quot;</span>),<span class="at">fun=</span>MDE.SS.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">1000</span>,<span class="at">pD=</span>pDhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb316-21"><a href="Power.html#cb316-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;10000&quot;</span>),<span class="at">fun=</span>MDE.SS.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">10000</span>,<span class="at">pD=</span>pDhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb316-22"><a href="Power.html#cb316-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100000&quot;</span>),<span class="at">fun=</span>MDE.SS.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100000</span>,<span class="at">pD=</span>pDhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb316-23"><a href="Power.html#cb316-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="fu">expression</span>(N<span class="sc">^</span>D)) <span class="sc">+</span></span>
<span id="cb316-24"><a href="Power.html#cb316-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;MDE&quot;</span>) <span class="sc">+</span></span>
<span id="cb316-25"><a href="Power.html#cb316-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;p&quot;</span>) <span class="sc">+</span></span>
<span id="cb316-26"><a href="Power.html#cb316-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb316-27"><a href="Power.html#cb316-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-28"><a href="Power.html#cb316-28" aria-hidden="true" tabindex="-1"></a><span class="co"># computing application rate</span></span>
<span id="cb316-29"><a href="Power.html#cb316-29" aria-hidden="true" tabindex="-1"></a>pDhat <span class="ot">&lt;-</span> <span class="fu">mean</span>(Ds)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MDESSPlot"></span>
<img src="STCI_files/figure-html/MDESSPlot-1.png" alt="Minimum detectable effect for the self-selection design" width="50%" /><img src="STCI_files/figure-html/MDESSPlot-2.png" alt="Minimum detectable effect for the self-selection design" width="50%" />
<p class="caption">
Figure 7.8: Minimum detectable effect for the self-selection design
</p>
</div>
<p>With a total sample size of <span class="math inline">\(N=100\)</span>, we now reach a MDE of 1.71.<br />
With a total sample size of <span class="math inline">\(N=1000\)</span>, we now reach a MDE of 0.54.<br />
With a total sample size of <span class="math inline">\(N=10000\)</span>, we now reach a MDE of 0.17.<br />
With a total sample size of <span class="math inline">\(N=100000\)</span>, we now reach a MDE of 0.05.</p>
<p>Remember that these sample sizes include ineligible units and units that do not apply for the program.
Figure <a href="Power.html#fig:MDESSPlot">7.8</a> also shows what happens when sample size corresponds to only applicants to the program (plot on the right).
MDEs in that case look much more like the ones in the brute force design presented in Figure <a href="Power.html#fig:MDEBFPlot">7.7</a>.</p>
<p>With a total sample size of <span class="math inline">\(N^D=100\)</span>, we now reach a MDE of 0.5.<br />
With a total sample size of <span class="math inline">\(N^D=1000\)</span>, we now reach a MDE of 0.16.<br />
With a total sample size of <span class="math inline">\(N^D=10000\)</span>, we now reach a MDE of 0.05.<br />
With a total sample size of <span class="math inline">\(N^D=100000\)</span>, we now reach a MDE of 0.02.</p>
</div>
<div id="power-analysis-for-eligibility-designs" class="section level4 hasAnchor" number="7.2.1.3">
<h4><span class="header-section-number">7.2.1.3</span> Power Analysis for Eligibility Designs<a href="Power.html#power-analysis-for-eligibility-designs" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In eligibility designs, we can make use Theorem <a href="RCT.html#thm:asymBloom">3.8</a> to show that:</p>
<p><span class="math display">\[\begin{align*}
\var{\hat{\Delta}^Y_{Bloom}} &amp; \approx \frac{1}{N}\frac{1}{p^{E}}\frac{1}{(p^{D}_1)^2}\left[\left(\frac{p^D}{p^R}\right)^2\frac{\var{Y_i|R_i=0,E_i=1}}{1-p^R}+\left(\frac{1-p^D}{1-p^R}\right)^2\frac{\var{Y_i|R_i=1,E_i=1}}{p^R}\right],
\end{align*}\]</span></p>
<p>with <span class="math inline">\(p^E=\Pr(E_i=1)\)</span>, <span class="math inline">\(p^D=\Pr(D_i=1|E_i=1)\)</span>, <span class="math inline">\(p^R=\Pr(R_i=1|E_i=1)\)</span> and <span class="math inline">\(p^{D}_1=\Pr(D_i=1|R_i=1,E_i=1)\)</span>.
Note that <span class="math inline">\(N\)</span> corresponds to the size of the sample including the ineligible individuals which do not enter in the estimation of the treatment effect of the program.
MDEs and minimum required sample size can also be expressed in terms of <span class="math inline">\(N^E=Np^E\)</span>, the size of the sample of eligible units.</p>
<p>There is a large number of parameters to find in order to compute this variance estimator.
We need to postulate a value for <span class="math inline">\(p^{E}\)</span> (unless we look for information on the sample size of the eligible population participating in the experiment, in which case we set <span class="math inline">\(p^{E}=1\)</span> and <span class="math inline">\(N=N^E\)</span> in the above formula), a value for <span class="math inline">\(p^D\)</span>, for <span class="math inline">\(p^R\)</span> and for <span class="math inline">\(p^D_1\)</span>.
For estimating <span class="math inline">\(p^E\)</span>, we are going to choose the proportion of individuals eligible to the program (<span class="math inline">\(\hat{p}^E=\Pr(y_i^B\leq\bar{y})\)</span>).
For <span class="math inline">\(p^D\)</span>, we know that: <span class="math inline">\(p^D=\Pr(D_i=1|E_i=1)=\Pr(D_i=1|R_i=1,E_i=1)\Pr(R_i=1|E_i=1)=p^{D}_1p^R\)</span>.
Since we can vary <span class="math inline">\(p^R\)</span>, we only need to settle on a value for <span class="math inline">\(p^{D}_1\)</span>.
We are going to choose the actual value of <span class="math inline">\(\Pr(D_i=1|R_i=1,E_i=1)\)</span>, or <span class="math inline">\(\hat{p}^{D}_1=\)</span> 1.
Finally, we are going to assume that all conditional variances are equal to the pre-treatment variance among eligibles: we use <span class="math inline">\(\hatvar{y^B_i|E_i=1}=\)</span> 0.18 as an estimate of <span class="math inline">\(\hatvar{y_i|R_i=1,E_i=1}=\)</span> 0.29 and <span class="math inline">\(\hatvar{y_i|R_i=0,E_i=1}=\)</span> 0.18.</p>
<p>We can now write <span class="math inline">\(C(E)\)</span> for the total sample size <span class="math inline">\(N\)</span> (set <span class="math inline">\(p^{E}=1\)</span> for <span class="math inline">\(N=N^E\)</span>):</p>
<p><span class="math display">\[\begin{align*}
\hat{C}(\hat{\Delta}^Y_{Bloom}) &amp; = \frac{1}{\hat{p}^{E}}\frac{1}{(\hat{p}^{D}_1)^2}\left[\left(\frac{\hat{p}^D}{p^R}\right)^2\frac{\hatvar{y^B_i|E_i=1}}{1-p^R}+\left(\frac{1-\hat{p}^D}{1-p^R}\right)^2\frac{\hatvar{y^B_i|E_i=1}}{p^R}\right].
\end{align*}\]</span></p>
<p>Let’s write a function to compute the MDE in eligibility designs:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="Power.html#cb317-1" aria-hidden="true" tabindex="-1"></a>CE.Elig.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(pR,varYb,pE,p1D){</span>
<span id="cb317-2"><a href="Power.html#cb317-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((<span class="dv">1</span><span class="sc">/</span>pE)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span>p1D)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>((p1D)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>varYb<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>pR)<span class="sc">+</span>(((<span class="dv">1</span><span class="sc">-</span>p1D<span class="sc">*</span>pR)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>pR))<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fu">var</span>(yB)<span class="sc">/</span>pR)))</span>
<span id="cb317-3"><a href="Power.html#cb317-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb317-4"><a href="Power.html#cb317-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-5"><a href="Power.html#cb317-5" aria-hidden="true" tabindex="-1"></a>MDE.Elig.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(pR,varYb,pE,p1D,...){</span>
<span id="cb317-6"><a href="Power.html#cb317-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">MDE</span>(<span class="at">CE=</span><span class="fu">CE.Elig.fun</span>(<span class="at">pR=</span>pR,<span class="at">varYb=</span>varYb,<span class="at">pE=</span>pE,<span class="at">p1D=</span>p1D),...))</span>
<span id="cb317-7"><a href="Power.html#cb317-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb317-8"><a href="Power.html#cb317-8" aria-hidden="true" tabindex="-1"></a><span class="co"># computing candidate participation rate, using the observed proportion below baryB</span></span>
<span id="cb317-9"><a href="Power.html#cb317-9" aria-hidden="true" tabindex="-1"></a>pEhat <span class="ot">&lt;-</span> <span class="fu">mean</span>(E)</span>
<span id="cb317-10"><a href="Power.html#cb317-10" aria-hidden="true" tabindex="-1"></a>p1Dhat <span class="ot">&lt;-</span> <span class="fu">mean</span>(Ds[E<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> R<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb317-11"><a href="Power.html#cb317-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-12"><a href="Power.html#cb317-12" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb317-13"><a href="Power.html#cb317-13" aria-hidden="true" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="fl">0.8</span></span></code></pre></div>
<p>Let us finally check what Minimum Detectable Effect looks like as a function of <span class="math inline">\(p^R\)</span> and of sample size.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="Power.html#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total sample size (including ineligibles)</span></span>
<span id="cb318-2"><a href="Power.html#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb318-3"><a href="Power.html#cb318-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb318-4"><a href="Power.html#cb318-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb318-5"><a href="Power.html#cb318-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100&quot;</span>),<span class="at">fun=</span>MDE.Elig.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb318-6"><a href="Power.html#cb318-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;1000&quot;</span>),<span class="at">fun=</span>MDE.Elig.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">1000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb318-7"><a href="Power.html#cb318-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;10000&quot;</span>),<span class="at">fun=</span>MDE.Elig.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">10000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb318-8"><a href="Power.html#cb318-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100000&quot;</span>),<span class="at">fun=</span>MDE.Elig.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb318-9"><a href="Power.html#cb318-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;N&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-10"><a href="Power.html#cb318-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;MDE&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-11"><a href="Power.html#cb318-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(p<span class="sc">^</span>R)) <span class="sc">+</span></span>
<span id="cb318-12"><a href="Power.html#cb318-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb318-13"><a href="Power.html#cb318-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-14"><a href="Power.html#cb318-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Applicants sample size</span></span>
<span id="cb318-15"><a href="Power.html#cb318-15" aria-hidden="true" tabindex="-1"></a>pEhat <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb318-16"><a href="Power.html#cb318-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb318-17"><a href="Power.html#cb318-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb318-18"><a href="Power.html#cb318-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb318-19"><a href="Power.html#cb318-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100&quot;</span>),<span class="at">fun=</span>MDE.Elig.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb318-20"><a href="Power.html#cb318-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;1000&quot;</span>),<span class="at">fun=</span>MDE.Elig.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">1000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb318-21"><a href="Power.html#cb318-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;10000&quot;</span>),<span class="at">fun=</span>MDE.Elig.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">10000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb318-22"><a href="Power.html#cb318-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100000&quot;</span>),<span class="at">fun=</span>MDE.Elig.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb318-23"><a href="Power.html#cb318-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="fu">expression</span>(N<span class="sc">^</span>E)) <span class="sc">+</span></span>
<span id="cb318-24"><a href="Power.html#cb318-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;MDE&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-25"><a href="Power.html#cb318-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;p&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-26"><a href="Power.html#cb318-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb318-27"><a href="Power.html#cb318-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-28"><a href="Power.html#cb318-28" aria-hidden="true" tabindex="-1"></a><span class="co"># computing application rate</span></span>
<span id="cb318-29"><a href="Power.html#cb318-29" aria-hidden="true" tabindex="-1"></a>pEhat <span class="ot">&lt;-</span> <span class="fu">mean</span>(E)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MDEEligPlot"></span>
<img src="STCI_files/figure-html/MDEEligPlot-1.png" alt="Minimum detectable effect for the eligibility design" width="50%" /><img src="STCI_files/figure-html/MDEEligPlot-2.png" alt="Minimum detectable effect for the eligibility design" width="50%" />
<p class="caption">
Figure 7.9: Minimum detectable effect for the eligibility design
</p>
</div>
<p>Note that the minimum detectable effect is no longer minimized at <span class="math inline">\(p^R=0.5\)</span>.
We are still going to give the examples at this proportion anyway, since the difference with the optimal proportion of treated is small in our application.</p>
<p>With a total sample size of <span class="math inline">\(N=100\)</span>, we now reach a MDE of 0.81.<br />
With a total sample size of <span class="math inline">\(N=1000\)</span>, we now reach a MDE of 0.26.<br />
With a total sample size of <span class="math inline">\(N=10000\)</span>, we now reach a MDE of 0.08.<br />
With a total sample size of <span class="math inline">\(N=100000\)</span>, we now reach a MDE of 0.03.</p>
<p>Remember that these sample sizes include ineligible units.
Figure <a href="Power.html#fig:MDEEligPlot">7.9</a> also shows what happens when sample size corresponds to only units eligibles to the program (plot on the right).</p>
<p>With a total sample size of <span class="math inline">\(N^E=100\)</span>, we now reach a MDE of 0.39.<br />
With a total sample size of <span class="math inline">\(N^E=1000\)</span>, we now reach a MDE of 0.12.<br />
With a total sample size of <span class="math inline">\(N^E=10000\)</span>, we now reach a MDE of 0.04.<br />
With a total sample size of <span class="math inline">\(N^E=100000\)</span>, we now reach a MDE of 0.01.</p>
</div>
<div id="power-analysis-for-encouragement-designs" class="section level4 hasAnchor" number="7.2.1.4">
<h4><span class="header-section-number">7.2.1.4</span> Power Analysis for Encouragement Designs<a href="Power.html#power-analysis-for-encouragement-designs" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In encouragement designs, we can make use Theorem <a href="RCT.html#thm:asymWald">3.16</a> to show that:</p>
<p><span class="math display">\[\begin{align*}
\var{\hat{\Delta}^Y_{Wald}} &amp; \approx \frac{1}{N}\frac{1}{p^{E}}\frac{1}{(p^D_1-p^D_0)^2}\left[\left(\frac{p^D}{p^R}\right)^2\frac{\var{Y_i|E_i=1,R_i=0}}{1-p^R}+\left(\frac{1-p^D}{1-p^R}\right)^2\frac{\var{Y_i|E_i=1,R_i=1}}{p^R}\right],
\end{align*}\]</span></p>
<p>with <span class="math inline">\(p^E=\Pr(E_i=1)\)</span>, <span class="math inline">\(p^D=\Pr(D_i=1|E_i=1)\)</span>, <span class="math inline">\(p^R=\Pr(R_i=1|E_i=1)\)</span>, <span class="math inline">\(p^{D}_0=\Pr(D_i=1|R_i=0,E_i=1)\)</span> and <span class="math inline">\(p^{D}_1=\Pr(D_i=1|R_i=1,E_i=1)\)</span>.
Note that <span class="math inline">\(N\)</span> corresponds to the size of the sample including the ineligible individuals which do not enter in the estimation of the treatment effect of the program.
MDEs and minimum required sample size can also be expressed in terms of <span class="math inline">\(N^E=Np^E\)</span>, the size of the sample in terms of eligible units.</p>
<p>As with eligibility designs, there is a large number of parameters to find in order to compute this variance estimator.
We need to postulate a value for <span class="math inline">\(p^{E}\)</span> (unless we look for information on the sample size of the eligible population participating in the experiment, in which case we set <span class="math inline">\(p^{E}=1\)</span> and <span class="math inline">\(N=N^E\)</span> in the above formula), a value for <span class="math inline">\(p^D\)</span>, for <span class="math inline">\(p^R\)</span> and for <span class="math inline">\(p^D_1\)</span>.
For estimating <span class="math inline">\(p^E\)</span>, we are going to choose the proportion of individuals eligible to the program (<span class="math inline">\(\hat{p}^E=\Pr(y_i^B\leq\bar{y})\)</span>).
For <span class="math inline">\(p^D\)</span>, we know that: <span class="math inline">\(p^D=\Pr(D_i=1|E_i=1)=\Pr(D_i=1|R_i=1,E_i=1)\Pr(R_i=1|E_i=1)+\Pr(D_i=1|R_i=0,E_i=1)\Pr(R_i=0|E_i=1)=p^{D}_1p^R+p^{D}_0(1-p^R)\)</span>.
Since we can vary <span class="math inline">\(p^R\)</span>, we only need to settle on a value for <span class="math inline">\(p^{D}_1\)</span> and <span class="math inline">\(p^{D}_0\)</span>.
We are going to choose their actual values in the sample, <span class="math inline">\(\Pr(D_i=1|R_i=1,E_i=1)\)</span> and <span class="math inline">\(\Pr(D_i=1|R_i=0,E_i=1)\)</span>, or <span class="math inline">\(\hat{p}^{D}_1=\)</span> 1 and <span class="math inline">\(\hat{p}^{D}_0=\)</span> 0.23.
In real life applications, this choice is much more difficult.
It can for example be based on pilot studies where the response rate to the encouragement is tested.
Finally, we are going to assume that all conditional variances are equal to the pre-treatment variance among eligibles: we use <span class="math inline">\(\hatvar{y^B_i|E_i=1}=\)</span> 0.18 as an estimate of <span class="math inline">\(\hatvar{y_i|R_i=1,E_i=1}=\)</span> 0.29 and <span class="math inline">\(\hatvar{y_i|R_i=0,E_i=1}=\)</span> 0.18.</p>
<p>We can now write <span class="math inline">\(C(E)\)</span> for the total sample size <span class="math inline">\(N\)</span> (set <span class="math inline">\(p^{E}=1\)</span> for <span class="math inline">\(N=N^E\)</span>):</p>
<p><span class="math display">\[\begin{align*}
\hat{C}(\hat{\Delta}^Y_{Wald}) &amp; = \frac{1}{\hat{p}^{E}}\frac{1}{(\hat{p}^{D}_1-\hat{p}^{D}_0)^2}\left[\left(\frac{p^{D}_1p^R+p^{D}_0(1-p^R)}{p^R}\right)^2\frac{\hatvar{y^B_i|E_i=1}}{1-p^R}\right.\\
                                &amp; \phantom{= \frac{1}{\hat{p}^{E}}\frac{1}{(\hat{p}^{D}_1-\hat{p}^{D}_0)^2}\left[\right.}\left.+\left(\frac{1-(p^{D}_1p^R+p^{D}_0(1-p^R))}{1-p^R}\right)^2\frac{\hatvar{y^B_i|E_i=1}}{p^R}\right].
\end{align*}\]</span></p>
<p>Let’s write a function to compute the MDE in encouragement designs:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="Power.html#cb319-1" aria-hidden="true" tabindex="-1"></a>CE.Encourage.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(pR,varYb,pE,p1D,p0D){</span>
<span id="cb319-2"><a href="Power.html#cb319-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((<span class="dv">1</span><span class="sc">/</span>pE)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span>(p1D<span class="sc">-</span>p0D))<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(((p1D<span class="sc">*</span>pR<span class="sc">+</span>p0D<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>pR))<span class="sc">/</span>pR)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>varYb<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>pR)<span class="sc">+</span>((<span class="dv">1</span><span class="sc">-</span>p1D<span class="sc">*</span>pR<span class="sc">-</span>p0D<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>pR))<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>pR))<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fu">var</span>(yB)<span class="sc">/</span>pR))</span>
<span id="cb319-3"><a href="Power.html#cb319-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb319-4"><a href="Power.html#cb319-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-5"><a href="Power.html#cb319-5" aria-hidden="true" tabindex="-1"></a>MDE.Encourage.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(pR,varYb,pE,p1D,p0D,...){</span>
<span id="cb319-6"><a href="Power.html#cb319-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">MDE</span>(<span class="at">CE=</span><span class="fu">CE.Encourage.fun</span>(<span class="at">pR=</span>pR,<span class="at">varYb=</span>varYb,<span class="at">pE=</span>pE,<span class="at">p1D=</span>p1D,<span class="at">p0D=</span>p0D),...))</span>
<span id="cb319-7"><a href="Power.html#cb319-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb319-8"><a href="Power.html#cb319-8" aria-hidden="true" tabindex="-1"></a><span class="co"># computing candidate participation rate, using the observed proportion below baryB</span></span>
<span id="cb319-9"><a href="Power.html#cb319-9" aria-hidden="true" tabindex="-1"></a>pEhat <span class="ot">&lt;-</span> <span class="fu">mean</span>(E)</span>
<span id="cb319-10"><a href="Power.html#cb319-10" aria-hidden="true" tabindex="-1"></a>p1Dhat <span class="ot">&lt;-</span> <span class="fu">mean</span>(Ds[E<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> R<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb319-11"><a href="Power.html#cb319-11" aria-hidden="true" tabindex="-1"></a>p0Dhat <span class="ot">&lt;-</span> <span class="fu">mean</span>(Ds[E<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> R<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb319-12"><a href="Power.html#cb319-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-13"><a href="Power.html#cb319-13" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb319-14"><a href="Power.html#cb319-14" aria-hidden="true" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="fl">0.8</span></span></code></pre></div>
<p>Let us finally check what Minimum Detectable Effect looks like as a function of <span class="math inline">\(p^R\)</span> and of sample size.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="Power.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total sample size (including ineligibles)</span></span>
<span id="cb320-2"><a href="Power.html#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb320-3"><a href="Power.html#cb320-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb320-4"><a href="Power.html#cb320-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb320-5"><a href="Power.html#cb320-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100&quot;</span>),<span class="at">fun=</span>MDE.Encourage.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">p0D=</span>p0Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb320-6"><a href="Power.html#cb320-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;1000&quot;</span>),<span class="at">fun=</span>MDE.Encourage.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">1000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">p0D=</span>p0Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb320-7"><a href="Power.html#cb320-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;10000&quot;</span>),<span class="at">fun=</span>MDE.Encourage.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">10000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">p0D=</span>p0Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb320-8"><a href="Power.html#cb320-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100000&quot;</span>),<span class="at">fun=</span>MDE.Encourage.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">p0D=</span>p0Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb320-9"><a href="Power.html#cb320-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;N&quot;</span>) <span class="sc">+</span></span>
<span id="cb320-10"><a href="Power.html#cb320-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;MDE&quot;</span>) <span class="sc">+</span></span>
<span id="cb320-11"><a href="Power.html#cb320-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(p<span class="sc">^</span>R)) <span class="sc">+</span></span>
<span id="cb320-12"><a href="Power.html#cb320-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb320-13"><a href="Power.html#cb320-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-14"><a href="Power.html#cb320-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Applicants sample size</span></span>
<span id="cb320-15"><a href="Power.html#cb320-15" aria-hidden="true" tabindex="-1"></a>pEhat <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb320-16"><a href="Power.html#cb320-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb320-17"><a href="Power.html#cb320-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb320-18"><a href="Power.html#cb320-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb320-19"><a href="Power.html#cb320-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100&quot;</span>),<span class="at">fun=</span>MDE.Encourage.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">p0D=</span>p0Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb320-20"><a href="Power.html#cb320-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;1000&quot;</span>),<span class="at">fun=</span>MDE.Encourage.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">1000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">p0D=</span>p0Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb320-21"><a href="Power.html#cb320-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;10000&quot;</span>),<span class="at">fun=</span>MDE.Encourage.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">10000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">p0D=</span>p0Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb320-22"><a href="Power.html#cb320-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100000&quot;</span>),<span class="at">fun=</span>MDE.Encourage.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100000</span>,<span class="at">pE=</span>pEhat,<span class="at">p1D=</span>p1Dhat,<span class="at">p0D=</span>p0Dhat,<span class="at">varYb=</span><span class="fu">var</span>(yB[E<span class="sc">==</span><span class="dv">1</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb320-23"><a href="Power.html#cb320-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="fu">expression</span>(N<span class="sc">^</span>E)) <span class="sc">+</span></span>
<span id="cb320-24"><a href="Power.html#cb320-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;MDE&quot;</span>) <span class="sc">+</span></span>
<span id="cb320-25"><a href="Power.html#cb320-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;p&quot;</span>) <span class="sc">+</span></span>
<span id="cb320-26"><a href="Power.html#cb320-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb320-27"><a href="Power.html#cb320-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-28"><a href="Power.html#cb320-28" aria-hidden="true" tabindex="-1"></a><span class="co"># computing application rate</span></span>
<span id="cb320-29"><a href="Power.html#cb320-29" aria-hidden="true" tabindex="-1"></a>pEhat <span class="ot">&lt;-</span> <span class="fu">mean</span>(E)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MDEEncouragePlot"></span>
<img src="STCI_files/figure-html/MDEEncouragePlot-1.png" alt="Minimum detectable effect for the encouragement design" width="50%" /><img src="STCI_files/figure-html/MDEEncouragePlot-2.png" alt="Minimum detectable effect for the encouragement design" width="50%" />
<p class="caption">
Figure 7.10: Minimum detectable effect for the encouragement design
</p>
</div>
<p>Note that the minimum detectable effect is no longer minimized at <span class="math inline">\(p^R=0.5\)</span>.
We are still going to give the examples at this proportion anyway, since the difference with the optimal proportion of treated is small in our application.</p>
<p>With a total sample size of <span class="math inline">\(N=100\)</span>, we now reach a MDE of 0.91.<br />
With a total sample size of <span class="math inline">\(N=1000\)</span>, we now reach a MDE of 0.29.<br />
With a total sample size of <span class="math inline">\(N=10000\)</span>, we now reach a MDE of 0.09.<br />
With a total sample size of <span class="math inline">\(N=100000\)</span>, we now reach a MDE of 0.03.</p>
<p>Remember that these sample sizes include ineligible units.
Figure <a href="Power.html#fig:MDEEncouragePlot">7.10</a> also shows what happens when sample size corresponds to only units eligible to the program (plot on the right).</p>
<p>With a total sample size of <span class="math inline">\(N^E=100\)</span>, we now reach a MDE of 0.44.<br />
With a total sample size of <span class="math inline">\(N^E=1000\)</span>, we now reach a MDE of 0.14.<br />
With a total sample size of <span class="math inline">\(N^E=10000\)</span>, we now reach a MDE of 0.04.<br />
With a total sample size of <span class="math inline">\(N^E=100000\)</span>, we now reach a MDE of 0.01.</p>
</div>
</div>
<div id="power-analysis-for-natural-experiments" class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Power Analysis for Natural Experiments<a href="Power.html#power-analysis-for-natural-experiments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Power analysis can be useful for natural experiments as well, especially to assess the level of precision we are likely to achieve with a given sample size.
It is still possible to use Theorem <a href="Power.html#thm:PowerE">7.1</a> to conduct a power analysis for natural experiments, since they comply with Assumption <a href="Power.html#hyp:AsymNE">7.1</a>.
In this section, we are going to focus in Difference in Differences and Regression Discontinuity Designs, since the case Instrumental Variables is similar to the case of encouragement designs seen just above.</p>
<div id="power-analysis-for-rdd" class="section level4 hasAnchor" number="7.2.2.1">
<h4><span class="header-section-number">7.2.2.1</span> Power Analysis for RDD<a href="Power.html#power-analysis-for-rdd" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let us start with power analysis for Regression Discontinuity designs.
They are very similar to the case of instrumental variables, and thus to the case of encouragement designs.
The only thing that differs is the size of the bandwidth around the discontinuity, which is going to be a major influence on the effective size of the sample.
Let us study the case of sharp RDD first, and then move on to fuzzy RDD.</p>
<div id="power-analysis-for-sharp-rdd" class="section level5 hasAnchor" number="7.2.2.1.1">
<h5><span class="header-section-number">7.2.2.1.1</span> Power analysis for sharp RDD<a href="Power.html#power-analysis-for-sharp-rdd" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>One way to conduct the power analysis for RDD in sharp designs would be to use the formula for the asymptotic variance of the RDD estimator derived in Theorem <a href="NE.html#thm:CLTSharpRDDLLR">4.5</a>.
This route requires to specify the density of the running variable at the threshold and the bandwidth.
Another route simply uses the fact that the RDD estimator is equivalent to a with-without estimator on both sides of the threshold.
Let’s first explore the first route.</p>
<p>Following Theorem <a href="NE.html#thm:CLTSharpRDDLLR">4.5</a>, we have that the variance of the simplified sharp RDD estimator can be approximated by:</p>
<p><span class="math display">\[\begin{align*}
 \var{\hat{\Delta}_{LLRRDD}} &amp; \approx \frac{1}{Nh}\frac{4}{f_{Z}(\bar{z})}\left(\lim_{e\rightarrow 0^{\text{+}}}\var{Y_i|Z_i=\bar{z}-e}+\lim_{e\rightarrow 0^{\text{+}}}\var{Y_i|Z_i=\bar{z}+e}\right),
\end{align*}\]</span></p>
<p>To implement this formula, we need to derive the variance of the outcome at the threshold, the optimal bandwidth and the density of the the running variable at the threshold.
All these quantities can be derived or at least approximated using the available pre-treatment data.</p>
<div class="example">
<p><span id="exm:unnamed-chunk-341" class="example"><strong>Example 7.6  </strong></span>Let us try to implement this in the example.</p>
</div>
<p>In order to be able to implement the power computation on data observed before the treatment takes place, we need to have at least three treatment periods: two before and one after.
Selection will take place in period <span class="math inline">\(2\)</span>.
We will estimate power on the period before that (<span class="math inline">\(1\)</span>).
Treatment effects will be observed in period <span class="math inline">\(3\)</span>.
We are going to use a setting similar to the one we used for staggered DID.
Let us first choose some parameter values:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="Power.html#cb321-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,</span>
<span id="cb321-2"><a href="Power.html#cb321-2" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,</span>
<span id="cb321-3"><a href="Power.html#cb321-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.05</span>,<span class="fl">0.05</span>,</span>
<span id="cb321-4"><a href="Power.html#cb321-4" aria-hidden="true" tabindex="-1"></a>           <span class="dv">0</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,</span>
<span id="cb321-5"><a href="Power.html#cb321-5" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.15</span>,</span>
<span id="cb321-6"><a href="Power.html#cb321-6" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.25</span>,<span class="fl">0.1</span>,<span class="fl">0.05</span>,</span>
<span id="cb321-7"><a href="Power.html#cb321-7" aria-hidden="true" tabindex="-1"></a>           <span class="fl">1.5</span>,<span class="fl">1.25</span>,<span class="dv">1</span>,</span>
<span id="cb321-8"><a href="Power.html#cb321-8" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.5</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb321-9"><a href="Power.html#cb321-9" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.1</span>,<span class="fl">0.28</span>,<span class="dv">0</span>)</span>
<span id="cb321-10"><a href="Power.html#cb321-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,</span>
<span id="cb321-11"><a href="Power.html#cb321-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;theta1&quot;</span>,<span class="st">&quot;theta2&quot;</span>,<span class="st">&quot;theta3&quot;</span>,</span>
<span id="cb321-12"><a href="Power.html#cb321-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,</span>
<span id="cb321-13"><a href="Power.html#cb321-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;delta1&quot;</span>,<span class="st">&quot;delta2&quot;</span>,<span class="st">&quot;delta3&quot;</span>,</span>
<span id="cb321-14"><a href="Power.html#cb321-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;baralpha1&quot;</span>,<span class="st">&quot;baralpha2&quot;</span>,<span class="st">&quot;baralpha3&quot;</span>,</span>
<span id="cb321-15"><a href="Power.html#cb321-15" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;barchi1&quot;</span>,<span class="st">&quot;barchi2&quot;</span>,<span class="st">&quot;barchi3&quot;</span>,</span>
<span id="cb321-16"><a href="Power.html#cb321-16" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;kappa1&quot;</span>,<span class="st">&quot;kappa2&quot;</span>,<span class="st">&quot;kappa3&quot;</span>,</span>
<span id="cb321-17"><a href="Power.html#cb321-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;xi1&quot;</span>,<span class="st">&quot;xi2&quot;</span>,<span class="st">&quot;xi3&quot;</span>,</span>
<span id="cb321-18"><a href="Power.html#cb321-18" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;gamma&quot;</span>,<span class="st">&quot;sigma2omega&quot;</span>,<span class="st">&quot;rhoetaomega&quot;</span>)</span></code></pre></div>
<p>Let us now generate the corresponding data (in long format):</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="Power.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb322-2"><a href="Power.html#cb322-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb322-3"><a href="Power.html#cb322-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb322-4"><a href="Power.html#cb322-4" aria-hidden="true" tabindex="-1"></a>cov.eta.omega <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(param[<span class="st">&quot;sigma2eta&quot;</span>],param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;sigma2omega&quot;</span>]),<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb322-5"><a href="Power.html#cb322-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">mvrnorm</span>(N<span class="sc">*</span>T,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),cov.eta.omega))</span>
<span id="cb322-6"><a href="Power.html#cb322-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;eta&#39;</span>,<span class="st">&#39;omega&#39;</span>)</span>
<span id="cb322-7"><a href="Power.html#cb322-7" aria-hidden="true" tabindex="-1"></a><span class="co"># time and individual identifiers</span></span>
<span id="cb322-8"><a href="Power.html#cb322-8" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,N),<span class="fu">rep</span>(<span class="dv">2</span>,N),<span class="fu">rep</span>(<span class="dv">3</span>,N))</span>
<span id="cb322-9"><a href="Power.html#cb322-9" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">rep</span>((<span class="dv">1</span><span class="sc">:</span>N),T)</span>
<span id="cb322-10"><a href="Power.html#cb322-10" aria-hidden="true" tabindex="-1"></a><span class="co"># unit fixed effects</span></span>
<span id="cb322-11"><a href="Power.html#cb322-11" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>])),T)</span>
<span id="cb322-12"><a href="Power.html#cb322-12" aria-hidden="true" tabindex="-1"></a><span class="co"># time fixed effects</span></span>
<span id="cb322-13"><a href="Power.html#cb322-13" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>delta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(param[<span class="st">&quot;delta1&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;delta2&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;delta3&quot;</span>],N))</span>
<span id="cb322-14"><a href="Power.html#cb322-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>baralphat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(param[<span class="st">&quot;baralpha1&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;baralpha2&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;baralpha3&quot;</span>],N))</span>
<span id="cb322-15"><a href="Power.html#cb322-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-16"><a href="Power.html#cb322-16" aria-hidden="true" tabindex="-1"></a><span class="co"># building autocorrelated error terms</span></span>
<span id="cb322-17"><a href="Power.html#cb322-17" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">*</span>T,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb322-18"><a href="Power.html#cb322-18" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>U[<span class="dv">1</span><span class="sc">:</span>N] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb322-19"><a href="Power.html#cb322-19" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>U[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)] <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>data<span class="sc">$</span>U[<span class="dv">1</span><span class="sc">:</span>N] <span class="sc">+</span> data<span class="sc">$</span>epsilon[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)]</span>
<span id="cb322-20"><a href="Power.html#cb322-20" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>U[(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N)] <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>data<span class="sc">$</span>U[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)] <span class="sc">+</span> data<span class="sc">$</span>epsilon[(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N)]</span>
<span id="cb322-21"><a href="Power.html#cb322-21" aria-hidden="true" tabindex="-1"></a><span class="co"># potential outcomes in the absence of the treatment</span></span>
<span id="cb322-22"><a href="Power.html#cb322-22" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>y0 <span class="ot">&lt;-</span> data<span class="sc">$</span>mu <span class="sc">+</span> data<span class="sc">$</span>delta <span class="sc">+</span> data<span class="sc">$</span>U </span>
<span id="cb322-23"><a href="Power.html#cb322-23" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(data<span class="sc">$</span>y0)</span>
<span id="cb322-24"><a href="Power.html#cb322-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-25"><a href="Power.html#cb322-25" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment status</span></span>
<span id="cb322-26"><a href="Power.html#cb322-26" aria-hidden="true" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">if_else</span>(data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)]<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb322-27"><a href="Power.html#cb322-27" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(Ds,T)</span></code></pre></div>
<p>With pre-treatment data (period <span class="math inline">\(2\)</span>), we can compute a density of the outcomes at the threshold, and then we can use period <span class="math inline">\(1\)</span> to compute the optimal bandwidth estimator and the variance of outcomes on each side of the threshold.
Let’s start with the density estimation and bandwidth choice first.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="Power.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="co"># density function estimated at one point</span></span>
<span id="cb323-2"><a href="Power.html#cb323-2" aria-hidden="true" tabindex="-1"></a>densy2.ybar <span class="ot">&lt;-</span> <span class="fu">density</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N],<span class="at">n=</span><span class="dv">1</span>,<span class="at">from=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">to=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">kernel=</span><span class="st">&quot;biweight&quot;</span>,<span class="at">bw=</span><span class="st">&quot;nrd&quot;</span>)[[<span class="dv">2</span>]]</span>
<span id="cb323-3"><a href="Power.html#cb323-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-4"><a href="Power.html#cb323-4" aria-hidden="true" tabindex="-1"></a><span class="co"># optimal bandwidth by cross validation</span></span>
<span id="cb323-5"><a href="Power.html#cb323-5" aria-hidden="true" tabindex="-1"></a>kernel <span class="ot">&lt;-</span> <span class="st">&#39;gaussian&#39;</span></span>
<span id="cb323-6"><a href="Power.html#cb323-6" aria-hidden="true" tabindex="-1"></a><span class="co">#bw &lt;- 0.1</span></span>
<span id="cb323-7"><a href="Power.html#cb323-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-8"><a href="Power.html#cb323-8" aria-hidden="true" tabindex="-1"></a>MSE.grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="at">by=</span>.<span class="dv">1</span>)</span>
<span id="cb323-9"><a href="Power.html#cb323-9" aria-hidden="true" tabindex="-1"></a>MSE.llr<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N],<span class="at">D=</span>Ds,<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">0</span>)</span>
<span id="cb323-10"><a href="Power.html#cb323-10" aria-hidden="true" tabindex="-1"></a>MSE.llr<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N],<span class="at">D=</span>Ds,<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">1</span>)</span>
<span id="cb323-11"><a href="Power.html#cb323-11" aria-hidden="true" tabindex="-1"></a>bw0 <span class="ot">&lt;-</span> MSE.grid[MSE.llr<span class="fl">.0</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.0</span>)]</span>
<span id="cb323-12"><a href="Power.html#cb323-12" aria-hidden="true" tabindex="-1"></a>bw1 <span class="ot">&lt;-</span> MSE.grid[MSE.llr<span class="fl">.1</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.1</span>)]</span>
<span id="cb323-13"><a href="Power.html#cb323-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-14"><a href="Power.html#cb323-14" aria-hidden="true" tabindex="-1"></a><span class="co"># final bandwidth choice: mean of the two</span></span>
<span id="cb323-15"><a href="Power.html#cb323-15" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">&lt;-</span> (bw1<span class="sc">+</span>bw0)<span class="sc">/</span><span class="dv">2</span></span></code></pre></div>
<p>Let us now compute the conditional variance on both sides.
We are going to assume that they are the same, as they are by construction on pre-treatment data.
We could increase the variance of the outcome in the absence of the treatment by the variance of the treatment effect if we had any idea of the magnitude of this parameter.
To compute the conditional variance, we need to estimate the regression function, then compute the residuals, then estimate the regression function ofthe squared residuals.
Let’s go.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="Power.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># llr estimate for y1</span></span>
<span id="cb324-2"><a href="Power.html#cb324-2" aria-hidden="true" tabindex="-1"></a>y1.llr <span class="ot">&lt;-</span> <span class="fu">llr</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N],data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)],data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)],<span class="at">bw=</span>bw,<span class="at">kernel=</span>kernel)    </span>
<span id="cb324-3"><a href="Power.html#cb324-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-4"><a href="Power.html#cb324-4" aria-hidden="true" tabindex="-1"></a><span class="co"># residuals</span></span>
<span id="cb324-5"><a href="Power.html#cb324-5" aria-hidden="true" tabindex="-1"></a>y1residual <span class="ot">&lt;-</span> data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">-</span>y1.llr</span>
<span id="cb324-6"><a href="Power.html#cb324-6" aria-hidden="true" tabindex="-1"></a><span class="co"># squared</span></span>
<span id="cb324-7"><a href="Power.html#cb324-7" aria-hidden="true" tabindex="-1"></a>y1residual.sq <span class="ot">&lt;-</span> y1residual<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb324-8"><a href="Power.html#cb324-8" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">length</span>(y1residual.sq))</span>
<span id="cb324-9"><a href="Power.html#cb324-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-10"><a href="Power.html#cb324-10" aria-hidden="true" tabindex="-1"></a><span class="co"># bandwidth choice</span></span>
<span id="cb324-11"><a href="Power.html#cb324-11" aria-hidden="true" tabindex="-1"></a>MSE.llr.vary1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>y1residual.sq,<span class="at">D=</span>test,<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">1</span>)</span>
<span id="cb324-12"><a href="Power.html#cb324-12" aria-hidden="true" tabindex="-1"></a>bw.var <span class="ot">&lt;-</span> MSE.grid[MSE.llr.vary1<span class="sc">==</span><span class="fu">min</span>(MSE.llr.vary1)]</span>
<span id="cb324-13"><a href="Power.html#cb324-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-14"><a href="Power.html#cb324-14" aria-hidden="true" tabindex="-1"></a><span class="co"># computing conditional variance at bary</span></span>
<span id="cb324-15"><a href="Power.html#cb324-15" aria-hidden="true" tabindex="-1"></a>var.y1.bary <span class="ot">&lt;-</span> <span class="fu">llr</span>(y1residual.sq,data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)],<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">bw=</span>bw.var,<span class="at">kernel=</span>kernel)    </span></code></pre></div>
<p>We now simply need to compute the variance of the LLRRDD estimator using our formula and then to generate the corresponding Minimum Detectable Effect.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="Power.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variance formula</span></span>
<span id="cb325-2"><a href="Power.html#cb325-2" aria-hidden="true" tabindex="-1"></a>var.LLRRDD <span class="ot">&lt;-</span> <span class="cf">function</span>(N,h,densZ,vary0,vary1){</span>
<span id="cb325-3"><a href="Power.html#cb325-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((<span class="dv">1</span><span class="sc">/</span>(N<span class="sc">*</span>h)<span class="sc">*</span>(<span class="dv">4</span><span class="sc">/</span>densZ)<span class="sc">*</span>(vary0<span class="sc">+</span>vary1)))</span>
<span id="cb325-4"><a href="Power.html#cb325-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb325-5"><a href="Power.html#cb325-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-6"><a href="Power.html#cb325-6" aria-hidden="true" tabindex="-1"></a><span class="co"># variance of LLRRDD on y1:</span></span>
<span id="cb325-7"><a href="Power.html#cb325-7" aria-hidden="true" tabindex="-1"></a>varLLRRDD.y1 <span class="ot">&lt;-</span> <span class="fu">var.LLRRDD</span>(<span class="at">N=</span>N,<span class="at">h=</span>bw,<span class="at">densZ=</span>densy2.ybar,<span class="at">vary0=</span>var.y1.bary,<span class="at">vary1=</span>var.y1.bary)</span>
<span id="cb325-8"><a href="Power.html#cb325-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-9"><a href="Power.html#cb325-9" aria-hidden="true" tabindex="-1"></a><span class="co"># MDE</span></span>
<span id="cb325-10"><a href="Power.html#cb325-10" aria-hidden="true" tabindex="-1"></a>MDE.LLRRDD <span class="ot">&lt;-</span> <span class="fu">MDE.var</span>(<span class="at">varE=</span>varLLRRDD.y1,<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>In our example, the Minimum Detectable Effect in a sharp Regression Discontinuity Design is thus 0.1.</p>
<div class="remark">
<p><span id="unlabeled-div-197" class="remark"><em>Remark</em>. </span>Another simpler approach would be to simply use the formula for the MDE of a brute force RCT and to vary the sample size as a function of the bandwidth.</p>
</div>
</div>
<div id="power-analysis-for-fuzzy-rdd" class="section level5 hasAnchor" number="7.2.2.1.2">
<h5><span class="header-section-number">7.2.2.1.2</span> Power analysis for fuzzy RDD<a href="Power.html#power-analysis-for-fuzzy-rdd" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>With Fuzzy RRD designs we can now use the formula developed in Theorem <a href="NE.html#thm:AsymWaldRDDLLR">4.8</a>:</p>
<p><span class="math display">\[\begin{align*}
 \var{\hat{\Delta}_{LLRRDDIV}} &amp; \approx \frac{1}{Nh}\left(\frac{1}{\tau^2_{D}}V_{\tau_Y}+\frac{\tau^2_{Y}}{\tau^4_{D}}V_{\tau_D}-2\frac{\tau_{Y}}{\tau^3_{D}}C_{\tau_Y,\tau_D}\right),
\end{align*}\]</span></p>
<p>with</p>
<p><span class="math display">\[\begin{align*}
 \tau_{D} &amp; = \lim_{e\rightarrow 0^{+}}\esp{D_i|Z_i=\bar{z}+e}-\lim_{e\rightarrow 0^{+}}\esp{D_i|Z_i=\bar{z}-e}\\
 V_{\tau_Y} &amp; = \frac{4}{f_Z(\bar{z})}\left(\sigma^2_{Y^r}+\sigma^2_{Y^l}\right) \qquad
 V_{\tau_D}  = \frac{4}{f_Z(\bar{z})}\left(\sigma^2_{D^r}+\sigma^2_{D^l}\right)\\
 C_{\tau_Y,\tau_D}&amp; = \frac{4}{f_Z(\bar{z})}\left(C_{YD^r}+C_{YD^l}\right) \qquad
 \sigma^2_{Y^r}  = \lim_{e\rightarrow 0^{+}}\var{Y_i|Z_i=\bar{z}+e} \\
 C_{YD^r} &amp; = \lim_{e\rightarrow 0^{+}}\cov{Y_i,D_i|Z_i=\bar{z}+e}.
\end{align*}\]</span></p>
<p>We need estimates of all of these quantities in order to be able to estimate the MDE.</p>
<div class="example">
<p><span id="exm:unnamed-chunk-343" class="example"><strong>Example 7.7  </strong></span>Let’s see how this works in our example:</p>
</div>
<p>We first need to simulate data with several periods.
We are going to use the same data for outcomes as we the ones we used for the sharp RDD design.
We simply are going to change the allocation to the treatment from a sharp to a fuzzy allocation rule.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="Power.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb326-2"><a href="Power.html#cb326-2" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(param,<span class="dv">1</span>)</span>
<span id="cb326-3"><a href="Power.html#cb326-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(param)[[<span class="fu">length</span>(param)]] <span class="ot">&lt;-</span> <span class="st">&quot;kappa&quot;</span></span>
<span id="cb326-4"><a href="Power.html#cb326-4" aria-hidden="true" tabindex="-1"></a><span class="co"># error term</span></span>
<span id="cb326-5"><a href="Power.html#cb326-5" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>V <span class="ot">&lt;-</span> param[<span class="st">&quot;gamma&quot;</span>]<span class="sc">*</span>(data<span class="sc">$</span>mu<span class="sc">-</span>param[<span class="st">&quot;barmu&quot;</span>])<span class="sc">+</span>data<span class="sc">$</span>omega</span>
<span id="cb326-6"><a href="Power.html#cb326-6" aria-hidden="true" tabindex="-1"></a><span class="co"># treament status</span></span>
<span id="cb326-7"><a href="Power.html#cb326-7" aria-hidden="true" tabindex="-1"></a>DsFuzz <span class="ot">&lt;-</span> <span class="fu">if_else</span>(((data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)]<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])) <span class="sc">&amp;</span> (data<span class="sc">$</span>V[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)]<span class="sc">&lt;=</span>param[<span class="st">&quot;kappa&quot;</span>])) <span class="sc">|</span> ((data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)]<span class="sc">&gt;</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])) <span class="sc">&amp;</span> (data<span class="sc">$</span>V[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)]<span class="sc">&gt;</span>param[<span class="st">&quot;kappa&quot;</span>])),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb326-8"><a href="Power.html#cb326-8" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>DsFuzz <span class="ot">&lt;-</span> <span class="fu">rep</span>(DsFuzz,T)</span></code></pre></div>
<p>We no need to compute each of the individual components of the formula.
The density <span class="math inline">\(f_Z\)</span> is the same has in the sharp design.
We also need to estimate the conditional variances of <span class="math inline">\(Y_{i,1}\)</span> and <span class="math inline">\(D_i\)</span> on each side of the threshold.
We need to estimate the conditional covariance between <span class="math inline">\(Y_{i,1}\)</span> and <span class="math inline">\(D_i\)</span> on each side of the threshold.
We also need to choose a bandwidth, in general the minimum of all the bandwidths on each side of the threshold.</p>
<p><span class="math inline">\(\tau_D\)</span> and <span class="math inline">\(\tau_Y\)</span> are the denominator and numerator the Wald LLR estimator respectively.
A problem that we have here is that we do not know the numerator of the Wald estimator for the true outcome, and the denominator for <span class="math inline">\(y_{i,1}\)</span> is by definition zero.
This difficulty is very broad since it implies that the we should take into account that the MDE parameter affects the precision of the estimator.
Solving for the MDE then requires solving a non-linear equation.
We are going to eschew this application and only compute the formula for various levels of the MDE, starting with the one for the Sharp estimator.
Another approach would be to start with an MDE of zero and then iterate the formula until convergence.
Tools exist to check whether that sequence would converge but we will study them another time.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="Power.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indicator for being below the threshold</span></span>
<span id="cb327-2"><a href="Power.html#cb327-2" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> Ds</span>
<span id="cb327-3"><a href="Power.html#cb327-3" aria-hidden="true" tabindex="-1"></a><span class="co"># optimal bandwidth by cross validation</span></span>
<span id="cb327-4"><a href="Power.html#cb327-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for y</span></span>
<span id="cb327-5"><a href="Power.html#cb327-5" aria-hidden="true" tabindex="-1"></a>MSE.llr<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N],<span class="at">D=</span>S,<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">0</span>)</span>
<span id="cb327-6"><a href="Power.html#cb327-6" aria-hidden="true" tabindex="-1"></a>MSE.llr<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N],<span class="at">D=</span>S,<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">1</span>)</span>
<span id="cb327-7"><a href="Power.html#cb327-7" aria-hidden="true" tabindex="-1"></a>bw0 <span class="ot">&lt;-</span> MSE.grid[MSE.llr<span class="fl">.0</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.0</span>)]</span>
<span id="cb327-8"><a href="Power.html#cb327-8" aria-hidden="true" tabindex="-1"></a>bw1 <span class="ot">&lt;-</span> MSE.grid[MSE.llr<span class="fl">.1</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.1</span>)]</span>
<span id="cb327-9"><a href="Power.html#cb327-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-10"><a href="Power.html#cb327-10" aria-hidden="true" tabindex="-1"></a><span class="co"># for D</span></span>
<span id="cb327-11"><a href="Power.html#cb327-11" aria-hidden="true" tabindex="-1"></a>MSE.pr.llr<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>data<span class="sc">$</span>DsFuzz[<span class="dv">1</span><span class="sc">:</span>N],<span class="at">D=</span>S,<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">0</span>)</span>
<span id="cb327-12"><a href="Power.html#cb327-12" aria-hidden="true" tabindex="-1"></a>MSE.pr.llr<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>data<span class="sc">$</span>DsFuzz[<span class="dv">1</span><span class="sc">:</span>N],<span class="at">D=</span>S,<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">1</span>)</span>
<span id="cb327-13"><a href="Power.html#cb327-13" aria-hidden="true" tabindex="-1"></a>bwD0 <span class="ot">&lt;-</span> MSE.grid[MSE.pr.llr<span class="fl">.0</span><span class="sc">==</span><span class="fu">min</span>(MSE.pr.llr<span class="fl">.0</span>)]</span>
<span id="cb327-14"><a href="Power.html#cb327-14" aria-hidden="true" tabindex="-1"></a>bwD1 <span class="ot">&lt;-</span> MSE.grid[MSE.pr.llr<span class="fl">.1</span><span class="sc">==</span><span class="fu">min</span>(MSE.pr.llr<span class="fl">.1</span>)]</span>
<span id="cb327-15"><a href="Power.html#cb327-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-16"><a href="Power.html#cb327-16" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment effects estimates</span></span>
<span id="cb327-17"><a href="Power.html#cb327-17" aria-hidden="true" tabindex="-1"></a><span class="co"># y</span></span>
<span id="cb327-18"><a href="Power.html#cb327-18" aria-hidden="true" tabindex="-1"></a>tau.y <span class="ot">&lt;-</span> MDE.LLRRDD <span class="co"># we start with the sharp MDE estimate</span></span>
<span id="cb327-19"><a href="Power.html#cb327-19" aria-hidden="true" tabindex="-1"></a><span class="co"># DsFuzz</span></span>
<span id="cb327-20"><a href="Power.html#cb327-20" aria-hidden="true" tabindex="-1"></a>DsFuzz.bary.llr.pred<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">llr</span>(<span class="at">y=</span>DsFuzz[S<span class="sc">==</span><span class="dv">0</span>],<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">0</span>],<span class="at">gridx=</span><span class="fu">c</span>(<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])),<span class="at">bw=</span>bwD0,<span class="at">kernel=</span>kernel) </span>
<span id="cb327-21"><a href="Power.html#cb327-21" aria-hidden="true" tabindex="-1"></a>DsFuzz.bary.llr.pred<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">llr</span>(<span class="at">y=</span>DsFuzz[S<span class="sc">==</span><span class="dv">1</span>],<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">1</span>],<span class="at">gridx=</span><span class="fu">c</span>(<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])),<span class="at">bw=</span>bwD1,<span class="at">kernel=</span>kernel) </span>
<span id="cb327-22"><a href="Power.html#cb327-22" aria-hidden="true" tabindex="-1"></a>tau.D <span class="ot">&lt;-</span> DsFuzz.bary.llr.pred<span class="fl">.1</span><span class="sc">-</span>DsFuzz.bary.llr.pred<span class="fl">.0</span></span>
<span id="cb327-23"><a href="Power.html#cb327-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-24"><a href="Power.html#cb327-24" aria-hidden="true" tabindex="-1"></a><span class="co"># conditional expectations estimates on both sides</span></span>
<span id="cb327-25"><a href="Power.html#cb327-25" aria-hidden="true" tabindex="-1"></a><span class="co"># LLR estoimate of conditional expectation of DFuzz on y2</span></span>
<span id="cb327-26"><a href="Power.html#cb327-26" aria-hidden="true" tabindex="-1"></a>Pr.D0.llr <span class="ot">&lt;-</span> <span class="fu">llr</span>(DsFuzz[S<span class="sc">==</span><span class="dv">0</span>],data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">0</span>],data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">0</span>],<span class="at">bw=</span>bwD0,<span class="at">kernel=</span>kernel)    </span>
<span id="cb327-27"><a href="Power.html#cb327-27" aria-hidden="true" tabindex="-1"></a>Pr.D1.llr <span class="ot">&lt;-</span> <span class="fu">llr</span>(DsFuzz[S<span class="sc">==</span><span class="dv">1</span>],data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">1</span>],data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">1</span>],<span class="at">bw=</span>bwD1,<span class="at">kernel=</span>kernel)    </span>
<span id="cb327-28"><a href="Power.html#cb327-28" aria-hidden="true" tabindex="-1"></a><span class="co"># llr estimate for y1</span></span>
<span id="cb327-29"><a href="Power.html#cb327-29" aria-hidden="true" tabindex="-1"></a>y.S0.llr <span class="ot">&lt;-</span> <span class="fu">llr</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N][S<span class="sc">==</span><span class="dv">0</span>],data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">0</span>],data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">0</span>],<span class="at">bw=</span>bw0,<span class="at">kernel=</span>kernel)    </span>
<span id="cb327-30"><a href="Power.html#cb327-30" aria-hidden="true" tabindex="-1"></a>y.S1.llr <span class="ot">&lt;-</span> <span class="fu">llr</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N][S<span class="sc">==</span><span class="dv">1</span>],data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">1</span>],data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">1</span>],<span class="at">bw=</span>bw1,<span class="at">kernel=</span>kernel)    </span>
<span id="cb327-31"><a href="Power.html#cb327-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-32"><a href="Power.html#cb327-32" aria-hidden="true" tabindex="-1"></a><span class="co"># conditional variance estimates on both sides</span></span>
<span id="cb327-33"><a href="Power.html#cb327-33" aria-hidden="true" tabindex="-1"></a><span class="co"># residuals</span></span>
<span id="cb327-34"><a href="Power.html#cb327-34" aria-hidden="true" tabindex="-1"></a>yresidual.S0.sq <span class="ot">&lt;-</span> (data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N][S<span class="sc">==</span><span class="dv">0</span>]<span class="sc">-</span>y.S0.llr)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb327-35"><a href="Power.html#cb327-35" aria-hidden="true" tabindex="-1"></a>yresidual.S1.sq <span class="ot">&lt;-</span> (data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N][S<span class="sc">==</span><span class="dv">1</span>]<span class="sc">-</span>y.S1.llr)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb327-36"><a href="Power.html#cb327-36" aria-hidden="true" tabindex="-1"></a>Dresidual.S0.sq <span class="ot">&lt;-</span> (DsFuzz[S<span class="sc">==</span><span class="dv">0</span>]<span class="sc">-</span>Pr.D0.llr)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb327-37"><a href="Power.html#cb327-37" aria-hidden="true" tabindex="-1"></a>Dresidual.S1.sq <span class="ot">&lt;-</span> (DsFuzz[S<span class="sc">==</span><span class="dv">1</span>]<span class="sc">-</span>Pr.D1.llr)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb327-38"><a href="Power.html#cb327-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-39"><a href="Power.html#cb327-39" aria-hidden="true" tabindex="-1"></a><span class="co"># bandwidth choice for variance estimates</span></span>
<span id="cb327-40"><a href="Power.html#cb327-40" aria-hidden="true" tabindex="-1"></a>MSE.llr.vary.S0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>yresidual.S0.sq,<span class="at">D=</span>S[S<span class="sc">==</span><span class="dv">0</span>],<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">0</span>],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">0</span>)</span>
<span id="cb327-41"><a href="Power.html#cb327-41" aria-hidden="true" tabindex="-1"></a>MSE.llr.vary.S1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>yresidual.S1.sq,<span class="at">D=</span>S[S<span class="sc">==</span><span class="dv">1</span>],<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">1</span>],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">1</span>)</span>
<span id="cb327-42"><a href="Power.html#cb327-42" aria-hidden="true" tabindex="-1"></a>bw.vary.S0 <span class="ot">&lt;-</span> MSE.grid[MSE.llr.vary.S0<span class="sc">==</span><span class="fu">min</span>(MSE.llr.vary.S0)]</span>
<span id="cb327-43"><a href="Power.html#cb327-43" aria-hidden="true" tabindex="-1"></a>bw.vary.S1 <span class="ot">&lt;-</span> MSE.grid[MSE.llr.vary.S1<span class="sc">==</span><span class="fu">min</span>(MSE.llr.vary.S1)]</span>
<span id="cb327-44"><a href="Power.html#cb327-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-45"><a href="Power.html#cb327-45" aria-hidden="true" tabindex="-1"></a><span class="co"># computing conditional variance at bary</span></span>
<span id="cb327-46"><a href="Power.html#cb327-46" aria-hidden="true" tabindex="-1"></a>var.y0.bary <span class="ot">&lt;-</span> <span class="fu">llr</span>(yresidual.S0.sq,data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">0</span>],<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">bw=</span>bw.vary.S0,<span class="at">kernel=</span>kernel)    </span>
<span id="cb327-47"><a href="Power.html#cb327-47" aria-hidden="true" tabindex="-1"></a>var.y1.bary <span class="ot">&lt;-</span> <span class="fu">llr</span>(yresidual.S1.sq,data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">1</span>],<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">bw=</span>bw.vary.S1,<span class="at">kernel=</span>kernel)</span>
<span id="cb327-48"><a href="Power.html#cb327-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-49"><a href="Power.html#cb327-49" aria-hidden="true" tabindex="-1"></a><span class="co"># bandwidth choice for variance estimates for D</span></span>
<span id="cb327-50"><a href="Power.html#cb327-50" aria-hidden="true" tabindex="-1"></a>MSE.llr.varD.S0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>Dresidual.S0.sq,<span class="at">D=</span>S[S<span class="sc">==</span><span class="dv">0</span>],<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">0</span>],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">0</span>)</span>
<span id="cb327-51"><a href="Power.html#cb327-51" aria-hidden="true" tabindex="-1"></a>MSE.llr.varD.S1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>Dresidual.S1.sq,<span class="at">D=</span>S[S<span class="sc">==</span><span class="dv">1</span>],<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">1</span>],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">1</span>)</span>
<span id="cb327-52"><a href="Power.html#cb327-52" aria-hidden="true" tabindex="-1"></a>bw.varD.S0 <span class="ot">&lt;-</span> MSE.grid[MSE.llr.varD.S0<span class="sc">==</span><span class="fu">min</span>(MSE.llr.varD.S0)]</span>
<span id="cb327-53"><a href="Power.html#cb327-53" aria-hidden="true" tabindex="-1"></a>bw.varD.S1 <span class="ot">&lt;-</span> MSE.grid[MSE.llr.varD.S1<span class="sc">==</span><span class="fu">min</span>(MSE.llr.varD.S1)]</span>
<span id="cb327-54"><a href="Power.html#cb327-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-55"><a href="Power.html#cb327-55" aria-hidden="true" tabindex="-1"></a><span class="co"># computing conditional variance at bary for D</span></span>
<span id="cb327-56"><a href="Power.html#cb327-56" aria-hidden="true" tabindex="-1"></a>var.D0.bary <span class="ot">&lt;-</span> <span class="fu">llr</span>(Dresidual.S0.sq,data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">0</span>],<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">bw=</span>bw.varD.S0,<span class="at">kernel=</span>kernel)    </span>
<span id="cb327-57"><a href="Power.html#cb327-57" aria-hidden="true" tabindex="-1"></a>var.D1.bary <span class="ot">&lt;-</span> <span class="fu">llr</span>(Dresidual.S1.sq,data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">1</span>],<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">bw=</span>bw.varD.S1,<span class="at">kernel=</span>kernel)</span>
<span id="cb327-58"><a href="Power.html#cb327-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-59"><a href="Power.html#cb327-59" aria-hidden="true" tabindex="-1"></a><span class="co"># conditional covariance estimates on both sides</span></span>
<span id="cb327-60"><a href="Power.html#cb327-60" aria-hidden="true" tabindex="-1"></a><span class="co"># deviations with respect to conditional expectation</span></span>
<span id="cb327-61"><a href="Power.html#cb327-61" aria-hidden="true" tabindex="-1"></a>yresidual.S0 <span class="ot">&lt;-</span> (data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N][S<span class="sc">==</span><span class="dv">0</span>]<span class="sc">-</span>y.S0.llr)</span>
<span id="cb327-62"><a href="Power.html#cb327-62" aria-hidden="true" tabindex="-1"></a>yresidual.S1 <span class="ot">&lt;-</span> (data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N][S<span class="sc">==</span><span class="dv">1</span>]<span class="sc">-</span>y.S1.llr)</span>
<span id="cb327-63"><a href="Power.html#cb327-63" aria-hidden="true" tabindex="-1"></a>Dresidual.S0 <span class="ot">&lt;-</span> (DsFuzz[S<span class="sc">==</span><span class="dv">0</span>]<span class="sc">-</span>Pr.D0.llr)</span>
<span id="cb327-64"><a href="Power.html#cb327-64" aria-hidden="true" tabindex="-1"></a>Dresidual.S1 <span class="ot">&lt;-</span> (DsFuzz[S<span class="sc">==</span><span class="dv">1</span>]<span class="sc">-</span>Pr.D1.llr)</span>
<span id="cb327-65"><a href="Power.html#cb327-65" aria-hidden="true" tabindex="-1"></a><span class="co"># product of deviations on each side</span></span>
<span id="cb327-66"><a href="Power.html#cb327-66" aria-hidden="true" tabindex="-1"></a>yDresidual.S0 <span class="ot">&lt;-</span> yresidual.S0<span class="sc">*</span>Dresidual.S0</span>
<span id="cb327-67"><a href="Power.html#cb327-67" aria-hidden="true" tabindex="-1"></a>yDresidual.S1 <span class="ot">&lt;-</span> yresidual.S1<span class="sc">*</span>Dresidual.S1</span>
<span id="cb327-68"><a href="Power.html#cb327-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-69"><a href="Power.html#cb327-69" aria-hidden="true" tabindex="-1"></a><span class="co"># bandwidth choice for covariance estimates</span></span>
<span id="cb327-70"><a href="Power.html#cb327-70" aria-hidden="true" tabindex="-1"></a>MSE.llr.covyD.S0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>yDresidual.S0,<span class="at">D=</span>S[S<span class="sc">==</span><span class="dv">0</span>],<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">0</span>],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">0</span>)</span>
<span id="cb327-71"><a href="Power.html#cb327-71" aria-hidden="true" tabindex="-1"></a>MSE.llr.covyD.S1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>yDresidual.S1,<span class="at">D=</span>S[S<span class="sc">==</span><span class="dv">1</span>],<span class="at">x=</span>data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">1</span>],<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">1</span>)</span>
<span id="cb327-72"><a href="Power.html#cb327-72" aria-hidden="true" tabindex="-1"></a>bw.covyD.S0 <span class="ot">&lt;-</span> MSE.grid[MSE.llr.covyD.S0<span class="sc">==</span><span class="fu">min</span>(MSE.llr.covyD.S0)]</span>
<span id="cb327-73"><a href="Power.html#cb327-73" aria-hidden="true" tabindex="-1"></a>bw.covyD.S1 <span class="ot">&lt;-</span> MSE.grid[MSE.llr.covyD.S1<span class="sc">==</span><span class="fu">min</span>(MSE.llr.covyD.S1)]</span>
<span id="cb327-74"><a href="Power.html#cb327-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-75"><a href="Power.html#cb327-75" aria-hidden="true" tabindex="-1"></a><span class="co"># computing conditional variance at bary</span></span>
<span id="cb327-76"><a href="Power.html#cb327-76" aria-hidden="true" tabindex="-1"></a>cov.yD0.bary <span class="ot">&lt;-</span> <span class="fu">llr</span>(yDresidual.S0,data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">0</span>],<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">bw=</span>bw.covyD.S0,<span class="at">kernel=</span>kernel)    </span>
<span id="cb327-77"><a href="Power.html#cb327-77" aria-hidden="true" tabindex="-1"></a>cov.yD1.bary <span class="ot">&lt;-</span> <span class="fu">llr</span>(yDresidual.S1,data<span class="sc">$</span>y0[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)][S<span class="sc">==</span><span class="dv">1</span>],<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">bw=</span>bw.covyD.S1,<span class="at">kernel=</span>kernel)</span>
<span id="cb327-78"><a href="Power.html#cb327-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-79"><a href="Power.html#cb327-79" aria-hidden="true" tabindex="-1"></a><span class="co"># computing the minimum bandwidth</span></span>
<span id="cb327-80"><a href="Power.html#cb327-80" aria-hidden="true" tabindex="-1"></a>h.Fuzz <span class="ot">&lt;-</span> <span class="fu">min</span>(bw.covyD.S1,bw.covyD.S0,bw.vary.S0,bw.vary.S1,bwD0,bwD1,bw0,bw1)</span></code></pre></div>
<p>We now simply need to compute the variance of the LLRRDDIV estimator using our formula and then to generate the corresponding Minimum Detectable Effect.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="Power.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variance formula</span></span>
<span id="cb328-2"><a href="Power.html#cb328-2" aria-hidden="true" tabindex="-1"></a>var.LLRRDD.IV <span class="ot">&lt;-</span> <span class="cf">function</span>(N,h,tauD,tauY,densZ,vary0,vary1,varD0,varD1,covyD0,covyD1){</span>
<span id="cb328-3"><a href="Power.html#cb328-3" aria-hidden="true" tabindex="-1"></a>  VtauY <span class="ot">&lt;-</span> (<span class="dv">4</span><span class="sc">/</span>densZ)<span class="sc">*</span>(vary0<span class="sc">+</span>vary1)</span>
<span id="cb328-4"><a href="Power.html#cb328-4" aria-hidden="true" tabindex="-1"></a>  VtauD <span class="ot">&lt;-</span> (<span class="dv">4</span><span class="sc">/</span>densZ)<span class="sc">*</span>(varD0<span class="sc">+</span>varD1)</span>
<span id="cb328-5"><a href="Power.html#cb328-5" aria-hidden="true" tabindex="-1"></a>  CtauYtauD <span class="ot">&lt;-</span> (<span class="dv">4</span><span class="sc">/</span>densZ)<span class="sc">*</span>(covyD0<span class="sc">+</span>covyD1)</span>
<span id="cb328-6"><a href="Power.html#cb328-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((<span class="dv">1</span><span class="sc">/</span>(N<span class="sc">*</span>h)<span class="sc">*</span>(VtauY<span class="sc">/</span>tauD<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>VtauD<span class="sc">*</span>tauY<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>tauD<span class="sc">^</span><span class="dv">4-2</span><span class="sc">*</span>tauY<span class="sc">*</span>CtauYtauD<span class="sc">/</span>tauD<span class="sc">^</span><span class="dv">3</span>)))</span>
<span id="cb328-7"><a href="Power.html#cb328-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb328-8"><a href="Power.html#cb328-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-9"><a href="Power.html#cb328-9" aria-hidden="true" tabindex="-1"></a><span class="co"># variance of LLRRDD on y1:</span></span>
<span id="cb328-10"><a href="Power.html#cb328-10" aria-hidden="true" tabindex="-1"></a>varLLRRDD.IV.tauY <span class="ot">&lt;-</span> <span class="fu">var.LLRRDD.IV</span>(<span class="at">N=</span>N,<span class="at">h=</span>h.Fuzz,<span class="at">tauD=</span>tau.D,<span class="at">tauY=</span>tau.y,<span class="at">densZ=</span>densy2.ybar,<span class="at">vary0=</span>var.y0.bary,<span class="at">vary1=</span>var.y1.bary,<span class="at">varD0=</span>var.D0.bary,<span class="at">varD1=</span>var.D1.bary,<span class="at">covyD0=</span>cov.yD0.bary,<span class="at">covyD1=</span>cov.yD1.bary)</span>
<span id="cb328-11"><a href="Power.html#cb328-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-12"><a href="Power.html#cb328-12" aria-hidden="true" tabindex="-1"></a><span class="co"># MDE</span></span>
<span id="cb328-13"><a href="Power.html#cb328-13" aria-hidden="true" tabindex="-1"></a>MDE.LLRRDD.IV <span class="ot">&lt;-</span> <span class="fu">MDE.var</span>(<span class="at">varE=</span>varLLRRDD.IV.tauY,<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)</span>
<span id="cb328-14"><a href="Power.html#cb328-14" aria-hidden="true" tabindex="-1"></a><span class="co"># second iteration</span></span>
<span id="cb328-15"><a href="Power.html#cb328-15" aria-hidden="true" tabindex="-1"></a>varLLRRDD.IV.tauY<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">var.LLRRDD.IV</span>(<span class="at">N=</span>N,<span class="at">h=</span>h.Fuzz,<span class="at">tauD=</span>tau.D,<span class="at">tauY=</span>MDE.LLRRDD.IV,<span class="at">densZ=</span>densy2.ybar,<span class="at">vary0=</span>var.y0.bary,<span class="at">vary1=</span>var.y1.bary,<span class="at">varD0=</span>var.D0.bary,<span class="at">varD1=</span>var.D1.bary,<span class="at">covyD0=</span>cov.yD0.bary,<span class="at">covyD1=</span>cov.yD1.bary)</span>
<span id="cb328-16"><a href="Power.html#cb328-16" aria-hidden="true" tabindex="-1"></a>MDE.LLRRDD.IV<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">MDE.var</span>(<span class="at">varE=</span>varLLRRDD.IV.tauY<span class="fl">.2</span>,<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>In our example, the Minimum Detectable Effect in a Fuzzy Regression Discontinuity Design is thus 0.13.
With a second iteration, using this value in the variance formula, we get a new MDE estimate of 0.13.</p>
</div>
</div>
<div id="power-analysis-for-did" class="section level4 hasAnchor" number="7.2.2.2">
<h4><span class="header-section-number">7.2.2.2</span> Power Analysis for DID<a href="Power.html#power-analysis-for-did" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>With the DID estimator, the two key questions is whether we are in a repeated cross section or in a panel, and whether we want to estimate power for a simple 2$$2 DID estimate, or for an aggregate treatment effect.</p>
<div id="power-estimation-for-simple-did-estimators" class="section level5 hasAnchor" number="7.2.2.2.1">
<h5><span class="header-section-number">7.2.2.2.1</span> Power estimation for simple DID estimators<a href="Power.html#power-estimation-for-simple-did-estimators" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div id="with-panel-data" class="section level6 hasAnchor" number="7.2.2.2.1.1">
<h6><span class="header-section-number">7.2.2.2.1.1</span> With panel data<a href="Power.html#with-panel-data" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>In panel data, we can use Theorem <a href="NE.html#thm:asympnoiseDID">4.11</a> which says that:</p>
<p><span class="math display">\[\begin{align*}
\sqrt{N}(\hat{\Delta}^Y_{DID_{panel}}-\Delta^Y_{DID}) &amp; \stackrel{d}{\rightarrow}
  \mathcal{N}\left(0,\frac{\var{Y_{i,A}^1-Y_{i,B}^0|D_i=1}}{\Pr(D_i=1)}+\frac{\var{Y_{i,A}^0-Y_{i,B}^0|D_i=0}}{1-\Pr(D_i=1)}\right).
\end{align*}\]</span></p>
<p>We thus simply need an estimate of the probability of receiving the treatment and of the variance of the changes in outcomes between two time periods to compute power, MDE and the minimum required sample size.
If there are two pre-treatment periods (and treatment is allocated at period <span class="math inline">\(2\)</span>), we can compute all members of the power computation.
As a result, our estimate of <span class="math inline">\(C(\hat{\Delta}^Y_{DID})\)</span> in panel data is:</p>
<p><span class="math display">\[\begin{align*}
\hat{C}(\hat{\Delta}^Y_{DID_{panel}}) &amp; = \frac{\var{Y_{i,2}-Y_{i,1}|D_i=1}}{p}+\frac{\var{Y_{i,2}-Y_{i,1}|D_i=0}}{1-p},
\end{align*}\]</span></p>
<p>where <span class="math inline">\(p\)</span> is the proportion of individuals in our sample who will be allocated to the treatment.
The corresponding functions in R are:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="Power.html#cb329-1" aria-hidden="true" tabindex="-1"></a>CE.DID.panel.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,varDeltaY1b,varDeltaY0b){</span>
<span id="cb329-2"><a href="Power.html#cb329-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((varDeltaY1b<span class="sc">/</span>p)<span class="sc">+</span>(varDeltaY0b<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p)))</span>
<span id="cb329-3"><a href="Power.html#cb329-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb329-4"><a href="Power.html#cb329-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-5"><a href="Power.html#cb329-5" aria-hidden="true" tabindex="-1"></a>MDE.DID.panel.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,varDeltaY1b,varDeltaY0b,...){</span>
<span id="cb329-6"><a href="Power.html#cb329-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">MDE</span>(<span class="at">CE=</span><span class="fu">CE.DID.panel.fun</span>(<span class="at">p=</span>p,<span class="at">varDeltaY1b=</span>varDeltaY1b,<span class="at">varDeltaY0b=</span>varDeltaY0b),...))</span>
<span id="cb329-7"><a href="Power.html#cb329-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="example">
<p><span id="exm:unnamed-chunk-344" class="example"><strong>Example 7.8  </strong></span>Let us see how this formula works out in our example.
First, we need to generate a sample:</p>
</div>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="Power.html#cb330-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,</span>
<span id="cb330-2"><a href="Power.html#cb330-2" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,</span>
<span id="cb330-3"><a href="Power.html#cb330-3" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.05</span>,<span class="fl">0.05</span>,</span>
<span id="cb330-4"><a href="Power.html#cb330-4" aria-hidden="true" tabindex="-1"></a>           <span class="dv">0</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span>,</span>
<span id="cb330-5"><a href="Power.html#cb330-5" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.15</span>,<span class="fl">0.2</span>,</span>
<span id="cb330-6"><a href="Power.html#cb330-6" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.25</span>,<span class="fl">0.1</span>,<span class="fl">0.05</span>,<span class="dv">0</span>,</span>
<span id="cb330-7"><a href="Power.html#cb330-7" aria-hidden="true" tabindex="-1"></a>           <span class="fl">1.5</span>,<span class="fl">1.25</span>,<span class="dv">1</span>,<span class="fl">0.75</span>,</span>
<span id="cb330-8"><a href="Power.html#cb330-8" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.5</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="fl">0.5</span>,<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb330-9"><a href="Power.html#cb330-9" aria-hidden="true" tabindex="-1"></a>           <span class="fl">0.1</span>,<span class="fl">0.28</span>,<span class="dv">0</span>)</span>
<span id="cb330-10"><a href="Power.html#cb330-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,</span>
<span id="cb330-11"><a href="Power.html#cb330-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;theta1&quot;</span>,<span class="st">&quot;theta2&quot;</span>,<span class="st">&quot;theta3&quot;</span>,<span class="st">&quot;theta4&quot;</span>,</span>
<span id="cb330-12"><a href="Power.html#cb330-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,</span>
<span id="cb330-13"><a href="Power.html#cb330-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;delta1&quot;</span>,<span class="st">&quot;delta2&quot;</span>,<span class="st">&quot;delta3&quot;</span>,<span class="st">&quot;delta4&quot;</span>,</span>
<span id="cb330-14"><a href="Power.html#cb330-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;baralpha1&quot;</span>,<span class="st">&quot;baralpha2&quot;</span>,<span class="st">&quot;baralpha3&quot;</span>,<span class="st">&quot;baralpha4&quot;</span>,</span>
<span id="cb330-15"><a href="Power.html#cb330-15" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;barchi1&quot;</span>,<span class="st">&quot;barchi2&quot;</span>,<span class="st">&quot;barchi3&quot;</span>,<span class="st">&quot;barchi4&quot;</span>,</span>
<span id="cb330-16"><a href="Power.html#cb330-16" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;kappa1&quot;</span>,<span class="st">&quot;kappa2&quot;</span>,<span class="st">&quot;kappa3&quot;</span>,<span class="st">&quot;kappa4&quot;</span>,</span>
<span id="cb330-17"><a href="Power.html#cb330-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;xi1&quot;</span>,<span class="st">&quot;xi2&quot;</span>,<span class="st">&quot;xi3&quot;</span>,<span class="st">&quot;xi4&quot;</span>,</span>
<span id="cb330-18"><a href="Power.html#cb330-18" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;gamma&quot;</span>,<span class="st">&quot;sigma2omega&quot;</span>,<span class="st">&quot;rhoetaomega&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="Power.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb331-2"><a href="Power.html#cb331-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb331-3"><a href="Power.html#cb331-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb331-4"><a href="Power.html#cb331-4" aria-hidden="true" tabindex="-1"></a>cov.eta.omega <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(param[<span class="st">&quot;sigma2eta&quot;</span>],param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;sigma2omega&quot;</span>]),<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb331-5"><a href="Power.html#cb331-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">mvrnorm</span>(N<span class="sc">*</span>T,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),cov.eta.omega))</span>
<span id="cb331-6"><a href="Power.html#cb331-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;eta&#39;</span>,<span class="st">&#39;omega&#39;</span>)</span>
<span id="cb331-7"><a href="Power.html#cb331-7" aria-hidden="true" tabindex="-1"></a><span class="co"># time and individual identifiers</span></span>
<span id="cb331-8"><a href="Power.html#cb331-8" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,N),<span class="fu">rep</span>(<span class="dv">2</span>,N),<span class="fu">rep</span>(<span class="dv">3</span>,N),<span class="fu">rep</span>(<span class="dv">4</span>,N))</span>
<span id="cb331-9"><a href="Power.html#cb331-9" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">rep</span>((<span class="dv">1</span><span class="sc">:</span>N),T)</span>
<span id="cb331-10"><a href="Power.html#cb331-10" aria-hidden="true" tabindex="-1"></a><span class="co"># unit fixed effects</span></span>
<span id="cb331-11"><a href="Power.html#cb331-11" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>])),T)</span>
<span id="cb331-12"><a href="Power.html#cb331-12" aria-hidden="true" tabindex="-1"></a><span class="co"># time fixed effects</span></span>
<span id="cb331-13"><a href="Power.html#cb331-13" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>delta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(param[<span class="st">&quot;delta1&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;delta2&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;delta3&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;delta4&quot;</span>],N))</span>
<span id="cb331-14"><a href="Power.html#cb331-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>baralphat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(param[<span class="st">&quot;baralpha1&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;baralpha2&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;baralpha3&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;baralpha4&quot;</span>],N))</span>
<span id="cb331-15"><a href="Power.html#cb331-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-16"><a href="Power.html#cb331-16" aria-hidden="true" tabindex="-1"></a><span class="co"># building autocorrelated error terms</span></span>
<span id="cb331-17"><a href="Power.html#cb331-17" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">*</span>T,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb331-18"><a href="Power.html#cb331-18" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>U[<span class="dv">1</span><span class="sc">:</span>N] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb331-19"><a href="Power.html#cb331-19" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>U[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)] <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>data<span class="sc">$</span>U[<span class="dv">1</span><span class="sc">:</span>N] <span class="sc">+</span> data<span class="sc">$</span>epsilon[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)]</span>
<span id="cb331-20"><a href="Power.html#cb331-20" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>U[(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N)] <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>data<span class="sc">$</span>U[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)] <span class="sc">+</span> data<span class="sc">$</span>epsilon[(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N)]</span>
<span id="cb331-21"><a href="Power.html#cb331-21" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>U[(<span class="dv">3</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(T<span class="sc">*</span>N)] <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>data<span class="sc">$</span>U[(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N)] <span class="sc">+</span> data<span class="sc">$</span>epsilon[(<span class="dv">3</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(T<span class="sc">*</span>N)]</span>
<span id="cb331-22"><a href="Power.html#cb331-22" aria-hidden="true" tabindex="-1"></a><span class="co"># potential outcomes in the absence of the treatment</span></span>
<span id="cb331-23"><a href="Power.html#cb331-23" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>y0 <span class="ot">&lt;-</span> data<span class="sc">$</span>mu <span class="sc">+</span> data<span class="sc">$</span>delta <span class="sc">+</span> data<span class="sc">$</span>U </span>
<span id="cb331-24"><a href="Power.html#cb331-24" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(data<span class="sc">$</span>y0)</span>
<span id="cb331-25"><a href="Power.html#cb331-25" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment timing</span></span>
<span id="cb331-26"><a href="Power.html#cb331-26" aria-hidden="true" tabindex="-1"></a><span class="co"># error term</span></span>
<span id="cb331-27"><a href="Power.html#cb331-27" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>V <span class="ot">&lt;-</span> param[<span class="st">&quot;gamma&quot;</span>]<span class="sc">*</span>(data<span class="sc">$</span>mu<span class="sc">-</span>param[<span class="st">&quot;barmu&quot;</span>])<span class="sc">+</span>data<span class="sc">$</span>omega</span>
<span id="cb331-28"><a href="Power.html#cb331-28" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment group, with 99 for the never treated instead of infinity</span></span>
<span id="cb331-29"><a href="Power.html#cb331-29" aria-hidden="true" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">if_else</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">+</span>param[<span class="st">&quot;xi1&quot;</span>]<span class="sc">+</span>data<span class="sc">$</span>V[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,</span>
<span id="cb331-30"><a href="Power.html#cb331-30" aria-hidden="true" tabindex="-1"></a>              <span class="fu">if_else</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">+</span>param[<span class="st">&quot;xi2&quot;</span>]<span class="sc">+</span>data<span class="sc">$</span>V[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">2</span>,</span>
<span id="cb331-31"><a href="Power.html#cb331-31" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">if_else</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">+</span>param[<span class="st">&quot;xi3&quot;</span>]<span class="sc">+</span>data<span class="sc">$</span>V[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">3</span>,</span>
<span id="cb331-32"><a href="Power.html#cb331-32" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">if_else</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">+</span>param[<span class="st">&quot;xi4&quot;</span>]<span class="sc">+</span>data<span class="sc">$</span>V[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">4</span>,<span class="dv">99</span>))))</span>
<span id="cb331-33"><a href="Power.html#cb331-33" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(Ds,T)</span>
<span id="cb331-34"><a href="Power.html#cb331-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment status</span></span>
<span id="cb331-35"><a href="Power.html#cb331-35" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>D <span class="ot">&lt;-</span> <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">&gt;</span>data<span class="sc">$</span>time,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb331-36"><a href="Power.html#cb331-36" aria-hidden="true" tabindex="-1"></a><span class="co"># potential outcomes with the treatment</span></span>
<span id="cb331-37"><a href="Power.html#cb331-37" aria-hidden="true" tabindex="-1"></a><span class="co"># effect of the treatment by group</span></span>
<span id="cb331-38"><a href="Power.html#cb331-38" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>baralphatd <span class="ot">&lt;-</span> <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">1</span>,param[<span class="st">&quot;barchi1&quot;</span>],</span>
<span id="cb331-39"><a href="Power.html#cb331-39" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">2</span>,param[<span class="st">&quot;barchi2&quot;</span>],</span>
<span id="cb331-40"><a href="Power.html#cb331-40" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">3</span>,param[<span class="st">&quot;barchi3&quot;</span>],</span>
<span id="cb331-41"><a href="Power.html#cb331-41" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">4</span>,param[<span class="st">&quot;barchi4&quot;</span>],<span class="dv">0</span>))))<span class="sc">+</span></span>
<span id="cb331-42"><a href="Power.html#cb331-42" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">1</span>,param[<span class="st">&quot;kappa1&quot;</span>],</span>
<span id="cb331-43"><a href="Power.html#cb331-43" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">2</span>,param[<span class="st">&quot;kappa2&quot;</span>],</span>
<span id="cb331-44"><a href="Power.html#cb331-44" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">3</span>,param[<span class="st">&quot;kappa3&quot;</span>],</span>
<span id="cb331-45"><a href="Power.html#cb331-45" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">4</span>,param[<span class="st">&quot;kappa4&quot;</span>],<span class="dv">0</span>))))<span class="sc">*</span>(data<span class="sc">$</span>t<span class="sc">-</span>data<span class="sc">$</span>Ds)<span class="sc">*</span><span class="fu">if_else</span>(data<span class="sc">$</span>time<span class="sc">&gt;=</span>data<span class="sc">$</span>Ds,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb331-46"><a href="Power.html#cb331-46" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>y1 <span class="ot">&lt;-</span> data<span class="sc">$</span>y0 <span class="sc">+</span> data<span class="sc">$</span>baralphat <span class="sc">+</span> data<span class="sc">$</span>baralphatd <span class="sc">+</span> <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">1</span>,param[<span class="st">&quot;theta1&quot;</span>],<span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">2</span>,param[<span class="st">&quot;theta2&quot;</span>],<span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">3</span>,param[<span class="st">&quot;theta3&quot;</span>],param[<span class="st">&quot;theta4&quot;</span>])))<span class="sc">*</span>data<span class="sc">$</span>mu <span class="sc">+</span> data<span class="sc">$</span>eta</span>
<span id="cb331-47"><a href="Power.html#cb331-47" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Y1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(data<span class="sc">$</span>y1)</span>
<span id="cb331-48"><a href="Power.html#cb331-48" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>y <span class="ot">&lt;-</span> data<span class="sc">$</span>y1<span class="sc">*</span>data<span class="sc">$</span>D<span class="sc">+</span>data<span class="sc">$</span>y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>data<span class="sc">$</span>D)</span>
<span id="cb331-49"><a href="Power.html#cb331-49" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Y <span class="ot">&lt;-</span> data<span class="sc">$</span>Y1<span class="sc">*</span>data<span class="sc">$</span>D<span class="sc">+</span>data<span class="sc">$</span>Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>data<span class="sc">$</span>D)</span></code></pre></div>
<p>Let us estimate the MDE effect for the effect of treatment assigned in period 2.
The DID estimator will compare what happens in period 2 and 3 to those assigned to this treatment with what happens to the never treated at the same time.
A useful way to get at this issue is to use the same treatment and control groups between periods 1 and 2.
Let’s go.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="Power.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimating the variances</span></span>
<span id="cb332-2"><a href="Power.html#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="co"># There are several ways to do thay, but I&#39;m going to use reshape to create variables indexed by time</span></span>
<span id="cb332-3"><a href="Power.html#cb332-3" aria-hidden="true" tabindex="-1"></a>var.y.D <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb332-4"><a href="Power.html#cb332-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(time<span class="sc">&lt;=</span><span class="dv">2</span>,Ds<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> Ds<span class="sc">==</span><span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb332-5"><a href="Power.html#cb332-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(id,time,y,Ds) <span class="sc">%&gt;%</span></span>
<span id="cb332-6"><a href="Power.html#cb332-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;time&quot;</span>,<span class="at">values_from =</span> <span class="st">&quot;y&quot;</span>,<span class="at">names_prefix =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb332-7"><a href="Power.html#cb332-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(</span>
<span id="cb332-8"><a href="Power.html#cb332-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">Deltay12 =</span> y2<span class="sc">-</span>y1</span>
<span id="cb332-9"><a href="Power.html#cb332-9" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb332-10"><a href="Power.html#cb332-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(Ds) <span class="sc">%&gt;%</span></span>
<span id="cb332-11"><a href="Power.html#cb332-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(</span>
<span id="cb332-12"><a href="Power.html#cb332-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">var.Deltay12 =</span> <span class="fu">var</span>(Deltay12)</span>
<span id="cb332-13"><a href="Power.html#cb332-13" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb332-14"><a href="Power.html#cb332-14" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of treated</span></span>
<span id="cb332-15"><a href="Power.html#cb332-15" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">==</span><span class="dv">2</span>,Ds<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> Ds<span class="sc">==</span><span class="dv">99</span>) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">pD2=</span><span class="fu">mean</span>(D)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(pD2)</span></code></pre></div>
<p>We can thus compute the minimum detectable effect for various sample sizes and proportions of treated individuals, using <span class="math inline">\(\hatvar{y_{i,2}-y_{i,1}|D_i=1}=\)</span> 0.09 and <span class="math inline">\(\hatvar{y_{i,2}-y_{i,1}|D_i=0}=\)</span> 0.06.
Let us finally check what Minimum Detectable Effect looks like as a function of <span class="math inline">\(p\)</span> and of sample size.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="Power.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb333-2"><a href="Power.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb333-3"><a href="Power.html#cb333-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb333-4"><a href="Power.html#cb333-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100&quot;</span>),<span class="at">fun=</span>MDE.DID.panel.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100</span>,<span class="at">varDeltaY1b=</span><span class="fu">as.numeric</span>(var.y.D[<span class="dv">1</span>,<span class="dv">2</span>]),<span class="at">varDeltaY0b=</span><span class="fu">as.numeric</span>(var.y.D[<span class="dv">2</span>,<span class="dv">2</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb333-5"><a href="Power.html#cb333-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;1000&quot;</span>),<span class="at">fun=</span>MDE.DID.panel.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">1000</span>,<span class="at">varDeltaY1b=</span><span class="fu">as.numeric</span>(var.y.D[<span class="dv">1</span>,<span class="dv">2</span>]),<span class="at">varDeltaY0b=</span><span class="fu">as.numeric</span>(var.y.D[<span class="dv">2</span>,<span class="dv">2</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb333-6"><a href="Power.html#cb333-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;10000&quot;</span>),<span class="at">fun=</span>MDE.DID.panel.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">10000</span>,<span class="at">varDeltaY1b=</span><span class="fu">as.numeric</span>(var.y.D[<span class="dv">1</span>,<span class="dv">2</span>]),<span class="at">varDeltaY0b=</span><span class="fu">as.numeric</span>(var.y.D[<span class="dv">2</span>,<span class="dv">2</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb333-7"><a href="Power.html#cb333-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100000&quot;</span>),<span class="at">fun=</span>MDE.DID.panel.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100000</span>,<span class="at">varDeltaY1b=</span><span class="fu">as.numeric</span>(var.y.D[<span class="dv">1</span>,<span class="dv">2</span>]),<span class="at">varDeltaY0b=</span><span class="fu">as.numeric</span>(var.y.D[<span class="dv">2</span>,<span class="dv">2</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb333-8"><a href="Power.html#cb333-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;N&quot;</span>) <span class="sc">+</span></span>
<span id="cb333-9"><a href="Power.html#cb333-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;MDE&quot;</span>) <span class="sc">+</span></span>
<span id="cb333-10"><a href="Power.html#cb333-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;p&quot;</span>) <span class="sc">+</span></span>
<span id="cb333-11"><a href="Power.html#cb333-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MDEDIDPlot"></span>
<img src="STCI_files/figure-html/MDEDIDPlot-1.png" alt="Minimum detectable effect for the 2 periods, 2 groups DID design in panel data" width="65%" />
<p class="caption">
Figure 7.11: Minimum detectable effect for the 2 periods, 2 groups DID design in panel data
</p>
</div>
<p>The actual proportion of treated in period 2 (vs never treated) is equal, in our sample, to 0.24.
With a sample size of <span class="math inline">\(N=100\)</span>, we reach a MDE of 0.19.<br />
With a sample size of <span class="math inline">\(N=1000\)</span>, we reach a MDE of 0.06.<br />
With a sample size of <span class="math inline">\(N=10000\)</span>, we reach a MDE of 0.02.<br />
With a sample size of <span class="math inline">\(N=100000\)</span>, we reach a MDE of 0.006.</p>
</div>
<div id="with-repeated-cross-sections" class="section level6 hasAnchor" number="7.2.2.2.1.2">
<h6><span class="header-section-number">7.2.2.2.1.2</span> With repeated cross sections<a href="Power.html#with-repeated-cross-sections" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>In repeated cross sections, we can use Theorem <a href="NE.html#thm:asympnoiseDIDCross">4.12</a> which says that:</p>
<p><span class="math display">\[\begin{align*}
\sqrt{N}(\hat{\Delta}^Y_{DID_{cs}}-\Delta^Y_{DID}) &amp; \stackrel{d}{\rightarrow}
  \mathcal{N}\left(0,\frac{\var{Y^0_{i,B}|D_i=0}}{(1-p)(1-p_A)}
                            +\frac{\var{Y^0_{i,B}|D_i=1}}{p(1-p_A)}\right.\\
                &amp; \phantom{\stackrel{d}{\rightarrow}\mathcal{N}\left(0,\right.} \left.
                            +\frac{\var{Y^0_{i,A}|D_i=0}}{(1-p)p_A}
                            +\frac{\var{Y^1_{i,A}|D_i=1}}{pp_A}\right).
\end{align*}\]</span></p>
<p>where <span class="math inline">\(p=\Pr(D_i=1)\)</span> and <span class="math inline">\(p_A\)</span> is the proportion of observations belonging to the After period.
As a result, our estimate of <span class="math inline">\(C(\hat{\Delta}^Y_{DID_{cs}})\)</span> in repeated cross sections is:</p>
<p><span class="math display">\[\begin{align*}
\hat{C}(\hat{\Delta}^Y_{DID_{cs}}) &amp; = \frac{\var{Y_{i,2}|D_i=1}}{pp_A}+ \frac{\var{Y_{i,1}|D_i=1}}{p(1-p_A)}+\frac{\var{Y_{i,2}|D_i=0}}{(1-p)p_A}+ \frac{\var{Y_{i,1}|D_i=0}}{(1-p)(1-p_A)}.
\end{align*}\]</span></p>
<p>The corresponding functions in R are:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="Power.html#cb334-1" aria-hidden="true" tabindex="-1"></a>CE.DID.cs.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,pA,varY1b,varY0b,varY1a,varY0a){</span>
<span id="cb334-2"><a href="Power.html#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((varY1a<span class="sc">/</span>(p<span class="sc">*</span>pA))<span class="sc">+</span>(varY0a<span class="sc">/</span>((<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">*</span>pA))<span class="sc">+</span>(varY1b<span class="sc">/</span>(p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>pA)))<span class="sc">+</span>(varY0b<span class="sc">/</span>((<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>pA))))</span>
<span id="cb334-3"><a href="Power.html#cb334-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb334-4"><a href="Power.html#cb334-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-5"><a href="Power.html#cb334-5" aria-hidden="true" tabindex="-1"></a>MDE.DID.cs.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,pA,varY1b,varY0b,varY1a,varY0a,...){</span>
<span id="cb334-6"><a href="Power.html#cb334-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">MDE</span>(<span class="at">CE=</span><span class="fu">CE.DID.cs.fun</span>(<span class="at">p=</span>p,<span class="at">pA=</span>pA,<span class="at">varY1b=</span>varY1b,<span class="at">varY0b=</span>varY0b,<span class="at">varY1a=</span>varY1a,<span class="at">varY0a=</span>varY0a),...))</span>
<span id="cb334-7"><a href="Power.html#cb334-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="example">
<p><span id="exm:unnamed-chunk-345" class="example"><strong>Example 7.9  </strong></span>Let us see how this formula works out in our example.
We are going to keep the same sample and simply ignore the panel data dimension.</p>
</div>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="Power.html#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimating the variances</span></span>
<span id="cb335-2"><a href="Power.html#cb335-2" aria-hidden="true" tabindex="-1"></a>var.y.D.cs <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb335-3"><a href="Power.html#cb335-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(time<span class="sc">&lt;=</span><span class="dv">2</span>,Ds<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> Ds<span class="sc">==</span><span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb335-4"><a href="Power.html#cb335-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(id,time,y,Ds) <span class="sc">%&gt;%</span></span>
<span id="cb335-5"><a href="Power.html#cb335-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(time,Ds) <span class="sc">%&gt;%</span></span>
<span id="cb335-6"><a href="Power.html#cb335-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(</span>
<span id="cb335-7"><a href="Power.html#cb335-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">var.y =</span> <span class="fu">var</span>(y)</span>
<span id="cb335-8"><a href="Power.html#cb335-8" aria-hidden="true" tabindex="-1"></a>            )</span></code></pre></div>
<p>We can now compute the minimum detectable effect for various sample sizes and proportions of treated individuals, using <span class="math inline">\(\hatvar{y_{i,2}|D_i=1}=\)</span> 0.27, <span class="math inline">\(\hatvar{y_{i,1}|D_i=1}=\)</span> 0.19, <span class="math inline">\(\hatvar{y_{i,2}|D_i=0}=\)</span> 0.38, and <span class="math inline">\(\hatvar{y_{i,1}|D_i=0}=\)</span> 0.35.
Let us finally check what Minimum Detectable Effect looks like as a function of <span class="math inline">\(p\)</span> and of sample size, using <span class="math inline">\(p_A=0.5\)</span>.</p>
<div class="remark">
<p><span id="unlabeled-div-198" class="remark"><em>Remark</em>. </span>In order to be fully comparable with the panel data case, we have to account for the fact that <span class="math inline">\(N\)</span> in Theorem <a href="NE.html#thm:asympnoiseDIDCross">4.12</a> is <span class="math inline">\(N\times T\)</span> in Theorem <a href="NE.html#thm:asympnoiseDID">4.11</a>.
For that, we are going to multiply each entry of sample size in the MDE function by <span class="math inline">\(T=2\)</span>.</p>
</div>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="Power.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pA</span></span>
<span id="cb336-2"><a href="Power.html#cb336-2" aria-hidden="true" tabindex="-1"></a>pA <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb336-3"><a href="Power.html#cb336-3" aria-hidden="true" tabindex="-1"></a>Tmult  <span class="ot">&lt;-</span> <span class="dv">2</span> </span>
<span id="cb336-4"><a href="Power.html#cb336-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb336-5"><a href="Power.html#cb336-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb336-6"><a href="Power.html#cb336-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb336-7"><a href="Power.html#cb336-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb336-8"><a href="Power.html#cb336-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100&quot;</span>),<span class="at">fun=</span>MDE.DID.cs.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span>Tmult<span class="sc">*</span><span class="dv">100</span>,<span class="at">pA=</span>pA,<span class="at">varY1b=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">1</span>,<span class="dv">3</span>]),<span class="at">varY0b=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">2</span>,<span class="dv">3</span>]),<span class="at">varY1a=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">3</span>,<span class="dv">3</span>]),<span class="at">varY0a=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">4</span>,<span class="dv">3</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb336-9"><a href="Power.html#cb336-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;1000&quot;</span>),<span class="at">fun=</span>MDE.DID.cs.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span>Tmult<span class="sc">*</span><span class="dv">1000</span>,<span class="at">pA=</span>pA,<span class="at">varY1b=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">1</span>,<span class="dv">3</span>]),<span class="at">varY0b=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">2</span>,<span class="dv">3</span>]),<span class="at">varY1a=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">3</span>,<span class="dv">3</span>]),<span class="at">varY0a=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">4</span>,<span class="dv">3</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb336-10"><a href="Power.html#cb336-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;10000&quot;</span>),<span class="at">fun=</span>MDE.DID.cs.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span>Tmult<span class="sc">*</span><span class="dv">10000</span>,<span class="at">pA=</span>pA,<span class="at">varY1b=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">1</span>,<span class="dv">3</span>]),<span class="at">varY0b=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">2</span>,<span class="dv">3</span>]),<span class="at">varY1a=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">3</span>,<span class="dv">3</span>]),<span class="at">varY0a=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">4</span>,<span class="dv">3</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb336-11"><a href="Power.html#cb336-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100000&quot;</span>),<span class="at">fun=</span>MDE.DID.cs.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span>Tmult<span class="sc">*</span><span class="dv">100000</span>,<span class="at">pA=</span>pA,<span class="at">varY1b=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">1</span>,<span class="dv">3</span>]),<span class="at">varY0b=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">2</span>,<span class="dv">3</span>]),<span class="at">varY1a=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">3</span>,<span class="dv">3</span>]),<span class="at">varY0a=</span><span class="fu">as.numeric</span>(var.y.D.cs[<span class="dv">4</span>,<span class="dv">3</span>]),<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb336-12"><a href="Power.html#cb336-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;N&quot;</span>) <span class="sc">+</span></span>
<span id="cb336-13"><a href="Power.html#cb336-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;MDE&quot;</span>) <span class="sc">+</span></span>
<span id="cb336-14"><a href="Power.html#cb336-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;p&quot;</span>) <span class="sc">+</span></span>
<span id="cb336-15"><a href="Power.html#cb336-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MDEDIDcsPlot"></span>
<img src="STCI_files/figure-html/MDEDIDcsPlot-1.png" alt="Minimum detectable effect for the 2 periods, 2 groups DID design in repeated cross sections" width="65%" />
<p class="caption">
Figure 7.12: Minimum detectable effect for the 2 periods, 2 groups DID design in repeated cross sections
</p>
</div>
<p>The actual proportion of treated in period 2 (vs never treated) is equal, in our sample, to 0.24.
With a sample size of <span class="math inline">\(N\times T=200\)</span>, we reach a MDE of 0.47.<br />
With a sample size of <span class="math inline">\(N\times T=2000\)</span>, we reach a MDE of 0.15.<br />
With a sample size of <span class="math inline">\(N\times T=20000\)</span>, we reach a MDE of 0.05.<br />
With a sample size of <span class="math inline">\(N\times T=200000\)</span>, we reach a MDE of 0.015.</p>
</div>
</div>
<div id="power-estimation-for-aggregate-treatment-effects-from-did-estimators" class="section level5 hasAnchor" number="7.2.2.2.2">
<h5><span class="header-section-number">7.2.2.2.2</span> Power estimation for aggregate treatment effects from DID estimators<a href="Power.html#power-estimation-for-aggregate-treatment-effects-from-did-estimators" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><strong>To Do</strong></p>
</div>
</div>
</div>
<div id="power-analysis-for-observational-methods" class="section level3 hasAnchor" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Power Analysis for Observational Methods<a href="Power.html#power-analysis-for-observational-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Power analysis for observational methods can be based on the results of Theorems <a href="OM.html#thm:AsympWWOLS10">5.4</a> or <a href="OM.html#thm:effbound">5.8</a>.
Let us start with the first one:</p>
<p><span class="math display">\[\begin{align*}
    \sqrt{N}(\hat\Delta^Y_{OLS(X)}-\Delta^Y_{TT}) &amp; \stackrel{d}{\rightarrow}
  \mathcal{N}\left(0,\frac{\var{Y^0_i|X_i,D_i=0}}{1-\Pr(D_i=1)}+\frac{\var{Y^1_i|X_i,D_i=1}}{\Pr(D_i=1)}\right).
\end{align*}\]</span></p>
<p>As a result, our estimate of <span class="math inline">\(C(\hat{\Delta}^Y_{OM})\)</span> is:</p>
<p><span class="math display">\[\begin{align*}
\hat{C}(\hat{\Delta}^Y_{OM}) &amp; = \frac{\var{Y_{i}|X_i,D_i=0}}{1-\Pr(D_i=1)}+\frac{\var{Y_{i}|X_i,D_i=1}}{\Pr(D_i=1)}.
\end{align*}\]</span></p>
<p>The corresponding functions in R are:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="Power.html#cb337-1" aria-hidden="true" tabindex="-1"></a>CE.OM.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,varY1bX,varY0bX){</span>
<span id="cb337-2"><a href="Power.html#cb337-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((varY1bX<span class="sc">/</span>p)<span class="sc">+</span>(varY0bX<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p)))</span>
<span id="cb337-3"><a href="Power.html#cb337-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb337-4"><a href="Power.html#cb337-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-5"><a href="Power.html#cb337-5" aria-hidden="true" tabindex="-1"></a>MDE.OM.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,varY1bX,varY0bX,...){</span>
<span id="cb337-6"><a href="Power.html#cb337-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">MDE</span>(<span class="at">CE=</span><span class="fu">CE.OM.fun</span>(<span class="at">p=</span>p,<span class="at">varY1bX=</span>varY1bX,<span class="at">varY0bX=</span>varY0bX),...))</span>
<span id="cb337-7"><a href="Power.html#cb337-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>A key component to compute <span class="math inline">\(C(\hat{\Delta}^Y_{OM})\)</span> is the variance of <span class="math inline">\(Y_{i}\)</span> conditional on observed covariates.</p>
<div class="example">
<p><span id="exm:unnamed-chunk-347" class="example"><strong>Example 7.10  </strong></span>Let’s see how this works in our example.
We are going to use the same dataset as the one for the fuzzy regression discontinuity design.
In order to be able to implement the MDE estimator with observational methods, we need to have access to one date of selection into the treatment and one outcome observed without the treatment (to be credible that no treatment has been given yet).
We use as treatment, the treatment decided in period <span class="math inline">\(3\)</span>, as outcomes, the ones observed in period <span class="math inline">\(2\)</span> and as controls, the outcomes observed in period <span class="math inline">\(1\)</span>.</p>
</div>
<p>We need to estimate the variance of outcomes <span class="math inline">\(Y_{i,2}\)</span> conditional on <span class="math inline">\(Y_{i,1}\)</span> and <span class="math inline">\(D_i\)</span>.
One way to do that is to regress <span class="math inline">\(Y_{i,2}\)</span> on <span class="math inline">\(Y_{i,1}\)</span> in both the treated and control groups, and then to compute the variance of the residuals.
Let’s do just that.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="Power.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimating the conditional variance</span></span>
<span id="cb338-2"><a href="Power.html#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="co"># putting the data in wide format</span></span>
<span id="cb338-3"><a href="Power.html#cb338-3" aria-hidden="true" tabindex="-1"></a>data.wide <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb338-4"><a href="Power.html#cb338-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(id,time,y,Ds) <span class="sc">%&gt;%</span></span>
<span id="cb338-5"><a href="Power.html#cb338-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;time&quot;</span>,<span class="at">values_from =</span> <span class="st">&quot;y&quot;</span>,<span class="at">names_prefix =</span> <span class="st">&quot;y&quot;</span>) </span>
<span id="cb338-6"><a href="Power.html#cb338-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-7"><a href="Power.html#cb338-7" aria-hidden="true" tabindex="-1"></a><span class="co"># in the treated group</span></span>
<span id="cb338-8"><a href="Power.html#cb338-8" aria-hidden="true" tabindex="-1"></a>regy2y1D1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y2 <span class="sc">~</span> y1,<span class="at">data=</span><span class="fu">filter</span>(data.wide,Ds<span class="sc">==</span><span class="dv">3</span>))</span>
<span id="cb338-9"><a href="Power.html#cb338-9" aria-hidden="true" tabindex="-1"></a>vary2y1D1 <span class="ot">&lt;-</span> <span class="fu">var</span>(regy2y1D1<span class="sc">$</span>residuals)</span>
<span id="cb338-10"><a href="Power.html#cb338-10" aria-hidden="true" tabindex="-1"></a><span class="co"># in the control group</span></span>
<span id="cb338-11"><a href="Power.html#cb338-11" aria-hidden="true" tabindex="-1"></a>regy2y1D0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y2 <span class="sc">~</span> y1,<span class="at">data=</span><span class="fu">filter</span>(data.wide,Ds<span class="sc">==</span><span class="dv">99</span>))</span>
<span id="cb338-12"><a href="Power.html#cb338-12" aria-hidden="true" tabindex="-1"></a>vary2y1D0 <span class="ot">&lt;-</span> <span class="fu">var</span>(regy2y1D0<span class="sc">$</span>residuals)</span>
<span id="cb338-13"><a href="Power.html#cb338-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-14"><a href="Power.html#cb338-14" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of treated</span></span>
<span id="cb338-15"><a href="Power.html#cb338-15" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">==</span><span class="dv">3</span>,Ds<span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> Ds<span class="sc">==</span><span class="dv">99</span>) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">pD3=</span><span class="fu">mean</span>(D)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(pD3)</span></code></pre></div>
<p>We can now compute the minimum detectable effect for various sample sizes and proportions of treated individuals, using <span class="math inline">\(\hatvar{y_{i,2}|y_{i,1},D_i=1}=\)</span> 0.06 and <span class="math inline">\(\hatvar{y_{i,2}|y_{i,1},D_i=0}=\)</span> 0.06.
Let us finally check what Minimum Detectable Effect looks like as a function of <span class="math inline">\(p\)</span> and of sample size.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="Power.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb339-2"><a href="Power.html#cb339-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb339-3"><a href="Power.html#cb339-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb339-4"><a href="Power.html#cb339-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb339-5"><a href="Power.html#cb339-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100&quot;</span>),<span class="at">fun=</span>MDE.OM.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100</span>,<span class="at">varY1bX=</span>vary2y1D1,<span class="at">varY0bX=</span>vary2y1D0,<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb339-6"><a href="Power.html#cb339-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;1000&quot;</span>),<span class="at">fun=</span>MDE.OM.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">1000</span>,<span class="at">varY1bX=</span>vary2y1D1,<span class="at">varY0bX=</span>vary2y1D0,<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb339-7"><a href="Power.html#cb339-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;10000&quot;</span>),<span class="at">fun=</span>MDE.OM.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">10000</span>,<span class="at">varY1bX=</span>vary2y1D1,<span class="at">varY0bX=</span>vary2y1D0,<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb339-8"><a href="Power.html#cb339-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;100000&quot;</span>),<span class="at">fun=</span>MDE.OM.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">N=</span><span class="dv">100000</span>,<span class="at">varY1bX=</span>vary2y1D1,<span class="at">varY0bX=</span>vary2y1D0,<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">oneside=</span><span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb339-9"><a href="Power.html#cb339-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;N&quot;</span>) <span class="sc">+</span></span>
<span id="cb339-10"><a href="Power.html#cb339-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;MDE&quot;</span>) <span class="sc">+</span></span>
<span id="cb339-11"><a href="Power.html#cb339-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;p&quot;</span>) <span class="sc">+</span></span>
<span id="cb339-12"><a href="Power.html#cb339-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MDEOMPlot"></span>
<img src="STCI_files/figure-html/MDEOMPlot-1.png" alt="Minimum detectable effect of observational methods" width="65%" />
<p class="caption">
Figure 7.13: Minimum detectable effect of observational methods
</p>
</div>
<p>The actual proportion of treated (vs never treated) is equal, in our sample, to 0.31.
With a sample size of <span class="math inline">\(N=100\)</span>, we reach a MDE of 0.15.<br />
With a sample size of <span class="math inline">\(N=1000\)</span>, we reach a MDE of 0.05.<br />
With a sample size of <span class="math inline">\(N=10000\)</span>, we reach a MDE of 0.01.<br />
With a sample size of <span class="math inline">\(N=100000\)</span>, we reach a MDE of 0.005.</p>
</div>
</div>
<div id="limitations-of-and-alternatives-to-traditional-power-analysis" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Limitations of and alternatives to traditional power analysis<a href="Power.html#limitations-of-and-alternatives-to-traditional-power-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Up to now, we have focused on traditional power analysis.
There are several limitations with that approach that we are going to detail before describing two alternative approaches.
What is fun is the alternative approaches I propose can be related to traditional power analysis ex-post and give rise to the same interpretations.</p>
<div id="limitations-of-traditional-power-analysis" class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Limitations of traditional power analysis<a href="Power.html#limitations-of-traditional-power-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Traditional power analysis suffers from several limitations that we are going to detail here.</p>
<div id="traditional-power-analysis-favors-publication-bias" class="section level4 hasAnchor" number="7.3.1.1">
<h4><span class="header-section-number">7.3.1.1</span> Traditional power analysis favors publication bias<a href="Power.html#traditional-power-analysis-favors-publication-bias" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Traditional power analysis is based on Null Hypothesis Significance Testing (NHST): we assume that we are going to use a test for deciding whether the treatment effect of interest is significantly different from zero or not.
NHST contributes to publication bias (see Chapter <a href="meta.html#meta">13</a>): by putting emphasis on results that are statistically significant, NHST contributes to populate the published record with an over-representation of statistically significant results.
Since significant effects are larger than the average effect, summaries of the published record using meta-analysis will over-estimate the effect of programs, sometimes severely.
Eschewing NHST, including when conducting power analysis, is one of the many ways to curb publication bias.</p>
<div class="remark">
<p><span id="unlabeled-div-199" class="remark"><em>Remark</em>. </span>This is my own position on this and it is not shared widely.
My priority is for users of statistical tools to focus on the order of magnitude of sampling noise, not on the position of a noisy measurement (a treatment effect estimate) relative to an arbitrary threshold.
Of course, other tools are needed to get rid of publication bias, among registered reports, and they are detailed in Chapter <a href="meta.html#meta">13</a>.</p>
</div>
</div>
<div id="with-default-settings-traditional-power-analysis-has-a-very-low-signal-to-noise-ratio" class="section level4 hasAnchor" number="7.3.1.2">
<h4><span class="header-section-number">7.3.1.2</span> With default settings, traditional power analysis has a very low signal to noise ratio<a href="Power.html#with-default-settings-traditional-power-analysis-has-a-very-low-signal-to-noise-ratio" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>One of my main issues with traditional power analysis is that, with its basic settings that everyone uses, it actually settles on a very low value for the signal to noise ratio.
Let me show you why.
Let’s take <span class="math inline">\(2\epsilon\)</span> as our measure of sampling noise, with <span class="math inline">\(2\epsilon=2\Phi^{-1}\left(\frac{\delta+1}{2}\right)\var{\hat{E}}\)</span>, following Assumption <a href="Power.html#hyp:AsymNE">7.1</a>, with <span class="math inline">\(\delta\)</span> the confidence level used to build the confidence interval.
Let’s use <span class="math inline">\(\beta_A\)</span> as our measure of the size of the treatment effect, which seems a good idea: it is the value of the treatment effect which seems <em>ex ante</em> most likely.
Then we have:</p>
<div class="theorem">
<p><span id="thm:SignalNoiseMDE" class="theorem"><strong>Theorem 7.4  (Signal to Noise Ratio of Traditional Power Analysis) </strong></span>With <span class="math inline">\(\hat{E}\)</span> complying with Assumption <a href="Power.html#hyp:AsymNE">7.1</a>, for a one-sided test of size <span class="math inline">\(\alpha\)</span> and power <span class="math inline">\(\kappa\)</span>, with a minimum detectable effect of <span class="math inline">\(\beta_A\)</span>, we have:</p>
</div>
<p><span class="math display">\[\begin{align*}
  \frac{\beta_A}{2\epsilon} &amp; \approx \frac{\left(\Phi^{-1}\left(\kappa\right)+\Phi^{-1}\left(1-\alpha\right)\right)}
                                            {2\Phi^{-1}\left(\frac{\delta+1}{2}\right)}                          
\end{align*}\]</span></p>
<div class="proof">
<p><span id="unlabeled-div-200" class="proof"><em>Proof</em>. </span>Using Theorems <a href="Power.html#thm:MDE">7.2</a> and Definition <a href="FPSI.html#def:sampnoise">2.1</a>, we have:</p>
<p><span class="math display">\[\begin{align*}
  \frac{\beta_A}{2\epsilon} &amp; \approx \frac{\left(\Phi^{-1}\left(\kappa\right)+\Phi^{-1}\left(1-\alpha\right)\right)\sqrt{\var{\hat{E}}}}
                                            {2\Phi^{-1}\left(\frac{\delta+1}{2}\right)\sqrt{\var{\hat{E}}}} \\
                            &amp; = \frac{\left(\Phi^{-1}\left(\kappa\right)+\Phi^{-1}\left(1-\alpha\right)\right)}
                                            {2\Phi^{-1}\left(\frac{\delta+1}{2}\right)}                          
\end{align*}\]</span></p>
</div>
<div class="remark">
<p><span id="unlabeled-div-201" class="remark"><em>Remark</em>. </span>For a two-sided test, simply replace <span class="math inline">\(\alpha\)</span> by <span class="math inline">\(\frac{\alpha}{2}\)</span> in the formula of Theorem <a href="Power.html#thm:SignalNoiseMDE">7.4</a>.</p>
</div>
<p>Theorem <a href="Power.html#thm:SignalNoiseMDE">7.4</a> shows that the signal to noise ratio of traditional approach power analysis is independent of <span class="math inline">\(\var{\hat{E}}\)</span>, the precision of the estimator.
The signal to noise ratio will always be the same, whatever the precision of the estimator.
This is a very strange property: it means that if we follow the advice of traditional power analysis, we will never have an incentive to increase the signal to noise ratio.
This could very well not be a problem if the signal to noise ratio implied by traditional power analysis with its default settings (<span class="math inline">\(\alpha=0.05\)</span> and <span class="math inline">\(\kappa=0.80\)</span>) was large.
What is its size in practice?
Let’s compute it.
In order to so, let’s define first a function which will compute the signal to noise ratio of traditional power analysis.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="Power.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># functino computing signal to noise ratio</span></span>
<span id="cb340-2"><a href="Power.html#cb340-2" aria-hidden="true" tabindex="-1"></a>signal.to.noise <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha,kappa,delta,<span class="at">oneside=</span><span class="cn">FALSE</span>){</span>
<span id="cb340-3"><a href="Power.html#cb340-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (oneside<span class="sc">==</span><span class="cn">TRUE</span>){</span>
<span id="cb340-4"><a href="Power.html#cb340-4" aria-hidden="true" tabindex="-1"></a>    StoN <span class="ot">&lt;-</span> (<span class="fu">qnorm</span>(kappa)<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha))<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">qnorm</span>((delta<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb340-5"><a href="Power.html#cb340-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb340-6"><a href="Power.html#cb340-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (oneside<span class="sc">==</span><span class="cn">FALSE</span>){</span>
<span id="cb340-7"><a href="Power.html#cb340-7" aria-hidden="true" tabindex="-1"></a>    StoN <span class="ot">&lt;-</span> (<span class="fu">qnorm</span>(kappa)<span class="sc">+</span><span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>alpha<span class="sc">/</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">qnorm</span>((delta<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb340-8"><a href="Power.html#cb340-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb340-9"><a href="Power.html#cb340-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(StoN)</span>
<span id="cb340-10"><a href="Power.html#cb340-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>With the basic settings of traditional power analysis (<span class="math inline">\(\alpha=0.05\)</span> and <span class="math inline">\(\kappa=0.80\)</span>) and with <span class="math inline">\(\delta=0.95\)</span>, we thus have a signal to noise ratio equal to 0.63 with a one-sided test and to 0.71 with a two-sided test.
With the same basic settings and <span class="math inline">\(\delta=0.99\)</span>, we have a signal to noise ratio of 0.48 with a one-sided test and to 0.54 with a two-sided test.</p>
<p>So, depending on how we define sampling noise and on the details of the power analysis, traditional power analysis gives rise to estimates with a signal to noise ratio between 0.5 and 0.7.
A signal to noise ratio of 0.5 to 0.7 is <strong>very</strong> imprecise.
It means that we accept a procedure which gives us, routinely, estimates of treatment effects where the signal (the treatment effect) is equal to 50% to 70% of the sampling noise.</p>
<p>Physicists like to express their estimates as multiples of <span class="math inline">\(\sigma=\sqrt{\var{\hat{E}}}\)</span>, the standard error of the estimated treatment effect.
Using the proof of Theorem <a href="Power.html#thm:SignalNoiseMDE">7.4</a>, we can show that <span class="math inline">\(\beta_A=\frac{\beta_A}{2\epsilon}2\Phi^{-1}\left(\frac{\delta+1}{2}\right)\sigma\)</span>, with traditional power analysis.
When <span class="math inline">\(\frac{\beta_A}{2\epsilon}=0.5\)</span>, as with the default settings of traditional power analysis, we have <span class="math inline">\(\beta_A=\Phi^{-1}\left(\frac{\delta+1}{2}\right)\sigma\)</span>, that is <span class="math inline">\(\beta_A=\)</span> 2.58 <span class="math inline">\(\sigma\)</span> with <span class="math inline">\(\delta=0.99\)</span> and <span class="math inline">\(\beta_A=\)</span> 1.96 <span class="math inline">\(\sigma\)</span> with <span class="math inline">\(\delta=0.95\)</span>.
So we operate at levels of 2 to 2.5 <span class="math inline">\(\sigma\)</span>, whereas physicists like to operate at <span class="math inline">\(5\sigma\)</span>, that is at levels of precision at least twice as large.</p>
<p>How could we reach levels of precision similar to the ones the physicists use?
One way would be to require a lower <span class="math inline">\(\alpha\)</span> as a default setting of power analysis.
Using <span class="math inline">\(\alpha=0.01\)</span> for example gives rise to signal to noise ratios of 0.81 with a one-sided test and to 0.87 with a two-sided test <span class="math inline">\(\delta=0.95\)</span> and to 0.61 with a one-sided test and to 0.66 with a two-sided test and <span class="math inline">\(\delta=0.99\)</span>.
These are insufficient to reach the required precision.
Indeed, we are at precision levels of <span class="math inline">\(\beta_A=\)</span> 3.42 <span class="math inline">\(\sigma\)</span> with <span class="math inline">\(\delta=0.99\)</span> and <span class="math inline">\(\beta_A=\)</span> 3.42 <span class="math inline">\(\sigma\)</span> with <span class="math inline">\(\delta=0.95\)</span>.
If we set <span class="math inline">\(\kappa=0.95\)</span>, we will be operating in precision levels that are closer to the pysicists’ one: <span class="math inline">\(\beta_A=\)</span> 4.22 <span class="math inline">\(\sigma\)</span> with <span class="math inline">\(\delta=0.99\)</span> and <span class="math inline">\(\beta_A=\)</span> 4.22 <span class="math inline">\(\sigma\)</span> with <span class="math inline">\(\delta=0.95\)</span>.</p>
<div class="remark">
<p><span id="unlabeled-div-202" class="remark"><em>Remark</em>. </span>All of this analysis is not to say that we should change our default settings for power analysis to <span class="math inline">\(\alpha=0.01\)</span> and <span class="math inline">\(\kappa=0.95\)</span>.
The sample size requirements for this settings might be daunting.
In the absence of publication bias, running small experiments is fine since we aim to learn from their aggregation in a meta-analysis and not from any single study.</p>
</div>
</div>
<div id="traditional-power-analysis-is-complex" class="section level4 hasAnchor" number="7.3.1.3">
<h4><span class="header-section-number">7.3.1.3</span> Traditional power analysis is complex<a href="Power.html#traditional-power-analysis-is-complex" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Traditional power analysis is not easy to understand and it is actually even harder to communicate to research partners.
I once tried to explain the results of our power computations to a partner in the policy sphere.
She could not understand the concept of minimum detectable effect.
This idea that you’re postulating an effect that you will be able to detect with 80% chance was very weird to her.
In our application (as is the case in a lot of applications), we did not have much choice on sample size.
The most important thing she was trying to get was the threshold effect above which we would detect statistically significant estimates at the usual rates (5% for a two-sided t-test).
She kept asking me for the minimum effect we needed to find that will be deemed different from zero.
After thinking about it, I decided to communicate that effect to her, because she was correct in that the success of an intervention is generally measured in terms of statistical significance (much to my chagrin, as will be detailed in Chapter <a href="meta.html#meta">13</a>).
Her requirement actually made a lot of sense, knowing the way statistical testing is used in practice.</p>
<div class="remark">
<p><span id="unlabeled-div-203" class="remark"><em>Remark</em>. </span>In order to find the minimum effect that will trigger a statistically significant result, you can use the formulae in Theorem <a href="Power.html#thm:MDE">7.2</a> by replacing <span class="math inline">\(\Phi^{-1}\left(\kappa\right)\)</span> by zero.</p>
</div>
<p>A related issue with traditional power analysis is that it requires to specify a lot of different parameters.
For example, in order to spit out a required sample size, you need to choose the size of the test <span class="math inline">\(\alpha\)</span>, whether it is one-sided or two-sided, its power <span class="math inline">\(\kappa\)</span> and the MDE you’re trying to detect (or the most plausible effect size ex-ante).
In general, researchers and practitioners have no idea how to choose these parameters or how to tailor them to their needs.
That is why they rely on default settings most of the time, which gives rise to low precision and signal to noise ratios.</p>
</div>
<div id="traditional-power-analysis-requires-a-closed-form-formula-for-sampling-noise" class="section level4 hasAnchor" number="7.3.1.4">
<h4><span class="header-section-number">7.3.1.4</span> Traditional power analysis requires a closed form formula for sampling noise<a href="Power.html#traditional-power-analysis-requires-a-closed-form-formula-for-sampling-noise" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A final limitation of traditional power analysis is that it only applies to estimators that comply with Assumption <a href="Power.html#hyp:AsymNE">7.1</a>: they need to be asymptotically normal and we need to know their asymptotic distribution.
That is why I spent a lot of time deriving these closed form formulae when I introduced the properties of each method.
Most of these closed form formula do not exist in the literature, but without them, you cannot run traditional power analysis.
The problem is that some estimators might not be asymptotically normally distributed or we might not be able to derive the features of their asymptotic distribution.
What to do in that case?
Let’s see.</p>
</div>
</div>
<div id="an-alternative-to-traditional-power-analysis" class="section level3 hasAnchor" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> An alternative to traditional power analysis<a href="Power.html#an-alternative-to-traditional-power-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The alternative that I propose to traditional power analysis rests on two pillars.
Let’s review them before studying three ways to implement them in practice.</p>
<div id="the-first-pillar-choosing-the-level-of-sampling-noise-directly" class="section level4 hasAnchor" number="7.3.2.1">
<h4><span class="header-section-number">7.3.2.1</span> The first pillar: choosing the level of sampling noise directly<a href="Power.html#the-first-pillar-choosing-the-level-of-sampling-noise-directly" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>I propose to eschew the use of NHST and to focus instead on quantifying sampling noise and the sample size required to reach a given level of precision.
This has several advantages.
First, we have much less parameters to set.
For a given sample size, we can directly estimate the corresponding level of sampling noise.
For a given target level of sampling noise, we can directly compute the sample size required to reach it.
Second, by eschewing NHST, we also help to focus on the size of sampling noise, a qualitative measure, and not on the position of the estimated effect relative to an arbitrarily set threshold.
Third and finally, our approach does not set the signal to noise ratio in stone.
It only focuses on the size of sampling noise and leaves completely unspecified the likely size of the effect.
In a sense, it asks the researcher and her partners what is the level of noise that they are comfortable with.
If the funds are limited and sample size cannot be increased by much, my proposal makes it clear which type precision of we can expect.</p>
<p>In practice, the user of my proposal selects a level of sampling noise, either by specifying <span class="math inline">\(2\epsilon\)</span> or simply <span class="math inline">\(\epsilon\)</span>, and recovers the required sample size.
The user can alternatively select a given sample size <span class="math inline">\(N\)</span> and recover the implied sampling noise (either <span class="math inline">\(2\epsilon\)</span> or <span class="math inline">\(\epsilon\)</span>).
I tend to prefer using <span class="math inline">\(\epsilon\)</span> as a measure of sampling noise since it can be put on the same level as the treatment effect itself by using <span class="math inline">\(\pm\epsilon\)</span> to present precision.
But this is a matter of taste, and using <span class="math inline">\(2\epsilon\)</span> is also fine</p>
<p>Under Assumption <a href="Power.html#hyp:AsymNE">7.1</a>, we can derive the sampling noise for a given sample size and the required sample size to reach a given level of sampling noise if we have an asymptotically normal estimator:</p>
<div class="theorem">
<p><span id="thm:AlternativePower" class="theorem"><strong>Theorem 7.5  (Alternative to Traditional Power Analysis) </strong></span>With <span class="math inline">\(\hat{E}\)</span> complying with Assumption <a href="Power.html#hyp:AsymNE">7.1</a>, we have:</p>
</div>
<p><span class="math display">\[\begin{align*}
  2\epsilon &amp; = 2\Phi^{-1}\left(\frac{\delta+1}{2}\right)\sqrt{\var{\hat{E}}}\\
  N &amp; = 4\left(\Phi^{-1}\left(\frac{\delta+1}{2}\right)\right)^2\frac{C(\hat{E})}{(2\epsilon)^2},
\end{align*}\]</span></p>
<p>with <span class="math inline">\(\var{\hat{E}}=\frac{C(\hat{E})}{N}\)</span>.</p>
<div class="proof">
<p><span id="unlabeled-div-204" class="proof"><em>Proof</em>. </span>The proof is a straighforward application of Theorem <a href="Power.html#thm:MDE">7.2</a> and Definition <a href="FPSI.html#def:sampnoise">2.1</a>.</p>
</div>
<div class="example">
<p><span id="exm:unnamed-chunk-354" class="example"><strong>Example 7.11  </strong></span>Let’s see how Theorem <a href="Power.html#thm:AlternativePower">7.5</a> works in practice.
We are going to focus on the case of the brute force randomized controlled trial, but the approach works similarly with all the other estimators we have examined above.
Let us first generate some data:</p>
</div>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="Power.html#cb341-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>)</span>
<span id="cb341-2"><a href="Power.html#cb341-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;theta&quot;</span>,<span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,<span class="st">&quot;delta&quot;</span>,<span class="st">&quot;baralpha&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="Power.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb342-2"><a href="Power.html#cb342-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb342-3"><a href="Power.html#cb342-3" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))</span>
<span id="cb342-4"><a href="Power.html#cb342-4" aria-hidden="true" tabindex="-1"></a>UB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb342-5"><a href="Power.html#cb342-5" aria-hidden="true" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UB </span>
<span id="cb342-6"><a href="Power.html#cb342-6" aria-hidden="true" tabindex="-1"></a>YB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yB)</span>
<span id="cb342-7"><a href="Power.html#cb342-7" aria-hidden="true" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb342-8"><a href="Power.html#cb342-8" aria-hidden="true" tabindex="-1"></a>Ds[YB<span class="sc">&lt;=</span>param[<span class="st">&quot;barY&quot;</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb342-9"><a href="Power.html#cb342-9" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb342-10"><a href="Power.html#cb342-10" aria-hidden="true" tabindex="-1"></a>eta<span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]))</span>
<span id="cb342-11"><a href="Power.html#cb342-11" aria-hidden="true" tabindex="-1"></a>U0 <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilon</span>
<span id="cb342-12"><a href="Power.html#cb342-12" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0 <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb342-13"><a href="Power.html#cb342-13" aria-hidden="true" tabindex="-1"></a>alpha.i <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta</span>
<span id="cb342-14"><a href="Power.html#cb342-14" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y0<span class="sc">+</span>alpha.i</span>
<span id="cb342-15"><a href="Power.html#cb342-15" aria-hidden="true" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y0)</span>
<span id="cb342-16"><a href="Power.html#cb342-16" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y1)</span>
<span id="cb342-17"><a href="Power.html#cb342-17" aria-hidden="true" tabindex="-1"></a><span class="co"># randomized allocation of 50% of individuals</span></span>
<span id="cb342-18"><a href="Power.html#cb342-18" aria-hidden="true" tabindex="-1"></a>Rs <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb342-19"><a href="Power.html#cb342-19" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Rs<span class="sc">&lt;=</span>.<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb342-20"><a href="Power.html#cb342-20" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y1<span class="sc">*</span>R<span class="sc">+</span>y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>R)</span>
<span id="cb342-21"><a href="Power.html#cb342-21" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y1<span class="sc">*</span>R<span class="sc">+</span>Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>R)</span></code></pre></div>
<p>Let us now compute the required sample size to reach a given precision level <span class="math inline">\(\epsilon\)</span>.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="Power.html#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="co"># basic formulas </span></span>
<span id="cb343-2"><a href="Power.html#cb343-2" aria-hidden="true" tabindex="-1"></a>sample.size.alt <span class="ot">&lt;-</span> <span class="cf">function</span>(epsilon,CE,delta){</span>
<span id="cb343-3"><a href="Power.html#cb343-3" aria-hidden="true" tabindex="-1"></a>    N <span class="ot">&lt;-</span> <span class="dv">4</span><span class="sc">*</span>(<span class="fu">qnorm</span>((delta<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>CE<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>epsilon)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb343-4"><a href="Power.html#cb343-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">round</span>(N))</span>
<span id="cb343-5"><a href="Power.html#cb343-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb343-6"><a href="Power.html#cb343-6" aria-hidden="true" tabindex="-1"></a>epsilon.alt <span class="ot">&lt;-</span> <span class="cf">function</span>(N,CE,delta){</span>
<span id="cb343-7"><a href="Power.html#cb343-7" aria-hidden="true" tabindex="-1"></a>  epsilon <span class="ot">&lt;-</span> <span class="fu">qnorm</span>((delta<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>(CE<span class="sc">/</span>N)</span>
<span id="cb343-8"><a href="Power.html#cb343-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(epsilon)</span>
<span id="cb343-9"><a href="Power.html#cb343-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb343-10"><a href="Power.html#cb343-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-11"><a href="Power.html#cb343-11" aria-hidden="true" tabindex="-1"></a><span class="co"># formulas for the BF design</span></span>
<span id="cb343-12"><a href="Power.html#cb343-12" aria-hidden="true" tabindex="-1"></a>sample.size.alt.BF.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,varYb,...){</span>
<span id="cb343-13"><a href="Power.html#cb343-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sample.size.alt</span>(<span class="at">CE=</span><span class="fu">CE.BF.fun</span>(<span class="at">p=</span>p,<span class="at">varYb=</span>varYb),...))</span>
<span id="cb343-14"><a href="Power.html#cb343-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb343-15"><a href="Power.html#cb343-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-16"><a href="Power.html#cb343-16" aria-hidden="true" tabindex="-1"></a>epsilon.alt.BF.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p,varYb,...){</span>
<span id="cb343-17"><a href="Power.html#cb343-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">epsilon.alt</span>(<span class="at">CE=</span><span class="fu">CE.BF.fun</span>(<span class="at">p=</span>p,<span class="at">varYb=</span>varYb),...))</span>
<span id="cb343-18"><a href="Power.html#cb343-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let us now plot the sample size as a function of the required precision in the brute force design for several values of <span class="math inline">\(p\)</span>:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="Power.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb344-2"><a href="Power.html#cb344-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb344-3"><a href="Power.html#cb344-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">100000</span>) <span class="sc">+</span></span>
<span id="cb344-4"><a href="Power.html#cb344-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;0.5&quot;</span>),<span class="at">fun=</span>sample.size.alt.BF.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">p=</span><span class="fl">0.5</span>,<span class="at">varYb=</span><span class="fu">var</span>(yB),<span class="at">delta=</span><span class="fl">0.99</span>)) <span class="sc">+</span></span>
<span id="cb344-5"><a href="Power.html#cb344-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;0.25&quot;</span>),<span class="at">fun=</span>sample.size.alt.BF.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">p=</span><span class="fl">0.25</span>,<span class="at">varYb=</span><span class="fu">var</span>(yB),<span class="at">delta=</span><span class="fl">0.99</span>)) <span class="sc">+</span></span>
<span id="cb344-6"><a href="Power.html#cb344-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&quot;0.1&quot;</span>),<span class="at">fun=</span>sample.size.alt.BF.fun,<span class="at">args=</span><span class="fu">list</span>(<span class="at">p=</span><span class="fl">0.1</span>,<span class="at">varYb=</span><span class="fu">var</span>(yB),<span class="at">delta=</span><span class="fl">0.99</span>)) <span class="sc">+</span></span>
<span id="cb344-7"><a href="Power.html#cb344-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;p&quot;</span>) <span class="sc">+</span></span>
<span id="cb344-8"><a href="Power.html#cb344-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;N&quot;</span>) <span class="sc">+</span></span>
<span id="cb344-9"><a href="Power.html#cb344-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(epsilon)) <span class="sc">+</span></span>
<span id="cb344-10"><a href="Power.html#cb344-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="fu">log10_trans</span>())<span class="sc">+</span></span>
<span id="cb344-11"><a href="Power.html#cb344-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:NepsilonhatPlot"></span>
<img src="STCI_files/figure-html/NepsilonhatPlot-1.png" alt="Required sample size for a given level of precision for the Brute Force design" width="65%" />
<p class="caption">
Figure 7.14: Required sample size for a given level of precision for the Brute Force design
</p>
</div>
<p>As we can see from Figure <a href="Power.html#fig:NepsilonhatPlot">7.14</a>, in order to reach a precision level of <span class="math inline">\(\pm 0.5\)</span> with <span class="math inline">\(p=0.5\)</span>, we need a sample size of 83.
To reach a precision level of <span class="math inline">\(\pm 0.2\)</span> with <span class="math inline">\(p=0.5\)</span>, we need a sample size of 521.
To reach a precision level of <span class="math inline">\(\pm 0.1\)</span> with <span class="math inline">\(p=0.5\)</span>, we need a sample size of 2083.
To reach a precision level of <span class="math inline">\(\pm 0.02\)</span> with <span class="math inline">\(p=0.5\)</span>, we need a sample size of 5.2079^{4}.</p>
</div>
<div id="the-second-pillar-simulating-treatment-allocation" class="section level4 hasAnchor" number="7.3.2.2">
<h4><span class="header-section-number">7.3.2.2</span> The second pillar: simulating treatment allocation<a href="Power.html#the-second-pillar-simulating-treatment-allocation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Relying on Theorem <a href="Power.html#thm:AlternativePower">7.5</a> to implement my proposed approach solves several issues with traditional power analysis, but it still relies on the existence of an asymptotically normal approximation to sampling noise.
The second pillar of my proposed approach uses randomly selected sample(s) as a way to estimate sampling noise without resorting to the closed form of an asymptotically normal approximation.
I propose to use two distinct approaches: either using one unique random sample or using multiple random samples.
Let’s detail these approaches in turn.</p>
<div id="power-analysis-using-one-random-sample" class="section level5 hasAnchor" number="7.3.2.2.1">
<h5><span class="header-section-number">7.3.2.2.1</span> Power analysis using one random sample<a href="Power.html#power-analysis-using-one-random-sample" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>This approach works well when we have a correct estimator of the sampling noise of our treatment effect but we have not derived its closed form in our particular case, or we have but we do not want to use it because it is too intricate or some components are too difficult to compute.
This is the case for example when we use heteroskedasticity-robust standard errors without deriving how they apply to a treatment setting.
This approach applies well when we have clustering as well, since most statistical software are able to account for clustering for most estimators, but we generally have not derived the precise formulae in a treatment effect context.</p>
<p>In practice, the proposed approach works as follows:</p>
<ol style="list-style-type: decimal">
<li>We resample the baseline data (with replacement) in order to obtain the target sample size.</li>
<li>We allocate the treatment among units as if we were actually implementing the actual selection rule.</li>
<li>We estimate the treatment effect <span class="math inline">\(\hat{E}\)</span> using the estimator <span class="math inline">\(E\)</span> and recover its standard error <span class="math inline">\(\sqrt{\var{\hat{E}}}\)</span>.</li>
<li>We use our estiamte of <span class="math inline">\(\sqrt{\var{\hat{E}}}\)</span> in order to compute an estimate of <span class="math inline">\(\epsilon\)</span> (using Theorem <a href="Power.html#thm:AlternativePower">7.5</a>) or an estimate of MDE (using Theorem <a href="Power.html#thm:MDE">7.2</a>).</li>
</ol>
<p>As a consequence, this approach works either with traditional power analysis (it uses a regression to estmate the sandard error instead of the closed form formula) or with my own proposal.</p>
<div class="remark">
<p><span id="unlabeled-div-205" class="remark"><em>Remark</em>. </span>If the survey is clustered or stratified, step 1 above has to account for that.
If the treatment allocation is clustered or stratified, both step 2 and step 3 have to account for that.</p>
</div>
<div class="example">
<p><span id="exm:unnamed-chunk-356" class="example"><strong>Example 7.12  </strong></span>Let us see how this approach works in our example.
I am going to focus again on the brute force design, but there is a lot to learn by using the same approach for other designs and estimators.
Let us first write a function that resamples the available data with replacement and then that computes the MDE (for the traditional approach to power analysis) and sampling noise <span class="math inline">\(\epsilon\)</span> (for my proposed approach).</p>
</div>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="Power.html#cb345-1" aria-hidden="true" tabindex="-1"></a>MDE.indirect.BF <span class="ot">&lt;-</span> <span class="cf">function</span>(N.simul,y,p,alpha,kappa,delta,...){</span>
<span id="cb345-2"><a href="Power.html#cb345-2" aria-hidden="true" tabindex="-1"></a>  set.seed <span class="ot">&lt;-</span> <span class="dv">1234</span></span>
<span id="cb345-3"><a href="Power.html#cb345-3" aria-hidden="true" tabindex="-1"></a>  resample <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">length</span>(y),N.simul,<span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb345-4"><a href="Power.html#cb345-4" aria-hidden="true" tabindex="-1"></a>  y.simul <span class="ot">&lt;-</span> y[resample]</span>
<span id="cb345-5"><a href="Power.html#cb345-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># randomized allocation of 50% of individuals</span></span>
<span id="cb345-6"><a href="Power.html#cb345-6" aria-hidden="true" tabindex="-1"></a>  Rs.simul <span class="ot">&lt;-</span> <span class="fu">runif</span>(N.simul)</span>
<span id="cb345-7"><a href="Power.html#cb345-7" aria-hidden="true" tabindex="-1"></a>  R.simul <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Rs.simul<span class="sc">&lt;=</span>p,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb345-8"><a href="Power.html#cb345-8" aria-hidden="true" tabindex="-1"></a>  reg.ols.ww.bf.simul <span class="ot">&lt;-</span> <span class="fu">lm</span>(y.simul<span class="sc">~</span>R.simul)</span>
<span id="cb345-9"><a href="Power.html#cb345-9" aria-hidden="true" tabindex="-1"></a>  varE.simul <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(reg.ols.ww.bf.simul,<span class="at">type=</span><span class="st">&#39;HC2&#39;</span>)[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb345-10"><a href="Power.html#cb345-10" aria-hidden="true" tabindex="-1"></a>  MDE.simul <span class="ot">&lt;-</span> <span class="fu">MDE.var</span>(<span class="at">alpha=</span>alpha,<span class="at">kappa=</span>kappa,<span class="at">varE=</span>varE.simul,...)</span>
<span id="cb345-11"><a href="Power.html#cb345-11" aria-hidden="true" tabindex="-1"></a>  epsilon.simul <span class="ot">&lt;-</span> <span class="fu">epsilon.alt</span>(<span class="at">N=</span>N.simul,<span class="at">CE=</span>varE.simul<span class="sc">*</span>N.simul,<span class="at">delta=</span>delta)</span>
<span id="cb345-12"><a href="Power.html#cb345-12" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">c</span>(MDE.simul,epsilon.simul)</span>
<span id="cb345-13"><a href="Power.html#cb345-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;MDE_simul&#39;</span>,<span class="st">&#39;Epsilon_simul&#39;</span>)</span>
<span id="cb345-14"><a href="Power.html#cb345-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb345-15"><a href="Power.html#cb345-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb345-16"><a href="Power.html#cb345-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-17"><a href="Power.html#cb345-17" aria-hidden="true" tabindex="-1"></a><span class="co"># computations</span></span>
<span id="cb345-18"><a href="Power.html#cb345-18" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb345-19"><a href="Power.html#cb345-19" aria-hidden="true" tabindex="-1"></a>test.indirect <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">sapply</span>(N.sample,MDE.indirect.BF,<span class="at">alpha=</span><span class="fl">0.05</span>,<span class="at">kappa=</span><span class="fl">0.8</span>,<span class="at">y=</span>y,<span class="at">p=</span>p,<span class="at">delta=</span><span class="fl">0.99</span>,<span class="at">oneside=</span><span class="cn">FALSE</span>))) </span>
<span id="cb345-20"><a href="Power.html#cb345-20" aria-hidden="true" tabindex="-1"></a>test.indirect<span class="sc">$</span>N.simul <span class="ot">&lt;-</span> N.sample</span>
<span id="cb345-21"><a href="Power.html#cb345-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-22"><a href="Power.html#cb345-22" aria-hidden="true" tabindex="-1"></a><span class="co"># adding results of traditional approach for comparison</span></span>
<span id="cb345-23"><a href="Power.html#cb345-23" aria-hidden="true" tabindex="-1"></a>test.indirect<span class="sc">$</span>MDE_tradi <span class="ot">&lt;-</span><span class="fu">sapply</span>(N.sample,MDE.BF.fun,<span class="at">p=</span>p,<span class="at">varYb=</span><span class="fu">var</span>(yB),<span class="at">alpha=</span><span class="fl">0.05</span>,<span class="at">kappa=</span><span class="fl">0.8</span>,<span class="at">oneside=</span><span class="cn">FALSE</span>)</span>
<span id="cb345-24"><a href="Power.html#cb345-24" aria-hidden="true" tabindex="-1"></a>test.indirect<span class="sc">$</span>Epsilon_tradi <span class="ot">&lt;-</span><span class="fu">sapply</span>(N.sample,epsilon.alt.BF.fun,<span class="at">p=</span>p,<span class="at">varYb=</span><span class="fu">var</span>(yB),<span class="at">delta=</span><span class="fl">0.99</span>)</span>
<span id="cb345-25"><a href="Power.html#cb345-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-26"><a href="Power.html#cb345-26" aria-hidden="true" tabindex="-1"></a><span class="co"># putting results in long form to enable plotting</span></span>
<span id="cb345-27"><a href="Power.html#cb345-27" aria-hidden="true" tabindex="-1"></a>test.indirect.long <span class="ot">&lt;-</span> test.indirect <span class="sc">%&gt;%</span></span>
<span id="cb345-28"><a href="Power.html#cb345-28" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">!</span>N.simul,<span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&#39;Type&#39;</span>,<span class="st">&#39;Method&#39;</span>),<span class="at">names_sep=</span><span class="fu">c</span>(<span class="st">&quot;_&quot;</span>),<span class="at">values_to=</span><span class="st">&#39;Estimate&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb345-29"><a href="Power.html#cb345-29" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(</span>
<span id="cb345-30"><a href="Power.html#cb345-30" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Type=</span><span class="fu">factor</span>(Type,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;MDE&#39;</span>,<span class="st">&#39;Epsilon&#39;</span>)),</span>
<span id="cb345-31"><a href="Power.html#cb345-31" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Method=</span><span class="fu">recode_factor</span>(Method,<span class="st">&quot;simul&quot;</span><span class="ot">=</span><span class="st">&quot;Simulation&quot;</span>,<span class="st">&quot;tradi&quot;</span><span class="ot">=</span><span class="st">&quot;Traditional&quot;</span>),</span>
<span id="cb345-32"><a href="Power.html#cb345-32" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Method=</span><span class="fu">factor</span>(Method,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;Traditional&#39;</span>,<span class="st">&#39;Simulation&#39;</span>))</span>
<span id="cb345-33"><a href="Power.html#cb345-33" aria-hidden="true" tabindex="-1"></a>                        ) </span></code></pre></div>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="Power.html#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test.indirect.long, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.factor</span>(N.simul), <span class="at">y=</span>Estimate, <span class="at">fill=</span>Method)) <span class="sc">+</span></span>
<span id="cb346-2"><a href="Power.html#cb346-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb346-3"><a href="Power.html#cb346-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Sample Size&quot;</span>) <span class="sc">+</span></span>
<span id="cb346-4"><a href="Power.html#cb346-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb346-5"><a href="Power.html#cb346-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(.<span class="sc">~</span>Type)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PlotIndirectBF"></span>
<img src="STCI_files/figure-html/PlotIndirectBF-1.png" alt="MDE, \epsilon and sample size for the Brute Force design using traditional and novel power analysis" width="65%" />
<p class="caption">
Figure 7.15: MDE, and sample size for the Brute Force design using traditional and novel power analysis
</p>
</div>
<p>What is pretty cool is that both approaches find very similar results for both MDE and <span class="math inline">\(\epsilon\)</span>.
What is less expected is that actually MDE and <span class="math inline">\(\epsilon\)</span> are extremely similar, although they relate to profoundly different concepts: MDE refers to a minimum effect size for detection using NHST with <span class="math inline">\(\alpha=0.05\)</span> and <span class="math inline">\(\kappa=0.80\)</span> while <span class="math inline">\(\epsilon\)</span> refers to the sampling noise to be expected with a given sample size for <span class="math inline">\(\delta=0.99\)</span>.
Why does the measure of sampling noise stemming out of my proposed approach ends up being so close to the measure of minimum detectable effect stemming from the traditional approach?
Well, this does make sense once you examine the formulae for both terms in Theorems <a href="Power.html#thm:MDE">7.2</a> and <a href="Power.html#thm:AlternativePower">7.5</a>: both MDE and <span class="math inline">\(\epsilon\)</span> depend on <span class="math inline">\(\sqrt{\var{\hat{E}}}\)</span>.
The formula for MDE multiplies <span class="math inline">\(\sqrt{\var{\hat{E}}}\)</span> by <span class="math inline">\(\Phi^{-1}\left(\kappa\right)+\Phi^{-1}\left(1-\frac{\alpha}{2}\right)\)</span> (in the two-sided case) while the formula for <span class="math inline">\(\epsilon\)</span> multiplies <span class="math inline">\(\sqrt{\var{\hat{E}}}\)</span> by <span class="math inline">\(\Phi^{-1}\left(\frac{\delta+1}{2}\right)\)</span>.
What happens is that these two terms are extremely close to each other with the parameters we have chosen so far.
With <span class="math inline">\(\alpha=0.05\)</span> and <span class="math inline">\(\kappa=0.80\)</span>, the first term is equal to 2.8.
With <span class="math inline">\(\delta=0.99\)</span>, the second term is equal to 2.58.</p>
<p>Overall, my feeling is that even if the results of two approaches are miraculously similar, they have completely different implications.
The traditional approach basically amounts to say that, when you estimate an effect <span class="math inline">\(\beta_A\pm\epsilon\)</span>, it is perfectly fine (and actually best practice) that <span class="math inline">\(\beta_A\)</span> is of the same order of magnitude as <span class="math inline">\(\epsilon\)</span>.
In the best case scenario where <span class="math inline">\(\delta=0.95\)</span>, <span class="math inline">\(\frac{\beta_A}{\epsilon}=\)</span> 1.43 so that is <span class="math inline">\(\beta_A\)</span> is 43% larger than <span class="math inline">\(\epsilon\)</span>.
In the case where <span class="math inline">\(\delta=0.99\)</span>, <span class="math inline">\(\frac{\beta_A}{\epsilon}=\)</span> 1.09 so that is <span class="math inline">\(\beta_A\)</span> is only 33% larger than <span class="math inline">\(\epsilon\)</span>.</p>
<p>With the novel approach, you would probably find these settings appalling and utterly insufficient.
It means that you are accepting a situation in which <span class="math inline">\(\epsilon\)</span> is barely smaller than <span class="math inline">\(\beta_A\)</span>.
You are in a <span class="math inline">\(2\sigma\)</span> world.
The signal to noise ratio is well below one (<span class="math inline">\(\frac{\beta_A}{2\epsilon}=\)</span> 0.71 with <span class="math inline">\(\delta=0.95\)</span> and 0.54 with <span class="math inline">\(\delta=0.99\)</span>).
This is a situation in which you have a 20% chance of not detecting the true effect if it has size <span class="math inline">\(\beta_A\)</span>.
20%!
Why even run the experiment in that case?
I’d be much more comfortable with a 1% to 5% chance.<br />
With these settings, you are adding 0.8 to 1.48 <span class="math inline">\(\sigma\)</span> to your precision.</p>
<p>But, even deeper, my proposed approach wants you to stop thinking about probabilities of detection.
Just think about noise.
Are you fine with an uncertainty of <span class="math inline">\(\pm\epsilon\)</span> around your main estimate?
Does it make sense for you to run this experiment?
If you have no choice (that is sample size has been chosen and the experiment will run), my proposed approach tells you simply that <span class="math inline">\(\pm\epsilon\)</span> is the best you can do and that you have to live with it.
Maybe it will be insufficient for now, but publishing this result and collecting similar ones will get us closer and closer to the truth.</p>
</div>
<div id="power-analysis-using-randomization-inference" class="section level5 hasAnchor" number="7.3.2.2.2">
<h5><span class="header-section-number">7.3.2.2.2</span> Power analysis using randomization inference<a href="Power.html#power-analysis-using-randomization-inference" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>One final limitation of the previous approach is that it is only valid when we have an estimator of sampling noise that is already built-in out statistical software.
What if we do not have such an estimator, or we do not know which one is correct?
Well, here, it might help tremendously to use randomization inference.
We are going to measure of much the treatment effect varies over randomized allocations of the treatment.
This is going to be a good approximation of the magnitude of the sampling noise we will be facing in the real experiment.</p>
<div class="remark">
<p><span id="unlabeled-div-206" class="remark"><em>Remark</em>. </span>One might want to associate ranoomization inference with the bootstrap.
That is, draw a new sample with replacement each time you selevct a new treatment allocation.
Not using the bootstrap will estimate sampling noise for the sample average treatment effect, while combining the bootstrap with randomization inference will estimate sampling noise for the population treatment effect.</p>
</div>
<div class="example">
<p><span id="exm:unnamed-chunk-358" class="example"><strong>Example 7.13  </strong></span>Let’s see how this approach works in our example.
Let’s write the code to produce a randomization inference estimate.</p>
</div>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="Power.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment effect estimate for one randomized sample</span></span>
<span id="cb347-2"><a href="Power.html#cb347-2" aria-hidden="true" tabindex="-1"></a>MDE.indirect.BF.RI <span class="ot">&lt;-</span> <span class="cf">function</span>(seed,N.simul,y,p,alpha,kappa,delta,...){</span>
<span id="cb347-3"><a href="Power.html#cb347-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb347-4"><a href="Power.html#cb347-4" aria-hidden="true" tabindex="-1"></a>  resample <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">length</span>(y),N.simul,<span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb347-5"><a href="Power.html#cb347-5" aria-hidden="true" tabindex="-1"></a>  y.simul <span class="ot">&lt;-</span> y[resample]</span>
<span id="cb347-6"><a href="Power.html#cb347-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># randomized allocation of 50% of individuals</span></span>
<span id="cb347-7"><a href="Power.html#cb347-7" aria-hidden="true" tabindex="-1"></a>  Rs.simul <span class="ot">&lt;-</span> <span class="fu">runif</span>(N.simul)</span>
<span id="cb347-8"><a href="Power.html#cb347-8" aria-hidden="true" tabindex="-1"></a>  R.simul <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Rs.simul<span class="sc">&lt;=</span>p,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb347-9"><a href="Power.html#cb347-9" aria-hidden="true" tabindex="-1"></a>  reg.ols.ww.bf.simul <span class="ot">&lt;-</span> <span class="fu">lm</span>(y.simul<span class="sc">~</span>R.simul)</span>
<span id="cb347-10"><a href="Power.html#cb347-10" aria-hidden="true" tabindex="-1"></a>  estim.RI <span class="ot">&lt;-</span> reg.ols.ww.bf.simul<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]</span>
<span id="cb347-11"><a href="Power.html#cb347-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(estim.RI)</span>
<span id="cb347-12"><a href="Power.html#cb347-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb347-13"><a href="Power.html#cb347-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-14"><a href="Power.html#cb347-14" aria-hidden="true" tabindex="-1"></a>simuls.MDE.indirect.BF.RI <span class="ot">&lt;-</span> <span class="cf">function</span>(Nsim,...){</span>
<span id="cb347-15"><a href="Power.html#cb347-15" aria-hidden="true" tabindex="-1"></a>  MDE.indirect.BF.RI.N <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>Nsim,MDE.indirect.BF.RI,...))</span>
<span id="cb347-16"><a href="Power.html#cb347-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(MDE.indirect.BF.RI.N)</span>
<span id="cb347-17"><a href="Power.html#cb347-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb347-18"><a href="Power.html#cb347-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-19"><a href="Power.html#cb347-19" aria-hidden="true" tabindex="-1"></a>sf.simuls.MDE.indirect.BF.RI <span class="ot">&lt;-</span> <span class="cf">function</span>(Nsim,...){</span>
<span id="cb347-20"><a href="Power.html#cb347-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sfInit</span>(<span class="at">parallel=</span><span class="cn">TRUE</span>,<span class="at">cpus=</span><span class="dv">2</span><span class="sc">*</span>ncpus)</span>
<span id="cb347-21"><a href="Power.html#cb347-21" aria-hidden="true" tabindex="-1"></a>  MDE.indirect.BF.RI.N <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">sfLapply</span>(<span class="dv">1</span><span class="sc">:</span>Nsim,MDE.indirect.BF.RI,...))</span>
<span id="cb347-22"><a href="Power.html#cb347-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sfStop</span>()</span>
<span id="cb347-23"><a href="Power.html#cb347-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(MDE.indirect.BF.RI.N)</span>
<span id="cb347-24"><a href="Power.html#cb347-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb347-25"><a href="Power.html#cb347-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-26"><a href="Power.html#cb347-26" aria-hidden="true" tabindex="-1"></a>Nsim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb347-27"><a href="Power.html#cb347-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Nsim &lt;- 10</span></span>
<span id="cb347-28"><a href="Power.html#cb347-28" aria-hidden="true" tabindex="-1"></a>N.sample <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">1000</span>,<span class="dv">10000</span>,<span class="dv">100000</span>)</span>
<span id="cb347-29"><a href="Power.html#cb347-29" aria-hidden="true" tabindex="-1"></a><span class="co">#N.sample &lt;- c(100,1000,10000)</span></span>
<span id="cb347-30"><a href="Power.html#cb347-30" aria-hidden="true" tabindex="-1"></a><span class="co">#N.sample &lt;- c(100,1000)</span></span>
<span id="cb347-31"><a href="Power.html#cb347-31" aria-hidden="true" tabindex="-1"></a><span class="co">#N.sample &lt;- c(100)</span></span>
<span id="cb347-32"><a href="Power.html#cb347-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-33"><a href="Power.html#cb347-33" aria-hidden="true" tabindex="-1"></a>simuls.sampling.noise.BF.RI <span class="ot">&lt;-</span>  <span class="fu">matrix</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(N.sample,sf.simuls.MDE.indirect.BF.RI,<span class="at">Nsim=</span>Nsim,<span class="at">y=</span>y,<span class="at">p=</span><span class="fl">0.5</span>,<span class="at">alpha=</span><span class="fl">0.05</span>,<span class="at">kappa=</span><span class="fl">0.8</span>,<span class="at">delta=</span><span class="fl">0.99</span>,<span class="at">oneside=</span><span class="cn">FALSE</span>)),<span class="at">ncol=</span><span class="fu">length</span>(N.sample),<span class="at">nrow=</span>Nsim,<span class="at">byrow =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## R Version:  R version 4.1.1 (2021-08-10)</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="Power.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(simuls.sampling.noise.BF.RI) <span class="ot">&lt;-</span> N.sample</span></code></pre></div>
<p>Let’s plot the resulting estimates:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="Power.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb350-2"><a href="Power.html#cb350-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(N.sample)){</span>
<span id="cb350-3"><a href="Power.html#cb350-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(simuls.sampling.noise.BF.RI[[i]],<span class="at">breaks=</span><span class="dv">30</span>,<span class="at">main=</span><span class="fu">paste</span>(<span class="st">&#39;N=&#39;</span>,<span class="fu">as.character</span>(N.sample[i])),<span class="at">xlab=</span><span class="fu">expression</span>(<span class="fu">hat</span>(Delta<span class="sc">^</span>y)[WW]),<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.55</span>,<span class="fl">0.55</span>))</span>
<span id="cb350-4"><a href="Power.html#cb350-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:IndirectBFRIPlot"></span>
<img src="STCI_files/figure-html/IndirectBFRIPlot-1.png" alt="Distribution of the Brute Force estimator using randomization inference" width="50%" />
<p class="caption">
Figure 7.16: Distribution of the Brute Force estimator using randomization inference
</p>
</div>
<p>And the resulting estimates of sampling noise:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="Power.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary stat</span></span>
<span id="cb351-2"><a href="Power.html#cb351-2" aria-hidden="true" tabindex="-1"></a>simuls.sampling.noise.BF.RI.summary <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(simuls.sampling.noise.BF.RI) <span class="sc">%&gt;%</span></span>
<span id="cb351-3"><a href="Power.html#cb351-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,<span class="at">names_to=</span><span class="st">&quot;SampleSize&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;Estimate&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb351-4"><a href="Power.html#cb351-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">group_by</span>(SampleSize) <span class="sc">%&gt;%</span></span>
<span id="cb351-5"><a href="Power.html#cb351-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">summarize</span>(</span>
<span id="cb351-6"><a href="Power.html#cb351-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">Se =</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(Estimate))</span>
<span id="cb351-7"><a href="Power.html#cb351-7" aria-hidden="true" tabindex="-1"></a>                                        ) <span class="sc">%&gt;%</span></span>
<span id="cb351-8"><a href="Power.html#cb351-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">mutate</span>(</span>
<span id="cb351-9"><a href="Power.html#cb351-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">TT =</span> <span class="dv">0</span>,</span>
<span id="cb351-10"><a href="Power.html#cb351-10" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">SampleSize=</span><span class="fu">as.numeric</span>(SampleSize)</span>
<span id="cb351-11"><a href="Power.html#cb351-11" aria-hidden="true" tabindex="-1"></a>                                        )</span></code></pre></div>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="Power.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(simuls.sampling.noise.BF.RI.summary, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.factor</span>(SampleSize), <span class="at">y=</span>TT)) <span class="sc">+</span></span>
<span id="cb352-2"><a href="Power.html#cb352-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>TT<span class="sc">-</span>Se<span class="sc">*</span><span class="fl">1.96</span>, <span class="at">ymax=</span>TT<span class="sc">+</span>Se<span class="sc">*</span><span class="fl">1.96</span>),<span class="at">color=</span><span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb352-3"><a href="Power.html#cb352-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Sample Size&quot;</span>)<span class="sc">+</span></span>
<span id="cb352-4"><a href="Power.html#cb352-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:IndirectBFRISePlot"></span>
<img src="STCI_files/figure-html/IndirectBFRISePlot-1.png" alt="Sampling noise of the Brute Force estimator using randomization inference" width="50%" />
<p class="caption">
Figure 7.17: Sampling noise of the Brute Force estimator using randomization inference
</p>
</div>
<p>We can also compare sampling noise estimated using randomization inference to the one estimated by using only one sample and the one estimated using the traditional approach.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="Power.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># preparing the data</span></span>
<span id="cb353-2"><a href="Power.html#cb353-2" aria-hidden="true" tabindex="-1"></a>test.indirect <span class="ot">&lt;-</span> test.indirect <span class="sc">%&gt;%</span></span>
<span id="cb353-3"><a href="Power.html#cb353-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">left_join</span>(simuls.sampling.noise.BF.RI.summary,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&#39;N.simul&#39;</span><span class="ot">=</span><span class="st">&#39;SampleSize&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb353-4"><a href="Power.html#cb353-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rename</span>(</span>
<span id="cb353-5"><a href="Power.html#cb353-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Epsilon_RI=</span>Se,</span>
<span id="cb353-6"><a href="Power.html#cb353-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">MDE_RI=</span>TT</span>
<span id="cb353-7"><a href="Power.html#cb353-7" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">%&gt;%</span></span>
<span id="cb353-8"><a href="Power.html#cb353-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(</span>
<span id="cb353-9"><a href="Power.html#cb353-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Epsilon_RI =</span> <span class="fu">qnorm</span>((<span class="fl">0.99</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>Epsilon_RI</span>
<span id="cb353-10"><a href="Power.html#cb353-10" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb353-11"><a href="Power.html#cb353-11" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb353-12"><a href="Power.html#cb353-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-13"><a href="Power.html#cb353-13" aria-hidden="true" tabindex="-1"></a><span class="co"># putting results in long form to enable plotting</span></span>
<span id="cb353-14"><a href="Power.html#cb353-14" aria-hidden="true" tabindex="-1"></a>test.indirect.long <span class="ot">&lt;-</span> test.indirect <span class="sc">%&gt;%</span></span>
<span id="cb353-15"><a href="Power.html#cb353-15" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">!</span>N.simul,<span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&#39;Type&#39;</span>,<span class="st">&#39;Method&#39;</span>),<span class="at">names_sep=</span><span class="fu">c</span>(<span class="st">&quot;_&quot;</span>),<span class="at">values_to=</span><span class="st">&#39;Estimate&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb353-16"><a href="Power.html#cb353-16" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(</span>
<span id="cb353-17"><a href="Power.html#cb353-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Type=</span><span class="fu">factor</span>(Type,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;MDE&#39;</span>,<span class="st">&#39;Epsilon&#39;</span>)),</span>
<span id="cb353-18"><a href="Power.html#cb353-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Method=</span><span class="fu">recode_factor</span>(Method,<span class="st">&quot;simul&quot;</span><span class="ot">=</span><span class="st">&quot;Simulation&quot;</span>,<span class="st">&quot;tradi&quot;</span><span class="ot">=</span><span class="st">&quot;Traditional&quot;</span>,<span class="st">&quot;RI&quot;</span><span class="ot">=</span><span class="st">&quot;Randomization Inference&quot;</span>),</span>
<span id="cb353-19"><a href="Power.html#cb353-19" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Method=</span><span class="fu">factor</span>(Method,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;Traditional&#39;</span>,<span class="st">&#39;Simulation&#39;</span>,<span class="st">&quot;Randomization Inference&quot;</span>))</span>
<span id="cb353-20"><a href="Power.html#cb353-20" aria-hidden="true" tabindex="-1"></a>                        ) </span></code></pre></div>
<p>Let’s plot the result:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="Power.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">filter</span>(test.indirect.long,Type<span class="sc">==</span><span class="st">&#39;Epsilon&#39;</span>), <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.factor</span>(N.simul), <span class="at">y=</span>Estimate, <span class="at">fill=</span>Method)) <span class="sc">+</span></span>
<span id="cb354-2"><a href="Power.html#cb354-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb354-3"><a href="Power.html#cb354-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Sample Size&quot;</span>) <span class="sc">+</span></span>
<span id="cb354-4"><a href="Power.html#cb354-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PlotIndirectBFRI"></span>
<img src="STCI_files/figure-html/PlotIndirectBFRI-1.png" alt="MDE, \epsilon and sample size for the Brute Force design using traditional, one simulation and randomization inference for power analysis" width="65%" />
<p class="caption">
Figure 7.18: MDE, and sample size for the Brute Force design using traditional, one simulation and randomization inference for power analysis
</p>
</div>
<p>We can see that our estimates of sampling noise using the various approaches are very similar, which is great.</p>

</div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="threats.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec:placebo.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/chabefer/STCI/blob/master/06_Power.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["STCI.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 1
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
