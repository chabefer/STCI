<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Placebo Tests | Statistical Tools for Causal Inference</title>
  <meta name="description" content="This is an open source collaborative book." />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Placebo Tests | Statistical Tools for Causal Inference" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is an open source collaborative book." />
  <meta name="github-repo" content="chabefer/STCI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Placebo Tests | Statistical Tools for Causal Inference" />
  
  <meta name="twitter:description" content="This is an open source collaborative book." />
  

<meta name="author" content="Sylvain ChabÃ©-Ferret" />


<meta name="date" content="2024-07-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Power.html"/>
<link rel="next" href="cluster.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
$$
\newcommand{\uns}[1]{\mathbf{1}[#1]}
\newcommand{\esp}[1]{\mathbf{E}[#1]}
\newcommand{\hatesp}[1]{\hat{\mathbf{E}}[ #1 ]}
\newcommand{\espE}{\mathbf{E}}
\newcommand{\Ind}{\perp\kern-5pt\perp}
\newcommand{\var}[1]{\mathbf{V}[ #1 ]}
\newcommand{\hatvar}[1]{\hat{\mathbf{V}}[ #1 ]}
\newcommand{\cov}[1]{\mathbf{C}[ #1 ]}
\newcommand{\plim}[1]{\text{plim}_{ #1 \rightarrow \infty}}
\newcommand{\plims}{\text{plim}}
\newcommand{\distr}{\stackrel{d}{\rightarrow}}
\newcommand{\partder}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\partdersq}[2]{\frac{\partial^2 #1}{\partial #2^2}}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\asym}{Asym}
$$


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Tools for Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>I Fundamental Problems of Inference</b></span></li>
<li class="chapter" data-level="" data-path="introduction-the-two-fundamental-problems-of-inference.html"><a href="introduction-the-two-fundamental-problems-of-inference.html"><i class="fa fa-check"></i>Introduction: the Two Fundamental Problems of Inference</a></li>
<li class="chapter" data-level="1" data-path="FPCI.html"><a href="FPCI.html"><i class="fa fa-check"></i><b>1</b> Fundamental Problem of Causal Inference</a>
<ul>
<li class="chapter" data-level="1.1" data-path="FPCI.html"><a href="FPCI.html#rubin-causal-model"><i class="fa fa-check"></i><b>1.1</b> Rubin Causal Model</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="FPCI.html"><a href="FPCI.html#treatment-allocation-rule"><i class="fa fa-check"></i><b>1.1.1</b> Treatment allocation rule</a></li>
<li class="chapter" data-level="1.1.2" data-path="FPCI.html"><a href="FPCI.html#potential-outcomes"><i class="fa fa-check"></i><b>1.1.2</b> Potential outcomes</a></li>
<li class="chapter" data-level="1.1.3" data-path="FPCI.html"><a href="FPCI.html#switching-equation"><i class="fa fa-check"></i><b>1.1.3</b> Switching equation</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="FPCI.html"><a href="FPCI.html#treatment-effects"><i class="fa fa-check"></i><b>1.2</b> Treatment effects</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="FPCI.html"><a href="FPCI.html#individual-level-treatment-effects"><i class="fa fa-check"></i><b>1.2.1</b> Individual level treatment effects</a></li>
<li class="chapter" data-level="1.2.2" data-path="FPCI.html"><a href="FPCI.html#average-treatment-effect-on-the-treated"><i class="fa fa-check"></i><b>1.2.2</b> Average treatment effect on the treated</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="FPCI.html"><a href="FPCI.html#fundamental-problem-of-causal-inference"><i class="fa fa-check"></i><b>1.3</b> Fundamental problem of causal inference</a></li>
<li class="chapter" data-level="1.4" data-path="FPCI.html"><a href="FPCI.html#intuitive-estimators-confounding-factors-and-selection-bias"><i class="fa fa-check"></i><b>1.4</b> Intuitive estimators, confounding factors and selection bias</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="FPCI.html"><a href="FPCI.html#withwithout-comparison-selection-bias-and-cross-sectional-confounders"><i class="fa fa-check"></i><b>1.4.1</b> With/Without comparison, selection bias and cross-sectional confounders</a></li>
<li class="chapter" data-level="1.4.2" data-path="FPCI.html"><a href="FPCI.html#the-beforeafter-comparison-temporal-confounders-and-time-trend-bias"><i class="fa fa-check"></i><b>1.4.2</b> The before/after comparison, temporal confounders and time trend bias</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="FPSI.html"><a href="FPSI.html"><i class="fa fa-check"></i><b>2</b> Fundamental Problem of Statistical Inference</a>
<ul>
<li class="chapter" data-level="2.1" data-path="FPSI.html"><a href="FPSI.html#sec:sampnoise"><i class="fa fa-check"></i><b>2.1</b> What is sampling noise? Definition and illustration</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="FPSI.html"><a href="FPSI.html#sec:definitionnoise"><i class="fa fa-check"></i><b>2.1.1</b> Sampling noise, a definition</a></li>
<li class="chapter" data-level="2.1.2" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisepop"><i class="fa fa-check"></i><b>2.1.2</b> Sampling noise for the population treatment effect</a></li>
<li class="chapter" data-level="2.1.3" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisesamp"><i class="fa fa-check"></i><b>2.1.3</b> Sampling noise for the sample treatment effect</a></li>
<li class="chapter" data-level="2.1.4" data-path="FPSI.html"><a href="FPSI.html#sec:confinterv"><i class="fa fa-check"></i><b>2.1.4</b> Building confidence intervals from estimates of sampling noise</a></li>
<li class="chapter" data-level="2.1.5" data-path="FPSI.html"><a href="FPSI.html#reporting-sampling-noise-a-proposal"><i class="fa fa-check"></i><b>2.1.5</b> Reporting sampling noise: a proposal</a></li>
<li class="chapter" data-level="2.1.6" data-path="FPSI.html"><a href="FPSI.html#sec:effectsize"><i class="fa fa-check"></i><b>2.1.6</b> Using effect sizes to normalize the reporting of treatment effects and their precision</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="FPSI.html"><a href="FPSI.html#sec:estimsampnoise"><i class="fa fa-check"></i><b>2.2</b> Estimating sampling noise</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="FPSI.html"><a href="FPSI.html#sec:assumptions"><i class="fa fa-check"></i><b>2.2.1</b> Assumptions</a></li>
<li class="chapter" data-level="2.2.2" data-path="FPSI.html"><a href="FPSI.html#sec:cheb"><i class="fa fa-check"></i><b>2.2.2</b> Using Chebyshevâs inequality</a></li>
<li class="chapter" data-level="2.2.3" data-path="FPSI.html"><a href="FPSI.html#sec:CLT"><i class="fa fa-check"></i><b>2.2.3</b> Using the Central Limit Theorem</a></li>
<li class="chapter" data-level="2.2.4" data-path="FPSI.html"><a href="FPSI.html#sec:resamp"><i class="fa fa-check"></i><b>2.2.4</b> Using resampling methods</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Methods of Causal Inference</b></span></li>
<li class="chapter" data-level="3" data-path="RCT.html"><a href="RCT.html"><i class="fa fa-check"></i><b>3</b> Randomized Controlled Trials</a>
<ul>
<li class="chapter" data-level="3.1" data-path="RCT.html"><a href="RCT.html#sec:design1"><i class="fa fa-check"></i><b>3.1</b> Brute Force Design</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="RCT.html"><a href="RCT.html#identification"><i class="fa fa-check"></i><b>3.1.1</b> Identification</a></li>
<li class="chapter" data-level="3.1.2" data-path="RCT.html"><a href="RCT.html#estimating-ate"><i class="fa fa-check"></i><b>3.1.2</b> Estimating ATE</a></li>
<li class="chapter" data-level="3.1.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise"><i class="fa fa-check"></i><b>3.1.3</b> Estimating Sampling Noise</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="RCT.html"><a href="RCT.html#sec:design2"><i class="fa fa-check"></i><b>3.2</b> Self-Selection design</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="RCT.html"><a href="RCT.html#identification-1"><i class="fa fa-check"></i><b>3.2.1</b> Identification</a></li>
<li class="chapter" data-level="3.2.2" data-path="RCT.html"><a href="RCT.html#estimating-tt"><i class="fa fa-check"></i><b>3.2.2</b> Estimating TT</a></li>
<li class="chapter" data-level="3.2.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-1"><i class="fa fa-check"></i><b>3.2.3</b> Estimating Sampling Noise</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="RCT.html"><a href="RCT.html#sec:design3"><i class="fa fa-check"></i><b>3.3</b> Eligibility design</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="RCT.html"><a href="RCT.html#identification-2"><i class="fa fa-check"></i><b>3.3.1</b> Identification</a></li>
<li class="chapter" data-level="3.3.2" data-path="RCT.html"><a href="RCT.html#estimating-the-ite-and-the-tt"><i class="fa fa-check"></i><b>3.3.2</b> Estimating the ITE and the TT</a></li>
<li class="chapter" data-level="3.3.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-2"><i class="fa fa-check"></i><b>3.3.3</b> Estimating sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="RCT.html"><a href="RCT.html#sec:design4"><i class="fa fa-check"></i><b>3.4</b> Encouragement Design</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="RCT.html"><a href="RCT.html#identification-3"><i class="fa fa-check"></i><b>3.4.1</b> Identification</a></li>
<li class="chapter" data-level="3.4.2" data-path="RCT.html"><a href="RCT.html#IVRCT"><i class="fa fa-check"></i><b>3.4.2</b> Estimating the Local Average Treatment Effect and the Intention to Treat Effect</a></li>
<li class="chapter" data-level="3.4.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-3"><i class="fa fa-check"></i><b>3.4.3</b> Estimating sampling noise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="NE.html"><a href="NE.html"><i class="fa fa-check"></i><b>4</b> Natural Experiments</a>
<ul>
<li class="chapter" data-level="4.1" data-path="NE.html"><a href="NE.html#instrumental-variables"><i class="fa fa-check"></i><b>4.1</b> Instrumental Variables</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="NE.html"><a href="NE.html#an-example-where-monotonicity-does-not-hold"><i class="fa fa-check"></i><b>4.1.1</b> An example where Monotonicity does not hold</a></li>
<li class="chapter" data-level="4.1.2" data-path="NE.html"><a href="NE.html#identification-4"><i class="fa fa-check"></i><b>4.1.2</b> Identification</a></li>
<li class="chapter" data-level="4.1.3" data-path="NE.html"><a href="NE.html#estimation"><i class="fa fa-check"></i><b>4.1.3</b> Estimation</a></li>
<li class="chapter" data-level="4.1.4" data-path="NE.html"><a href="NE.html#estimation-of-sampling-noise"><i class="fa fa-check"></i><b>4.1.4</b> Estimation of sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="NE.html"><a href="NE.html#regression-discontinuity-designs"><i class="fa fa-check"></i><b>4.2</b> Regression Discontinuity Designs</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="NE.html"><a href="NE.html#sharp-regression-discontinuity-designs"><i class="fa fa-check"></i><b>4.2.1</b> Sharp Regression Discontinuity Designs</a></li>
<li class="chapter" data-level="4.2.2" data-path="NE.html"><a href="NE.html#fuzzy-regression-discontinuity-designs"><i class="fa fa-check"></i><b>4.2.2</b> Fuzzy Regression Discontinuity Designs</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="NE.html"><a href="NE.html#DID"><i class="fa fa-check"></i><b>4.3</b> Difference In Differences</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="NE.html"><a href="NE.html#sec:DIDbasic"><i class="fa fa-check"></i><b>4.3.1</b> Difference In Differences with two time periods</a></li>
<li class="chapter" data-level="4.3.2" data-path="NE.html"><a href="NE.html#sec:DIDr"><i class="fa fa-check"></i><b>4.3.2</b> Reverse Difference In Differences designs with two time periods</a></li>
<li class="chapter" data-level="4.3.3" data-path="NE.html"><a href="NE.html#DIDStaggered"><i class="fa fa-check"></i><b>4.3.3</b> Difference In Differences with multiple time periods</a></li>
<li class="chapter" data-level="4.3.4" data-path="NE.html"><a href="NE.html#difference-in-differences-with-instrumental-variables"><i class="fa fa-check"></i><b>4.3.4</b> Difference In Differences with Instrumental Variables</a></li>
<li class="chapter" data-level="4.3.5" data-path="NE.html"><a href="NE.html#difference-in-differences-with-continuous-treatment-variables-and-staggered-adoption"><i class="fa fa-check"></i><b>4.3.5</b> Difference In Differences with Continuous Treatment Variables and Staggered Adoption</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="OM.html"><a href="OM.html"><i class="fa fa-check"></i><b>5</b> Observational Methods</a>
<ul>
<li class="chapter" data-level="5.1" data-path="OM.html"><a href="OM.html#parametric-methods"><i class="fa fa-check"></i><b>5.1</b> Parametric methods</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="OM.html"><a href="OM.html#assuming-espy_i0x_i-is-known"><i class="fa fa-check"></i><b>5.1.1</b> Assuming <span class="math inline">\(\esp{Y_i^0|X_i}\)</span> is known</a></li>
<li class="chapter" data-level="5.1.2" data-path="OM.html"><a href="OM.html#assuming-espy_i1x_i-is-known"><i class="fa fa-check"></i><b>5.1.2</b> Assuming <span class="math inline">\(\esp{Y_i^1|X_i}\)</span> is known</a></li>
<li class="chapter" data-level="5.1.3" data-path="OM.html"><a href="OM.html#BiasOLS"><i class="fa fa-check"></i><b>5.1.3</b> Properties of the OLS estimator under Conditional Independence</a></li>
<li class="chapter" data-level="5.1.4" data-path="OM.html"><a href="OM.html#problems-with-parametric-methods"><i class="fa fa-check"></i><b>5.1.4</b> Problems with parametric methods</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="OM.html"><a href="OM.html#nonparametric-methods"><i class="fa fa-check"></i><b>5.2</b> Nonparametric methods</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="OM.html"><a href="OM.html#identification-13"><i class="fa fa-check"></i><b>5.2.1</b> Identification</a></li>
<li class="chapter" data-level="5.2.2" data-path="OM.html"><a href="OM.html#estimation-9"><i class="fa fa-check"></i><b>5.2.2</b> Estimation</a></li>
<li class="chapter" data-level="5.2.3" data-path="OM.html"><a href="OM.html#estimating-precision-2"><i class="fa fa-check"></i><b>5.2.3</b> Estimating precision</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="OM.html"><a href="OM.html#imputation-methods"><i class="fa fa-check"></i><b>5.3</b> Imputation methods</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="threats.html"><a href="threats.html"><i class="fa fa-check"></i><b>6</b> Threats to the validity of Causal Inference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="threats.html"><a href="threats.html#threats-to-internal-validity"><i class="fa fa-check"></i><b>6.1</b> Threats to internal validity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="threats.html"><a href="threats.html#survey-bias"><i class="fa fa-check"></i><b>6.1.1</b> Survey bias</a></li>
<li class="chapter" data-level="6.1.2" data-path="threats.html"><a href="threats.html#experimenter-bias"><i class="fa fa-check"></i><b>6.1.2</b> Experimenter bias</a></li>
<li class="chapter" data-level="6.1.3" data-path="threats.html"><a href="threats.html#substitution-bias"><i class="fa fa-check"></i><b>6.1.3</b> Substitution bias</a></li>
<li class="chapter" data-level="6.1.4" data-path="threats.html"><a href="threats.html#diffusion-bias"><i class="fa fa-check"></i><b>6.1.4</b> Diffusion bias</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="threats.html"><a href="threats.html#threats-to-the-measurement-of-precision"><i class="fa fa-check"></i><b>6.2</b> Threats to the measurement of precision</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="threats.html"><a href="threats.html#insufficient-precision"><i class="fa fa-check"></i><b>6.2.1</b> Insufficient precision</a></li>
<li class="chapter" data-level="6.2.2" data-path="threats.html"><a href="threats.html#clustering"><i class="fa fa-check"></i><b>6.2.2</b> Clustering</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="threats.html"><a href="threats.html#threats-to-external-validity"><i class="fa fa-check"></i><b>6.3</b> Threats to external validity</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="threats.html"><a href="threats.html#randomization-bias"><i class="fa fa-check"></i><b>6.3.1</b> Randomization bias</a></li>
<li class="chapter" data-level="6.3.2" data-path="threats.html"><a href="threats.html#equilibrium-effects"><i class="fa fa-check"></i><b>6.3.2</b> Equilibrium effects</a></li>
<li class="chapter" data-level="6.3.3" data-path="threats.html"><a href="threats.html#context-effects"><i class="fa fa-check"></i><b>6.3.3</b> Context effects</a></li>
<li class="chapter" data-level="6.3.4" data-path="threats.html"><a href="threats.html#site-selection-bias"><i class="fa fa-check"></i><b>6.3.4</b> Site selection bias</a></li>
<li class="chapter" data-level="6.3.5" data-path="threats.html"><a href="threats.html#publication-bias"><i class="fa fa-check"></i><b>6.3.5</b> Publication bias</a></li>
<li class="chapter" data-level="6.3.6" data-path="threats.html"><a href="threats.html#ethical-and-political-issues"><i class="fa fa-check"></i><b>6.3.6</b> Ethical and political issues</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Additional Topics</b></span></li>
<li class="chapter" data-level="7" data-path="Power.html"><a href="Power.html"><i class="fa fa-check"></i><b>7</b> Power Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Power.html"><a href="Power.html#basics-of-traditional-power-analysis-using-test-statistics"><i class="fa fa-check"></i><b>7.1</b> Basics of traditional power analysis using test statistics</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="Power.html"><a href="Power.html#power"><i class="fa fa-check"></i><b>7.1.1</b> Power</a></li>
<li class="chapter" data-level="7.1.2" data-path="Power.html"><a href="Power.html#minimum-detectable-effect"><i class="fa fa-check"></i><b>7.1.2</b> Minimum Detectable Effect</a></li>
<li class="chapter" data-level="7.1.3" data-path="Power.html"><a href="Power.html#minimum-required-sample-size"><i class="fa fa-check"></i><b>7.1.3</b> Minimum Required Sample Size</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="Power.html"><a href="Power.html#traditional-power-analysis-in-practice"><i class="fa fa-check"></i><b>7.2</b> Traditional power analysis in practice</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="Power.html"><a href="Power.html#power-analysis-for-randomized-controlled-trials"><i class="fa fa-check"></i><b>7.2.1</b> Power Analysis for Randomized Controlled Trials</a></li>
<li class="chapter" data-level="7.2.2" data-path="Power.html"><a href="Power.html#power-analysis-for-natural-experiments"><i class="fa fa-check"></i><b>7.2.2</b> Power Analysis for Natural Experiments</a></li>
<li class="chapter" data-level="7.2.3" data-path="Power.html"><a href="Power.html#power-analysis-for-observational-methods"><i class="fa fa-check"></i><b>7.2.3</b> Power Analysis for Observational Methods</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="Power.html"><a href="Power.html#limitations-of-and-alternatives-to-traditional-power-analysis"><i class="fa fa-check"></i><b>7.3</b> Limitations of and alternatives to traditional power analysis</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="Power.html"><a href="Power.html#limitations-of-traditional-power-analysis"><i class="fa fa-check"></i><b>7.3.1</b> Limitations of traditional power analysis</a></li>
<li class="chapter" data-level="7.3.2" data-path="Power.html"><a href="Power.html#an-alternative-to-traditional-power-analysis"><i class="fa fa-check"></i><b>7.3.2</b> An alternative to traditional power analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="placebo.html"><a href="placebo.html"><i class="fa fa-check"></i><b>8</b> Placebo Tests</a>
<ul>
<li class="chapter" data-level="8.1" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-randomized-controlled-trials"><i class="fa fa-check"></i><b>8.1</b> Placebo tests for randomized controlled trials</a></li>
<li class="chapter" data-level="8.2" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-natural-experiments"><i class="fa fa-check"></i><b>8.2</b> Placebo tests for natural experiments</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-instrumental-variables"><i class="fa fa-check"></i><b>8.2.1</b> Placebo tests for Instrumental Variables</a></li>
<li class="chapter" data-level="8.2.2" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-regression-discontinuity-designs"><i class="fa fa-check"></i><b>8.2.2</b> Placebo tests for Regression Discontinuity Designs</a></li>
<li class="chapter" data-level="8.2.3" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-difference-in-differences"><i class="fa fa-check"></i><b>8.2.3</b> Placebo tests for Difference in Differences</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-observational-methods"><i class="fa fa-check"></i><b>8.3</b> Placebo tests for observational methods</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cluster.html"><a href="cluster.html"><i class="fa fa-check"></i><b>9</b> Clustering</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cluster.html"><a href="cluster.html#ClusterRCT"><i class="fa fa-check"></i><b>9.1</b> Clustering in Randomized Controlled Trials</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="cluster.html"><a href="cluster.html#an-example"><i class="fa fa-check"></i><b>9.1.1</b> An example</a></li>
<li class="chapter" data-level="9.1.2" data-path="cluster.html"><a href="cluster.html#design-effect"><i class="fa fa-check"></i><b>9.1.2</b> Design effect</a></li>
<li class="chapter" data-level="9.1.3" data-path="cluster.html"><a href="cluster.html#estimating-sampling-noise-accounting-for-clustering"><i class="fa fa-check"></i><b>9.1.3</b> Estimating sampling noise accounting for clustering</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="cluster.html"><a href="cluster.html#clustering-in-panel-data"><i class="fa fa-check"></i><b>9.2</b> Clustering in panel data</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="cluster.html"><a href="cluster.html#an-example-1"><i class="fa fa-check"></i><b>9.2.1</b> An example</a></li>
<li class="chapter" data-level="9.2.2" data-path="cluster.html"><a href="cluster.html#design-effect-in-panel-data"><i class="fa fa-check"></i><b>9.2.2</b> Design effect in panel data</a></li>
<li class="chapter" data-level="9.2.3" data-path="cluster.html"><a href="cluster.html#estimating-sampling-noise-in-panel-data-with-autocorrelated-error-terms"><i class="fa fa-check"></i><b>9.2.3</b> Estimating sampling noise in panel data with autocorrelated error terms</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cluster.html"><a href="cluster.html#spatial-correlation"><i class="fa fa-check"></i><b>9.3</b> Spatial correlation</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="cluster.html"><a href="cluster.html#an-example-2"><i class="fa fa-check"></i><b>9.3.1</b> An example</a></li>
<li class="chapter" data-level="9.3.2" data-path="cluster.html"><a href="cluster.html#design-effect-in-spatially-autocorrelated-data"><i class="fa fa-check"></i><b>9.3.2</b> Design effect in spatially autocorrelated data</a></li>
<li class="chapter" data-level="9.3.3" data-path="cluster.html"><a href="cluster.html#estimating-sampling-noise-with-spatially-autocorrelated-data"><i class="fa fa-check"></i><b>9.3.3</b> Estimating sampling noise with spatially autocorrelated data</a></li>
<li class="chapter" data-level="9.3.4" data-path="cluster.html"><a href="cluster.html#testing-for-spatial-autocorrelation"><i class="fa fa-check"></i><b>9.3.4</b> Testing for spatial autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="cluster.html"><a href="cluster.html#clustering-on-a-network"><i class="fa fa-check"></i><b>9.4</b> Clustering on a network</a></li>
<li class="chapter" data-level="9.5" data-path="cluster.html"><a href="cluster.html#multi-way-clustering"><i class="fa fa-check"></i><b>9.5</b> Multi-way clustering</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="cluster.html"><a href="cluster.html#at-which-level-should-we-cluster"><i class="fa fa-check"></i><b>9.5.1</b> At which level should we cluster?</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="cluster.html"><a href="cluster.html#what-to-do-when-there-are-few-clusters"><i class="fa fa-check"></i><b>9.6</b> What to do when there are few clusters?</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="cluster.html"><a href="cluster.html#aggregation"><i class="fa fa-check"></i><b>9.6.1</b> Aggregation</a></li>
<li class="chapter" data-level="9.6.2" data-path="cluster.html"><a href="cluster.html#permutation-tests"><i class="fa fa-check"></i><b>9.6.2</b> Permutation tests</a></li>
<li class="chapter" data-level="9.6.3" data-path="cluster.html"><a href="cluster.html#wild-bootstrap"><i class="fa fa-check"></i><b>9.6.3</b> Wild bootstrap</a></li>
<li class="chapter" data-level="9.6.4" data-path="cluster.html"><a href="cluster.html#ibragimov-and-muller-2010-group-based-inference"><i class="fa fa-check"></i><b>9.6.4</b> Ibragimov and Muller (2010) group-based inference</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="cluster.html"><a href="cluster.html#CLTDD"><i class="fa fa-check"></i><b>9.7</b> Central Limit Theorems for Dependent Data</a></li>
<li class="chapter" data-level="9.8" data-path="cluster.html"><a href="cluster.html#DesignBasedClusters"><i class="fa fa-check"></i><b>9.8</b> Sampling-based and design-based approaches to clustering</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="LaLonde.html"><a href="LaLonde.html"><i class="fa fa-check"></i><b>10</b> LaLonde Tests</a></li>
<li class="chapter" data-level="11" data-path="Diffusion.html"><a href="Diffusion.html"><i class="fa fa-check"></i><b>11</b> Diffusion effects</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Diffusion.html"><a href="Diffusion.html#allowing-for-diffusion-effects-in-rubin-causal-model"><i class="fa fa-check"></i><b>11.1</b> Allowing for diffusion effects in Rubin Causal Model</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="Diffusion.html"><a href="Diffusion.html#potential-outcomes-and-treatment-effects-with-diffusion-effects"><i class="fa fa-check"></i><b>11.1.1</b> Potential outcomes and treatment effects with diffusion effects</a></li>
<li class="chapter" data-level="11.1.2" data-path="Diffusion.html"><a href="Diffusion.html#encoding-the-absence-of-diffusion-effects"><i class="fa fa-check"></i><b>11.1.2</b> Encoding the absence of diffusion effects</a></li>
<li class="chapter" data-level="11.1.3" data-path="Diffusion.html"><a href="Diffusion.html#TreatmentExposure"><i class="fa fa-check"></i><b>11.1.3</b> Treatment exposure</a></li>
<li class="chapter" data-level="11.1.4" data-path="Diffusion.html"><a href="Diffusion.html#fundamental-problem-of-causal-inference-for-diffusion-effects"><i class="fa fa-check"></i><b>11.1.4</b> Fundamental problem of causal inference for diffusion effects</a></li>
<li class="chapter" data-level="11.1.5" data-path="Diffusion.html"><a href="Diffusion.html#bias-of-one-step-randomized-controlled-trials"><i class="fa fa-check"></i><b>11.1.5</b> Bias of one-step randomized controlled trials</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="Diffusion.html"><a href="Diffusion.html#diffusion-effects-with-coarse-networks"><i class="fa fa-check"></i><b>11.2</b> Diffusion effects with coarse networks</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="Diffusion.html"><a href="Diffusion.html#optimal-treatment-allocation-under-monotone-response"><i class="fa fa-check"></i><b>11.2.1</b> Optimal treatment allocation under monotone response</a></li>
<li class="chapter" data-level="11.2.2" data-path="Diffusion.html"><a href="Diffusion.html#identifying-optimal-treatment-levels"><i class="fa fa-check"></i><b>11.2.2</b> Identifying optimal treatment levels</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="Diffusion.html"><a href="Diffusion.html#diffusion-effects-with-detailed-networks"><i class="fa fa-check"></i><b>11.3</b> Diffusion effects with detailed networks</a></li>
<li class="chapter" data-level="11.4" data-path="Diffusion.html"><a href="Diffusion.html#nonparametric-test-for-the-existence-of-diffusion-effects-based-on-randomization-inference"><i class="fa fa-check"></i><b>11.4</b> Nonparametric test for the existence of diffusion effects based on randomization inference</a></li>
<li class="chapter" data-level="11.5" data-path="Diffusion.html"><a href="Diffusion.html#diffusion-effects-with-did"><i class="fa fa-check"></i><b>11.5</b> Diffusion effects with DID</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="Distribution.html"><a href="Distribution.html"><i class="fa fa-check"></i><b>12</b> Distributional effects</a></li>
<li class="chapter" data-level="13" data-path="meta.html"><a href="meta.html"><i class="fa fa-check"></i><b>13</b> Meta-analysis and Publication Bias</a>
<ul>
<li class="chapter" data-level="13.1" data-path="meta.html"><a href="meta.html#meta-analysis"><i class="fa fa-check"></i><b>13.1</b> Meta-analysis</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="meta.html"><a href="meta.html#basic-setting"><i class="fa fa-check"></i><b>13.1.1</b> Basic setting</a></li>
<li class="chapter" data-level="13.1.2" data-path="meta.html"><a href="meta.html#why-vote-counting-does-not-work"><i class="fa fa-check"></i><b>13.1.2</b> Why vote-counting does not work</a></li>
<li class="chapter" data-level="13.1.3" data-path="meta.html"><a href="meta.html#MetaWA"><i class="fa fa-check"></i><b>13.1.3</b> Meta-analysis when treatment effects are homogeneous: the fixed effects approach</a></li>
<li class="chapter" data-level="13.1.4" data-path="meta.html"><a href="meta.html#meta-analysis-when-treatment-effects-are-heterogeneous-the-random-effects-approach"><i class="fa fa-check"></i><b>13.1.4</b> Meta-analysis when treatment effects are heterogeneous: the random effects approach</a></li>
<li class="chapter" data-level="13.1.5" data-path="meta.html"><a href="meta.html#meta-regression"><i class="fa fa-check"></i><b>13.1.5</b> Meta-regression</a></li>
<li class="chapter" data-level="13.1.6" data-path="meta.html"><a href="meta.html#constantly-updated-meta-analysis"><i class="fa fa-check"></i><b>13.1.6</b> Constantly updated meta-analysis</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="meta.html"><a href="meta.html#publication-bias-and-site-selection-bias"><i class="fa fa-check"></i><b>13.2</b> Publication bias and site selection bias</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="meta.html"><a href="meta.html#sources-of-publication-bias-and-of-site-selection-bias-and-questionable-research-practices"><i class="fa fa-check"></i><b>13.2.1</b> Sources of publication bias and of site selection bias and Questionable Research Practices</a></li>
<li class="chapter" data-level="13.2.2" data-path="meta.html"><a href="meta.html#detection-of-and-correction-for-publication-bias"><i class="fa fa-check"></i><b>13.2.2</b> Detection of and correction for publication bias</a></li>
<li class="chapter" data-level="13.2.3" data-path="meta.html"><a href="meta.html#getting-rid-of-publication-bias-registered-reports-and-pre-analysis-plans"><i class="fa fa-check"></i><b>13.2.3</b> Getting rid of publication bias: registered reports and pre-analysis plans</a></li>
<li class="chapter" data-level="13.2.4" data-path="meta.html"><a href="meta.html#detection-of-and-correction-for-site-selection-bias"><i class="fa fa-check"></i><b>13.2.4</b> Detection of and correction for site selection bias</a></li>
<li class="chapter" data-level="13.2.5" data-path="meta.html"><a href="meta.html#vote-counting-and-publication-bias"><i class="fa fa-check"></i><b>13.2.5</b> Vote counting and publication bias</a></li>
<li class="chapter" data-level="13.2.6" data-path="meta.html"><a href="meta.html#the-value-of-a-statistically-significant-result"><i class="fa fa-check"></i><b>13.2.6</b> The value of a statistically significant result</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="Bounds.html"><a href="Bounds.html"><i class="fa fa-check"></i><b>14</b> Bounds</a></li>
<li class="chapter" data-level="15" data-path="mediation-analysis.html"><a href="mediation-analysis.html"><i class="fa fa-check"></i><b>15</b> Mediation Analysis</a>
<ul>
<li class="chapter" data-level="15.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-a-framework"><i class="fa fa-check"></i><b>15.1</b> Mediation analysis: a framework</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#defining-mediated-and-unmediated-treatment-effects"><i class="fa fa-check"></i><b>15.1.1</b> Defining mediated and unmediated treatment effects</a></li>
<li class="chapter" data-level="15.1.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#decomposing-mediated-and-unmediated-effects"><i class="fa fa-check"></i><b>15.1.2</b> Decomposing mediated and unmediated effects</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#the-fundamental-problem-of-mediation-analysis"><i class="fa fa-check"></i><b>15.2</b> The Fundamental Problem of Mediation Analysis</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#the-fundamental-problem-of-mediation-analysis-1"><i class="fa fa-check"></i><b>15.2.1</b> The Fundamental Problem of Mediation Analysis</a></li>
<li class="chapter" data-level="15.2.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#biases-of-intuitive-comparisons"><i class="fa fa-check"></i><b>15.2.2</b> Biases of Intuitive Comparisons</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-experimental-data"><i class="fa fa-check"></i><b>15.3</b> Mediation analysis with experimental data</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-in-the-parallel-design"><i class="fa fa-check"></i><b>15.3.1</b> Mediation analysis in the Parallel design</a></li>
<li class="chapter" data-level="15.3.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-in-the-sequential-self-selection-design"><i class="fa fa-check"></i><b>15.3.2</b> Mediation analysis in the Sequential Self-Selection design</a></li>
<li class="chapter" data-level="15.3.3" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-in-the-crossover-design"><i class="fa fa-check"></i><b>15.3.3</b> Mediation analysis in the Crossover design</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-under-unconfoundedness"><i class="fa fa-check"></i><b>15.4</b> Mediation analysis under unconfoundedness</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#non-parametric-identification-under-sequential-ignorability"><i class="fa fa-check"></i><b>15.4.1</b> Non-parametric identification under sequential ignorability</a></li>
<li class="chapter" data-level="15.4.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-under-sequential-ignorability-in-linear-models"><i class="fa fa-check"></i><b>15.4.2</b> Mediation analysis under sequential ignorability in linear models</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-panel-data"><i class="fa fa-check"></i><b>15.5</b> Mediation analysis with panel data</a></li>
<li class="chapter" data-level="15.6" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-instruments"><i class="fa fa-check"></i><b>15.6</b> Mediation analysis with instruments</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="stratification.html"><a href="stratification.html"><i class="fa fa-check"></i><b>16</b> Stratification</a>
<ul>
<li class="chapter" data-level="16.1" data-path="stratification.html"><a href="stratification.html#ClassicalStratification"><i class="fa fa-check"></i><b>16.1</b> Analysis of classical stratified experiments</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="stratification.html"><a href="stratification.html#an-example-3"><i class="fa fa-check"></i><b>16.1.1</b> An example</a></li>
<li class="chapter" data-level="16.1.2" data-path="stratification.html"><a href="stratification.html#estimating-treatment-effects-with-stratified-randomized-controlled-trials"><i class="fa fa-check"></i><b>16.1.2</b> Estimating treatment effects with stratified randomized controlled trials</a></li>
<li class="chapter" data-level="16.1.3" data-path="stratification.html"><a href="stratification.html#estimating-sampling-noise-in-stratified-randomized-controlled-trials"><i class="fa fa-check"></i><b>16.1.3</b> Estimating sampling noise in stratified randomized controlled trials</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="stratification.html"><a href="stratification.html#analysis-of-pairwise-randomized-controlled-trials"><i class="fa fa-check"></i><b>16.2</b> Analysis of pairwise randomized controlled trials</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="stratification.html"><a href="stratification.html#building-a-sample-of-pairs"><i class="fa fa-check"></i><b>16.2.1</b> Building a sample of pairs</a></li>
<li class="chapter" data-level="16.2.2" data-path="stratification.html"><a href="stratification.html#estimating-treatment-effects-in-pairwise-randomized-controlled-trials"><i class="fa fa-check"></i><b>16.2.2</b> Estimating treatment effects in pairwise randomized controlled trials</a></li>
<li class="chapter" data-level="16.2.3" data-path="stratification.html"><a href="stratification.html#estimating-sampling-noise-in-pairwise-randomized-controlled-trials"><i class="fa fa-check"></i><b>16.2.3</b> Estimating sampling noise in pairwise randomized controlled trials</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="proofs.html"><a href="proofs.html"><i class="fa fa-check"></i><b>A</b> Proofs</a>
<ul>
<li class="chapter" data-level="A.1" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-reffpsi"><i class="fa fa-check"></i><b>A.1</b> Proofs of results in Chapter @ref(FPSI)</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="proofs.html"><a href="proofs.html#proofcheb"><i class="fa fa-check"></i><b>A.1.1</b> Proof of Theorem @ref(thm:uppsampnoise)</a></li>
<li class="chapter" data-level="A.1.2" data-path="proofs.html"><a href="proofs.html#proofCLT"><i class="fa fa-check"></i><b>A.1.2</b> Proof of Theorem @ref(thm:asympnoiseWW)</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refrct"><i class="fa fa-check"></i><b>A.2</b> Proofs of results in Chapter @ref(RCT)</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="proofs.html"><a href="proofs.html#proofIdentLATE"><i class="fa fa-check"></i><b>A.2.1</b> Proof of Theorem @ref(thm:IdentLATE)</a></li>
<li class="chapter" data-level="A.2.2" data-path="proofs.html"><a href="proofs.html#proofWaldIV"><i class="fa fa-check"></i><b>A.2.2</b> Proof of Theorem @ref(thm:WaldIV)</a></li>
<li class="chapter" data-level="A.2.3" data-path="proofs.html"><a href="proofs.html#ProofAsymWald"><i class="fa fa-check"></i><b>A.2.3</b> Proof of Theorem @ref(thm:asymWald)</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refne"><i class="fa fa-check"></i><b>A.3</b> Proofs of results in Chapter @ref(NE)</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="proofs.html"><a href="proofs.html#proofEstimDID"><i class="fa fa-check"></i><b>A.3.1</b> Proof of Theorem @ref(thm:EstimDID)</a></li>
<li class="chapter" data-level="A.3.2" data-path="proofs.html"><a href="proofs.html#proofasympnoiseDIDCross"><i class="fa fa-check"></i><b>A.3.2</b> Proof of Theorem @ref(thm:asympnoiseDIDCross)</a></li>
<li class="chapter" data-level="A.3.3" data-path="proofs.html"><a href="proofs.html#proofEquivDIDSApop"><i class="fa fa-check"></i><b>A.3.3</b> Proof of Theorem @ref(thm:EquivDIDSApop)</a></li>
<li class="chapter" data-level="A.3.4" data-path="proofs.html"><a href="proofs.html#proofEquivDIDSAsamp"><i class="fa fa-check"></i><b>A.3.4</b> Proof of Theorem @ref(thm:EquivDIDSAsamp)</a></li>
<li class="chapter" data-level="A.3.5" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSACross"><i class="fa fa-check"></i><b>A.3.5</b> Proof of Theorem @ref(thm:asympnoiseSACross)</a></li>
<li class="chapter" data-level="A.3.6" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSATTCross"><i class="fa fa-check"></i><b>A.3.6</b> Proof of Theorem @ref(thm:asympnoiseSATTCross)</a></li>
<li class="chapter" data-level="A.3.7" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSAPanel"><i class="fa fa-check"></i><b>A.3.7</b> Proof of Theorem @ref(thm:asympnoiseSAPanel)</a></li>
<li class="chapter" data-level="A.3.8" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSATTPanel"><i class="fa fa-check"></i><b>A.3.8</b> Proof of Theorem @ref(thm:asympnoiseSATTPanel)</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refom"><i class="fa fa-check"></i><b>A.4</b> Proofs of results in Chapter @ref(OM)</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="proofs.html"><a href="proofs.html#proofAsympWWOLS10"><i class="fa fa-check"></i><b>A.4.1</b> Proof of Theorem @ref(thm:AsympWWOLS10)</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refcluster"><i class="fa fa-check"></i><b>A.5</b> Proofs of results in Chapter @ref(cluster)</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="proofs.html"><a href="proofs.html#proofVarWWClus"><i class="fa fa-check"></i><b>A.5.1</b> Proof of Theorem @ref(thm:VarWWClus)</a></li>
<li class="chapter" data-level="A.5.2" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSATTPanelAR1"><i class="fa fa-check"></i><b>A.5.2</b> Proof of Theorem @ref(thm:asympnoiseSATTPanelAR1)</a></li>
<li class="chapter" data-level="A.5.3" data-path="proofs.html"><a href="proofs.html#proofVarWWSpatial"><i class="fa fa-check"></i><b>A.5.3</b> Proof of Theorem @ref(thm:VarWWSpatial)</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refdiffusion"><i class="fa fa-check"></i><b>A.6</b> Proofs of results in Chapter @ref(Diffusion)</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="proofs.html"><a href="proofs.html#proofSmoothSymAlloc"><i class="fa fa-check"></i><b>A.6.1</b> Proof of Theorem @ref(thm:SmoothSymAlloc)</a></li>
<li class="chapter" data-level="A.6.2" data-path="proofs.html"><a href="proofs.html#proofIdentSmoothSymAlloc"><i class="fa fa-check"></i><b>A.6.2</b> Proof of Theorem @ref(thm:IdentSmoothSymAlloc)</a></li>
<li class="chapter" data-level="A.6.3" data-path="proofs.html"><a href="proofs.html#proofContagionDiffusionSmoothSymAlloc"><i class="fa fa-check"></i><b>A.6.3</b> Proof of Theorem @ref(thm:ContagionDiffusionSmoothSymAlloc)</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refstratification"><i class="fa fa-check"></i><b>A.7</b> Proofs of results in Chapter @ref(stratification)</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="proofs.html"><a href="proofs.html#proofSFEdecomp"><i class="fa fa-check"></i><b>A.7.1</b> Proof of Theorem @ref(thm:SFEdecomp)</a></li>
<li class="chapter" data-level="A.7.2" data-path="proofs.html"><a href="proofs.html#proofSFEconsistent"><i class="fa fa-check"></i><b>A.7.2</b> Proof of Theorem @ref(thm:SFEconsistent)</a></li>
<li class="chapter" data-level="A.7.3" data-path="proofs.html"><a href="proofs.html#proofSATUnbiasedConsistent"><i class="fa fa-check"></i><b>A.7.3</b> Proof of Theorem @ref(thm:SATUnbiasedConsistent)</a></li>
<li class="chapter" data-level="A.7.4" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSATStrata"><i class="fa fa-check"></i><b>A.7.4</b> Proof of Theorem @ref(thm:asympnoiseSATStrata)</a></li>
<li class="chapter" data-level="A.7.5" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSFEStrata"><i class="fa fa-check"></i><b>A.7.5</b> Proof of Theorem @ref(thm:asympnoiseSFEStrata)</a></li>
<li class="chapter" data-level="A.7.6" data-path="proofs.html"><a href="proofs.html#proofPairUnbiasedConsistent"><i class="fa fa-check"></i><b>A.7.6</b> Proof of Theorem @ref(thm:PairUnbiasedConsistent)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Tools for Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="placebo" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Placebo Tests<a href="placebo.html#placebo" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Placebo tests are tests we perform to ensure that implications of our most important identifying assumptions hold.
In general, placebo tests entail estimating the effect of the considered treatment on an outcome where we know the treatment effect to be zero.
For example, estimating the effect of the treatment on outcomes observed before the treatment was even implemented.
We are going to study placebo tests for RCTs, natural experiments and observational methods.
Letâs get started.</p>
<div id="placebo-tests-for-randomized-controlled-trials" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Placebo tests for randomized controlled trials<a href="placebo.html#placebo-tests-for-randomized-controlled-trials" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I have to issue a warning as a foreword to this section: placebo tests for randomized controlled trials are kind of a weird object.
If randomization was well conducted, there should be no point in conducting such a test.
But I am going to present them anyway, since they are a good introduction to placebo tests for other designs.
I will comment on their limitations in the case of RCTs at the end of this section.</p>
<p>We need a few assumptions to make placebo tests do what we do.
The most important one is the no-anticipation condition.
In order to define it, we are going to consider a setting with two periods (<span class="math inline">\(t=B\)</span> for Before and <span class="math inline">\(t=A\)</span> for After).
In the Before period, units can have four potential outcomes: <span class="math inline">\(Y_{i,B}^{b,a}\)</span>, with <span class="math inline">\((a,b)\in\left\{0,1\right\}^2\)</span>, with <span class="math inline">\(b\)</span> standing for the treatment status in the Before period and <span class="math inline">\(a\)</span> standing for the treatment status in the After period.</p>
<p>With this notation, we have the possibility that future treatment status impacts current outcomes.
For example, <span class="math inline">\(Y_{i,B}^{0,1}-Y_{i,B}^{0,0}\)</span> is the treatment effect on unit <span class="math inline">\(i\)</span> in period <span class="math inline">\(t=B\)</span> of receiving the treatment in period <span class="math inline">\(t=A\)</span>.
What is this?
How can the future affect the past?
This seems to impose some violation of the usual standards of logic.
Actually, we only need agents to be able to at least partially forecast their future treatment status for that to happen.
For example, agents might that they will be part of the treatment group, have not started receiving the treatment yet, but have already started modifying their behavior as a consequence of the future treatment receipt.
If I know I am going to receive a cash transfer in the future, I might change my behavior in ancitipation, by starting borowing, or, if the transfer is conditional, making sure I am going to comply with the conditionality rules.</p>
<p>Anyway, with the no-anticipation condition, we are assuming away such effects:</p>
<div class="hypothesis">
<p><span id="hyp:NoAnticipation" class="hypothesis"><strong>Hypothesis 8.1  (No Anticipation) </strong></span>There is no causal effect of a future treatment on pre-treatment outcomes: <span class="math inline">\(Y_{i,B}^{b,a}=Y_{i,B}^{b}\)</span>, <span class="math inline">\(\forall (a,b)\in\left\{0,1\right\}^2\)</span>.</p>
</div>
<p>Under Assumption <a href="placebo.html#hyp:NoAnticipation">8.1</a>, agents did not anticipate the receipt of the treatment, or at least they did not change their decisions before receiving the treatment.
Let us now focus on the case where no one receives the treatment in the Before period: <span class="math inline">\(R_{i,B}=0\)</span>, <span class="math inline">\(\forall i\)</span>.
We thus can redefine <span class="math inline">\(R_{i,A}=R_i\)</span> without any confusion.</p>
<p>As a consequence of these assumptions, and of randomization, we have the following result:</p>
<div class="theorem">
<p><span id="thm:PlaceboBF" class="theorem"><strong>Theorem 8.1  (Placebo Test in the Brute Force Design) </strong></span>Under Assumptions <a href="RCT.html#def:independence">3.1</a>, <a href="RCT.html#def:BF">3.2</a> (both suitably extended to both periods <span class="math inline">\(t=A\)</span> and <span class="math inline">\(t=B\)</span>), and <a href="placebo.html#hyp:NoAnticipation">8.1</a>, the WW estimator of the effect of the treatment on <span class="math inline">\(Y_{i,B}\)</span> is zero:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^{Y_B}_{WW} &amp; = 0.
\end{align*}\]</span></p>
</div>
<div class="proof">
<p><span id="unlabeled-div-215" class="proof"><em>Proof</em>. </span>Under Assumption <a href="RCT.html#def:BF">3.2</a>, we have:</p>
<p><span class="math display">\[\begin{align*}
  Y_{i,B} &amp; = R_{i,B}R_{i,A}Y^{1,1}_{i,B}+R_{i,B}(1-R_{i,A})Y^{1,0}_{i,B}+(1-R_{i,B})R_{i,A}Y^{0,1}_{i,B}+(1-R_{i,B})(1-R_{i,A})Y^{0,0}_{i,B}\\
          &amp; = Y^0_{i,B}
\end{align*}\]</span></p>
<p>where the second line uses the fact that <span class="math inline">\(R_{i,B}=0\)</span>, <span class="math inline">\(\forall i\)</span> along with Assumption <a href="placebo.html#hyp:NoAnticipation">8.1</a>.
Therefore:
<span class="math display">\[\begin{align*}
  \Delta^{Y_B}_{WW} &amp; = \esp{Y_{i,B}|R_i=1}-\esp{Y_{i,B}|R_i=0}\\
                    &amp; = \esp{Y^0_{i,B}|R_i=1}-\esp{Y^0_{i,B}|R_i=0}\\
                    &amp; = 0,
\end{align*}\]</span>
where the last line stems from the fact that Assumptions <a href="RCT.html#def:independence">3.1</a> and <a href="placebo.html#hyp:NoAnticipation">8.1</a> imply that <span class="math inline">\(R_i\Ind(Y_{i,B}^0,Y_{i,B}^1,Y_{i,A}^0,Y_{i,A}^1)\)</span>, which in turns implies that <span class="math inline">\(\esp{Y_{i,B}^0|R_i=0}=\esp{Y_{i,B}^0|R_i=1}\)</span>.</p>
</div>
<p>Theorem <a href="placebo.html#thm:PlaceboBF">8.1</a> says that, in the population, there should be no effect of the treatment on outcomes observed before the treatment was implemented.
The only reason why that might happen is either that there are anticipation effects, or that randomization failed.</p>
<div class="remark">
<p><span id="unlabeled-div-216" class="remark"><em>Remark</em>. </span>In a finite sample, there is another difficulty: the effect of the treatment on pre-treatment outcomes will never be exactly zero.
How do we evaluate if it as small as to be practically zero?
Most researchers use statistical testing, and more specifically form the t-statistic for the null hypothesis of the treatment effect being zero and judge that randomization is well conducted when this test does not reject the null.
Is that a good practice?
On the one hand, this test seems to make sense.
It detects instances when confounders are severely misaligned between treatment and control group, and therefore the bias of the main treatment effect will probably be large.
On the other hand, it begs the question of what to do when the test rejects the null (as it will do 5% of the time).
We will come back to that issue at the end of the section.</p>
</div>
<div class="example">
<p><span id="exm:unnamed-chunk-369" class="example"><strong>Example 8.1  </strong></span>Let us first see how to implement the placebo test in our numerical example.
We are going to study the case of a brute force design, but all other designs can be treated in a similar way.
Let us first set the parameter values:</p>
</div>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="placebo.html#cb364-1" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>)</span>
<span id="cb364-2"><a href="placebo.html#cb364-2" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;theta&quot;</span>,<span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,<span class="st">&quot;delta&quot;</span>,<span class="st">&quot;baralpha&quot;</span>)</span></code></pre></div>
<p>We can now draw a new sample:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="placebo.html#cb365-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb365-2"><a href="placebo.html#cb365-2" tabindex="-1"></a>N <span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb365-3"><a href="placebo.html#cb365-3" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))</span>
<span id="cb365-4"><a href="placebo.html#cb365-4" tabindex="-1"></a>UB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb365-5"><a href="placebo.html#cb365-5" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UB </span>
<span id="cb365-6"><a href="placebo.html#cb365-6" tabindex="-1"></a>YB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yB)</span>
<span id="cb365-7"><a href="placebo.html#cb365-7" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb365-8"><a href="placebo.html#cb365-8" tabindex="-1"></a>Ds[YB<span class="sc">&lt;=</span>param[<span class="st">&quot;barY&quot;</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb365-9"><a href="placebo.html#cb365-9" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb365-10"><a href="placebo.html#cb365-10" tabindex="-1"></a>eta<span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]))</span>
<span id="cb365-11"><a href="placebo.html#cb365-11" tabindex="-1"></a>U0 <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilon</span>
<span id="cb365-12"><a href="placebo.html#cb365-12" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0 <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb365-13"><a href="placebo.html#cb365-13" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta</span>
<span id="cb365-14"><a href="placebo.html#cb365-14" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y0<span class="sc">+</span>alpha</span>
<span id="cb365-15"><a href="placebo.html#cb365-15" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y0)</span>
<span id="cb365-16"><a href="placebo.html#cb365-16" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y1)</span></code></pre></div>
<p>And finally we randomly allocate the treatment:</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="placebo.html#cb366-1" tabindex="-1"></a><span class="co"># randomized allocation of 50% of individuals</span></span>
<span id="cb366-2"><a href="placebo.html#cb366-2" tabindex="-1"></a>Rs <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb366-3"><a href="placebo.html#cb366-3" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Rs<span class="sc">&lt;=</span>.<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb366-4"><a href="placebo.html#cb366-4" tabindex="-1"></a>y <span class="ot">&lt;-</span> y1<span class="sc">*</span>R<span class="sc">+</span>y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>R)</span>
<span id="cb366-5"><a href="placebo.html#cb366-5" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y1<span class="sc">*</span>R<span class="sc">+</span>Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>R)</span></code></pre></div>
<p>Let us now estimate the effect of the treatment on the pre-treatment outcome <span class="math inline">\(y_i^B\)</span>:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="placebo.html#cb367-1" tabindex="-1"></a>PlaceboReg <span class="ot">&lt;-</span> <span class="fu">lm</span>(yB<span class="sc">~</span>R)</span>
<span id="cb367-2"><a href="placebo.html#cb367-2" tabindex="-1"></a><span class="co"># placebo TE</span></span>
<span id="cb367-3"><a href="placebo.html#cb367-3" tabindex="-1"></a>PlaceboTE <span class="ot">&lt;-</span> <span class="fu">coef</span>(PlaceboReg)[[<span class="dv">2</span>]]</span>
<span id="cb367-4"><a href="placebo.html#cb367-4" tabindex="-1"></a>PlaceboSe <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(PlaceboReg))[[<span class="dv">2</span>]])</span>
<span id="cb367-5"><a href="placebo.html#cb367-5" tabindex="-1"></a>tTwoSided <span class="ot">&lt;-</span> <span class="fu">abs</span>(PlaceboTE<span class="sc">/</span>PlaceboSe)</span>
<span id="cb367-6"><a href="placebo.html#cb367-6" tabindex="-1"></a>pTwoSided <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pnorm</span>(tTwoSided))</span></code></pre></div>
<p>We estimate a placebo treatment effect of -0.02 <span class="math inline">\(\pm\)</span> 0.11.
The corresponding t-statistic for a (two-sided) test of the null hypothesis of no treatment effect is equal to 0.4 and the corresponding p-value is equal to 0.69.</p>
<div class="remark">
<p><span id="unlabeled-div-217" class="remark"><em>Remark</em>. </span>Very often, researchers have access to additional pre-treatment covariates on top of the pre-treatment outcome.
A similar placebo test can be conducted for each of these baseline characteristics.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-218" class="remark"><em>Remark</em>. </span>What shall a researcher do when the test rejects the null of no difference for of one of the baseline characteristics?
Presenting a table of covariate balance with statistically significant difference in baseline characteristics undermines gravely the trust that researchers put in the presented results (and there are good reasons for that).
As a consequence, in practice, applied researchers tend to re-randomize until they achieve a satisfying level of covariate balance (see for example the evidence reported in <a href="https://doi.org/10.1257/app.1.4.200">Bruhn and McKenzie (2009)</a>).
Is that a bad practice?
Not really, since what it does is to prevent the emergence of too serious imbalance in baseline covariates, and therefore probably will decrease sampling noise (see <a href="https://doi.org/10.1214/12-AOS1008">Morgan and Rubin (2012)</a> for more dicussion).
As such, rerandomization is a form of covariate-adaptive randomization similar to stratification.
The main difference with stratification is that we do not have (at least to my knowledge) CLT-based estimators of sampling noise after re-randomization.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-219" class="remark"><em>Remark</em>. </span><a href="https://doi.org/10.1016/bs.hefe.2016.08.005">Banerjee, Chassang and Snowberg (2017)</a> provide a fascinating discussion of re-randomization in the context of a theoretical model of experimentation.
They argue that randomization serves to reconcile conflicting priors as to what is the best experiment.
In that context, a low level of rerandomization is acceptable (of the order of 100 such re-randomizations).</p>
</div>
</div>
<div id="placebo-tests-for-natural-experiments" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Placebo tests for natural experiments<a href="placebo.html#placebo-tests-for-natural-experiments" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We are now going to study how to conduct placebo tests with natural experiments.
We are going to start with Instrumental Variable estimators, then look at RDD, DID and DID-IV.</p>
<div id="placebo-tests-for-instrumental-variables" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Placebo tests for Instrumental Variables<a href="placebo.html#placebo-tests-for-instrumental-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>With instrumental variables, the key assumption that we want to test is Assumption <a href="NE.html#hyp:Independence">4.3</a> of Independence between potential outcomes and the instrument.
Assumption <a href="NE.html#hyp:Independence">4.3</a> is generally thought to be untestable, but I beg to disagree.
How would we go about and test that assumption?
We would need to find some variable which is highly correlated with potential outcomes and can act as a surrogate.
One such variable is a pre-treatment outcome: if the instrument is independent from post-treatment potential outcomes, it has to be independent from pre-treatment outcomes, otherwise, something fishy is going on (and probably our instrument is not very good).
This is for example what happens in RCTs with eligiblity or encouragement designs: the randomized offer or encouragement to take the treatment is independent from pre-treatment outcomes.</p>
<div class="example">
<p><span id="exm:unnamed-chunk-373" class="example"><strong>Example 8.2  </strong></span>Let us see how this test works in the example we used in Section <a href="NE.html#IVMONO">4.1.2.3</a>.
Let us first choose parameter values and generate the data.</p>
</div>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="placebo.html#cb368-1" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">7.98</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.5</span>,<span class="fl">0.9</span>,<span class="fl">0.28</span>,<span class="dv">0</span>)</span>
<span id="cb368-2"><a href="placebo.html#cb368-2" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;theta&quot;</span>,<span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,<span class="st">&quot;delta&quot;</span>,<span class="st">&quot;baralpha&quot;</span>,<span class="st">&quot;gamma&quot;</span>,<span class="st">&quot;baryB&quot;</span>,<span class="st">&quot;pZ&quot;</span>,<span class="st">&quot;barkappa&quot;</span>,<span class="st">&quot;underbarkappa&quot;</span>,<span class="st">&quot;pxi&quot;</span>,<span class="st">&quot;sigma2omega&quot;</span>,<span class="st">&quot;rhoetaomega&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="placebo.html#cb369-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb369-2"><a href="placebo.html#cb369-2" tabindex="-1"></a>N <span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb369-3"><a href="placebo.html#cb369-3" tabindex="-1"></a>cov.eta.omega <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(param[<span class="st">&quot;sigma2eta&quot;</span>],param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;sigma2omega&quot;</span>]),<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb369-4"><a href="placebo.html#cb369-4" tabindex="-1"></a>eta.omega <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">mvrnorm</span>(N,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),cov.eta.omega))</span>
<span id="cb369-5"><a href="placebo.html#cb369-5" tabindex="-1"></a><span class="fu">colnames</span>(eta.omega) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;eta&#39;</span>,<span class="st">&#39;omega&#39;</span>)</span>
<span id="cb369-6"><a href="placebo.html#cb369-6" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))</span>
<span id="cb369-7"><a href="placebo.html#cb369-7" tabindex="-1"></a>UB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb369-8"><a href="placebo.html#cb369-8" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UB </span>
<span id="cb369-9"><a href="placebo.html#cb369-9" tabindex="-1"></a>YB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yB)</span>
<span id="cb369-10"><a href="placebo.html#cb369-10" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb369-11"><a href="placebo.html#cb369-11" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,param[<span class="st">&quot;pZ&quot;</span>])</span>
<span id="cb369-12"><a href="placebo.html#cb369-12" tabindex="-1"></a>V <span class="ot">&lt;-</span> param[<span class="st">&quot;gamma&quot;</span>]<span class="sc">*</span>(mu<span class="sc">-</span>param[<span class="st">&quot;barmu&quot;</span>])<span class="sc">+</span>eta.omega<span class="sc">$</span>omega</span>
<span id="cb369-13"><a href="placebo.html#cb369-13" tabindex="-1"></a>Ds[yB<span class="sc">-</span>param[<span class="st">&quot;barkappa&quot;</span>]<span class="sc">*</span>Z<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb369-14"><a href="placebo.html#cb369-14" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb369-15"><a href="placebo.html#cb369-15" tabindex="-1"></a>U0 <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilon</span>
<span id="cb369-16"><a href="placebo.html#cb369-16" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0 <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb369-17"><a href="placebo.html#cb369-17" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta.omega<span class="sc">$</span>eta</span>
<span id="cb369-18"><a href="placebo.html#cb369-18" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y0<span class="sc">+</span>alpha</span>
<span id="cb369-19"><a href="placebo.html#cb369-19" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y0)</span>
<span id="cb369-20"><a href="placebo.html#cb369-20" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y1)</span>
<span id="cb369-21"><a href="placebo.html#cb369-21" tabindex="-1"></a>y <span class="ot">&lt;-</span> y1<span class="sc">*</span>Ds<span class="sc">+</span>y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span>
<span id="cb369-22"><a href="placebo.html#cb369-22" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y1<span class="sc">*</span>Ds<span class="sc">+</span>Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span>
<span id="cb369-23"><a href="placebo.html#cb369-23" tabindex="-1"></a><span class="co"># Types</span></span>
<span id="cb369-24"><a href="placebo.html#cb369-24" tabindex="-1"></a>D1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(yB<span class="sc">-</span>param[<span class="st">&quot;barkappa&quot;</span>]<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb369-25"><a href="placebo.html#cb369-25" tabindex="-1"></a>D0 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(yB<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb369-26"><a href="placebo.html#cb369-26" tabindex="-1"></a>AT <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb369-27"><a href="placebo.html#cb369-27" tabindex="-1"></a>NT <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb369-28"><a href="placebo.html#cb369-28" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb369-29"><a href="placebo.html#cb369-29" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb369-30"><a href="placebo.html#cb369-30" tabindex="-1"></a>Type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(AT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;a&#39;</span>,</span>
<span id="cb369-31"><a href="placebo.html#cb369-31" tabindex="-1"></a>            <span class="fu">ifelse</span>(NT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;n&#39;</span>,</span>
<span id="cb369-32"><a href="placebo.html#cb369-32" tabindex="-1"></a>                   <span class="fu">ifelse</span>(C<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;c&#39;</span>,</span>
<span id="cb369-33"><a href="placebo.html#cb369-33" tabindex="-1"></a>                          <span class="fu">ifelse</span>(D<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;d&#39;</span>,<span class="st">&quot;&quot;</span>))))</span>
<span id="cb369-34"><a href="placebo.html#cb369-34" tabindex="-1"></a><span class="co"># dataframe</span></span>
<span id="cb369-35"><a href="placebo.html#cb369-35" tabindex="-1"></a>data.mono <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(Type,C,NT,AT,D1,D0,Y,y,Y1,Y0,y0,y1,yB,alpha,U0,eta.omega<span class="sc">$</span>eta,epsilon,Ds,Z,mu,UB))</span></code></pre></div>
<p>Let us now run the first stage, reduced form and structural regressions.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="placebo.html#cb370-1" tabindex="-1"></a><span class="co"># First stage</span></span>
<span id="cb370-2"><a href="placebo.html#cb370-2" tabindex="-1"></a>OLS.D.Z.IV.Placebo <span class="ot">&lt;-</span> <span class="fu">lm</span>(Ds<span class="sc">~</span>Z)</span>
<span id="cb370-3"><a href="placebo.html#cb370-3" tabindex="-1"></a>OLS.First.Stage.IV.Placebo <span class="ot">&lt;-</span> <span class="fu">coef</span>(OLS.D.Z.IV.Placebo)[[<span class="dv">2</span>]]</span>
<span id="cb370-4"><a href="placebo.html#cb370-4" tabindex="-1"></a>OLS.First.Stage.IV.Placebo.Se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(OLS.D.Z.IV.Placebo))[[<span class="dv">2</span>]])</span>
<span id="cb370-5"><a href="placebo.html#cb370-5" tabindex="-1"></a></span>
<span id="cb370-6"><a href="placebo.html#cb370-6" tabindex="-1"></a><span class="co"># Reduced form</span></span>
<span id="cb370-7"><a href="placebo.html#cb370-7" tabindex="-1"></a>OLS.yB.Z.IV.Placebo <span class="ot">&lt;-</span> <span class="fu">lm</span>(yB<span class="sc">~</span>Z)</span>
<span id="cb370-8"><a href="placebo.html#cb370-8" tabindex="-1"></a>OLS.Reduced.Form.IV.Placebo <span class="ot">&lt;-</span> <span class="fu">coef</span>(OLS.yB.Z.IV.Placebo)[[<span class="dv">2</span>]]</span>
<span id="cb370-9"><a href="placebo.html#cb370-9" tabindex="-1"></a>OLS.Reduced.Form.IV.Placebo.Se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(OLS.yB.Z.IV.Placebo))[[<span class="dv">2</span>]])</span>
<span id="cb370-10"><a href="placebo.html#cb370-10" tabindex="-1"></a></span>
<span id="cb370-11"><a href="placebo.html#cb370-11" tabindex="-1"></a><span class="co"># Structural regression</span></span>
<span id="cb370-12"><a href="placebo.html#cb370-12" tabindex="-1"></a>TSLS.yB.D.Z.IV.Placebo <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(yB<span class="sc">~</span>Ds<span class="sc">|</span>Z)</span>
<span id="cb370-13"><a href="placebo.html#cb370-13" tabindex="-1"></a>TSLS.Structural.Form.IV.Placebo <span class="ot">&lt;-</span> <span class="fu">coef</span>(TSLS.yB.D.Z.IV.Placebo)[[<span class="dv">2</span>]]</span>
<span id="cb370-14"><a href="placebo.html#cb370-14" tabindex="-1"></a>TSLS.Structural.Form.IV.Placebo.Se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(TSLS.yB.D.Z.IV.Placebo))[[<span class="dv">2</span>]])</span></code></pre></div>
<p>The first stage estimate of the impact of the instrument on take-up of the treatment is equal to 0.37 <span class="math inline">\(\pm\)</span> 0.06.
The reduced form estimate of the placebo intention to treat effect is equal to -0.1 <span class="math inline">\(\pm\)</span> 0.11.
The structural form estimate of the placebo LATE is equal to -0.26 <span class="math inline">\(\pm\)</span> 0.27.</p>
</div>
<div id="placebo-tests-for-regression-discontinuity-designs" class="section level3 hasAnchor" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Placebo tests for Regression Discontinuity Designs<a href="placebo.html#placebo-tests-for-regression-discontinuity-designs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For regression discontinuity designs, the main assumption is Assumption <a href="NE.html#hyp:ContinuousOutcomes">4.8</a> of the continuity of potential outcomes around the threshold.
In order to test this assumption, placebo tests can take two forms:</p>
<ol style="list-style-type: decimal">
<li>Testing the continuity of the expectation of pre-treatment covariates around the threshold.</li>
<li>Testing the continuity of the density of the running variable around the threshold.</li>
</ol>
<div id="testing-the-continuity-of-the-expectation-of-pre-treatment-covariates-around-the-threshold" class="section level4 hasAnchor" number="8.2.2.1">
<h4><span class="header-section-number">8.2.2.1</span> Testing the continuity of the expectation of pre-treatment covariates around the threshold<a href="placebo.html#testing-the-continuity-of-the-expectation-of-pre-treatment-covariates-around-the-threshold" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Under Assumption <a href="NE.html#hyp:ContinuousOutcomes">4.8</a>, it is plenty likely that all pre-treatment covariates have continuous expected outcomes around the threshold.
Finding the contrary would be worrying.
In order to test for that assumption, we are going to estimate a placebo treatment effect and its precision.</p>
<div class="example">
<p><span id="exm:unnamed-chunk-374" class="example"><strong>Example 8.3  </strong></span>Letâs see how this works in our example.
In order to be able to implement the test, we need to have pre-treatment covariates that are not the running variable (which is by definition continuous around the threshold).
We are going to simulate data with a <span class="math inline">\(BB\)</span> period, observed before the <span class="math inline">\(B\)</span> period used for selection.</p>
</div>
<p>Let us first generate some data:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="placebo.html#cb371-1" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span> </span>
<span id="cb371-2"><a href="placebo.html#cb371-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb371-3"><a href="placebo.html#cb371-3" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))</span>
<span id="cb371-4"><a href="placebo.html#cb371-4" tabindex="-1"></a>UBB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb371-5"><a href="placebo.html#cb371-5" tabindex="-1"></a>yBB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UBB </span>
<span id="cb371-6"><a href="placebo.html#cb371-6" tabindex="-1"></a>YBB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yBB)</span>
<span id="cb371-7"><a href="placebo.html#cb371-7" tabindex="-1"></a>epsilonB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb371-8"><a href="placebo.html#cb371-8" tabindex="-1"></a>UB <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UBB <span class="sc">+</span> epsilonB</span>
<span id="cb371-9"><a href="placebo.html#cb371-9" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>param[<span class="st">&quot;delta&quot;</span>]<span class="sc">+</span>  UB </span>
<span id="cb371-10"><a href="placebo.html#cb371-10" tabindex="-1"></a>epsilonA <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb371-11"><a href="placebo.html#cb371-11" tabindex="-1"></a>U0A <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilonA</span>
<span id="cb371-12"><a href="placebo.html#cb371-12" tabindex="-1"></a>y0A <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0A <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb371-13"><a href="placebo.html#cb371-13" tabindex="-1"></a>eta<span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]))</span>
<span id="cb371-14"><a href="placebo.html#cb371-14" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta</span>
<span id="cb371-15"><a href="placebo.html#cb371-15" tabindex="-1"></a>y1A <span class="ot">&lt;-</span> y0A<span class="sc">+</span>alpha</span>
<span id="cb371-16"><a href="placebo.html#cb371-16" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(yB<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb371-17"><a href="placebo.html#cb371-17" tabindex="-1"></a>yA <span class="ot">&lt;-</span> y1A<span class="sc">*</span>Ds<span class="sc">+</span>y0A<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span></code></pre></div>
<p>Let us now run the Local Linear Regression around the threshold for the <span class="math inline">\(y_i^{BB}\)</span> variable.
For that, we first select the optimal bandwidth on both sides using an MSE leav-one-out cruterion.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="placebo.html#cb372-1" tabindex="-1"></a>kernel <span class="ot">&lt;-</span> <span class="st">&#39;gaussian&#39;</span></span>
<span id="cb372-2"><a href="placebo.html#cb372-2" tabindex="-1"></a>bw <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb372-3"><a href="placebo.html#cb372-3" tabindex="-1"></a></span>
<span id="cb372-4"><a href="placebo.html#cb372-4" tabindex="-1"></a>MSE.grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="at">by=</span>.<span class="dv">1</span>)</span>
<span id="cb372-5"><a href="placebo.html#cb372-5" tabindex="-1"></a>MSE.llr<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>yBB,<span class="at">D=</span>Ds,<span class="at">x=</span>yB,<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">0</span>)</span>
<span id="cb372-6"><a href="placebo.html#cb372-6" tabindex="-1"></a>MSE.llr<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>yBB,<span class="at">D=</span>Ds,<span class="at">x=</span>yB,<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">1</span>)</span>
<span id="cb372-7"><a href="placebo.html#cb372-7" tabindex="-1"></a></span>
<span id="cb372-8"><a href="placebo.html#cb372-8" tabindex="-1"></a>y0.llr <span class="ot">&lt;-</span> <span class="fu">llr</span>(yBB[Ds<span class="sc">==</span><span class="dv">0</span>],yB[Ds<span class="sc">==</span><span class="dv">0</span>],yB[Ds<span class="sc">==</span><span class="dv">0</span>],<span class="at">bw=</span>MSE.grid[MSE.llr<span class="fl">.0</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.0</span>)],<span class="at">kernel=</span>kernel)    </span>
<span id="cb372-9"><a href="placebo.html#cb372-9" tabindex="-1"></a>y1.llr <span class="ot">&lt;-</span> <span class="fu">llr</span>(yBB[Ds<span class="sc">==</span><span class="dv">1</span>],yB[Ds<span class="sc">==</span><span class="dv">1</span>],yB[Ds<span class="sc">==</span><span class="dv">1</span>],<span class="at">bw=</span>MSE.grid[MSE.llr<span class="fl">.1</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.1</span>)],<span class="at">kernel=</span>kernel)    </span></code></pre></div>
<p>Let us plot the resulting estimates:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="placebo.html#cb373-1" tabindex="-1"></a><span class="fu">plot</span>(yB[Ds<span class="sc">==</span><span class="dv">0</span>],yBB[Ds<span class="sc">==</span><span class="dv">0</span>],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">xlab=</span><span class="st">&quot;yB&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;yBB&quot;</span>)</span>
<span id="cb373-2"><a href="placebo.html#cb373-2" tabindex="-1"></a><span class="fu">points</span>(yB[Ds<span class="sc">==</span><span class="dv">1</span>],yBB[Ds<span class="sc">==</span><span class="dv">1</span>],<span class="at">pch=</span><span class="dv">3</span>)</span>
<span id="cb373-3"><a href="placebo.html#cb373-3" tabindex="-1"></a><span class="fu">points</span>(yB[Ds<span class="sc">==</span><span class="dv">0</span>],y0.llr,<span class="at">col=</span><span class="st">&#39;blue&#39;</span>,<span class="at">pch=</span><span class="dv">1</span>)</span>
<span id="cb373-4"><a href="placebo.html#cb373-4" tabindex="-1"></a><span class="fu">points</span>(yB[Ds<span class="sc">==</span><span class="dv">1</span>],y1.llr,<span class="at">col=</span><span class="st">&#39;blue&#39;</span>,<span class="at">pch=</span><span class="dv">3</span>)</span>
<span id="cb373-5"><a href="placebo.html#cb373-5" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb373-6"><a href="placebo.html#cb373-6" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])),<span class="at">y=</span><span class="fu">c</span>(<span class="dv">5</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>))),<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">2</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;red&#39;</span>))</span>
<span id="cb373-7"><a href="placebo.html#cb373-7" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">5</span>,<span class="dv">11</span>,<span class="fu">c</span>(<span class="st">&#39;y|D=0&#39;</span>,<span class="st">&#39;y|D=1&#39;</span>,<span class="fu">expression</span>(<span class="fu">hat</span>(<span class="st">&#39;y0&#39;</span>)),<span class="fu">expression</span>(<span class="fu">hat</span>(<span class="st">&#39;y1&#39;</span>))),<span class="at">pch=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">3</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;black&#39;</span>,<span class="st">&#39;black&#39;</span>,<span class="st">&#39;blue&#39;</span>,<span class="st">&#39;blue&#39;</span>),<span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plotrddllr"></span>
<img src="STCI_files/figure-html/plotrddllr-1.png" alt="Placebo test with RDD LLR" width="65%" />
<p class="caption">
Figure 8.1: Placebo test with RDD LLR
</p>
</div>
<p>Let us now estimate the resulting placebo parameter and its precision:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="placebo.html#cb374-1" tabindex="-1"></a>bw <span class="ot">&lt;-</span> <span class="fu">max</span>(MSE.grid[MSE.llr<span class="fl">.0</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.0</span>)],MSE.grid[MSE.llr<span class="fl">.1</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.1</span>)])</span>
<span id="cb374-2"><a href="placebo.html#cb374-2" tabindex="-1"></a>yBB.h <span class="ot">&lt;-</span> yBB[<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">-</span>bw<span class="sc">&lt;</span>yB <span class="sc">&amp;</span> yB<span class="sc">&lt;</span><span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>bw]</span>
<span id="cb374-3"><a href="placebo.html#cb374-3" tabindex="-1"></a>Ds.h <span class="ot">&lt;-</span> Ds[<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">-</span>bw<span class="sc">&lt;</span>yB <span class="sc">&amp;</span> yB<span class="sc">&lt;</span><span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>bw]</span>
<span id="cb374-4"><a href="placebo.html#cb374-4" tabindex="-1"></a>yB.l <span class="ot">&lt;-</span> (yB[<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">-</span>bw<span class="sc">&lt;</span>yB <span class="sc">&amp;</span> yB<span class="sc">&lt;</span><span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>bw]<span class="sc">-</span><span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>]))<span class="sc">*</span>Ds[<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">-</span>bw<span class="sc">&lt;</span>yB <span class="sc">&amp;</span> yB<span class="sc">&lt;</span><span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>bw]</span>
<span id="cb374-5"><a href="placebo.html#cb374-5" tabindex="-1"></a>yB.r <span class="ot">&lt;-</span> (yB[<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">-</span>bw<span class="sc">&lt;</span>yB <span class="sc">&amp;</span> yB<span class="sc">&lt;</span><span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>bw]<span class="sc">-</span><span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>]))<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds[<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">-</span>bw<span class="sc">&lt;</span>yB <span class="sc">&amp;</span> yB<span class="sc">&lt;</span><span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>bw])</span>
<span id="cb374-6"><a href="placebo.html#cb374-6" tabindex="-1"></a>reg.rdd.local.ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(yBB.h <span class="sc">~</span> Ds.h <span class="sc">+</span> yB.l <span class="sc">+</span> yB.r)</span>
<span id="cb374-7"><a href="placebo.html#cb374-7" tabindex="-1"></a>TT.Placebo <span class="ot">&lt;-</span> reg.rdd.local.ols<span class="sc">$</span>coef[<span class="dv">2</span>]</span>
<span id="cb374-8"><a href="placebo.html#cb374-8" tabindex="-1"></a>se.TT.Placebo <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">vcov</span>(reg.rdd.local.ols)[<span class="dv">2</span>,<span class="dv">2</span>])</span></code></pre></div>
<p>The estimated placebo treatment effect is of -0.05 <span class="math inline">\(\pm\)</span> 0.09.</p>
</div>
<div id="testing-the-continuity-of-the-density-of-the-running-variable-around-the-threshold" class="section level4 hasAnchor" number="8.2.2.2">
<h4><span class="header-section-number">8.2.2.2</span> Testing the continuity of the density of the running variable around the threshold<a href="placebo.html#testing-the-continuity-of-the-density-of-the-running-variable-around-the-threshold" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><a href="https://doi.org/10.1016/j.jeconom.2007.05.005">McCrary (2008)</a> has proposed a test of the continuity of the density of the running variable around the threshold.
This test is one of the manipulation of the position around the threshold: maybe individuals are manipulating the value of their running variable in order to become eligible to the program.
This would of course make the RDD estimate fully false.</p>
<p>The approach porposed by McCray has two steps:</p>
<ol style="list-style-type: decimal">
<li>Build an undersmoothed histogram of the distribution of the running variable, using the selection threshold as a bound for two of the bins.</li>
<li>Apply LLR on each side of the threshold and estimate the difference in the predicted value of the density at the threshold.</li>
</ol>
<p>In order to build an histogram of the distribution of the running variable <span class="math inline">\(R_i\)</span> around the selection threshold, McCrary proposes to build a discretized version of the running variable using the following transformation:</p>
<p><span class="math display">\[\begin{align*}
  g(R_i) &amp; = \lfloor\frac{R_i-c}{b}\rfloor b+\frac{b}{2} + c,
\end{align*}\]</span></p>
<p>with <span class="math inline">\(\lfloor a \rfloor\)</span> the floor function, returning the greatest integer lower or equal to <span class="math inline">\(a\)</span> (<span class="math inline">\(\lfloor a \rfloor = k\)</span>, with <span class="math inline">\(k\in\mathbf{Z}\)</span> and <span class="math inline">\(k\leq a &lt; k+1\)</span>), <span class="math inline">\(c\)</span> the selection threshold, and <span class="math inline">\(b\)</span> the binsize.
The <span class="math inline">\(g\)</span> transformation generates a set of equi-spaced (with a distance <span class="math inline">\(b\)</span>) values, <span class="math inline">\(X_1,X_2,\dots,X_J\)</span> which serve as the <span class="math inline">\(x\)</span>-axis of the histogram.
The <span class="math inline">\(y\)</span>-axis of the histogram is defined as the normalized number of observations that take each of these values:</p>
<p><span class="math display">\[\begin{align*}
  Y_j &amp; = \frac{1}{Nb}\sum_{i=1}^N\uns{g(R_i)=X_j}.
\end{align*}\]</span></p>
<p>The second step simply runs a LLR estimate through the resulting data <span class="math inline">\(\left(X_j,Y_j\right)\)</span>, around <span class="math inline">\(c\)</span>, yielding two estimates of the density, one above <span class="math inline">\(c\)</span> (<span class="math inline">\(\hat{f}^+\)</span>), and one below (<span class="math inline">\(\hat{f}^-\)</span>).
The final parameter estimate used to teste the continuity of the density of the running variable is <span class="math inline">\(\hat\theta\)</span>, with:</p>
<p><span class="math display">\[\begin{align*}
  \hat\theta &amp; = \ln\hat{f}^+-\ln\hat{f}^-.
\end{align*}\]</span></p>
<p><a href="https://doi.org/10.1016/j.jeconom.2007.05.005">McCrary (2008)</a> proves the following result:</p>
<div class="theorem">
<p><span id="thm:McCrary" class="theorem"><strong>Theorem 8.2  (Asymptotic distribution of the density disconuity estimator) </strong></span>If <span class="math inline">\(f\)</span> has three continuous and bounded derivatives everywhere on its domain except at <span class="math inline">\(c\)</span>, if <span class="math inline">\(h\rightarrow 0\)</span>, <span class="math inline">\(Nh\rightarrow \infty\)</span>, <span class="math inline">\(\frac{b}{h}\rightarrow 0\)</span> and <span class="math inline">\(h^2\sqrt{Nh}\rightarrow H\geq 0\)</span> and if <span class="math inline">\(R_1,R_2,\dots,R_N\)</span> is a random sample with density <span class="math inline">\(f\)</span>, we have:</p>
<p><span class="math display">\[\begin{align*}
  \sqrt{Nh}(\hat\theta-\theta) &amp; \distr \mathcal{N}\left(B,\frac{24}{5}\left(\frac{1}{\hat{f}^+}+\frac{1}{\hat{f}^-}\right)\right).
\end{align*}\]</span></p>
</div>
<div class="proof">
<p><span id="unlabeled-div-220" class="proof"><em>Proof</em>. </span>See <a href="https://doi.org/10.1016/j.jeconom.2007.05.005">McCrary (2008)</a>.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-221" class="remark"><em>Remark</em>. </span>Theorem <a href="placebo.html#thm:McCrary">8.2</a> shows that the asymptotic distribution of <span class="math inline">\(\hat\theta\)</span> is actually biased.
This is a classical result of non-parametric statistics.
The answer to that is to undersmooth, to make the bias term <span class="math inline">\(B\)</span> go to zero faster than <span class="math inline">\(\sqrt{Nh}\)</span>, and therefore restores consistency.
Undersmoothing means choosing a bandwidth <span class="math inline">\(h\)</span> that is half the optimal bandwidth chosen by cross-validation.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-222" class="remark"><em>Remark</em>. </span>Theorem <a href="placebo.html#thm:McCrary">8.2</a> relies on a Local Linear Regression using the triangular kernel.
We will use the Gaussian kernel in practice, and it should work fine.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-223" class="remark"><em>Remark</em>. </span>In practice, <a href="https://doi.org/10.1016/j.jeconom.2007.05.005">McCrary (2008)</a> suggests to use <span class="math inline">\(\hat{b}=\frac{2}{N}\hat{\sigma}\)</span>, with <span class="math inline">\(\hat{\sigma}\)</span> the sample standard deviation of the running variable, and then to use as <span class="math inline">\(\hat{h}\)</span> the average of the two quantities <span class="math inline">\(\kappa\left(\frac{\tilde{\sigma}^2(d-e)}{\sum_{j}\tilde{f&#39;&#39;}(X_j)^2}\right)^{\frac{1}{5}}\)</span>, where <span class="math inline">\(d-e\)</span> is <span class="math inline">\(X_J-c\)</span> for the right-hand side regression and <span class="math inline">\(c-X_1\)</span> for the left hand side, <span class="math inline">\(\kappa=3.348\)</span>, <span class="math inline">\(\tilde{\sigma}^2\)</span> the mean squared error of a regression of a fourth order polynomial run on each side of the cutoff, and <span class="math inline">\(\tilde{f&#39;&#39;}\)</span> the second derivative estimate from this same regression.</p>
</div>
<div class="example">
<p><span id="exm:unnamed-chunk-379" class="example"><strong>Example 8.4  </strong></span>Letâs see how McCraryâs test works in our example.
First, we have to build an undersmoothed histogram.
For that, we need to choose a binsize <span class="math inline">\(b\)</span> and generate the <span class="math inline">\(R_i\)</span> variable.
Letâs go.</p>
</div>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="placebo.html#cb375-1" tabindex="-1"></a><span class="co"># kernel</span></span>
<span id="cb375-2"><a href="placebo.html#cb375-2" tabindex="-1"></a>kernel <span class="ot">=</span> <span class="st">&#39;gaussian&#39;</span></span>
<span id="cb375-3"><a href="placebo.html#cb375-3" tabindex="-1"></a><span class="co">#threshold</span></span>
<span id="cb375-4"><a href="placebo.html#cb375-4" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])</span>
<span id="cb375-5"><a href="placebo.html#cb375-5" tabindex="-1"></a><span class="co"># binwidth</span></span>
<span id="cb375-6"><a href="placebo.html#cb375-6" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb375-7"><a href="placebo.html#cb375-7" tabindex="-1"></a><span class="co"># generating the discretized running variable         </span></span>
<span id="cb375-8"><a href="placebo.html#cb375-8" tabindex="-1"></a>Data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(yA,Ds,yB,yBB) <span class="sc">%&gt;%</span></span>
<span id="cb375-9"><a href="placebo.html#cb375-9" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb375-10"><a href="placebo.html#cb375-10" tabindex="-1"></a>          <span class="at">gR =</span> <span class="fu">floor</span>((yB<span class="sc">-</span>c)<span class="sc">/</span>b)<span class="sc">*</span>b<span class="sc">+</span>b<span class="sc">/</span><span class="dv">2</span><span class="sc">+</span>c</span>
<span id="cb375-11"><a href="placebo.html#cb375-11" tabindex="-1"></a>        )</span>
<span id="cb375-12"><a href="placebo.html#cb375-12" tabindex="-1"></a><span class="co"># generating the undersmoothed histogram</span></span>
<span id="cb375-13"><a href="placebo.html#cb375-13" tabindex="-1"></a>McCraryHist <span class="ot">&lt;-</span> Data <span class="sc">%&gt;%</span></span>
<span id="cb375-14"><a href="placebo.html#cb375-14" tabindex="-1"></a>              <span class="fu">group_by</span>(gR,Ds) <span class="sc">%&gt;%</span></span>
<span id="cb375-15"><a href="placebo.html#cb375-15" tabindex="-1"></a>              <span class="fu">summarize</span>(</span>
<span id="cb375-16"><a href="placebo.html#cb375-16" tabindex="-1"></a>                <span class="at">Dens =</span> <span class="fu">n</span>()<span class="sc">/</span>(N<span class="sc">*</span>b)</span>
<span id="cb375-17"><a href="placebo.html#cb375-17" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span></span>
<span id="cb375-18"><a href="placebo.html#cb375-18" tabindex="-1"></a>              <span class="fu">mutate</span>(</span>
<span id="cb375-19"><a href="placebo.html#cb375-19" tabindex="-1"></a>                <span class="at">Ds =</span> <span class="fu">factor</span>(Ds,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>))</span>
<span id="cb375-20"><a href="placebo.html#cb375-20" tabindex="-1"></a>              )</span>
<span id="cb375-21"><a href="placebo.html#cb375-21" tabindex="-1"></a><span class="co"># bandwidth choice by cross validation</span></span>
<span id="cb375-22"><a href="placebo.html#cb375-22" tabindex="-1"></a>MSE.grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="at">by=</span>.<span class="dv">1</span>)</span>
<span id="cb375-23"><a href="placebo.html#cb375-23" tabindex="-1"></a>MSE.llr<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>McCraryHist<span class="sc">$</span>Dens,<span class="at">D=</span>McCraryHist<span class="sc">$</span>Ds,<span class="at">x=</span>McCraryHist<span class="sc">$</span>gR,<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">0</span>)</span>
<span id="cb375-24"><a href="placebo.html#cb375-24" tabindex="-1"></a>MSE.llr<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">sapply</span>(MSE.grid,MSE.llr,<span class="at">y=</span>McCraryHist<span class="sc">$</span>Dens,<span class="at">D=</span>McCraryHist<span class="sc">$</span>Ds,<span class="at">x=</span>McCraryHist<span class="sc">$</span>gR,<span class="at">kernel=</span>kernel,<span class="at">d=</span><span class="dv">1</span>)</span>
<span id="cb375-25"><a href="placebo.html#cb375-25" tabindex="-1"></a><span class="co"># LLR regression with optimal bandwidth</span></span>
<span id="cb375-26"><a href="placebo.html#cb375-26" tabindex="-1"></a>y0.llr <span class="ot">&lt;-</span> <span class="fu">llr</span>(McCraryHist<span class="sc">$</span>Dens[McCraryHist<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">0</span>],McCraryHist<span class="sc">$</span>gR[McCraryHist<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">0</span>],McCraryHist<span class="sc">$</span>gR[McCraryHist<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">0</span>],<span class="at">bw=</span>MSE.grid[MSE.llr<span class="fl">.0</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.0</span>)],<span class="at">kernel=</span>kernel)    </span>
<span id="cb375-27"><a href="placebo.html#cb375-27" tabindex="-1"></a>y1.llr <span class="ot">&lt;-</span> <span class="fu">llr</span>(McCraryHist<span class="sc">$</span>Dens[McCraryHist<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">1</span>],McCraryHist<span class="sc">$</span>gR[McCraryHist<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">1</span>],McCraryHist<span class="sc">$</span>gR[McCraryHist<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">1</span>],<span class="at">bw=</span>MSE.grid[MSE.llr<span class="fl">.1</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.1</span>)],<span class="at">kernel=</span>kernel)    </span>
<span id="cb375-28"><a href="placebo.html#cb375-28" tabindex="-1"></a>yLLR <span class="ot">&lt;-</span> <span class="fu">c</span>(y1.llr,y0.llr)</span>
<span id="cb375-29"><a href="placebo.html#cb375-29" tabindex="-1"></a>McCraryHist<span class="sc">$</span>yLLR <span class="ot">&lt;-</span> yLLR</span>
<span id="cb375-30"><a href="placebo.html#cb375-30" tabindex="-1"></a><span class="co"># undersmoothing to estimate the actual effect</span></span>
<span id="cb375-31"><a href="placebo.html#cb375-31" tabindex="-1"></a>y0.llr.c <span class="ot">&lt;-</span> <span class="fu">llr</span>(McCraryHist<span class="sc">$</span>Dens[McCraryHist<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">0</span>],McCraryHist<span class="sc">$</span>gR[McCraryHist<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">0</span>],c,<span class="at">bw=</span><span class="fu">min</span>(MSE.grid[MSE.llr<span class="fl">.0</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.0</span>)],MSE.grid[MSE.llr<span class="fl">.1</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.1</span>)])<span class="sc">/</span><span class="dv">2</span>,<span class="at">kernel=</span>kernel)    </span>
<span id="cb375-32"><a href="placebo.html#cb375-32" tabindex="-1"></a>y1.llr.c <span class="ot">&lt;-</span> <span class="fu">llr</span>(McCraryHist<span class="sc">$</span>Dens[McCraryHist<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">1</span>],McCraryHist<span class="sc">$</span>gR[McCraryHist<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">1</span>],c,<span class="at">bw=</span><span class="fu">min</span>(MSE.grid[MSE.llr<span class="fl">.0</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.0</span>)],MSE.grid[MSE.llr<span class="fl">.1</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.1</span>)])<span class="sc">/</span><span class="dv">2</span>,<span class="at">kernel=</span>kernel)    </span>
<span id="cb375-33"><a href="placebo.html#cb375-33" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">log</span>(y1.llr.c)<span class="sc">-</span><span class="fu">log</span>(y0.llr.c)</span>
<span id="cb375-34"><a href="placebo.html#cb375-34" tabindex="-1"></a><span class="co"># estimating the standard error of theta</span></span>
<span id="cb375-35"><a href="placebo.html#cb375-35" tabindex="-1"></a>Se.theta <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(N<span class="sc">*</span><span class="fu">min</span>(MSE.grid[MSE.llr<span class="fl">.0</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.0</span>)],MSE.grid[MSE.llr<span class="fl">.1</span><span class="sc">==</span><span class="fu">min</span>(MSE.llr<span class="fl">.1</span>)]))<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">24</span><span class="sc">/</span><span class="dv">5</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span>y1.llr.c<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span>y0.llr.c))</span></code></pre></div>
<p>Letâs plot the resulting data:</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="placebo.html#cb376-1" tabindex="-1"></a><span class="fu">ggplot</span>(McCraryHist,<span class="fu">aes</span>(<span class="at">x=</span>gR,<span class="at">y=</span>Dens)) <span class="sc">+</span></span>
<span id="cb376-2"><a href="placebo.html#cb376-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb376-3"><a href="placebo.html#cb376-3" tabindex="-1"></a><span class="co">#  geom_point(aes(x=gR,y=yLLR),shape=2,color=&#39;blue&#39;)+</span></span>
<span id="cb376-4"><a href="placebo.html#cb376-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>gR,<span class="at">y=</span>yLLR,<span class="at">group=</span>Ds,<span class="at">color=</span>Ds,<span class="at">linetype=</span>Ds))<span class="sc">+</span></span>
<span id="cb376-5"><a href="placebo.html#cb376-5" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span>c,<span class="at">color=</span><span class="st">&#39;red&#39;</span>,<span class="at">linetype=</span><span class="st">&#39;dashed&#39;</span>)<span class="sc">+</span></span>
<span id="cb376-6"><a href="placebo.html#cb376-6" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">x=</span>c<span class="fl">+0.05</span>,<span class="at">y=</span><span class="sc">-</span><span class="fl">0.001</span>,<span class="at">label=</span><span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>)),<span class="at">color=</span><span class="st">&#39;red&#39;</span>)<span class="sc">+</span></span>
<span id="cb376-7"><a href="placebo.html#cb376-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:McCraryHistPlot"></span>
<img src="STCI_files/figure-html/McCraryHistPlot-1.png" alt="Histogram of the running variable" width="65%" />
<p class="caption">
Figure 8.2: Histogram of the running variable
</p>
</div>
<p>The resulting estimate is <span class="math inline">\(\hat\theta=\)</span> -0.17 <span class="math inline">\(\pm\)</span> 0.54.</p>
</div>
</div>
<div id="placebo-tests-for-difference-in-differences" class="section level3 hasAnchor" number="8.2.3">
<h3><span class="header-section-number">8.2.3</span> Placebo tests for Difference in Differences<a href="placebo.html#placebo-tests-for-difference-in-differences" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are going to look at placebo tests for DID, DID-IV and staggered DID.
The key assumptions we are going to test is the assumption of Parallel Trends (Assumption <a href="NE.html#hyp:ParallelTrends">4.14</a>).
We are actually going to test that this assumption holds in pre-treatment data.
If it does, it will give more credence to the fact that it holds in the post-treatment period.</p>
<div id="testing-for-parallel-trends-in-did-with-two-periods-of-pre-treatment-data" class="section level4 hasAnchor" number="8.2.3.1">
<h4><span class="header-section-number">8.2.3.1</span> Testing for parallel trends in DID with two periods of pre-treatment data<a href="placebo.html#testing-for-parallel-trends-in-did-with-two-periods-of-pre-treatment-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>With two years (<span class="math inline">\(BB\)</span> and <span class="math inline">\(B\)</span>) of pre-treatment data and knowledge of <span class="math inline">\(D_i\)</span> (or <span class="math inline">\(Z_i\)</span>) we can test the Parallel Trends Assumption by estimating the effect of a placebo treatment given on year <span class="math inline">\(B\)</span> to the group with <span class="math inline">\(D_i=1\)</span>.</p>
<div class="example">
<p><span id="exm:unnamed-chunk-380" class="example"><strong>Example 8.5  </strong></span>Letâs see how this works in our example.
For that, we are going to simiulate first a dataset with two periods of pre-treatment data.</p>
</div>
<p>Let us choose some parameter values first:</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="placebo.html#cb377-1" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>)</span>
<span id="cb377-2"><a href="placebo.html#cb377-2" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;theta&quot;</span>,<span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,<span class="st">&quot;delta&quot;</span>,<span class="st">&quot;baralpha&quot;</span>)</span></code></pre></div>
<p>And generate some data:</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="placebo.html#cb378-1" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span> </span>
<span id="cb378-2"><a href="placebo.html#cb378-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb378-3"><a href="placebo.html#cb378-3" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))</span>
<span id="cb378-4"><a href="placebo.html#cb378-4" tabindex="-1"></a>UBB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb378-5"><a href="placebo.html#cb378-5" tabindex="-1"></a>yBB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UBB </span>
<span id="cb378-6"><a href="placebo.html#cb378-6" tabindex="-1"></a>YBB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yBB)</span>
<span id="cb378-7"><a href="placebo.html#cb378-7" tabindex="-1"></a>epsilonB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb378-8"><a href="placebo.html#cb378-8" tabindex="-1"></a>UB <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UBB <span class="sc">+</span> epsilonB</span>
<span id="cb378-9"><a href="placebo.html#cb378-9" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>param[<span class="st">&quot;delta&quot;</span>]<span class="sc">+</span>  UB </span>
<span id="cb378-10"><a href="placebo.html#cb378-10" tabindex="-1"></a>epsilonA <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb378-11"><a href="placebo.html#cb378-11" tabindex="-1"></a>U0A <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilonA</span>
<span id="cb378-12"><a href="placebo.html#cb378-12" tabindex="-1"></a>y0A <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0A <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb378-13"><a href="placebo.html#cb378-13" tabindex="-1"></a>eta<span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]))</span>
<span id="cb378-14"><a href="placebo.html#cb378-14" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta</span>
<span id="cb378-15"><a href="placebo.html#cb378-15" tabindex="-1"></a>y1A <span class="ot">&lt;-</span> y0A<span class="sc">+</span>alpha</span>
<span id="cb378-16"><a href="placebo.html#cb378-16" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(yB<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb378-17"><a href="placebo.html#cb378-17" tabindex="-1"></a>yA <span class="ot">&lt;-</span> y1A<span class="sc">*</span>Ds<span class="sc">+</span>y0A<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span>
<span id="cb378-18"><a href="placebo.html#cb378-18" tabindex="-1"></a></span>
<span id="cb378-19"><a href="placebo.html#cb378-19" tabindex="-1"></a>y.t<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(yBB[Ds<span class="sc">==</span><span class="dv">1</span>]),<span class="fu">mean</span>(yB[Ds<span class="sc">==</span><span class="dv">1</span>]),<span class="fu">mean</span>(yA[Ds<span class="sc">==</span><span class="dv">1</span>]))</span>
<span id="cb378-20"><a href="placebo.html#cb378-20" tabindex="-1"></a>y.t<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(yBB[Ds<span class="sc">==</span><span class="dv">0</span>]),<span class="fu">mean</span>(yB[Ds<span class="sc">==</span><span class="dv">0</span>]),<span class="fu">mean</span>(yA[Ds<span class="sc">==</span><span class="dv">0</span>]))</span>
<span id="cb378-21"><a href="placebo.html#cb378-21" tabindex="-1"></a>y.did <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">c</span>(y.t<span class="fl">.1</span>,y.t<span class="fl">.0</span>))</span>
<span id="cb378-22"><a href="placebo.html#cb378-22" tabindex="-1"></a><span class="fu">colnames</span>(y.did) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;y&#39;</span>)</span>
<span id="cb378-23"><a href="placebo.html#cb378-23" tabindex="-1"></a>y.did<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&#39;BB&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;A&#39;</span>,<span class="st">&#39;BB&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;A&#39;</span>),<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;BB&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;A&#39;</span>))</span>
<span id="cb378-24"><a href="placebo.html#cb378-24" tabindex="-1"></a>y.did<span class="sc">$</span>D <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">3</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">3</span>)),<span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>Let us plot the resulting means:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="placebo.html#cb379-1" tabindex="-1"></a><span class="fu">ggplot</span>(y.did, <span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>y)) <span class="sc">+</span> </span>
<span id="cb379-2"><a href="placebo.html#cb379-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour=</span>D,<span class="at">group=</span>D)) <span class="sc">+</span></span>
<span id="cb379-3"><a href="placebo.html#cb379-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span>D),<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb379-4"><a href="placebo.html#cb379-4" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">6</span>,<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb379-5"><a href="placebo.html#cb379-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PlotPlaceboDID"></span>
<img src="STCI_files/figure-html/PlotPlaceboDID-1.png" alt="Outcomes Over Time in the Treated and Control Group" width="65%" />
<p class="caption">
Figure 8.3: Outcomes Over Time in the Treated and Control Group
</p>
</div>
<p>Let us now compute treatment effect estimates using <span class="math inline">\(B\)</span> as our placebo treatment period.
We are going to compare the estimates stemming from a pooled DID model (which ignores the individual level panel dimension of the data) and the fixed effects estimator.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="placebo.html#cb380-1" tabindex="-1"></a>y.pool <span class="ot">&lt;-</span> <span class="fu">c</span>(yA,yB,yBB)</span>
<span id="cb380-2"><a href="placebo.html#cb380-2" tabindex="-1"></a>Ds.pool <span class="ot">&lt;-</span> <span class="fu">c</span>(Ds,Ds,Ds)</span>
<span id="cb380-3"><a href="placebo.html#cb380-3" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">2</span>,N),<span class="fu">rep</span>(<span class="dv">1</span>,N),<span class="fu">rep</span>(<span class="dv">0</span>,N))</span>
<span id="cb380-4"><a href="placebo.html#cb380-4" tabindex="-1"></a>t.D <span class="ot">&lt;-</span> time<span class="sc">*</span>Ds.pool</span>
<span id="cb380-5"><a href="placebo.html#cb380-5" tabindex="-1"></a>data.panel <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>,N),<span class="fu">seq</span>(<span class="dv">1</span>,N),<span class="fu">seq</span>(<span class="dv">1</span>,N)),time,y.pool,Ds.pool,t.D)</span>
<span id="cb380-6"><a href="placebo.html#cb380-6" tabindex="-1"></a><span class="fu">colnames</span>(data.panel) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Individual&#39;</span>,<span class="st">&#39;time&#39;</span>,<span class="st">&#39;y&#39;</span>,<span class="st">&#39;Ds&#39;</span>,<span class="st">&#39;t.D&#39;</span>)</span>
<span id="cb380-7"><a href="placebo.html#cb380-7" tabindex="-1"></a>data.panel <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(data.panel)</span>
<span id="cb380-8"><a href="placebo.html#cb380-8" tabindex="-1"></a>reg.did.pool <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> time <span class="sc">+</span> Ds <span class="sc">+</span> t.D,<span class="at">data=</span>data.panel[data.panel<span class="sc">$</span>time<span class="sc">&lt;=</span><span class="dv">1</span>,])</span>
<span id="cb380-9"><a href="placebo.html#cb380-9" tabindex="-1"></a>reg.did.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(y <span class="sc">~</span> time <span class="sc">+</span> t.D,<span class="at">data=</span>data.panel[data.panel<span class="sc">$</span>time<span class="sc">&lt;=</span><span class="dv">1</span>,],<span class="at">index=</span><span class="fu">c</span>(<span class="st">&#39;Individual&#39;</span>,<span class="st">&#39;time&#39;</span>),<span class="at">model=</span><span class="st">&#39;within&#39;</span>)</span>
<span id="cb380-10"><a href="placebo.html#cb380-10" tabindex="-1"></a>placebo.did <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">c</span>(reg.did.fe<span class="sc">$</span>coef[<span class="dv">2</span>],reg.did.pool<span class="sc">$</span>coef[<span class="dv">4</span>]),<span class="fu">c</span>(<span class="fu">sqrt</span>(<span class="fu">vcov</span>(reg.did.fe)[<span class="dv">2</span>,<span class="dv">2</span>]),<span class="fu">sqrt</span>(<span class="fu">vcov</span>(reg.did.pool)[<span class="dv">4</span>,<span class="dv">4</span>])))</span>
<span id="cb380-11"><a href="placebo.html#cb380-11" tabindex="-1"></a><span class="fu">rownames</span>(placebo.did) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(placebo.did)</span>
<span id="cb380-12"><a href="placebo.html#cb380-12" tabindex="-1"></a><span class="fu">colnames</span>(placebo.did) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Coef&#39;</span>,<span class="st">&#39;SeCoef&#39;</span>)</span>
<span id="cb380-13"><a href="placebo.html#cb380-13" tabindex="-1"></a>placebo.did <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(placebo.did)</span>
<span id="cb380-14"><a href="placebo.html#cb380-14" tabindex="-1"></a>placebo.did<span class="sc">$</span>Method <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&#39;FE&#39;</span>,<span class="st">&#39;Pooled&#39;</span>),<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;Pooled&#39;</span>,<span class="st">&#39;FE&#39;</span>))</span></code></pre></div>
<p>Letâs plot our results:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="placebo.html#cb381-1" tabindex="-1"></a><span class="fu">ggplot</span>(placebo.did, <span class="fu">aes</span>(<span class="at">x=</span>Method, <span class="at">y=</span>Coef)) <span class="sc">+</span></span>
<span id="cb381-2"><a href="placebo.html#cb381-2" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>Coef<span class="fl">-1.96</span><span class="sc">*</span>SeCoef, <span class="at">ymax=</span>Coef<span class="fl">+1.96</span><span class="sc">*</span>SeCoef),<span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>),<span class="at">color=</span><span class="st">&#39;blue&#39;</span>) <span class="sc">+</span></span>
<span id="cb381-3"><a href="placebo.html#cb381-3" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PlaceboDIDEstimPlot"></span>
<img src="STCI_files/figure-html/PlaceboDIDEstimPlot-1.png" alt="Placebo Test with DID" width="65%" />
<p class="caption">
Figure 8.4: Placebo Test with DID
</p>
</div>
<p>The estimated placebo effect with the fixed effects estimator is equal to -0.06 <span class="math inline">\(\pm\)</span> 0.02.
Therefore the test rejects the validity of DID.
Why is that so?
Remember that DID is valid in our model only when <span class="math inline">\(\rho=1\)</span>.
This is absolutely not the case here, with <span class="math inline">\(\rho=\)</span> 0.9.</p>
</div>
<div id="testing-for-parallel-trends-in-did-iv-with-two-periods-of-pre-treatment-data" class="section level4 hasAnchor" number="8.2.3.2">
<h4><span class="header-section-number">8.2.3.2</span> Testing for parallel trends in DID-IV with two periods of pre-treatment data<a href="placebo.html#testing-for-parallel-trends-in-did-iv-with-two-periods-of-pre-treatment-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In DID-IV, we are going to do the same test as with DID, except that we are going to use <span class="math inline">\(Z_i\)</span> as the treatment group variable, as we are now testing the Parallel Trends Assumption <a href="NE.html#hyp:ParallelTrendsIV">4.29</a>.</p>
<div class="example">
<p><span id="exm:unnamed-chunk-381" class="example"><strong>Example 8.6  </strong></span>Letâs see how this works in our example:
Let us first generate some data.</p>
</div>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="placebo.html#cb382-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb382-2"><a href="placebo.html#cb382-2" tabindex="-1"></a>N <span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb382-3"><a href="placebo.html#cb382-3" tabindex="-1"></a><span class="co"># I am going to draw a state fixed effect for 50 states with variance 1/3 of the total variance of mu</span></span>
<span id="cb382-4"><a href="placebo.html#cb382-4" tabindex="-1"></a>Nstates <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb382-5"><a href="placebo.html#cb382-5" tabindex="-1"></a>muS <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(Nstates,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]<span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb382-6"><a href="placebo.html#cb382-6" tabindex="-1"></a>muS <span class="ot">&lt;-</span> <span class="fu">rep</span>(muS,<span class="at">each=</span>N<span class="sc">/</span>Nstates)</span>
<span id="cb382-7"><a href="placebo.html#cb382-7" tabindex="-1"></a><span class="co"># I draw an individual fixed effect with the remaining variance</span></span>
<span id="cb382-8"><a href="placebo.html#cb382-8" tabindex="-1"></a>muU <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]<span class="sc">*</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb382-9"><a href="placebo.html#cb382-9" tabindex="-1"></a>mu <span class="ot">&lt;-</span> param[<span class="st">&quot;barmu&quot;</span>] <span class="sc">+</span> muS <span class="sc">+</span> muU </span>
<span id="cb382-10"><a href="placebo.html#cb382-10" tabindex="-1"></a>UBB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb382-11"><a href="placebo.html#cb382-11" tabindex="-1"></a>yBB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UBB </span>
<span id="cb382-12"><a href="placebo.html#cb382-12" tabindex="-1"></a>YBB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yBB)</span>
<span id="cb382-13"><a href="placebo.html#cb382-13" tabindex="-1"></a>epsilonB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb382-14"><a href="placebo.html#cb382-14" tabindex="-1"></a>UB <span class="ot">&lt;-</span> param[<span class="st">&#39;rho&#39;</span>]<span class="sc">*</span>UBB<span class="sc">+</span>epsilonB</span>
<span id="cb382-15"><a href="placebo.html#cb382-15" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UB </span>
<span id="cb382-16"><a href="placebo.html#cb382-16" tabindex="-1"></a>YB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yB)</span>
<span id="cb382-17"><a href="placebo.html#cb382-17" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb382-18"><a href="placebo.html#cb382-18" tabindex="-1"></a>eta<span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]))</span>
<span id="cb382-19"><a href="placebo.html#cb382-19" tabindex="-1"></a>U0 <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilon</span>
<span id="cb382-20"><a href="placebo.html#cb382-20" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0 <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb382-21"><a href="placebo.html#cb382-21" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta</span>
<span id="cb382-22"><a href="placebo.html#cb382-22" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y0<span class="sc">+</span>alpha</span>
<span id="cb382-23"><a href="placebo.html#cb382-23" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y0)</span>
<span id="cb382-24"><a href="placebo.html#cb382-24" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y1)</span>
<span id="cb382-25"><a href="placebo.html#cb382-25" tabindex="-1"></a></span>
<span id="cb382-26"><a href="placebo.html#cb382-26" tabindex="-1"></a><span class="co"># Z=1 if states have lower muS than 0</span></span>
<span id="cb382-27"><a href="placebo.html#cb382-27" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(muS<span class="sc">&lt;=</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb382-28"><a href="placebo.html#cb382-28" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(YB<span class="sc">&lt;=</span>param[<span class="st">&quot;barY&quot;</span>] <span class="sc">&amp;</span> Z<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb382-29"><a href="placebo.html#cb382-29" tabindex="-1"></a>yA <span class="ot">&lt;-</span> y1<span class="sc">*</span>Ds<span class="sc">+</span>y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span>
<span id="cb382-30"><a href="placebo.html#cb382-30" tabindex="-1"></a>YA <span class="ot">&lt;-</span> Y1<span class="sc">*</span>Ds<span class="sc">+</span>Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span>
<span id="cb382-31"><a href="placebo.html#cb382-31" tabindex="-1"></a></span>
<span id="cb382-32"><a href="placebo.html#cb382-32" tabindex="-1"></a>y.t<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(yBB[Z<span class="sc">==</span><span class="dv">1</span>]),<span class="fu">mean</span>(yB[Z<span class="sc">==</span><span class="dv">1</span>]),<span class="fu">mean</span>(yA[Z<span class="sc">==</span><span class="dv">1</span>]))</span>
<span id="cb382-33"><a href="placebo.html#cb382-33" tabindex="-1"></a>y.t<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(yBB[Z<span class="sc">==</span><span class="dv">0</span>]),<span class="fu">mean</span>(yB[Z<span class="sc">==</span><span class="dv">0</span>]),<span class="fu">mean</span>(yA[Z<span class="sc">==</span><span class="dv">0</span>]))</span>
<span id="cb382-34"><a href="placebo.html#cb382-34" tabindex="-1"></a>y.did.iv <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">c</span>(y.t<span class="fl">.1</span>,y.t<span class="fl">.0</span>))</span>
<span id="cb382-35"><a href="placebo.html#cb382-35" tabindex="-1"></a><span class="fu">colnames</span>(y.did.iv) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;y&#39;</span>)</span>
<span id="cb382-36"><a href="placebo.html#cb382-36" tabindex="-1"></a>y.did.iv<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&#39;BB&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;A&#39;</span>,<span class="st">&#39;BB&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;A&#39;</span>),<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;BB&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;A&#39;</span>))</span>
<span id="cb382-37"><a href="placebo.html#cb382-37" tabindex="-1"></a>y.did.iv<span class="sc">$</span>Z <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">3</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">3</span>)),<span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>Let us now plot the resulting estimates:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="placebo.html#cb383-1" tabindex="-1"></a><span class="fu">ggplot</span>(y.did.iv, <span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>y)) <span class="sc">+</span> </span>
<span id="cb383-2"><a href="placebo.html#cb383-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour=</span>Z,<span class="at">group=</span>Z)) <span class="sc">+</span></span>
<span id="cb383-3"><a href="placebo.html#cb383-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span>Z),<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb383-4"><a href="placebo.html#cb383-4" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">6</span>,<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb383-5"><a href="placebo.html#cb383-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PlaceboDIDIVPlot"></span>
<img src="STCI_files/figure-html/PlaceboDIDIVPlot-1.png" alt="Outcomes Over Time" width="65%" />
<p class="caption">
Figure 8.5: Outcomes Over Time
</p>
</div>
<p>Let us now estimate the effect using the <code>feols</code> command of the <code>fixest</code> package, which will let us account for state-level autocorrelation between outcomes and the instrument, as we have seen in Chapter <a href="cluster.html#cluster">9</a>.
Let us first generate a dataset with all the required information.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="placebo.html#cb384-1" tabindex="-1"></a>DIDIVA <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id=</span><span class="dv">1</span><span class="sc">:</span>N,<span class="at">y=</span>yA,<span class="at">Ds=</span>Ds,<span class="at">Z=</span>Z,<span class="at">time=</span><span class="st">&quot;A&quot;</span>,<span class="at">muS=</span>muS)</span>
<span id="cb384-2"><a href="placebo.html#cb384-2" tabindex="-1"></a>DIDIVB <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id=</span><span class="dv">1</span><span class="sc">:</span>N,<span class="at">y=</span>yB,<span class="at">Ds=</span>Ds,<span class="at">Z=</span>Z,<span class="at">time=</span><span class="st">&quot;B&quot;</span>,<span class="at">muS=</span>muS)</span>
<span id="cb384-3"><a href="placebo.html#cb384-3" tabindex="-1"></a>DIDIVBB <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id=</span><span class="dv">1</span><span class="sc">:</span>N,<span class="at">y=</span>yBB,<span class="at">Ds=</span>Ds,<span class="at">Z=</span>Z,<span class="at">time=</span><span class="st">&quot;BB&quot;</span>,<span class="at">muS=</span>muS)</span>
<span id="cb384-4"><a href="placebo.html#cb384-4" tabindex="-1"></a>DIDIVPlacebo <span class="ot">&lt;-</span> <span class="fu">rbind</span>(DIDIVA,DIDIVB,DIDIVBB) <span class="sc">%&gt;%</span></span>
<span id="cb384-5"><a href="placebo.html#cb384-5" tabindex="-1"></a>              <span class="co"># Adding a treatment indicator taking value Ds when period is B and zero otherwise</span></span>
<span id="cb384-6"><a href="placebo.html#cb384-6" tabindex="-1"></a>              <span class="fu">mutate</span>(</span>
<span id="cb384-7"><a href="placebo.html#cb384-7" tabindex="-1"></a>                <span class="at">ZPlacebo =</span> <span class="fu">case_when</span>(</span>
<span id="cb384-8"><a href="placebo.html#cb384-8" tabindex="-1"></a>                  time <span class="sc">==</span> <span class="st">&quot;B&quot;</span> <span class="sc">~</span> Z,</span>
<span id="cb384-9"><a href="placebo.html#cb384-9" tabindex="-1"></a>                  time <span class="sc">!=</span> <span class="st">&quot;B&quot;</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb384-10"><a href="placebo.html#cb384-10" tabindex="-1"></a>                ),</span>
<span id="cb384-11"><a href="placebo.html#cb384-11" tabindex="-1"></a>                <span class="at">DPlacebo =</span> <span class="fu">case_when</span>(</span>
<span id="cb384-12"><a href="placebo.html#cb384-12" tabindex="-1"></a>                  time <span class="sc">==</span> <span class="st">&quot;B&quot;</span> <span class="sc">~</span> Ds,</span>
<span id="cb384-13"><a href="placebo.html#cb384-13" tabindex="-1"></a>                  time <span class="sc">!=</span> <span class="st">&quot;B&quot;</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb384-14"><a href="placebo.html#cb384-14" tabindex="-1"></a>                )</span>
<span id="cb384-15"><a href="placebo.html#cb384-15" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span></span>
<span id="cb384-16"><a href="placebo.html#cb384-16" tabindex="-1"></a>              <span class="co"># Adding a State level indicator for clustering</span></span>
<span id="cb384-17"><a href="placebo.html#cb384-17" tabindex="-1"></a>              <span class="fu">group_by</span>(muS) <span class="sc">%&gt;%</span></span>
<span id="cb384-18"><a href="placebo.html#cb384-18" tabindex="-1"></a>              <span class="fu">mutate</span>(</span>
<span id="cb384-19"><a href="placebo.html#cb384-19" tabindex="-1"></a>                <span class="at">StateId =</span> <span class="fu">cur_group_id</span>()</span>
<span id="cb384-20"><a href="placebo.html#cb384-20" tabindex="-1"></a>              )</span></code></pre></div>
<p>Let us now estimate the model on the placebo periods <span class="math inline">\(t=B\)</span> and <span class="math inline">\(t=BB\)</span>:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="placebo.html#cb385-1" tabindex="-1"></a><span class="co"># running DID regression on Placebo Z</span></span>
<span id="cb385-2"><a href="placebo.html#cb385-2" tabindex="-1"></a>regDIDIVPlacebo <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> ZPlacebo <span class="sc">|</span> time <span class="sc">+</span> id,<span class="at">data=</span><span class="fu">filter</span>(DIDIVPlacebo,time<span class="sc">!=</span><span class="st">&quot;A&quot;</span>),<span class="at">cluster=</span><span class="st">&quot;StateId&quot;</span>)</span>
<span id="cb385-3"><a href="placebo.html#cb385-3" tabindex="-1"></a>PlaceboDIDIVCoef <span class="ot">&lt;-</span> <span class="fu">coef</span>(regDIDIVPlacebo)[[<span class="dv">1</span>]]</span>
<span id="cb385-4"><a href="placebo.html#cb385-4" tabindex="-1"></a>PlaceboDIDIVSe <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(regDIDIVPlacebo))[[<span class="dv">1</span>]])</span>
<span id="cb385-5"><a href="placebo.html#cb385-5" tabindex="-1"></a><span class="co"># running DID regression on Placebo D</span></span>
<span id="cb385-6"><a href="placebo.html#cb385-6" tabindex="-1"></a>regDIDPlacebo <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> DPlacebo <span class="sc">|</span> time <span class="sc">+</span> id,<span class="at">data=</span><span class="fu">filter</span>(DIDIVPlacebo,time<span class="sc">!=</span><span class="st">&quot;A&quot;</span>),<span class="at">cluster=</span><span class="st">&quot;StateId&quot;</span>)</span>
<span id="cb385-7"><a href="placebo.html#cb385-7" tabindex="-1"></a>PlaceboDIDCoef <span class="ot">&lt;-</span> <span class="fu">coef</span>(regDIDPlacebo)[[<span class="dv">1</span>]]</span>
<span id="cb385-8"><a href="placebo.html#cb385-8" tabindex="-1"></a>PlaceboDIDSe <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(regDIDPlacebo))[[<span class="dv">1</span>]])</span></code></pre></div>
<p>When testing the Parallel Trends Assumption on the instrumental variable <span class="math inline">\(Z_{i}\)</span>, we find a placebo Intention to Treat Effect of 0.01 <span class="math inline">\(\pm\)</span> 0.02.
When using the treatment indicator directly, instead, the placebo test of DID yields a placebo Treatment Effect on the Treated of -0.02 <span class="math inline">\(\pm\)</span> 0.04.</p>
</div>
<div id="testing-for-parallel-trends-in-did-with-multiple-periods-of-pre-treatment-data" class="section level4 hasAnchor" number="8.2.3.3">
<h4><span class="header-section-number">8.2.3.3</span> Testing for parallel trends in DID with multiple periods of pre-treatment data<a href="placebo.html#testing-for-parallel-trends-in-did-with-multiple-periods-of-pre-treatment-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When we have access to several years of pre-treatment data, we can theoretically conduct several placebo tests: one for each additional pre-treatment year on top of the reference year.
In staggered designs, this is compounded by the fact that we can conduct one such placebo test per cohort.
The usual practice, in traditional non-staggered DID designs with multiple periods, is to consider that the placebo test is valid when none of the pre-treatment placebo tests is statistically significantly different from zero at usual levels of significance.
There might be some visual tolerance if one of the effects is slightly significant.
With staggered designs, there is no established practice yet, but it seems that people look at the placebo estimates aggregated over all cohorts in order to judge the quality of the test.
A more severe test would look at each of the individual cohort estimates and have them to be non zero.</p>
<div class="example">
<p><span id="exm:unnamed-chunk-382" class="example"><strong>Example 8.7  </strong></span>Letâs see how this works in practice, with the example of staggered designs.
In order to see what happens letâs first generate some data:</p>
</div>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="placebo.html#cb386-1" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,</span>
<span id="cb386-2"><a href="placebo.html#cb386-2" tabindex="-1"></a>           <span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,</span>
<span id="cb386-3"><a href="placebo.html#cb386-3" tabindex="-1"></a>           <span class="fl">0.05</span>,<span class="fl">0.05</span>,</span>
<span id="cb386-4"><a href="placebo.html#cb386-4" tabindex="-1"></a>           <span class="dv">0</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span>,</span>
<span id="cb386-5"><a href="placebo.html#cb386-5" tabindex="-1"></a>           <span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.15</span>,<span class="fl">0.2</span>,</span>
<span id="cb386-6"><a href="placebo.html#cb386-6" tabindex="-1"></a>           <span class="fl">0.25</span>,<span class="fl">0.1</span>,<span class="fl">0.05</span>,<span class="dv">0</span>,</span>
<span id="cb386-7"><a href="placebo.html#cb386-7" tabindex="-1"></a>           <span class="fl">1.5</span>,<span class="fl">1.25</span>,<span class="dv">1</span>,<span class="fl">0.75</span>,</span>
<span id="cb386-8"><a href="placebo.html#cb386-8" tabindex="-1"></a>           <span class="fl">0.5</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="fl">0.5</span>,<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb386-9"><a href="placebo.html#cb386-9" tabindex="-1"></a>           <span class="fl">0.1</span>,<span class="fl">0.28</span>,<span class="dv">0</span>)</span>
<span id="cb386-10"><a href="placebo.html#cb386-10" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,</span>
<span id="cb386-11"><a href="placebo.html#cb386-11" tabindex="-1"></a>                  <span class="st">&quot;theta1&quot;</span>,<span class="st">&quot;theta2&quot;</span>,<span class="st">&quot;theta3&quot;</span>,<span class="st">&quot;theta4&quot;</span>,</span>
<span id="cb386-12"><a href="placebo.html#cb386-12" tabindex="-1"></a>                  <span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,</span>
<span id="cb386-13"><a href="placebo.html#cb386-13" tabindex="-1"></a>                  <span class="st">&quot;delta1&quot;</span>,<span class="st">&quot;delta2&quot;</span>,<span class="st">&quot;delta3&quot;</span>,<span class="st">&quot;delta4&quot;</span>,</span>
<span id="cb386-14"><a href="placebo.html#cb386-14" tabindex="-1"></a>                  <span class="st">&quot;baralpha1&quot;</span>,<span class="st">&quot;baralpha2&quot;</span>,<span class="st">&quot;baralpha3&quot;</span>,<span class="st">&quot;baralpha4&quot;</span>,</span>
<span id="cb386-15"><a href="placebo.html#cb386-15" tabindex="-1"></a>                  <span class="st">&quot;barchi1&quot;</span>,<span class="st">&quot;barchi2&quot;</span>,<span class="st">&quot;barchi3&quot;</span>,<span class="st">&quot;barchi4&quot;</span>,</span>
<span id="cb386-16"><a href="placebo.html#cb386-16" tabindex="-1"></a>                  <span class="st">&quot;kappa1&quot;</span>,<span class="st">&quot;kappa2&quot;</span>,<span class="st">&quot;kappa3&quot;</span>,<span class="st">&quot;kappa4&quot;</span>,</span>
<span id="cb386-17"><a href="placebo.html#cb386-17" tabindex="-1"></a>                  <span class="st">&quot;xi1&quot;</span>,<span class="st">&quot;xi2&quot;</span>,<span class="st">&quot;xi3&quot;</span>,<span class="st">&quot;xi4&quot;</span>,</span>
<span id="cb386-18"><a href="placebo.html#cb386-18" tabindex="-1"></a>                  <span class="st">&quot;gamma&quot;</span>,<span class="st">&quot;sigma2omega&quot;</span>,<span class="st">&quot;rhoetaomega&quot;</span>)</span></code></pre></div>
<p>Let us now generate the corresponding data (in long format):</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="placebo.html#cb387-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb387-2"><a href="placebo.html#cb387-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb387-3"><a href="placebo.html#cb387-3" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb387-4"><a href="placebo.html#cb387-4" tabindex="-1"></a>cov.eta.omega <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(param[<span class="st">&quot;sigma2eta&quot;</span>],param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;sigma2omega&quot;</span>]),<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb387-5"><a href="placebo.html#cb387-5" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">mvrnorm</span>(N<span class="sc">*</span>T,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),cov.eta.omega))</span>
<span id="cb387-6"><a href="placebo.html#cb387-6" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;eta&#39;</span>,<span class="st">&#39;omega&#39;</span>)</span>
<span id="cb387-7"><a href="placebo.html#cb387-7" tabindex="-1"></a><span class="co"># time and individual identifiers</span></span>
<span id="cb387-8"><a href="placebo.html#cb387-8" tabindex="-1"></a>data<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,N),<span class="fu">rep</span>(<span class="dv">2</span>,N),<span class="fu">rep</span>(<span class="dv">3</span>,N),<span class="fu">rep</span>(<span class="dv">4</span>,N))</span>
<span id="cb387-9"><a href="placebo.html#cb387-9" tabindex="-1"></a>data<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">rep</span>((<span class="dv">1</span><span class="sc">:</span>N),T)</span>
<span id="cb387-10"><a href="placebo.html#cb387-10" tabindex="-1"></a><span class="co"># unit fixed effects</span></span>
<span id="cb387-11"><a href="placebo.html#cb387-11" tabindex="-1"></a>data<span class="sc">$</span>mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>])),T)</span>
<span id="cb387-12"><a href="placebo.html#cb387-12" tabindex="-1"></a><span class="co"># time fixed effects</span></span>
<span id="cb387-13"><a href="placebo.html#cb387-13" tabindex="-1"></a>data<span class="sc">$</span>delta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(param[<span class="st">&quot;delta1&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;delta2&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;delta3&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;delta4&quot;</span>],N))</span>
<span id="cb387-14"><a href="placebo.html#cb387-14" tabindex="-1"></a>data<span class="sc">$</span>baralphat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(param[<span class="st">&quot;baralpha1&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;baralpha2&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;baralpha3&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;baralpha4&quot;</span>],N))</span>
<span id="cb387-15"><a href="placebo.html#cb387-15" tabindex="-1"></a></span>
<span id="cb387-16"><a href="placebo.html#cb387-16" tabindex="-1"></a><span class="co"># building autocorrelated error terms</span></span>
<span id="cb387-17"><a href="placebo.html#cb387-17" tabindex="-1"></a>data<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">*</span>T,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb387-18"><a href="placebo.html#cb387-18" tabindex="-1"></a>data<span class="sc">$</span>U[<span class="dv">1</span><span class="sc">:</span>N] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb387-19"><a href="placebo.html#cb387-19" tabindex="-1"></a>data<span class="sc">$</span>U[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)] <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>data<span class="sc">$</span>U[<span class="dv">1</span><span class="sc">:</span>N] <span class="sc">+</span> data<span class="sc">$</span>epsilon[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)]</span>
<span id="cb387-20"><a href="placebo.html#cb387-20" tabindex="-1"></a>data<span class="sc">$</span>U[(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N)] <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>data<span class="sc">$</span>U[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)] <span class="sc">+</span> data<span class="sc">$</span>epsilon[(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N)]</span>
<span id="cb387-21"><a href="placebo.html#cb387-21" tabindex="-1"></a>data<span class="sc">$</span>U[(<span class="dv">3</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(T<span class="sc">*</span>N)] <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>data<span class="sc">$</span>U[(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N)] <span class="sc">+</span> data<span class="sc">$</span>epsilon[(<span class="dv">3</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(T<span class="sc">*</span>N)]</span>
<span id="cb387-22"><a href="placebo.html#cb387-22" tabindex="-1"></a><span class="co"># potential outcomes in the absence of the treatment</span></span>
<span id="cb387-23"><a href="placebo.html#cb387-23" tabindex="-1"></a>data<span class="sc">$</span>y0 <span class="ot">&lt;-</span> data<span class="sc">$</span>mu <span class="sc">+</span> data<span class="sc">$</span>delta <span class="sc">+</span> data<span class="sc">$</span>U </span>
<span id="cb387-24"><a href="placebo.html#cb387-24" tabindex="-1"></a>data<span class="sc">$</span>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(data<span class="sc">$</span>y0)</span>
<span id="cb387-25"><a href="placebo.html#cb387-25" tabindex="-1"></a><span class="co"># treatment timing</span></span>
<span id="cb387-26"><a href="placebo.html#cb387-26" tabindex="-1"></a><span class="co"># error term</span></span>
<span id="cb387-27"><a href="placebo.html#cb387-27" tabindex="-1"></a>data<span class="sc">$</span>V <span class="ot">&lt;-</span> param[<span class="st">&quot;gamma&quot;</span>]<span class="sc">*</span>(data<span class="sc">$</span>mu<span class="sc">-</span>param[<span class="st">&quot;barmu&quot;</span>])<span class="sc">+</span>data<span class="sc">$</span>omega</span>
<span id="cb387-28"><a href="placebo.html#cb387-28" tabindex="-1"></a><span class="co"># treatment group, with 99 for the never treated instead of infinity</span></span>
<span id="cb387-29"><a href="placebo.html#cb387-29" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">if_else</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">+</span>param[<span class="st">&quot;xi1&quot;</span>]<span class="sc">+</span>data<span class="sc">$</span>V[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,</span>
<span id="cb387-30"><a href="placebo.html#cb387-30" tabindex="-1"></a>              <span class="fu">if_else</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">+</span>param[<span class="st">&quot;xi2&quot;</span>]<span class="sc">+</span>data<span class="sc">$</span>V[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">2</span>,</span>
<span id="cb387-31"><a href="placebo.html#cb387-31" tabindex="-1"></a>                      <span class="fu">if_else</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">+</span>param[<span class="st">&quot;xi3&quot;</span>]<span class="sc">+</span>data<span class="sc">$</span>V[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">3</span>,</span>
<span id="cb387-32"><a href="placebo.html#cb387-32" tabindex="-1"></a>                              <span class="fu">if_else</span>(data<span class="sc">$</span>y0[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">+</span>param[<span class="st">&quot;xi4&quot;</span>]<span class="sc">+</span>data<span class="sc">$</span>V[<span class="dv">1</span><span class="sc">:</span>N]<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">4</span>,<span class="dv">99</span>))))</span>
<span id="cb387-33"><a href="placebo.html#cb387-33" tabindex="-1"></a>data<span class="sc">$</span>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(Ds,T)</span>
<span id="cb387-34"><a href="placebo.html#cb387-34" tabindex="-1"></a><span class="co"># Treatment status</span></span>
<span id="cb387-35"><a href="placebo.html#cb387-35" tabindex="-1"></a>data<span class="sc">$</span>D <span class="ot">&lt;-</span> <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">&gt;</span>data<span class="sc">$</span>time,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb387-36"><a href="placebo.html#cb387-36" tabindex="-1"></a><span class="co"># potential outcomes with the treatment</span></span>
<span id="cb387-37"><a href="placebo.html#cb387-37" tabindex="-1"></a><span class="co"># effect of the treatment by group</span></span>
<span id="cb387-38"><a href="placebo.html#cb387-38" tabindex="-1"></a>data<span class="sc">$</span>baralphatd <span class="ot">&lt;-</span> <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">1</span>,param[<span class="st">&quot;barchi1&quot;</span>],</span>
<span id="cb387-39"><a href="placebo.html#cb387-39" tabindex="-1"></a>                           <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">2</span>,param[<span class="st">&quot;barchi2&quot;</span>],</span>
<span id="cb387-40"><a href="placebo.html#cb387-40" tabindex="-1"></a>                                   <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">3</span>,param[<span class="st">&quot;barchi3&quot;</span>],</span>
<span id="cb387-41"><a href="placebo.html#cb387-41" tabindex="-1"></a>                                           <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">4</span>,param[<span class="st">&quot;barchi4&quot;</span>],<span class="dv">0</span>))))<span class="sc">+</span></span>
<span id="cb387-42"><a href="placebo.html#cb387-42" tabindex="-1"></a>                  <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">1</span>,param[<span class="st">&quot;kappa1&quot;</span>],</span>
<span id="cb387-43"><a href="placebo.html#cb387-43" tabindex="-1"></a>                           <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">2</span>,param[<span class="st">&quot;kappa2&quot;</span>],</span>
<span id="cb387-44"><a href="placebo.html#cb387-44" tabindex="-1"></a>                                   <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">3</span>,param[<span class="st">&quot;kappa3&quot;</span>],</span>
<span id="cb387-45"><a href="placebo.html#cb387-45" tabindex="-1"></a>                                           <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">4</span>,param[<span class="st">&quot;kappa4&quot;</span>],<span class="dv">0</span>))))<span class="sc">*</span>(data<span class="sc">$</span>t<span class="sc">-</span>data<span class="sc">$</span>Ds)<span class="sc">*</span><span class="fu">if_else</span>(data<span class="sc">$</span>time<span class="sc">&gt;=</span>data<span class="sc">$</span>Ds,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb387-46"><a href="placebo.html#cb387-46" tabindex="-1"></a>data<span class="sc">$</span>y1 <span class="ot">&lt;-</span> data<span class="sc">$</span>y0 <span class="sc">+</span> data<span class="sc">$</span>baralphat <span class="sc">+</span> data<span class="sc">$</span>baralphatd <span class="sc">+</span> <span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">1</span>,param[<span class="st">&quot;theta1&quot;</span>],<span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">2</span>,param[<span class="st">&quot;theta2&quot;</span>],<span class="fu">if_else</span>(data<span class="sc">$</span>Ds<span class="sc">==</span><span class="dv">3</span>,param[<span class="st">&quot;theta3&quot;</span>],param[<span class="st">&quot;theta4&quot;</span>])))<span class="sc">*</span>data<span class="sc">$</span>mu <span class="sc">+</span> data<span class="sc">$</span>eta</span>
<span id="cb387-47"><a href="placebo.html#cb387-47" tabindex="-1"></a>data<span class="sc">$</span>Y1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(data<span class="sc">$</span>y1)</span>
<span id="cb387-48"><a href="placebo.html#cb387-48" tabindex="-1"></a>data<span class="sc">$</span>y <span class="ot">&lt;-</span> data<span class="sc">$</span>y1<span class="sc">*</span>data<span class="sc">$</span>D<span class="sc">+</span>data<span class="sc">$</span>y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>data<span class="sc">$</span>D)</span>
<span id="cb387-49"><a href="placebo.html#cb387-49" tabindex="-1"></a>data<span class="sc">$</span>Y <span class="ot">&lt;-</span> data<span class="sc">$</span>Y1<span class="sc">*</span>data<span class="sc">$</span>D<span class="sc">+</span>data<span class="sc">$</span>Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>data<span class="sc">$</span>D)</span></code></pre></div>
<p>Letâs now estimate Sun and Abrahamâs model:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="placebo.html#cb388-1" tabindex="-1"></a><span class="co"># regression</span></span>
<span id="cb388-2"><a href="placebo.html#cb388-2" tabindex="-1"></a>reg.fixest.SA.Agg <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> <span class="fu">sunab</span>(Ds,time)<span class="sc">|</span> id <span class="sc">+</span> time, <span class="at">data=</span><span class="fu">filter</span>(data,Ds<span class="sc">&gt;</span><span class="dv">1</span>),<span class="at">cluster=</span><span class="st">&#39;id&#39;</span>)</span>
<span id="cb388-3"><a href="placebo.html#cb388-3" tabindex="-1"></a></span>
<span id="cb388-4"><a href="placebo.html#cb388-4" tabindex="-1"></a><span class="co"># Disaggregate estimates</span></span>
<span id="cb388-5"><a href="placebo.html#cb388-5" tabindex="-1"></a>disaggregate.SA <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(reg.fixest.SA.Agg,<span class="at">agg=</span><span class="cn">FALSE</span>),<span class="fu">se</span>(reg.fixest.SA.Agg,<span class="at">agg=</span><span class="cn">FALSE</span>)))</span>
<span id="cb388-6"><a href="placebo.html#cb388-6" tabindex="-1"></a><span class="fu">colnames</span>(disaggregate.SA) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Coef&#39;</span>,<span class="st">&#39;Se&#39;</span>)</span>
<span id="cb388-7"><a href="placebo.html#cb388-7" tabindex="-1"></a><span class="co"># adding treatment groups and time to treatment</span></span>
<span id="cb388-8"><a href="placebo.html#cb388-8" tabindex="-1"></a>disaggregate.SA <span class="ot">&lt;-</span> disaggregate.SA <span class="sc">%&gt;%</span></span>
<span id="cb388-9"><a href="placebo.html#cb388-9" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">test =</span>  <span class="fu">names</span>(<span class="fu">coef</span>(reg.fixest.SA.Agg,<span class="at">agg=</span><span class="cn">FALSE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb388-10"><a href="placebo.html#cb388-10" tabindex="-1"></a>                    <span class="fu">mutate</span>(</span>
<span id="cb388-11"><a href="placebo.html#cb388-11" tabindex="-1"></a>                      <span class="at">Group =</span> <span class="fu">factor</span>(<span class="fu">str_sub</span>(test,<span class="sc">-</span><span class="dv">1</span>),<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;1&#39;</span>,<span class="st">&#39;2&#39;</span>,<span class="st">&#39;3&#39;</span>,<span class="st">&#39;4&#39;</span>,<span class="st">&#39;Aggregate&#39;</span>)),</span>
<span id="cb388-12"><a href="placebo.html#cb388-12" tabindex="-1"></a>                      <span class="at">TimeToTreatment =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(<span class="fu">str_detect</span>(test,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">-&quot;</span>),<span class="fu">str_extract</span>(test,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">-[[:digit:]]&quot;</span>),<span class="fu">str_extract</span>(test,<span class="st">&quot;[[:digit:]]&quot;</span>)),<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;-3&#39;</span>,<span class="st">&#39;-2&#39;</span>,<span class="st">&#39;-1&#39;</span>,<span class="st">&#39;0&#39;</span>,<span class="st">&#39;1&#39;</span>,<span class="st">&#39;2&#39;</span>))</span>
<span id="cb388-13"><a href="placebo.html#cb388-13" tabindex="-1"></a>                    ) <span class="sc">%&gt;%</span></span>
<span id="cb388-14"><a href="placebo.html#cb388-14" tabindex="-1"></a>                  <span class="fu">select</span>(<span class="sc">-</span>test)</span>
<span id="cb388-15"><a href="placebo.html#cb388-15" tabindex="-1"></a></span>
<span id="cb388-16"><a href="placebo.html#cb388-16" tabindex="-1"></a><span class="co"># adding reference period</span></span>
<span id="cb388-17"><a href="placebo.html#cb388-17" tabindex="-1"></a>Group <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;2&#39;</span>,<span class="st">&#39;3&#39;</span>,<span class="st">&#39;4&#39;</span>)</span>
<span id="cb388-18"><a href="placebo.html#cb388-18" tabindex="-1"></a>TimeToTreatment <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&#39;-1&#39;</span>,<span class="dv">3</span>)</span>
<span id="cb388-19"><a href="placebo.html#cb388-19" tabindex="-1"></a>ref.dis <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Group,TimeToTreatment)) <span class="sc">%&gt;%</span></span>
<span id="cb388-20"><a href="placebo.html#cb388-20" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb388-21"><a href="placebo.html#cb388-21" tabindex="-1"></a>          <span class="at">Coef =</span> <span class="dv">0</span>,</span>
<span id="cb388-22"><a href="placebo.html#cb388-22" tabindex="-1"></a>          <span class="at">Se =</span> <span class="dv">0</span>,</span>
<span id="cb388-23"><a href="placebo.html#cb388-23" tabindex="-1"></a>          <span class="at">Group =</span> <span class="fu">factor</span>(Group,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;1&#39;</span>,<span class="st">&#39;2&#39;</span>,<span class="st">&#39;3&#39;</span>,<span class="st">&#39;4&#39;</span>,<span class="st">&#39;Aggregate&#39;</span>)),</span>
<span id="cb388-24"><a href="placebo.html#cb388-24" tabindex="-1"></a>          <span class="at">TimeToTreatment =</span> <span class="fu">factor</span>(TimeToTreatment,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;-3&#39;</span>,<span class="st">&#39;-2&#39;</span>,<span class="st">&#39;-1&#39;</span>,<span class="st">&#39;0&#39;</span>,<span class="st">&#39;1&#39;</span>,<span class="st">&#39;2&#39;</span>))</span>
<span id="cb388-25"><a href="placebo.html#cb388-25" tabindex="-1"></a>          )</span>
<span id="cb388-26"><a href="placebo.html#cb388-26" tabindex="-1"></a>disaggregate.SA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(disaggregate.SA,ref.dis) </span>
<span id="cb388-27"><a href="placebo.html#cb388-27" tabindex="-1"></a></span>
<span id="cb388-28"><a href="placebo.html#cb388-28" tabindex="-1"></a><span class="co"># adding aggregate results</span></span>
<span id="cb388-29"><a href="placebo.html#cb388-29" tabindex="-1"></a><span class="co"># aggregate estimates</span></span>
<span id="cb388-30"><a href="placebo.html#cb388-30" tabindex="-1"></a>aggregate.SA <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="fu">coef</span>(reg.fixest.SA.Agg),<span class="fu">se</span>(reg.fixest.SA.Agg)))</span>
<span id="cb388-31"><a href="placebo.html#cb388-31" tabindex="-1"></a><span class="fu">colnames</span>(aggregate.SA) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Coef&#39;</span>,<span class="st">&#39;Se&#39;</span>)</span>
<span id="cb388-32"><a href="placebo.html#cb388-32" tabindex="-1"></a><span class="co"># adding treatment groups and time to treatment</span></span>
<span id="cb388-33"><a href="placebo.html#cb388-33" tabindex="-1"></a>aggregate.SA <span class="ot">&lt;-</span> aggregate.SA <span class="sc">%&gt;%</span></span>
<span id="cb388-34"><a href="placebo.html#cb388-34" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">test =</span>  <span class="fu">names</span>(<span class="fu">coef</span>(reg.fixest.SA.Agg))) <span class="sc">%&gt;%</span></span>
<span id="cb388-35"><a href="placebo.html#cb388-35" tabindex="-1"></a>                    <span class="fu">mutate</span>(</span>
<span id="cb388-36"><a href="placebo.html#cb388-36" tabindex="-1"></a>                      <span class="at">Group =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="st">&quot;Aggregate&quot;</span>,<span class="dv">5</span>),<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;1&#39;</span>,<span class="st">&#39;2&#39;</span>,<span class="st">&#39;3&#39;</span>,<span class="st">&#39;4&#39;</span>,<span class="st">&#39;Aggregate&#39;</span>)),</span>
<span id="cb388-37"><a href="placebo.html#cb388-37" tabindex="-1"></a>                      <span class="at">TimeToTreatment =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(<span class="fu">str_detect</span>(test,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">-&quot;</span>),<span class="fu">str_extract</span>(test,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">-[[:digit:]]&quot;</span>),<span class="fu">str_extract</span>(test,<span class="st">&quot;[[:digit:]]&quot;</span>)),<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;-3&#39;</span>,<span class="st">&#39;-2&#39;</span>,<span class="st">&#39;-1&#39;</span>,<span class="st">&#39;0&#39;</span>,<span class="st">&#39;1&#39;</span>,<span class="st">&#39;2&#39;</span>))</span>
<span id="cb388-38"><a href="placebo.html#cb388-38" tabindex="-1"></a>                    ) <span class="sc">%&gt;%</span></span>
<span id="cb388-39"><a href="placebo.html#cb388-39" tabindex="-1"></a>                  <span class="fu">select</span>(<span class="sc">-</span>test)</span>
<span id="cb388-40"><a href="placebo.html#cb388-40" tabindex="-1"></a></span>
<span id="cb388-41"><a href="placebo.html#cb388-41" tabindex="-1"></a><span class="co"># adding reference period</span></span>
<span id="cb388-42"><a href="placebo.html#cb388-42" tabindex="-1"></a>Group <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Aggregate&quot;</span>)</span>
<span id="cb388-43"><a href="placebo.html#cb388-43" tabindex="-1"></a>TimeToTreatment <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&#39;-1&#39;</span>,<span class="dv">1</span>)</span>
<span id="cb388-44"><a href="placebo.html#cb388-44" tabindex="-1"></a>ref <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Group,TimeToTreatment)) <span class="sc">%&gt;%</span></span>
<span id="cb388-45"><a href="placebo.html#cb388-45" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb388-46"><a href="placebo.html#cb388-46" tabindex="-1"></a>          <span class="at">Coef =</span> <span class="dv">0</span>,</span>
<span id="cb388-47"><a href="placebo.html#cb388-47" tabindex="-1"></a>          <span class="at">Se =</span> <span class="dv">0</span>,</span>
<span id="cb388-48"><a href="placebo.html#cb388-48" tabindex="-1"></a>          <span class="at">Group =</span> <span class="fu">factor</span>(Group,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;1&#39;</span>,<span class="st">&#39;2&#39;</span>,<span class="st">&#39;3&#39;</span>,<span class="st">&#39;4&#39;</span>,<span class="st">&#39;Aggregate&#39;</span>)),</span>
<span id="cb388-49"><a href="placebo.html#cb388-49" tabindex="-1"></a>          <span class="at">TimeToTreatment =</span> <span class="fu">factor</span>(TimeToTreatment,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;-3&#39;</span>,<span class="st">&#39;-2&#39;</span>,<span class="st">&#39;-1&#39;</span>,<span class="st">&#39;0&#39;</span>,<span class="st">&#39;1&#39;</span>,<span class="st">&#39;2&#39;</span>))</span>
<span id="cb388-50"><a href="placebo.html#cb388-50" tabindex="-1"></a>          )</span>
<span id="cb388-51"><a href="placebo.html#cb388-51" tabindex="-1"></a>disaggregate.SA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(disaggregate.SA,aggregate.SA,ref) <span class="sc">%&gt;%</span></span>
<span id="cb388-52"><a href="placebo.html#cb388-52" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">TimeToTreatment =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(TimeToTreatment)))</span></code></pre></div>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="placebo.html#cb389-1" tabindex="-1"></a><span class="fu">ggplot</span>(disaggregate.SA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TimeToTreatment<span class="sc">&lt;</span><span class="dv">0</span>),<span class="fu">aes</span>(<span class="at">x=</span>TimeToTreatment,<span class="at">y=</span>Coef,<span class="at">colour=</span>Group,<span class="at">linetype=</span>Group))<span class="sc">+</span></span>
<span id="cb389-2"><a href="placebo.html#cb389-2" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb389-3"><a href="placebo.html#cb389-3" tabindex="-1"></a>    <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>Coef<span class="fl">-1.96</span><span class="sc">*</span>Se,<span class="at">ymax=</span>Coef<span class="fl">+1.96</span><span class="sc">*</span>Se),<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb389-4"><a href="placebo.html#cb389-4" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;DID estimate&quot;</span>) <span class="sc">+</span></span>
<span id="cb389-5"><a href="placebo.html#cb389-5" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Time relative to treatment&quot;</span>) <span class="sc">+</span></span>
<span id="cb389-6"><a href="placebo.html#cb389-6" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb389-7"><a href="placebo.html#cb389-7" tabindex="-1"></a>    <span class="fu">expand_limits</span>(<span class="at">y=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb389-8"><a href="placebo.html#cb389-8" tabindex="-1"></a>    <span class="fu">scale_colour_discrete</span>(<span class="at">name=</span><span class="st">&quot;Treatment</span><span class="sc">\n</span><span class="st">group&quot;</span>)<span class="sc">+</span></span>
<span id="cb389-9"><a href="placebo.html#cb389-9" tabindex="-1"></a>    <span class="fu">scale_linetype_discrete</span>(<span class="at">name=</span><span class="st">&quot;Treatment</span><span class="sc">\n</span><span class="st">group&quot;</span>)<span class="sc">+</span></span>
<span id="cb389-10"><a href="placebo.html#cb389-10" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PlotDIDStaggeredDisAggPlacebo"></span>
<img src="STCI_files/figure-html/PlotDIDStaggeredDisAggPlacebo-1.png" alt="Placebo tests for DID estimated using Sun and Abraham procedure (reference period $\tau'=1$)" width="65%" />
<p class="caption">
Figure 8.6: Placebo tests for DID estimated using Sun and Abraham procedure (reference period <span class="math inline">\(\tau&#39;=1\)</span>)
</p>
</div>
<p>As we can see on Figure <a href="placebo.html#fig:PlotDIDStaggeredDisAggPlacebo">8.6</a>, the placebo test for the group that enters the treatment at period 4 is significantly different from zero (it is equal to -0.09 <span class="math inline">\(\pm\)</span> 0.06).
In this case, we would reject the parallel trends assumption, and we would be correct.
There are non parallel trends in our model because of regression to the mean.</p>
</div>
</div>
</div>
<div id="placebo-tests-for-observational-methods" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Placebo tests for observational methods<a href="placebo.html#placebo-tests-for-observational-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It might seem strange to think of testing the validity of observational methods without additional data.
Indeed, observational methods work mostly by assuming that conditioning on everything that we observe pre-treatment is what is required to cancel selection bias.
How could we ever find variables that we would use for placebo tests, that we would not like to condition on in the first place?
One proposal has been made by <a href="https://doi.org/10.1257/jel.47.1.5">Imbens and Wooldridge (2009)</a>: measure the effect of the treatment on outcomes observed at <span class="math inline">\(t=k-1\)</span>, where <span class="math inline">\(k\)</span> is the actual treatment date, by conditioning on <span class="math inline">\(Y_{i,k-2}\)</span> and other pre-treatment covariates.
If the matching estimator is able to find a zero treatment effect, you would have a confirmation that your approach works.
What we are going to see here is that this approach is actually misguided: unless there is no selection bias at all (which we can easily check), it is going to reject cases where the matching estimator is perfectly valid.
Here, I am proposing to run the reverse test: estimate the effect on <span class="math inline">\(Y_{i,k-2}\)</span> conditioning on <span class="math inline">\(Y_{i,k-1}\)</span>.
This test will not reject when matching is correct, and will have the same rejection properties when matching is not correct.</p>
<p>Here is a quick theoretical argument of why <a href="https://doi.org/10.1257/jel.47.1.5">Imbens and Wooldridge (2009)</a>âs proposal is flawed and why my alternative proposal works.
The reasoning and model Iâm using are derived from my own research, namely <a href="https://doi.org/10.1016/j.jeconom.2014.09.013">Chabe-Ferret (2015)</a>.
To make things simpler, letâs assume that we have only selection on transitory shocks (there are no permanent fixed effects).
In that case, we have:</p>
<p><span class="math display">\[\begin{align*}
  Y^0_{i,t} &amp; = \rho Y^0_{i,t-1} + U_{i,t} \\
  D_{i,k} &amp; = \uns{Y^0_{i,k-1}+V_{i,k}\leq 0},
\end{align*}\]</span></p>
<p>with <span class="math inline">\(V_{i,k}\)</span> a shock independent of all the other shocks in the model.</p>
<p>In that model, we can show the following theorem:</p>
<div class="theorem">
<p><span id="thm:PlaceboMatching" class="theorem"><strong>Theorem 8.3  (Placebo tests for matching) </strong></span>In the simplified model where there is only selection on transitory shocks, Matching is unbiased, <a href="https://doi.org/10.1257/jel.47.1.5">Imbens and Wooldridge (2009)</a>âs test rejects the validity of matching and my proposed reversed test accepts the validity of matching:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^{Y_{k+\tau}}_{M}(Y_{k-1}) &amp;  = \Delta^{Y_{k+\tau}}_{TT} \\
  \Delta^{Y_{k-1}}_{M}(Y_{k-2}) &amp;  \neq 0 \\
  \Delta^{Y_{k-2}}_{M}(Y_{k-1}) &amp;  = 0,
\end{align*}\]</span></p>
<p>with <span class="math inline">\(\Delta^{Y_{k+\tau}}_{M}(Y_{k-\tau&#39;})=\esp{Y_{i,k+\tau}-\esp{Y_{i,k+\tau}|Y_{i,k-\tau&#39;},D_{i,k}=0}|D_{i,k}=1}\)</span> the matching estimator for the effect at period <span class="math inline">\(k+\tau\)</span> conditioning on <span class="math inline">\(Y_{i,k-\tau&#39;}\)</span>.</p>
</div>
<div class="proof">
<p><span id="unlabeled-div-224" class="proof"><em>Proof</em>. </span>Because <span class="math inline">\(V_{i,k}\)</span> is independent from all the other shocks in the model, conditioning on <span class="math inline">\(Y_{i,k-1}\)</span> is sufficient to get rid of selection bias:</p>
<p><span class="math display">\[\begin{align*}
  \esp{Y^0_{i,k+\tau}|D_{i,k}=1,Y_{i,k-1}} &amp; = \esp{Y^0_{i,k+\tau}|Y_{i,k-1}} \\
                                          &amp; = \esp{Y^0_{i,k+\tau}|D_{i,k}=0,Y_{i,k-1}}.
\end{align*}\]</span></p>
<p>This, together with the Law of Iterated Expectations, proves the first part of the theorem.
Now, letâs look at what <a href="https://doi.org/10.1257/jel.47.1.5">Imbens and Wooldridge (2009)</a>âs test does.
It computes the placebo treatment effect <span class="math inline">\(\Delta^{Y_{k-1}}_{M}(Y_{k-2})\)</span> as:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^{Y_{k-1}}_{M}(Y_{k-2}) &amp; = \esp{Y^0_{i,k-1}|D_{i,k}=1,Y_{i,k-2}} -\esp{Y^0_{i,k-1}|D_{i,k}=0,Y_{i,k-2}}\\
                                          &amp; = \esp{\rho Y^0_{i,k-2} + U_{i,k-1}|D_{i,k}=1,Y_{i,k-2}} -\esp{\rho Y^0_{i,k-2} + U_{i,k-1}|D_{i,k}=0,Y_{i,k-2}}\\
                                          &amp; = \esp{U_{i,k-1}|D_{i,k}=1,Y_{i,k-2}} -\esp{U_{i,k-1}|D_{i,k}=0,Y_{i,k-2}}\\
                                          &amp; = \esp{U_{i,k-1}|D_{i,k}=1} -\esp{U_{i,k-1}|D_{i,k}=0}\\
                                          &amp; = \esp{U_{i,k-1}|Y^0_{i,k-1}+V_{i,k}\leq 0} -\esp{U_{i,k-1}|Y^0_{i,k-1}+V_{i,k}&gt; 0}\\
                                          &amp; = \esp{U_{i,k-1}|U_{i,k-1}+\rho Y^0_{i,k-2}+V_{i,k}\leq 0} -\esp{U_{i,k-1}|U_{i,k-1}+\rho Y^0_{i,k-2}+V_{i,k}&gt; 0}\\
                                          &amp; \neq 0,
\end{align*}\]</span></p>
<p>where the first equality is definitional, the second equality uses the model, the third equality uses the fact that <span class="math inline">\(Y^0_{i,k-2}=Y_{i,k-2}\)</span> and <span class="math inline">\(\esp{Y^0_{i,k-2}|D_{i,k},Y_{i,k-2}}=Y_{i,k-2}\)</span>, the fourth equality uses the fact that <span class="math inline">\(U_{i,k-1}\)</span> is independent from <span class="math inline">\(Y_{i,k-2}\)</span> and the fifth and sixth equalities use the model.
The result follows because, since <span class="math inline">\(Y^0_{i,k-2}\)</span> and <span class="math inline">\(V_{i,k}\)</span> are independent from <span class="math inline">\(U_{i,k-1}\)</span>, the final expectations of <span class="math inline">\(U_{i,k-1}\)</span> are conditional on a variable positively correlated with <span class="math inline">\(U_{i,k-1}\)</span> to be above or below a threshold, which cannot be equal to zero.
Indeed, since <span class="math inline">\(\esp{U_{i,k-1}}=0\)</span>, <span class="math inline">\(\esp{U_{i,k-1}|U_{i,k-1}+\rho Y^0_{i,k-2}+V_{i,k}\leq 0}&lt; 0\)</span> and <span class="math inline">\(\esp{U_{i,k-1}|U_{i,k-1}+\rho Y^0_{i,k-2}+V_{i,k}\leq 0}&gt; 0\)</span>, hence the result.</p>
<p>Letâs see how my proposed test works in that case:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^{Y_{k-2}}_{M}(Y_{k-1}) &amp; = \esp{Y^0_{i,k-2}|D_{i,k}=1,Y_{i,k-1}} -\esp{Y^0_{i,k-2}|D_{i,k}=0,Y_{i,k-1}}\\
                                 &amp; = \esp{Y^0_{i,k-2}|Y^0_{i,k-1}+V_{i,k}\leq 0,Y_{i,k-1}} -\esp{Y^0_{i,k-2}|Y^0_{i,k-1}+V_{i,k}&gt; 0,Y_{i,k-1}}\\
                                 &amp; = \esp{Y^0_{i,k-2}|Y_{i,k-1}} -\esp{Y^0_{i,k-2}|Y_{i,k-1}}\\
                                 &amp; = 0,
\end{align*}\]</span></p>
<p>where the first equality is definitional, the second equality uses the model and the third equality uses the fact that <span class="math inline">\(V_{i,k}\)</span> is independent from all the other variables in the model, and therefore independent from <span class="math inline">\(Y^0_{i,k-2}\)</span>, even after conditioning on <span class="math inline">\(Y^0_{i,k-1}\)</span> (this actually uses Lemma 4.2 in <a href="https://doi.org/10.1111/j.2517-6161.1979.tb01052.x">Dawid (1979)</a>).
This proves the result.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-225" class="remark"><em>Remark</em>. </span>Theorem 1 in <a href="https://drive.google.com/file/d/14yZqtkVCw6Xp_c3yESI-LRz-ho7hk2ig/view?usp=sharing">Chabe-Ferret (2017)</a> shows that the simple model we have written is the only one where matching is going to be consistent.
Coupled with Theorem <a href="placebo.html#thm:PlaceboMatching">8.3</a>, this means that <a href="https://doi.org/10.1257/jel.47.1.5">Imbens and Wooldridge (2009)</a>âs test will always reject in all the cases when matching is consistent.
My proposed test, on the contrary, will accept the validity of matching everytime it is consistent, and will reject when it is not.</p>
</div>
<div class="example">
<p><span id="exm:unnamed-chunk-385" class="example"><strong>Example 8.8  </strong></span>Letâs see how both of these tests work in our example.
For that, we need to generate data with at least three pre-treatment periods.
Let us first choose a simple model, with <span class="math inline">\(k\)</span> the date at which treatment starts:</p>
</div>
<p><span class="math display">\[\begin{align*}
y^0_{i,t} &amp; = \bar\mu + \delta_t+U^0_{i,t} \\
U^0_{i,t} &amp; = \rho U^0_{i,t-1}+\epsilon_{i,t} \\
D_{i,k}   &amp; = \uns{y^0_{i,k-1}+ \xi_k + V_i\leq\bar{y}} \\
V_i   &amp; = \sim\mathcal{N}(0,\sigma^2_{V}) \\
U^0_{i,1} &amp; \sim\mathcal{N}(0,\sigma^2_{U}) \\
\epsilon_{i,t} &amp; \sim\mathcal{N}(0,\sigma^2_{\epsilon}),
\end{align*}\]</span></p>
<p>Let us now choose some parameter values:</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="placebo.html#cb390-1" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">28</span>,<span class="fl">0.28</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,<span class="fl">0.05</span>,</span>
<span id="cb390-2"><a href="placebo.html#cb390-2" tabindex="-1"></a>           <span class="dv">0</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span>,</span>
<span id="cb390-3"><a href="placebo.html#cb390-3" tabindex="-1"></a>           <span class="fl">0.5</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="fl">0.5</span>,<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb390-4"><a href="placebo.html#cb390-4" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;sigma2V&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;sigma2epsilon&quot;</span>,</span>
<span id="cb390-5"><a href="placebo.html#cb390-5" tabindex="-1"></a>                  <span class="st">&quot;delta1&quot;</span>,<span class="st">&quot;delta2&quot;</span>,<span class="st">&quot;delta3&quot;</span>,<span class="st">&quot;delta4&quot;</span>,</span>
<span id="cb390-6"><a href="placebo.html#cb390-6" tabindex="-1"></a>                  <span class="st">&quot;xi1&quot;</span>,<span class="st">&quot;xi2&quot;</span>,<span class="st">&quot;xi3&quot;</span>,<span class="st">&quot;xi4&quot;</span>)</span></code></pre></div>
<p>Let us now generate some data, with <span class="math inline">\(k=4\)</span>:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="placebo.html#cb391-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb391-2"><a href="placebo.html#cb391-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb391-3"><a href="placebo.html#cb391-3" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb391-4"><a href="placebo.html#cb391-4" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,N),<span class="fu">rep</span>(<span class="dv">2</span>,N),<span class="fu">rep</span>(<span class="dv">3</span>,N),<span class="fu">rep</span>(<span class="dv">4</span>,N)),<span class="at">id=</span><span class="fu">rep</span>((<span class="dv">1</span><span class="sc">:</span>N),T))</span>
<span id="cb391-5"><a href="placebo.html#cb391-5" tabindex="-1"></a><span class="co"># time fixed effects</span></span>
<span id="cb391-6"><a href="placebo.html#cb391-6" tabindex="-1"></a>data<span class="sc">$</span>delta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(param[<span class="st">&quot;delta1&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;delta2&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;delta3&quot;</span>],N),<span class="fu">rep</span>(param[<span class="st">&quot;delta4&quot;</span>],N))</span>
<span id="cb391-7"><a href="placebo.html#cb391-7" tabindex="-1"></a></span>
<span id="cb391-8"><a href="placebo.html#cb391-8" tabindex="-1"></a><span class="co"># building autocorrelated error terms</span></span>
<span id="cb391-9"><a href="placebo.html#cb391-9" tabindex="-1"></a>data<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">*</span>T,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb391-10"><a href="placebo.html#cb391-10" tabindex="-1"></a>data<span class="sc">$</span>U[<span class="dv">1</span><span class="sc">:</span>N] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb391-11"><a href="placebo.html#cb391-11" tabindex="-1"></a>data<span class="sc">$</span>U[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)] <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>data<span class="sc">$</span>U[<span class="dv">1</span><span class="sc">:</span>N] <span class="sc">+</span> data<span class="sc">$</span>epsilon[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)]</span>
<span id="cb391-12"><a href="placebo.html#cb391-12" tabindex="-1"></a>data<span class="sc">$</span>U[(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N)] <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>data<span class="sc">$</span>U[(N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N)] <span class="sc">+</span> data<span class="sc">$</span>epsilon[(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N)]</span>
<span id="cb391-13"><a href="placebo.html#cb391-13" tabindex="-1"></a>data<span class="sc">$</span>U[(<span class="dv">3</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(T<span class="sc">*</span>N)] <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>data<span class="sc">$</span>U[(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N)] <span class="sc">+</span> data<span class="sc">$</span>epsilon[(<span class="dv">3</span><span class="sc">*</span>N<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(T<span class="sc">*</span>N)]</span>
<span id="cb391-14"><a href="placebo.html#cb391-14" tabindex="-1"></a><span class="co"># potential outcomes in the absence of the treatment</span></span>
<span id="cb391-15"><a href="placebo.html#cb391-15" tabindex="-1"></a>data<span class="sc">$</span>y0 <span class="ot">&lt;-</span> param[<span class="st">&quot;barmu&quot;</span>] <span class="sc">+</span> data<span class="sc">$</span>delta <span class="sc">+</span> data<span class="sc">$</span>U </span>
<span id="cb391-16"><a href="placebo.html#cb391-16" tabindex="-1"></a><span class="co"># treatment timing</span></span>
<span id="cb391-17"><a href="placebo.html#cb391-17" tabindex="-1"></a><span class="co"># error term</span></span>
<span id="cb391-18"><a href="placebo.html#cb391-18" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2V&quot;</span>]))</span>
<span id="cb391-19"><a href="placebo.html#cb391-19" tabindex="-1"></a><span class="co"># Let&#39;s focus only on the treatment given at period 4</span></span>
<span id="cb391-20"><a href="placebo.html#cb391-20" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">if_else</span>(data<span class="sc">$</span>y0[<span class="fu">which</span>(data<span class="sc">$</span>time<span class="sc">==</span><span class="dv">3</span>)]<span class="sc">+</span>param[<span class="st">&quot;xi4&quot;</span>]<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb391-21"><a href="placebo.html#cb391-21" tabindex="-1"></a>data<span class="sc">$</span>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(Ds,T)</span>
<span id="cb391-22"><a href="placebo.html#cb391-22" tabindex="-1"></a><span class="co"># let&#39;s put the data in wide format now</span></span>
<span id="cb391-23"><a href="placebo.html#cb391-23" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb391-24"><a href="placebo.html#cb391-24" tabindex="-1"></a>        <span class="fu">select</span>(id,time,y0,Ds) <span class="sc">%&gt;%</span></span>
<span id="cb391-25"><a href="placebo.html#cb391-25" tabindex="-1"></a>        <span class="fu">pivot_wider</span>(<span class="at">names_from=</span><span class="st">&quot;time&quot;</span>,<span class="at">values_from =</span> <span class="st">&quot;y0&quot;</span>,<span class="at">names_prefix =</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<p>Let us first check that matching is indeed consistent in this dataset.
We are going to use the <code>Matching</code> package for that.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="placebo.html#cb392-1" tabindex="-1"></a>NNM.Match.y4.y3 <span class="ot">&lt;-</span> <span class="fu">Match</span>(data<span class="sc">$</span>y4,data<span class="sc">$</span>Ds,data<span class="sc">$</span>y3,<span class="at">estimand=</span><span class="st">&#39;ATT&#39;</span>,<span class="at">M=</span><span class="dv">1</span>,<span class="at">replace=</span><span class="cn">TRUE</span>,<span class="at">CommonSupport =</span> <span class="cn">FALSE</span>,<span class="at">Weight=</span><span class="dv">1</span>,<span class="at">Var.calc=</span><span class="dv">1</span>,<span class="at">sample=</span><span class="cn">FALSE</span>)</span>
<span id="cb392-2"><a href="placebo.html#cb392-2" tabindex="-1"></a>ATT.y40.y3 <span class="ot">&lt;-</span> NNM.Match.y4.y3<span class="sc">$</span>est</span>
<span id="cb392-3"><a href="placebo.html#cb392-3" tabindex="-1"></a>ATT.y40.y3.se <span class="ot">&lt;-</span> NNM.Match.y4.y3<span class="sc">$</span>se</span></code></pre></div>
<p>We find that <span class="math inline">\(\hat\Delta^{y^0_{4}}_{M}(y_{3})=\)</span> -0.023 <span class="math inline">\(\pm\)</span> 0.04.
Let us now estimate <a href="https://doi.org/10.1257/jel.47.1.5">Imbens and Wooldridge (2009)</a>âs placebo test:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="placebo.html#cb393-1" tabindex="-1"></a>NNM.Match.y3.y2 <span class="ot">&lt;-</span> <span class="fu">Match</span>(data<span class="sc">$</span>y3,data<span class="sc">$</span>Ds,data<span class="sc">$</span>y2,<span class="at">estimand=</span><span class="st">&#39;ATT&#39;</span>,<span class="at">M=</span><span class="dv">1</span>,<span class="at">replace=</span><span class="cn">TRUE</span>,<span class="at">CommonSupport =</span> <span class="cn">FALSE</span>,<span class="at">Weight=</span><span class="dv">1</span>,<span class="at">Var.calc=</span><span class="dv">1</span>,<span class="at">sample=</span><span class="cn">FALSE</span>)</span>
<span id="cb393-2"><a href="placebo.html#cb393-2" tabindex="-1"></a>ATT.y30.y2 <span class="ot">&lt;-</span> NNM.Match.y3.y2<span class="sc">$</span>est</span>
<span id="cb393-3"><a href="placebo.html#cb393-3" tabindex="-1"></a>ATT.y30.y2.se <span class="ot">&lt;-</span> NNM.Match.y3.y2<span class="sc">$</span>se</span></code></pre></div>
<p>We find that <span class="math inline">\(\hat\Delta^{y^0_{3}}_{M}(y_{2})=\)</span> -0.157 <span class="math inline">\(\pm\)</span> 0.052.
Let us now estimate my proposed placebo test:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="placebo.html#cb394-1" tabindex="-1"></a>NNM.Match.y2.y3 <span class="ot">&lt;-</span> <span class="fu">Match</span>(data<span class="sc">$</span>y2,data<span class="sc">$</span>Ds,data<span class="sc">$</span>y3,<span class="at">estimand=</span><span class="st">&#39;ATT&#39;</span>,<span class="at">M=</span><span class="dv">1</span>,<span class="at">replace=</span><span class="cn">TRUE</span>,<span class="at">CommonSupport =</span> <span class="cn">FALSE</span>,<span class="at">Weight=</span><span class="dv">1</span>,<span class="at">Var.calc=</span><span class="dv">1</span>,<span class="at">sample=</span><span class="cn">FALSE</span>)</span>
<span id="cb394-2"><a href="placebo.html#cb394-2" tabindex="-1"></a>ATT.y20.y3 <span class="ot">&lt;-</span> NNM.Match.y2.y3<span class="sc">$</span>est</span>
<span id="cb394-3"><a href="placebo.html#cb394-3" tabindex="-1"></a>ATT.y20.y3.se <span class="ot">&lt;-</span> NNM.Match.y2.y3<span class="sc">$</span>se</span></code></pre></div>
<p>We find that <span class="math inline">\(\hat\Delta^{y^0_{2}}_{M}(y_{3})=\)</span> 0.006 <span class="math inline">\(\pm\)</span> 0.064.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Power.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cluster.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/chabefer/STCI/blob/master/07_Placebo.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["STCI.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 1
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
