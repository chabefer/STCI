<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Natural Experiments | Statistical Tools for Causal Inference</title>
  <meta name="description" content="This is an open source collaborative book." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Natural Experiments | Statistical Tools for Causal Inference" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is an open source collaborative book." />
  <meta name="github-repo" content="chabefer/STCI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Natural Experiments | Statistical Tools for Causal Inference" />
  
  <meta name="twitter:description" content="This is an open source collaborative book." />
  

<meta name="author" content="Sylvain Chabé-Ferret" />


<meta name="date" content="2021-10-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="RCT.html"/>
<link rel="next" href="sec:OM.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
$$
\newcommand{\uns}[1]{\mathbf{1}[#1]}
\newcommand{\esp}[1]{\mathbf{E}[#1]}
\newcommand{\Ind}{\perp\kern-5pt\perp}
\newcommand{\var}[1]{\mathbf{V}[ #1 ]}
\newcommand{\cov}[1]{\mathbf{C}[ #1 ]}
\newcommand{\plim}[1]{\text{plim}_{ #1 \rightarrow \infty}}
\newcommand{\plims}{\text{plim}}
\newcommand{\partder}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\partdersq}[2]{\frac{\partial^2 #1}{\partial #2^2}}
\DeclareMathOperator{\diag}{diag}
$$


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Tools for Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>I Fundamental Problems of Inference</b></span></li>
<li class="chapter" data-level="" data-path="introduction-the-two-fundamental-problems-of-inference.html"><a href="introduction-the-two-fundamental-problems-of-inference.html"><i class="fa fa-check"></i>Introduction: the Two Fundamental Problems of Inference</a></li>
<li class="chapter" data-level="1" data-path="FPCI.html"><a href="FPCI.html"><i class="fa fa-check"></i><b>1</b> Fundamental Problem of Causal Inference</a>
<ul>
<li class="chapter" data-level="1.1" data-path="FPCI.html"><a href="FPCI.html#rubin-causal-model"><i class="fa fa-check"></i><b>1.1</b> Rubin Causal Model</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="FPCI.html"><a href="FPCI.html#treatment-allocation-rule"><i class="fa fa-check"></i><b>1.1.1</b> Treatment allocation rule</a></li>
<li class="chapter" data-level="1.1.2" data-path="FPCI.html"><a href="FPCI.html#potential-outcomes"><i class="fa fa-check"></i><b>1.1.2</b> Potential outcomes</a></li>
<li class="chapter" data-level="1.1.3" data-path="FPCI.html"><a href="FPCI.html#switching-equation"><i class="fa fa-check"></i><b>1.1.3</b> Switching equation</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="FPCI.html"><a href="FPCI.html#treatment-effects"><i class="fa fa-check"></i><b>1.2</b> Treatment effects</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="FPCI.html"><a href="FPCI.html#individual-level-treatment-effects"><i class="fa fa-check"></i><b>1.2.1</b> Individual level treatment effects</a></li>
<li class="chapter" data-level="1.2.2" data-path="FPCI.html"><a href="FPCI.html#average-treatment-effect-on-the-treated"><i class="fa fa-check"></i><b>1.2.2</b> Average treatment effect on the treated</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="FPCI.html"><a href="FPCI.html#fundamental-problem-of-causal-inference"><i class="fa fa-check"></i><b>1.3</b> Fundamental problem of causal inference</a></li>
<li class="chapter" data-level="1.4" data-path="FPCI.html"><a href="FPCI.html#intuitive-estimators-confounding-factors-and-selection-bias"><i class="fa fa-check"></i><b>1.4</b> Intuitive estimators, confounding factors and selection bias</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="FPCI.html"><a href="FPCI.html#withwithout-comparison-selection-bias-and-cross-sectional-confounders"><i class="fa fa-check"></i><b>1.4.1</b> With/Without comparison, selection bias and cross-sectional confounders</a></li>
<li class="chapter" data-level="1.4.2" data-path="FPCI.html"><a href="FPCI.html#the-beforeafter-comparison-temporal-confounders-and-time-trend-bias"><i class="fa fa-check"></i><b>1.4.2</b> The before/after comparison, temporal confounders and time trend bias</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="FPSI.html"><a href="FPSI.html"><i class="fa fa-check"></i><b>2</b> Fundamental Problem of Statistical Inference</a>
<ul>
<li class="chapter" data-level="2.1" data-path="FPSI.html"><a href="FPSI.html#sec:sampnoise"><i class="fa fa-check"></i><b>2.1</b> What is sampling noise? Definition and illustration</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="FPSI.html"><a href="FPSI.html#sec:definitionnoise"><i class="fa fa-check"></i><b>2.1.1</b> Sampling noise, a definition</a></li>
<li class="chapter" data-level="2.1.2" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisepop"><i class="fa fa-check"></i><b>2.1.2</b> Sampling noise for the population treatment effect</a></li>
<li class="chapter" data-level="2.1.3" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisesamp"><i class="fa fa-check"></i><b>2.1.3</b> Sampling noise for the sample treatment effect</a></li>
<li class="chapter" data-level="2.1.4" data-path="FPSI.html"><a href="FPSI.html#sec:confinterv"><i class="fa fa-check"></i><b>2.1.4</b> Building confidence intervals from estimates of sampling noise</a></li>
<li class="chapter" data-level="2.1.5" data-path="FPSI.html"><a href="FPSI.html#reporting-sampling-noise-a-proposal"><i class="fa fa-check"></i><b>2.1.5</b> Reporting sampling noise: a proposal</a></li>
<li class="chapter" data-level="2.1.6" data-path="FPSI.html"><a href="FPSI.html#sec:effectsize"><i class="fa fa-check"></i><b>2.1.6</b> Using effect sizes to normalize the reporting of treatment effects and their precision</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="FPSI.html"><a href="FPSI.html#sec:estimsampnoise"><i class="fa fa-check"></i><b>2.2</b> Estimating sampling noise</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="FPSI.html"><a href="FPSI.html#sec:assumptions"><i class="fa fa-check"></i><b>2.2.1</b> Assumptions</a></li>
<li class="chapter" data-level="2.2.2" data-path="FPSI.html"><a href="FPSI.html#sec:cheb"><i class="fa fa-check"></i><b>2.2.2</b> Using Chebyshev’s inequality</a></li>
<li class="chapter" data-level="2.2.3" data-path="FPSI.html"><a href="FPSI.html#sec:CLT"><i class="fa fa-check"></i><b>2.2.3</b> Using the Central Limit Theorem</a></li>
<li class="chapter" data-level="2.2.4" data-path="FPSI.html"><a href="FPSI.html#sec:resamp"><i class="fa fa-check"></i><b>2.2.4</b> Using resampling methods</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Methods of Causal Inference</b></span></li>
<li class="chapter" data-level="3" data-path="RCT.html"><a href="RCT.html"><i class="fa fa-check"></i><b>3</b> Randomized Controlled Trials</a>
<ul>
<li class="chapter" data-level="3.1" data-path="RCT.html"><a href="RCT.html#sec:design1"><i class="fa fa-check"></i><b>3.1</b> Brute Force Design</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="RCT.html"><a href="RCT.html#identification"><i class="fa fa-check"></i><b>3.1.1</b> Identification</a></li>
<li class="chapter" data-level="3.1.2" data-path="RCT.html"><a href="RCT.html#estimating-ate"><i class="fa fa-check"></i><b>3.1.2</b> Estimating ATE</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="RCT.html"><a href="RCT.html#sec:design2"><i class="fa fa-check"></i><b>3.2</b> Self-Selection design</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="RCT.html"><a href="RCT.html#identification-1"><i class="fa fa-check"></i><b>3.2.1</b> Identification</a></li>
<li class="chapter" data-level="3.2.2" data-path="RCT.html"><a href="RCT.html#estimating-tt"><i class="fa fa-check"></i><b>3.2.2</b> Estimating TT</a></li>
<li class="chapter" data-level="3.2.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-1"><i class="fa fa-check"></i><b>3.2.3</b> Estimating Sampling Noise</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="RCT.html"><a href="RCT.html#sec:design3"><i class="fa fa-check"></i><b>3.3</b> Eligibility design</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="RCT.html"><a href="RCT.html#identification-2"><i class="fa fa-check"></i><b>3.3.1</b> Identification</a></li>
<li class="chapter" data-level="3.3.2" data-path="RCT.html"><a href="RCT.html#estimating-the-ite-and-the-tt"><i class="fa fa-check"></i><b>3.3.2</b> Estimating the ITE and the TT</a></li>
<li class="chapter" data-level="3.3.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-2"><i class="fa fa-check"></i><b>3.3.3</b> Estimating sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="RCT.html"><a href="RCT.html#sec:design4"><i class="fa fa-check"></i><b>3.4</b> Encouragement Design</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="RCT.html"><a href="RCT.html#identification-3"><i class="fa fa-check"></i><b>3.4.1</b> Identification</a></li>
<li class="chapter" data-level="3.4.2" data-path="RCT.html"><a href="RCT.html#estimating-the-local-average-treatment-effect-and-the-intention-to-treat-effect"><i class="fa fa-check"></i><b>3.4.2</b> Estimating the Local Average Treatment Effect and the Intention to Treat Effect</a></li>
<li class="chapter" data-level="3.4.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-3"><i class="fa fa-check"></i><b>3.4.3</b> Estimating sampling noise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="NE.html"><a href="NE.html"><i class="fa fa-check"></i><b>4</b> Natural Experiments</a>
<ul>
<li class="chapter" data-level="4.1" data-path="NE.html"><a href="NE.html#instrumental-variables"><i class="fa fa-check"></i><b>4.1</b> Instrumental Variables</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="NE.html"><a href="NE.html#an-example-where-monotonicity-does-not-hold"><i class="fa fa-check"></i><b>4.1.1</b> An example where Monotonicity does not hold</a></li>
<li class="chapter" data-level="4.1.2" data-path="NE.html"><a href="NE.html#identification-4"><i class="fa fa-check"></i><b>4.1.2</b> Identification</a></li>
<li class="chapter" data-level="4.1.3" data-path="NE.html"><a href="NE.html#estimation"><i class="fa fa-check"></i><b>4.1.3</b> Estimation</a></li>
<li class="chapter" data-level="4.1.4" data-path="NE.html"><a href="NE.html#estimation-of-sampling-noise"><i class="fa fa-check"></i><b>4.1.4</b> Estimation of sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="NE.html"><a href="NE.html#regression-discontinuity-designs"><i class="fa fa-check"></i><b>4.2</b> Regression Discontinuity Designs</a></li>
<li class="chapter" data-level="4.3" data-path="NE.html"><a href="NE.html#difference-in-differences"><i class="fa fa-check"></i><b>4.3</b> Difference In Differences</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sec:OM.html"><a href="sec:OM.html"><i class="fa fa-check"></i><b>5</b> Observational Methods</a></li>
<li class="chapter" data-level="6" data-path="sec:threats.html"><a href="sec:threats.html"><i class="fa fa-check"></i><b>6</b> Threats to the validity of Causal Inference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sec:threats.html"><a href="sec:threats.html#threats-to-internal-validity"><i class="fa fa-check"></i><b>6.1</b> Threats to internal validity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="sec:threats.html"><a href="sec:threats.html#survey-bias"><i class="fa fa-check"></i><b>6.1.1</b> Survey bias</a></li>
<li class="chapter" data-level="6.1.2" data-path="sec:threats.html"><a href="sec:threats.html#experimenter-bias"><i class="fa fa-check"></i><b>6.1.2</b> Experimenter bias</a></li>
<li class="chapter" data-level="6.1.3" data-path="sec:threats.html"><a href="sec:threats.html#substitution-bias"><i class="fa fa-check"></i><b>6.1.3</b> Substitution bias</a></li>
<li class="chapter" data-level="6.1.4" data-path="sec:threats.html"><a href="sec:threats.html#diffusion-bias"><i class="fa fa-check"></i><b>6.1.4</b> Diffusion bias</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="sec:threats.html"><a href="sec:threats.html#threats-to-the-measurement-of-precision"><i class="fa fa-check"></i><b>6.2</b> Threats to the measurement of precision</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="sec:threats.html"><a href="sec:threats.html#insufficient-precision"><i class="fa fa-check"></i><b>6.2.1</b> Insufficient precision</a></li>
<li class="chapter" data-level="6.2.2" data-path="sec:threats.html"><a href="sec:threats.html#clustering"><i class="fa fa-check"></i><b>6.2.2</b> Clustering</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="sec:threats.html"><a href="sec:threats.html#threats-to-external-validity"><i class="fa fa-check"></i><b>6.3</b> Threats to external validity</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="sec:threats.html"><a href="sec:threats.html#randomization-bias"><i class="fa fa-check"></i><b>6.3.1</b> Randomization bias</a></li>
<li class="chapter" data-level="6.3.2" data-path="sec:threats.html"><a href="sec:threats.html#equilibrium-effects"><i class="fa fa-check"></i><b>6.3.2</b> Equilibrium effects</a></li>
<li class="chapter" data-level="6.3.3" data-path="sec:threats.html"><a href="sec:threats.html#context-effects"><i class="fa fa-check"></i><b>6.3.3</b> Context effects</a></li>
<li class="chapter" data-level="6.3.4" data-path="sec:threats.html"><a href="sec:threats.html#site-selection-bias"><i class="fa fa-check"></i><b>6.3.4</b> Site selection bias</a></li>
<li class="chapter" data-level="6.3.5" data-path="sec:threats.html"><a href="sec:threats.html#publication-bias"><i class="fa fa-check"></i><b>6.3.5</b> Publication bias</a></li>
<li class="chapter" data-level="6.3.6" data-path="sec:threats.html"><a href="sec:threats.html#ethical-and-political-issues"><i class="fa fa-check"></i><b>6.3.6</b> Ethical and political issues</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Additional Topics</b></span></li>
<li class="chapter" data-level="7" data-path="Power.html"><a href="Power.html"><i class="fa fa-check"></i><b>7</b> Power Analysis</a></li>
<li class="chapter" data-level="8" data-path="Placebo.html"><a href="Placebo.html"><i class="fa fa-check"></i><b>8</b> Placebo Tests</a></li>
<li class="chapter" data-level="9" data-path="cluster.html"><a href="cluster.html"><i class="fa fa-check"></i><b>9</b> Clustering</a></li>
<li class="chapter" data-level="10" data-path="LaLonde.html"><a href="LaLonde.html"><i class="fa fa-check"></i><b>10</b> LaLonde Tests</a></li>
<li class="chapter" data-level="11" data-path="Diffusion.html"><a href="Diffusion.html"><i class="fa fa-check"></i><b>11</b> Diffusion effects</a></li>
<li class="chapter" data-level="12" data-path="Distribution.html"><a href="Distribution.html"><i class="fa fa-check"></i><b>12</b> Distributional effects</a></li>
<li class="chapter" data-level="13" data-path="sec:meta.html"><a href="sec:meta.html"><i class="fa fa-check"></i><b>13</b> Meta-analysis and Publication Bias</a>
<ul>
<li class="chapter" data-level="13.1" data-path="sec:meta.html"><a href="sec:meta.html#meta-analysis"><i class="fa fa-check"></i><b>13.1</b> Meta-analysis</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="sec:meta.html"><a href="sec:meta.html#basic-setting"><i class="fa fa-check"></i><b>13.1.1</b> Basic setting</a></li>
<li class="chapter" data-level="13.1.2" data-path="sec:meta.html"><a href="sec:meta.html#why-vote-counting-does-not-work"><i class="fa fa-check"></i><b>13.1.2</b> Why vote-counting does not work</a></li>
<li class="chapter" data-level="13.1.3" data-path="sec:meta.html"><a href="sec:meta.html#MetaWA"><i class="fa fa-check"></i><b>13.1.3</b> Meta-analysis when treatment effects are homogeneous: the fixed effects approach</a></li>
<li class="chapter" data-level="13.1.4" data-path="sec:meta.html"><a href="sec:meta.html#meta-analysis-when-treatment-effects-are-heterogeneous-the-random-effects-approach"><i class="fa fa-check"></i><b>13.1.4</b> Meta-analysis when treatment effects are heterogeneous: the random effects approach</a></li>
<li class="chapter" data-level="13.1.5" data-path="sec:meta.html"><a href="sec:meta.html#meta-regression"><i class="fa fa-check"></i><b>13.1.5</b> Meta-regression</a></li>
<li class="chapter" data-level="13.1.6" data-path="sec:meta.html"><a href="sec:meta.html#constantly-updated-meta-analysis"><i class="fa fa-check"></i><b>13.1.6</b> Constantly updated meta-analysis</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="sec:meta.html"><a href="sec:meta.html#publication-bias-and-site-selection-bias"><i class="fa fa-check"></i><b>13.2</b> Publication bias and site selection bias</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="sec:meta.html"><a href="sec:meta.html#sources-of-publication-bias-and-of-site-selection-bias-and-questionable-research-practices"><i class="fa fa-check"></i><b>13.2.1</b> Sources of publication bias and of site selection bias and Questionable Research Practices</a></li>
<li class="chapter" data-level="13.2.2" data-path="sec:meta.html"><a href="sec:meta.html#detection-of-and-correction-for-publication-bias"><i class="fa fa-check"></i><b>13.2.2</b> Detection of and correction for publication bias</a></li>
<li class="chapter" data-level="13.2.3" data-path="sec:meta.html"><a href="sec:meta.html#getting-rid-of-publication-bias-registered-reports-and-pre-analysis-plans"><i class="fa fa-check"></i><b>13.2.3</b> Getting rid of publication bias: registered reports and pre-analysis plans</a></li>
<li class="chapter" data-level="13.2.4" data-path="sec:meta.html"><a href="sec:meta.html#detection-of-and-correction-for-site-selection-bias"><i class="fa fa-check"></i><b>13.2.4</b> Detection of and correction for site selection bias</a></li>
<li class="chapter" data-level="13.2.5" data-path="sec:meta.html"><a href="sec:meta.html#vote-counting-and-publication-bias"><i class="fa fa-check"></i><b>13.2.5</b> Vote counting and publication bias</a></li>
<li class="chapter" data-level="13.2.6" data-path="sec:meta.html"><a href="sec:meta.html#the-value-of-a-statistically-significant-result"><i class="fa fa-check"></i><b>13.2.6</b> The value of a statistically significant result</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="Bounds.html"><a href="Bounds.html"><i class="fa fa-check"></i><b>14</b> Bounds</a></li>
<li class="chapter" data-level="15" data-path="mediation-analysis.html"><a href="mediation-analysis.html"><i class="fa fa-check"></i><b>15</b> Mediation Analysis</a>
<ul>
<li class="chapter" data-level="15.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-a-framework"><i class="fa fa-check"></i><b>15.1</b> Mediation analysis: a framework</a></li>
<li class="chapter" data-level="15.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#the-fundamental-problem-of-mediation-analysis"><i class="fa fa-check"></i><b>15.2</b> The Fundamental Problem of Mediation Analysis</a></li>
<li class="chapter" data-level="15.3" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-under-unconfoundedness"><i class="fa fa-check"></i><b>15.3</b> Mediation analysis under unconfoundedness</a></li>
<li class="chapter" data-level="15.4" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-panel-data"><i class="fa fa-check"></i><b>15.4</b> Mediation analysis with panel data</a></li>
<li class="chapter" data-level="15.5" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-instruments"><i class="fa fa-check"></i><b>15.5</b> Mediation analysis with instruments</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="proofs.html"><a href="proofs.html"><i class="fa fa-check"></i><b>A</b> Proofs</a>
<ul>
<li class="chapter" data-level="A.1" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-reffpsi"><i class="fa fa-check"></i><b>A.1</b> Proofs of results in Chapter @ref(FPSI)</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="proofs.html"><a href="proofs.html#proofcheb"><i class="fa fa-check"></i><b>A.1.1</b> Proof of Theorem @ref(thm:uppsampnoise)</a></li>
<li class="chapter" data-level="A.1.2" data-path="proofs.html"><a href="proofs.html#proofCLT"><i class="fa fa-check"></i><b>A.1.2</b> Proof of Theorem @ref(thm:asympnoiseWW)</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refrct"><i class="fa fa-check"></i><b>A.2</b> Proofs of results in Chapter @ref(RCT)</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="proofs.html"><a href="proofs.html#proofIdentLATE"><i class="fa fa-check"></i><b>A.2.1</b> Proof of Theorem @ref(thm:IdentLATE)</a></li>
<li class="chapter" data-level="A.2.2" data-path="proofs.html"><a href="proofs.html#proofWaldIV"><i class="fa fa-check"></i><b>A.2.2</b> Proof of Theorem @ref(thm:WaldIV)</a></li>
<li class="chapter" data-level="A.2.3" data-path="proofs.html"><a href="proofs.html#ProofAsymWald"><i class="fa fa-check"></i><b>A.2.3</b> Proof of Theorem @ref(thm:asymWald)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Tools for Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="NE" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Natural Experiments</h1>
<p>Natural Experiments are situations due to the natural course of events that approximate the conditions of a randomized controlled trial.
In the economists’ toolkit, we generally make a distinction between:</p>
<ol style="list-style-type: decimal">
<li>Instrumental variables (IV), that rely on finding a plausibly exogeneous source of variation in treatment intake.</li>
<li>Regression Discontinuity Designs (RDD), that exploit a discontinuity in the eligibility to the treatment.</li>
<li>Difference In Differences (DID), that make use of the differential exposure of some groups to the treatment of interest over time.</li>
</ol>

<div class="remark">
 <span class="remark"><em>Remark. </em></span> The term <em>Natural Experiments</em> seems to be mostly used by economists.
It dates back to Haavelmo (1944)’s paper on the Probability Approach to Econometrics, where he makes a distinction between the experiments we’d like to make as social scientists and the experiments that Nature provides us with, that are in general a subset of the experiments we’d like to make.
This raises the question of our ability to <strong>identify</strong> the relationships of interest from the variation that is present in the data, a traditional problem in classical econometrics that has echoes in treatment effect estimation, where we also try to <em>identify</em> treatment effect parameters.
At the time of Haavelmo, and until the beginning of the 1990s, there was no real discussion of the plausibility of the <em>identifying assumptions</em> (or restrictions) required for identification of certain relations, outside of a discussion of their theoretical plausiblility.
With the credibility revolution brought about by Angrist (1990)’s paper and summarized in Angrist and Krueger (2001)’s review paper, the notion of natural experiment made a come back, with the idea that we might be able to look for specific set of events produced by Nature that more credibly identify a relationship of interest, <em>i.e.</em> that closely approximate true experimental conditions.
</div>

<div class="remark">
 <span class="remark"><em>Remark. </em></span> Outside of economics, Natural Experiments have also flourished, but without the term, and were compiled in the early textbook on research methods by Campbell (1966).
Both Difference In Differences and Regression Discontinuity Designs have been actually developed outside of economics, mostly in education research.
Instrumental Variables have had a separate history in economics and in genetics, were it is called the method of path coefficients.
</div>
<div id="instrumental-variables" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Instrumental Variables</h2>
<p>Instrumental Variables rely on finding a plausibly exogeneous source of variation in treatment intake.
In the simple case of a binary instrument, the identification and estimation parts are actually identical to Encouragements designs in RCTs, that we have already studied in Section <a href="RCT.html#sec:design4">3.4</a>.
As a consequence, unless we make very strong assumptions, an IV design is going to recover a Local Average Treatment Effect.
Our classical assumptions are going to show up again: Independence, Exclusion Restriction, Monotonicity.</p>

<div class="remark">
 <span class="remark"><em>Remark. </em></span> Examples of Instrumental Variables are:
</div>
<ul>
<li>Distance to college or to school for studying the impact of college or school enrollement on education, earnings and other outcomes.</li>
<li>Random draft lottery number for investigating the impact of military experience on earnings and other outcomes.</li>
<li>Randomized encouragement to participate in order to study the impact of a program.</li>
</ul>

<div class="remark">
<p> <span class="remark"><em>Remark. </em></span> The crucial part of an IV design is to justify the credibility of the exclusion restriction and independence assumptions.
It is in general very difficult to justify these assumptions, especially the exclusion restriction assumption.
In the examples above, one could argue that schools or colleges might be built where they are necessary, i.e. close to destitute populations, or, on the contrary, that they are built far from difficult neighbourhoods.
As soon as distance to school becomes correlated with other determinants of schooling, such as parental income and education, the independence assumption is violated.</p>
<p>Even if school placement is truly independent of potential education and earnings outcomes at first, parents, by choosing where to live, will sort themselves such as the parents that pay more attention to education end up located closer to school.
As a consequence, the independence assumption might be violated again.</p>
Even when the instrumen is truly random, such as a draft lottery number, and thus the independence assumption seems fine, the instrument may directly affect the outcomes by other ways than the treatment of interest.
For example, receiving a low draft lottery number makes one more likely to be drafted.
In response, one might decide to increase his length of stay in college in order to use the waiver for the draft reserved for students.
If receiving a low draft lottery number increases the number of years of education, and in turn subsequent earnings, then the exclusion restriction assumption is violated.
</div>
<p>In this section, I’m going to denote <span class="math inline">\(Z_i\)</span> a binary instrument that can either take value <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>.
In general, we try to reserve the value <span class="math inline">\(1\)</span> for the instrument value that increases participation in the treatment of interest.
In our examples, that would be when for example, the distance to college is low, the draft lottery number is low, or someone receives an encouragement to enter a program.</p>
<div id="an-example-where-monotonicity-does-not-hold" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> An example where Monotonicity does not hold</h3>
<p>Since Monotonicity is going to play such a particular role, and since we have already explored this assumption a little in Chapter <a href="RCT.html#RCT">3</a>, I am going to use as an example a model where the Monotonicity assumption actually does not hold.
It will, I hope, help us understand better the way Monotonicity works and how it interacts with the other assumptions.
The key component of the model that makes Monotonicity necessary is the fact that treatment effects are heterogeneous and correlated with participation in the treatment.
We’ll see later that Monotonicity is unnecessary when treatment effects are orthogonal to take up.</p>

<div class="example">
<span id="exm:unnamed-chunk-139" class="example"><strong>Example 4.1  </strong></span>Let’s see how we can generate a model without Monotonicity:
</div>
<p><span class="math display">\[\begin{align*}
y_i^1 &amp; = y_i^0+\bar{\alpha}+\theta\mu_i+\eta_i \\
y_i^0 &amp; = \mu_i+\delta+U_i^0 \\
U_i^0 &amp; = \rho U_i^B+\epsilon_i \\
y_i^B &amp; =\mu_i+U_i^B \\
U_i^B &amp; \sim\mathcal{N}(0,\sigma^2_{U}) \\
D_i   &amp; = \uns{y_i^B+\kappa_i Z_i + V_i\leq\bar{y}} \\
\kappa_i &amp; = 
\begin{cases}
-\bar{\kappa} &amp; \text{ if } \xi = 1 \\
\underline{\kappa} &amp; \text{ if } \xi = 0
\end{cases} \\
\xi &amp; \sim\mathcal{B}(p_{\xi}) \\
V_i   &amp; = \gamma(\mu_i-\bar{\mu}) + \omega_i \\
(\eta_i,\omega_i) &amp; \sim\mathcal{N}(0,0,\sigma^2_{\eta},\sigma^2_{\omega},\rho_{\eta,\omega}) \\
Z_i   &amp; \sim\mathcal{B}(p_Z) \\
Z_i   &amp; \Ind (y_i^0,y_i^1,y_i^B,V_i) \\
\xi &amp; \Ind (y_i^0,y_i^1,y_i^B,V_i,Z_i)
\end{align*}\]</span></p>
<p>The key component of the model that generates a failure of Monotonicity is the coefficient <span class="math inline">\(\kappa_i\)</span>, that determines how individuals’ participation into the program reacts to the instrument <span class="math inline">\(Z_i\)</span>.
<span class="math inline">\(\kappa_i\)</span> is a coefficient whose value varies accross the population.
In my simplified model, <span class="math inline">\(\kappa_i\)</span> can take only two values, <span class="math inline">\(-\bar{\kappa}\)</span> or <span class="math inline">\(\underline{\kappa}\)</span>.
When <span class="math inline">\(-\bar{\kappa}\)</span> and <span class="math inline">\(\underline{\kappa}\)</span> have opposite signs (let’s say <span class="math inline">\(-\bar{\kappa}&lt;0\)</span> and <span class="math inline">\(\underline{\kappa}&gt;0\)</span>), then individuals with <span class="math inline">\(\kappa_i=-\bar{\kappa}\)</span> are going to be more likely to enter the program when they receive an encouragement (when <span class="math inline">\(Z_i=1\)</span>) while individuals with <span class="math inline">\(\kappa_i=\underline{\kappa}\)</span> will be less likely to enter the program when <span class="math inline">\(Z_i=1\)</span>.
When <span class="math inline">\(-\bar{\kappa}\)</span> and <span class="math inline">\(\underline{\kappa}\)</span> have different signs, we have four types of reactions when the instrumental variable moves from <span class="math inline">\(Z_i=0\)</span> to <span class="math inline">\(Z_i=1\)</span>, holding everything else constant.
These four types of reactions define four types of individuals:</p>
<ul>
<li><strong>Always takers</strong> (<span class="math inline">\(T_i=a\)</span>): individuals that participate in the program both when <span class="math inline">\(Z_i=0\)</span> and <span class="math inline">\(Z_i=1\)</span>.</li>
<li><strong>Never takers</strong> (<span class="math inline">\(T_i=n\)</span>): individuals that do not participate in the program both when <span class="math inline">\(Z_i=0\)</span> and <span class="math inline">\(Z_i=1\)</span>.</li>
<li><strong>Compliers</strong> (<span class="math inline">\(T_i=c\)</span>): individuals that do not participate in the program when <span class="math inline">\(Z_i=0\)</span> but that participate in the program when <span class="math inline">\(Z_i=1\)</span> .</li>
<li><strong>Defiers</strong> (<span class="math inline">\(T_i=d\)</span>): individuals that participate in the program when <span class="math inline">\(Z_i=0\)</span> but that do not participate in the program when <span class="math inline">\(Z_i=1\)</span> .</li>
</ul>
<p>In our model, these four types are a function of <span class="math inline">\(y_i^B+V_i\)</span> and <span class="math inline">\(\kappa_i\)</span>.
In order to see this let’s define, as in Section <a href="RCT.html#sec:design4">3.4</a>, <span class="math inline">\(D^z_i\)</span> the participation decision of individual <span class="math inline">\(i\)</span> when the instrument is exogenously set to <span class="math inline">\(Z_i=z\)</span>, with <span class="math inline">\(z\in\left\{0,1\right\}\)</span>.
When <span class="math inline">\(\kappa_i=-\bar{\kappa}&lt;0\)</span>, we have three types of reactions to the instrument.
It turns out that each of type can be defined by where <span class="math inline">\(y_i^B+V_i\)</span> lies with respect to a series of thresholds:</p>
<ul>
<li><strong>Always takers</strong> (<span class="math inline">\(T_i=a\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B-\bar{\kappa} + V_i\leq\bar{y}}=1\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=1\)</span>, so that they actually are such that: <span class="math inline">\(y_i^B+V_i\leq\bar{y}\)</span>.
This is because <span class="math inline">\(y_i^B+V_i\leq\bar{y} \Rightarrow y_i^B+V_i\leq\bar{y}+\bar{\kappa}\)</span>, when <span class="math inline">\(\bar{\kappa}&gt;0\)</span>.</li>
<li><strong>Never takers</strong> (<span class="math inline">\(T_i=n\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B-\bar{\kappa} + V_i\leq\bar{y}}=0\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=0\)</span>, so that they actually are such that: <span class="math inline">\(y_i^B+V_i&gt;\bar{y}+\bar{\kappa}\)</span>.
This is because <span class="math inline">\(y_i^B+V_i&gt;\bar{y}+\bar{\kappa} \Rightarrow y_i^B+V_i&gt;\bar{y}\)</span>, when <span class="math inline">\(\bar{\kappa}&gt;0\)</span>.</li>
<li><strong>Compliers</strong> (<span class="math inline">\(T_i=c\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B-\bar{\kappa} + V_i\leq\bar{y}}=1\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=0\)</span>, so that they actually are such that: <span class="math inline">\(\bar{y}&lt;y_i^B+V_i\leq\bar{y}+\bar{\kappa}\)</span>.</li>
</ul>
<p>When <span class="math inline">\(\kappa_i=\underline{\kappa}&gt;0\)</span>, we have three types defined by where <span class="math inline">\(V_i\)</span> lies with respect to a series of thresholds:</p>
<ul>
<li><strong>Always takers</strong> (<span class="math inline">\(T_i=a\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B+\underline{\kappa} + V_i\leq\bar{y}}=1\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=1\)</span>, so that they actually are such that: <span class="math inline">\(y_i^B+V_i\leq\bar{y}-\underline{\kappa}\)</span>.
This is because <span class="math inline">\(y_i^B+V_i\leq\bar{y}-\underline{\kappa} \Rightarrow y_i^B+V_i\leq\bar{y}\)</span>, when <span class="math inline">\(\underline{\kappa}&gt;0\)</span>.</li>
<li><strong>Never takers</strong> (<span class="math inline">\(T_i=n\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B-\bar{\kappa} + V_i\leq\bar{y}}=0\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=0\)</span>, so that they actually are such that: <span class="math inline">\(y_i^B+V_i&gt;\bar{y}\)</span>.
This is because <span class="math inline">\(y_i^B+V_i&gt;\bar{y} \Rightarrow y_i^B+V_i\leq\bar{y}-\underline{\kappa}\)</span>, when <span class="math inline">\(\underline{\kappa}&gt;0\)</span>.</li>
<li><strong>Defiers</strong> (<span class="math inline">\(T_i=d\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B+\underline{\kappa} + V_i\leq\bar{y}}=0\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=1\)</span>, so that they actually are such that: <span class="math inline">\(\bar{y}-\underline{\kappa}&lt;V_i+y_i^B\leq\bar{y}\)</span>.</li>
</ul>
<p>Let’s visualize how this works in a plot.
Before that, let’s generate some data according to this process.
For that, let’s choose values for the new parameters.</p>
<p><strong><span class="smallcaps">Generate the true model now.</span></strong></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="NE.html#cb127-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">7.98</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.5</span>,<span class="fl">0.9</span>,<span class="fl">0.28</span>,<span class="dv">0</span>)</span>
<span id="cb127-2"><a href="NE.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;theta&quot;</span>,<span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,<span class="st">&quot;delta&quot;</span>,<span class="st">&quot;baralpha&quot;</span>,<span class="st">&quot;gamma&quot;</span>,<span class="st">&quot;baryB&quot;</span>,<span class="st">&quot;pZ&quot;</span>,<span class="st">&quot;barkappa&quot;</span>,<span class="st">&quot;underbarkappa&quot;</span>,<span class="st">&quot;pxi&quot;</span>,<span class="st">&quot;sigma2omega&quot;</span>,<span class="st">&quot;rhoetaomega&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="NE.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb128-2"><a href="NE.html#cb128-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb128-3"><a href="NE.html#cb128-3" aria-hidden="true" tabindex="-1"></a>cov.eta.omega <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(param[<span class="st">&quot;sigma2eta&quot;</span>],param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;sigma2omega&quot;</span>]),<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb128-4"><a href="NE.html#cb128-4" aria-hidden="true" tabindex="-1"></a>eta.omega <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">mvrnorm</span>(N,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),cov.eta.omega))</span>
<span id="cb128-5"><a href="NE.html#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(eta.omega) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;eta&#39;</span>,<span class="st">&#39;omega&#39;</span>)</span>
<span id="cb128-6"><a href="NE.html#cb128-6" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))</span>
<span id="cb128-7"><a href="NE.html#cb128-7" aria-hidden="true" tabindex="-1"></a>UB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb128-8"><a href="NE.html#cb128-8" aria-hidden="true" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UB </span>
<span id="cb128-9"><a href="NE.html#cb128-9" aria-hidden="true" tabindex="-1"></a>YB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yB)</span>
<span id="cb128-10"><a href="NE.html#cb128-10" aria-hidden="true" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb128-11"><a href="NE.html#cb128-11" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,param[<span class="st">&quot;pZ&quot;</span>])</span>
<span id="cb128-12"><a href="NE.html#cb128-12" aria-hidden="true" tabindex="-1"></a>xi <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,param[<span class="st">&quot;pxi&quot;</span>]) </span>
<span id="cb128-13"><a href="NE.html#cb128-13" aria-hidden="true" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(xi<span class="sc">==</span><span class="dv">1</span>,<span class="sc">-</span>param[<span class="st">&quot;barkappa&quot;</span>],param[<span class="st">&quot;underbarkappa&quot;</span>])</span>
<span id="cb128-14"><a href="NE.html#cb128-14" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> param[<span class="st">&quot;gamma&quot;</span>]<span class="sc">*</span>(mu<span class="sc">-</span>param[<span class="st">&quot;barmu&quot;</span>])<span class="sc">+</span>eta.omega<span class="sc">$</span>omega</span>
<span id="cb128-15"><a href="NE.html#cb128-15" aria-hidden="true" tabindex="-1"></a>Ds[yB<span class="sc">+</span>kappa<span class="sc">*</span>Z<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb128-16"><a href="NE.html#cb128-16" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb128-17"><a href="NE.html#cb128-17" aria-hidden="true" tabindex="-1"></a>U0 <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilon</span>
<span id="cb128-18"><a href="NE.html#cb128-18" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0 <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb128-19"><a href="NE.html#cb128-19" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta.omega<span class="sc">$</span>eta</span>
<span id="cb128-20"><a href="NE.html#cb128-20" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y0<span class="sc">+</span>alpha</span>
<span id="cb128-21"><a href="NE.html#cb128-21" aria-hidden="true" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y0)</span>
<span id="cb128-22"><a href="NE.html#cb128-22" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y1)</span>
<span id="cb128-23"><a href="NE.html#cb128-23" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y1<span class="sc">*</span>Ds<span class="sc">+</span>y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span>
<span id="cb128-24"><a href="NE.html#cb128-24" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y1<span class="sc">*</span>Ds<span class="sc">+</span>Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span></code></pre></div>
<p>We can now define the types variable <span class="math inline">\(T_i\)</span>:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="NE.html#cb129-1" aria-hidden="true" tabindex="-1"></a>D1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(yB<span class="sc">+</span>kappa<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-2"><a href="NE.html#cb129-2" aria-hidden="true" tabindex="-1"></a>D0 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(yB<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-3"><a href="NE.html#cb129-3" aria-hidden="true" tabindex="-1"></a>AT <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-4"><a href="NE.html#cb129-4" aria-hidden="true" tabindex="-1"></a>NT <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-5"><a href="NE.html#cb129-5" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-6"><a href="NE.html#cb129-6" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-7"><a href="NE.html#cb129-7" aria-hidden="true" tabindex="-1"></a>Type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(AT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;a&#39;</span>,</span>
<span id="cb129-8"><a href="NE.html#cb129-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ifelse</span>(NT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;n&#39;</span>,</span>
<span id="cb129-9"><a href="NE.html#cb129-9" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">ifelse</span>(C<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;c&#39;</span>,</span>
<span id="cb129-10"><a href="NE.html#cb129-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">ifelse</span>(D<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;d&#39;</span>,<span class="st">&quot;&quot;</span>))))</span>
<span id="cb129-11"><a href="NE.html#cb129-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-12"><a href="NE.html#cb129-12" aria-hidden="true" tabindex="-1"></a>data.non.mono <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(Type,C,NT,AT,D1,D0,Y,y,Y1,Y0,y0,y1,yB,alpha,U0,eta.omega<span class="sc">$</span>eta,epsilon,Ds,kappa,xi,Z,mu,UB))</span></code></pre></div>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="NE.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplot(data.non.mono, aes(x=V, y=yB),color(as.factor(Type))) +</span></span>
<span id="cb130-2"><a href="NE.html#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    geom_point(shape=1)+</span></span>
<span id="cb130-3"><a href="NE.html#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    facet_grid(.~ as.factor(kappa))</span></span>
<span id="cb130-4"><a href="NE.html#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="NE.html#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yB[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]]<span class="sc">+</span>V[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],y[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">xlab=</span><span class="st">&#39;yB+V&#39;</span>,<span class="at">ylab=</span><span class="st">&quot;Outcomes&quot;</span>)</span>
<span id="cb130-6"><a href="NE.html#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]]<span class="sc">+</span>V[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],y[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb130-7"><a href="NE.html#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]]<span class="sc">+</span>V[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],y[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-8"><a href="NE.html#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]]<span class="sc">+</span>V[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],y[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb130-9"><a href="NE.html#cb130-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-10"><a href="NE.html#cb130-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>],<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-11"><a href="NE.html#cb130-11" aria-hidden="true" tabindex="-1"></a><span class="co">#abline(v=log(param[&quot;barY&quot;])-param[&#39;underbarkappa&#39;],col=&#39;red&#39;)</span></span>
<span id="cb130-12"><a href="NE.html#cb130-12" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>]),<span class="at">y=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>)),<span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>)<span class="sc">+</span><span class="fu">bar</span>(kappa))),<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;red&#39;</span>),<span class="at">lty=</span><span class="fu">c</span>(<span class="st">&#39;solid&#39;</span>,<span class="st">&#39;solid&#39;</span>))</span>
<span id="cb130-13"><a href="NE.html#cb130-13" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">5</span>,<span class="fl">10.5</span>,<span class="fu">c</span>(<span class="st">&#39;AT&#39;</span>,<span class="st">&#39;NT&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>),<span class="at">pch=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;black&#39;</span>,<span class="st">&#39;blue&#39;</span>,<span class="st">&#39;red&#39;</span>,<span class="st">&#39;green&#39;</span>),<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb130-14"><a href="NE.html#cb130-14" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">expression</span>(<span class="at">kappa=</span><span class="fu">bar</span>(kappa)))</span>
<span id="cb130-15"><a href="NE.html#cb130-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-16"><a href="NE.html#cb130-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yB[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]]<span class="sc">+</span>V[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],y[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">xlab=</span><span class="st">&#39;yB+V&#39;</span>,<span class="at">ylab=</span><span class="st">&quot;Outcomes&quot;</span>)</span>
<span id="cb130-17"><a href="NE.html#cb130-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]]<span class="sc">+</span>V[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],y[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb130-18"><a href="NE.html#cb130-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]]<span class="sc">+</span>V[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],y[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-19"><a href="NE.html#cb130-19" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]]<span class="sc">+</span>V[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],y[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb130-20"><a href="NE.html#cb130-20" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-21"><a href="NE.html#cb130-21" aria-hidden="true" tabindex="-1"></a><span class="co">#abline(v=log(param[&quot;barY&quot;])-param[&#39;barkappa&#39;],col=&#39;red&#39;)</span></span>
<span id="cb130-22"><a href="NE.html#cb130-22" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">-</span>param[<span class="st">&#39;underbarkappa&#39;</span>],<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-23"><a href="NE.html#cb130-23" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">-</span>param[<span class="st">&#39;underbarkappa&#39;</span>]),<span class="at">y=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>)),<span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>)<span class="sc">-</span><span class="fu">underbar</span>(kappa))),<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;red&#39;</span>),<span class="at">lty=</span><span class="fu">c</span>(<span class="st">&#39;solid&#39;</span>,<span class="st">&#39;solid&#39;</span>))</span>
<span id="cb130-24"><a href="NE.html#cb130-24" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">5</span>,<span class="fl">10.5</span>,<span class="fu">c</span>(<span class="st">&#39;AT&#39;</span>,<span class="st">&#39;NT&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>),<span class="at">pch=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;black&#39;</span>,<span class="st">&#39;blue&#39;</span>,<span class="st">&#39;red&#39;</span>,<span class="st">&#39;green&#39;</span>),<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb130-25"><a href="NE.html#cb130-25" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">expression</span>(<span class="at">kappa=</span><span class="fu">underbar</span>(kappa)))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plottypes"></span>
<img src="STCI_files/figure-html/plottypes-1.png" alt="Types" width="50%" /><img src="STCI_files/figure-html/plottypes-2.png" alt="Types" width="50%" />
<p class="caption">
Figure 4.1: Types
</p>
</div>
<p>As Figure <a href="NE.html#fig:plottypes">4.1</a> shows how the different types interact with <span class="math inline">\(\kappa_i\)</span>.
When <span class="math inline">\(\kappa_i=-\bar{\kappa}\)</span>, individuals with <span class="math inline">\(y_i^B+V_i\)</span> below <span class="math inline">\(\bar{y}\)</span> always take the program.
Even when <span class="math inline">\(Z_i=1\)</span> and <span class="math inline">\(\bar{\kappa}\)</span> is subtracted from their index, it is still low enough so that they get to participate.
When <span class="math inline">\(y_i^B+V_i\)</span> is in between <span class="math inline">\(\bar{y}\)</span> and <span class="math inline">\(\bar{y}+\bar{\kappa}\)</span>, the individuals are such that their index without subtracting <span class="math inline">\(\bar{\kappa}\)</span> is above <span class="math inline">\(\bar{y}\)</span>, but it is below <span class="math inline">\(\bar{y}\)</span> when <span class="math inline">\(\bar{\kappa}\)</span> is subtracted from it.
These individuals participate when <span class="math inline">\(Z_i=1\)</span> and do not participate when <span class="math inline">\(Z_i=0\)</span>: they are compliers.
Individuals such that <span class="math inline">\(y_i^B+V_i\)</span> is above <span class="math inline">\(\bar{y}+\bar{\kappa}\)</span> will have an index above <span class="math inline">\(\bar{y}\)</span> whether we substract <span class="math inline">\(\bar{\kappa}\)</span> from it or not.
They are never takers.</p>
<p>When <span class="math inline">\(\kappa_i=\underline{\kappa}\)</span>, individuals with <span class="math inline">\(y_i^B+V_i\)</span> below <span class="math inline">\(\bar{y}-\underline{\kappa}\)</span> always take the program.
Even when <span class="math inline">\(Z_i=0\)</span> and <span class="math inline">\(\underline{\kappa}\)</span> is not subtracted from their index, it is still low enough so that they get to participate.
When <span class="math inline">\(y_i^B+V_i\)</span> is in between <span class="math inline">\(\bar{y}-\underline{\kappa}\)</span> and <span class="math inline">\(\bar{y}\)</span>, the individuals are such that their index without adding <span class="math inline">\(\underline{\kappa}\)</span> is below <span class="math inline">\(\bar{y}\)</span>, but it is above <span class="math inline">\(\bar{y}\)</span> when <span class="math inline">\(\underline{\kappa}\)</span> is added to it.
These individuals participate when <span class="math inline">\(Z_i=0\)</span> and do not participate when <span class="math inline">\(Z_i=1\)</span>: they are defiers.
Individuals such that <span class="math inline">\(y_i^B+V_i\)</span> is above <span class="math inline">\(\bar{y}\)</span> will have an index above <span class="math inline">\(\bar{y}\)</span> whether we add <span class="math inline">\(\underline{\kappa}\)</span> from it or not.
They are never takers.</p>
</div>
<div id="identification-4" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Identification</h3>
<p>We need several assumptions for identification in an Instrumental Variable framework.
We are going to explore two sets of assumption that secure the identification of two different parameters:</p>
<ul>
<li>The Average Treatment Effect on the Treated (<span class="math inline">\(TT\)</span>): identification will happen through the assumption of independence of treatment effects from potential treatment choice</li>
<li>The Local Average Treatment Effect (<span class="math inline">\(LATE\)</span>)</li>
</ul>
<div id="assumptions" class="section level4" number="4.1.2.1">
<h4><span class="header-section-number">4.1.2.1</span> Assumptions</h4>

<div class="definition">
<p><span id="def:FirstStage" class="definition"><strong>Definition 4.1  (First Stage Full Rank)  </strong></span>We assume that the instrument <span class="math inline">\(Z_i\)</span> has a direct effect on treatment participation:</p>
<span class="math display">\[\begin{align*}
\Pr(D_i=1|Z_i=1)\neq\Pr(D_i=1|Z_i=0).
\end{align*}\]</span>
</div>

<div class="example">
<span id="exm:unnamed-chunk-140" class="example"><strong>Example 4.2  </strong></span>Let’s see how this assumption works in our example.
Let’s first compute the average values of <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(D_i\)</span> as a function of <span class="math inline">\(Z_i\)</span>, for later use.
</div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="NE.html#cb131-1" aria-hidden="true" tabindex="-1"></a>means.IV <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(Ds[Z<span class="sc">==</span><span class="dv">0</span>]),<span class="fu">mean</span>(Ds[Z<span class="sc">==</span><span class="dv">1</span>]),<span class="fu">mean</span>(y0[Z<span class="sc">==</span><span class="dv">0</span>]),<span class="fu">mean</span>(y0[Z<span class="sc">==</span><span class="dv">1</span>]),<span class="fu">mean</span>(y[Z<span class="sc">==</span><span class="dv">0</span>]),<span class="fu">mean</span>(y[Z<span class="sc">==</span><span class="dv">1</span>]),<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb131-2"><a href="NE.html#cb131-2" aria-hidden="true" tabindex="-1"></a>means.IV <span class="ot">&lt;-</span> <span class="fu">matrix</span>(means.IV,<span class="at">nrow=</span><span class="dv">2</span>,<span class="at">ncol=</span><span class="dv">4</span>,<span class="at">byrow=</span><span class="cn">FALSE</span>,<span class="at">dimnames=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&#39;Z=0&#39;</span>,<span class="st">&#39;Z=1&#39;</span>),<span class="fu">c</span>(<span class="st">&#39;D&#39;</span>,<span class="st">&#39;y0&#39;</span>,<span class="st">&#39;y&#39;</span>,<span class="st">&#39;Z&#39;</span>)))</span>
<span id="cb131-3"><a href="NE.html#cb131-3" aria-hidden="true" tabindex="-1"></a>means.IV <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(means.IV)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:IVFirstStage"></span>
<img src="STCI_files/figure-html/IVFirstStage-1.png" alt="Proportion of participants as a function of $Z_i$" width="60%" />
<p class="caption">
Figure 4.2: Proportion of participants as a function of <span class="math inline">\(Z_i\)</span>
</p>
</div>
<p>Figure <a href="NE.html#fig:IVFirstStage">4.2</a> shows that the proportion of treated when <span class="math inline">\(Z_i=1\)</span> in our sample is equal to 0.53 while the proportion of treated when <span class="math inline">\(Z_i=0\)</span> is equal to 0.28, in accordance with Assumption <a href="NE.html#def:FirstStage">4.1</a>.
In the population, the proportion of treated when <span class="math inline">\(Z_i=1\)</span> depends on the value of <span class="math inline">\(\kappa_i\)</span>.
Let’s derive its value:</p>
<p><span class="math display">\[\begin{align*}
  \Pr(D_i=1|Z_i=1) &amp; = \Pr(y_i^B+\kappa_i Z_i + V_i\leq\bar{y}|Z_i=1) \\
                  &amp; =  \Pr(y_i^B+\kappa_i + V_i\leq\bar{y}) \\
                  &amp; =  \Pr(y_i^B+ V_i\leq\bar{y}+\bar{\kappa}|\xi_i=1)\Pr(\xi_i=1) + \Pr(y_i^B+V_i\leq\bar{y}-\underline{\kappa}|\xi_i=0)\Pr(\xi_i=0) \\
                                    &amp; =  \Pr(y_i^B+ V_i\leq\bar{y}+\bar{\kappa})p_{\xi} + \Pr(y_i^B+ V_i\leq\bar{y}-\underline{\kappa})(1-p_{\xi}) \\
                  &amp; =  p_{\xi}\Phi\left(\frac{\bar{y}+\bar{\kappa}-\bar{\mu}}{\sqrt{(1+\gamma)\sigma^2_{\mu}+\sigma^2_{U}+\sigma^2_{\omega}}}\right) + (1-p_{\xi})\Phi\left(\frac{\bar{y}-\underline{\kappa}-\bar{\mu}}{\sqrt{(1+\gamma)\sigma^2_{\mu}+\sigma^2_{U}+\sigma^2_{\omega}}}\right)
\end{align*}\]</span></p>
<p>where the second equality follows from <span class="math inline">\(Z_i\)</span> being independent of <span class="math inline">\((y_i^0,y_i^1,y_i^B,V_i)\)</span>, the third equality follows from <span class="math inline">\(\xi_i\)</span> being independent from <span class="math inline">\((y_i^0,y_i^1,y_i^B,V_i,Z_i)\)</span> and the last equality follows from the formula for the cumulative of a normal distribution.
The formula for <span class="math inline">\(\Pr(D_i=1|Z_i=0)\)</span> is the same except for <span class="math inline">\(\bar{\kappa}\)</span> and <span class="math inline">\(\underline{\kappa}\)</span> that are set to zero.</p>
<p>Let’s write two functions to compute these probabilities:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="NE.html#cb132-1" aria-hidden="true" tabindex="-1"></a>prob.D.Z<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(param){</span>
<span id="cb132-2"><a href="NE.html#cb132-2" aria-hidden="true" tabindex="-1"></a>  part<span class="fl">.1</span> <span class="ot">&lt;-</span> param[<span class="st">&#39;pxi&#39;</span>]<span class="sc">*</span><span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>]<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&quot;sigma2U&quot;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>]))</span>
<span id="cb132-3"><a href="NE.html#cb132-3" aria-hidden="true" tabindex="-1"></a>  part<span class="fl">.2</span> <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>param[<span class="st">&#39;pxi&#39;</span>])<span class="sc">*</span><span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">-</span>param[<span class="st">&#39;underbarkappa&#39;</span>]<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&quot;sigma2U&quot;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>]))</span>
<span id="cb132-4"><a href="NE.html#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(part<span class="fl">.1</span><span class="sc">+</span>part<span class="fl">.2</span>)</span>
<span id="cb132-5"><a href="NE.html#cb132-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-6"><a href="NE.html#cb132-6" aria-hidden="true" tabindex="-1"></a>prob.D.Z<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(param){</span>
<span id="cb132-7"><a href="NE.html#cb132-7" aria-hidden="true" tabindex="-1"></a>  part<span class="fl">.1</span> <span class="ot">&lt;-</span> param[<span class="st">&#39;pxi&#39;</span>]<span class="sc">*</span><span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&quot;sigma2U&quot;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>]))</span>
<span id="cb132-8"><a href="NE.html#cb132-8" aria-hidden="true" tabindex="-1"></a>  part<span class="fl">.2</span> <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>param[<span class="st">&#39;pxi&#39;</span>])<span class="sc">*</span><span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&quot;sigma2U&quot;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>]))</span>
<span id="cb132-9"><a href="NE.html#cb132-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(part<span class="fl">.1</span><span class="sc">+</span>part<span class="fl">.2</span>)</span>
<span id="cb132-10"><a href="NE.html#cb132-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>With these functions, we know that, in the population, <span class="math inline">\(\Pr(D_i=1|Z_i=1)=\)</span> 0.57 and <span class="math inline">\(\Pr(D_i=1|Z_i=0)=\)</span> 0.26.</p>
</div>
</div>
<div id="estimation" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Estimation</h3>
</div>
<div id="estimation-of-sampling-noise" class="section level3" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Estimation of sampling noise</h3>
</div>
</div>
<div id="regression-discontinuity-designs" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Regression Discontinuity Designs</h2>
</div>
<div id="difference-in-differences" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Difference In Differences</h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="RCT.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec:OM.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/chabefer/STCI/blob/master/04_NE.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["STCI.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 1
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
