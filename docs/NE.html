<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Natural Experiments | Statistical Tools for Causal Inference</title>
  <meta name="description" content="This is an open source collaborative book." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Natural Experiments | Statistical Tools for Causal Inference" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is an open source collaborative book." />
  <meta name="github-repo" content="chabefer/STCI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Natural Experiments | Statistical Tools for Causal Inference" />
  
  <meta name="twitter:description" content="This is an open source collaborative book." />
  

<meta name="author" content="Sylvain Chabé-Ferret" />


<meta name="date" content="2021-10-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="RCT.html"/>
<link rel="next" href="sec:OM.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
$$
\newcommand{\uns}[1]{\mathbf{1}[#1]}
\newcommand{\esp}[1]{\mathbf{E}[#1]}
\newcommand{\Ind}{\perp\kern-5pt\perp}
\newcommand{\var}[1]{\mathbf{V}[ #1 ]}
\newcommand{\cov}[1]{\mathbf{C}[ #1 ]}
\newcommand{\plim}[1]{\text{plim}_{ #1 \rightarrow \infty}}
\newcommand{\plims}{\text{plim}}
\newcommand{\partder}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\partdersq}[2]{\frac{\partial^2 #1}{\partial #2^2}}
\DeclareMathOperator{\diag}{diag}
$$


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Tools for Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>I Fundamental Problems of Inference</b></span></li>
<li class="chapter" data-level="" data-path="introduction-the-two-fundamental-problems-of-inference.html"><a href="introduction-the-two-fundamental-problems-of-inference.html"><i class="fa fa-check"></i>Introduction: the Two Fundamental Problems of Inference</a></li>
<li class="chapter" data-level="1" data-path="FPCI.html"><a href="FPCI.html"><i class="fa fa-check"></i><b>1</b> Fundamental Problem of Causal Inference</a>
<ul>
<li class="chapter" data-level="1.1" data-path="FPCI.html"><a href="FPCI.html#rubin-causal-model"><i class="fa fa-check"></i><b>1.1</b> Rubin Causal Model</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="FPCI.html"><a href="FPCI.html#treatment-allocation-rule"><i class="fa fa-check"></i><b>1.1.1</b> Treatment allocation rule</a></li>
<li class="chapter" data-level="1.1.2" data-path="FPCI.html"><a href="FPCI.html#potential-outcomes"><i class="fa fa-check"></i><b>1.1.2</b> Potential outcomes</a></li>
<li class="chapter" data-level="1.1.3" data-path="FPCI.html"><a href="FPCI.html#switching-equation"><i class="fa fa-check"></i><b>1.1.3</b> Switching equation</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="FPCI.html"><a href="FPCI.html#treatment-effects"><i class="fa fa-check"></i><b>1.2</b> Treatment effects</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="FPCI.html"><a href="FPCI.html#individual-level-treatment-effects"><i class="fa fa-check"></i><b>1.2.1</b> Individual level treatment effects</a></li>
<li class="chapter" data-level="1.2.2" data-path="FPCI.html"><a href="FPCI.html#average-treatment-effect-on-the-treated"><i class="fa fa-check"></i><b>1.2.2</b> Average treatment effect on the treated</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="FPCI.html"><a href="FPCI.html#fundamental-problem-of-causal-inference"><i class="fa fa-check"></i><b>1.3</b> Fundamental problem of causal inference</a></li>
<li class="chapter" data-level="1.4" data-path="FPCI.html"><a href="FPCI.html#intuitive-estimators-confounding-factors-and-selection-bias"><i class="fa fa-check"></i><b>1.4</b> Intuitive estimators, confounding factors and selection bias</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="FPCI.html"><a href="FPCI.html#withwithout-comparison-selection-bias-and-cross-sectional-confounders"><i class="fa fa-check"></i><b>1.4.1</b> With/Without comparison, selection bias and cross-sectional confounders</a></li>
<li class="chapter" data-level="1.4.2" data-path="FPCI.html"><a href="FPCI.html#the-beforeafter-comparison-temporal-confounders-and-time-trend-bias"><i class="fa fa-check"></i><b>1.4.2</b> The before/after comparison, temporal confounders and time trend bias</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="FPSI.html"><a href="FPSI.html"><i class="fa fa-check"></i><b>2</b> Fundamental Problem of Statistical Inference</a>
<ul>
<li class="chapter" data-level="2.1" data-path="FPSI.html"><a href="FPSI.html#sec:sampnoise"><i class="fa fa-check"></i><b>2.1</b> What is sampling noise? Definition and illustration</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="FPSI.html"><a href="FPSI.html#sec:definitionnoise"><i class="fa fa-check"></i><b>2.1.1</b> Sampling noise, a definition</a></li>
<li class="chapter" data-level="2.1.2" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisepop"><i class="fa fa-check"></i><b>2.1.2</b> Sampling noise for the population treatment effect</a></li>
<li class="chapter" data-level="2.1.3" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisesamp"><i class="fa fa-check"></i><b>2.1.3</b> Sampling noise for the sample treatment effect</a></li>
<li class="chapter" data-level="2.1.4" data-path="FPSI.html"><a href="FPSI.html#sec:confinterv"><i class="fa fa-check"></i><b>2.1.4</b> Building confidence intervals from estimates of sampling noise</a></li>
<li class="chapter" data-level="2.1.5" data-path="FPSI.html"><a href="FPSI.html#reporting-sampling-noise-a-proposal"><i class="fa fa-check"></i><b>2.1.5</b> Reporting sampling noise: a proposal</a></li>
<li class="chapter" data-level="2.1.6" data-path="FPSI.html"><a href="FPSI.html#sec:effectsize"><i class="fa fa-check"></i><b>2.1.6</b> Using effect sizes to normalize the reporting of treatment effects and their precision</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="FPSI.html"><a href="FPSI.html#sec:estimsampnoise"><i class="fa fa-check"></i><b>2.2</b> Estimating sampling noise</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="FPSI.html"><a href="FPSI.html#sec:assumptions"><i class="fa fa-check"></i><b>2.2.1</b> Assumptions</a></li>
<li class="chapter" data-level="2.2.2" data-path="FPSI.html"><a href="FPSI.html#sec:cheb"><i class="fa fa-check"></i><b>2.2.2</b> Using Chebyshev’s inequality</a></li>
<li class="chapter" data-level="2.2.3" data-path="FPSI.html"><a href="FPSI.html#sec:CLT"><i class="fa fa-check"></i><b>2.2.3</b> Using the Central Limit Theorem</a></li>
<li class="chapter" data-level="2.2.4" data-path="FPSI.html"><a href="FPSI.html#sec:resamp"><i class="fa fa-check"></i><b>2.2.4</b> Using resampling methods</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Methods of Causal Inference</b></span></li>
<li class="chapter" data-level="3" data-path="RCT.html"><a href="RCT.html"><i class="fa fa-check"></i><b>3</b> Randomized Controlled Trials</a>
<ul>
<li class="chapter" data-level="3.1" data-path="RCT.html"><a href="RCT.html#sec:design1"><i class="fa fa-check"></i><b>3.1</b> Brute Force Design</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="RCT.html"><a href="RCT.html#identification"><i class="fa fa-check"></i><b>3.1.1</b> Identification</a></li>
<li class="chapter" data-level="3.1.2" data-path="RCT.html"><a href="RCT.html#estimating-ate"><i class="fa fa-check"></i><b>3.1.2</b> Estimating ATE</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="RCT.html"><a href="RCT.html#sec:design2"><i class="fa fa-check"></i><b>3.2</b> Self-Selection design</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="RCT.html"><a href="RCT.html#identification-1"><i class="fa fa-check"></i><b>3.2.1</b> Identification</a></li>
<li class="chapter" data-level="3.2.2" data-path="RCT.html"><a href="RCT.html#estimating-tt"><i class="fa fa-check"></i><b>3.2.2</b> Estimating TT</a></li>
<li class="chapter" data-level="3.2.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-1"><i class="fa fa-check"></i><b>3.2.3</b> Estimating Sampling Noise</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="RCT.html"><a href="RCT.html#sec:design3"><i class="fa fa-check"></i><b>3.3</b> Eligibility design</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="RCT.html"><a href="RCT.html#identification-2"><i class="fa fa-check"></i><b>3.3.1</b> Identification</a></li>
<li class="chapter" data-level="3.3.2" data-path="RCT.html"><a href="RCT.html#estimating-the-ite-and-the-tt"><i class="fa fa-check"></i><b>3.3.2</b> Estimating the ITE and the TT</a></li>
<li class="chapter" data-level="3.3.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-2"><i class="fa fa-check"></i><b>3.3.3</b> Estimating sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="RCT.html"><a href="RCT.html#sec:design4"><i class="fa fa-check"></i><b>3.4</b> Encouragement Design</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="RCT.html"><a href="RCT.html#identification-3"><i class="fa fa-check"></i><b>3.4.1</b> Identification</a></li>
<li class="chapter" data-level="3.4.2" data-path="RCT.html"><a href="RCT.html#estimating-the-local-average-treatment-effect-and-the-intention-to-treat-effect"><i class="fa fa-check"></i><b>3.4.2</b> Estimating the Local Average Treatment Effect and the Intention to Treat Effect</a></li>
<li class="chapter" data-level="3.4.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-3"><i class="fa fa-check"></i><b>3.4.3</b> Estimating sampling noise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="NE.html"><a href="NE.html"><i class="fa fa-check"></i><b>4</b> Natural Experiments</a>
<ul>
<li class="chapter" data-level="4.1" data-path="NE.html"><a href="NE.html#instrumental-variables"><i class="fa fa-check"></i><b>4.1</b> Instrumental Variables</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="NE.html"><a href="NE.html#an-example-where-monotonicity-does-not-hold"><i class="fa fa-check"></i><b>4.1.1</b> An example where Monotonicity does not hold</a></li>
<li class="chapter" data-level="4.1.2" data-path="NE.html"><a href="NE.html#identification-4"><i class="fa fa-check"></i><b>4.1.2</b> Identification</a></li>
<li class="chapter" data-level="4.1.3" data-path="NE.html"><a href="NE.html#estimation"><i class="fa fa-check"></i><b>4.1.3</b> Estimation</a></li>
<li class="chapter" data-level="4.1.4" data-path="NE.html"><a href="NE.html#estimation-of-sampling-noise"><i class="fa fa-check"></i><b>4.1.4</b> Estimation of sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="NE.html"><a href="NE.html#regression-discontinuity-designs"><i class="fa fa-check"></i><b>4.2</b> Regression Discontinuity Designs</a></li>
<li class="chapter" data-level="4.3" data-path="NE.html"><a href="NE.html#difference-in-differences"><i class="fa fa-check"></i><b>4.3</b> Difference In Differences</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sec:OM.html"><a href="sec:OM.html"><i class="fa fa-check"></i><b>5</b> Observational Methods</a></li>
<li class="chapter" data-level="6" data-path="sec:threats.html"><a href="sec:threats.html"><i class="fa fa-check"></i><b>6</b> Threats to the validity of Causal Inference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sec:threats.html"><a href="sec:threats.html#threats-to-internal-validity"><i class="fa fa-check"></i><b>6.1</b> Threats to internal validity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="sec:threats.html"><a href="sec:threats.html#survey-bias"><i class="fa fa-check"></i><b>6.1.1</b> Survey bias</a></li>
<li class="chapter" data-level="6.1.2" data-path="sec:threats.html"><a href="sec:threats.html#experimenter-bias"><i class="fa fa-check"></i><b>6.1.2</b> Experimenter bias</a></li>
<li class="chapter" data-level="6.1.3" data-path="sec:threats.html"><a href="sec:threats.html#substitution-bias"><i class="fa fa-check"></i><b>6.1.3</b> Substitution bias</a></li>
<li class="chapter" data-level="6.1.4" data-path="sec:threats.html"><a href="sec:threats.html#diffusion-bias"><i class="fa fa-check"></i><b>6.1.4</b> Diffusion bias</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="sec:threats.html"><a href="sec:threats.html#threats-to-the-measurement-of-precision"><i class="fa fa-check"></i><b>6.2</b> Threats to the measurement of precision</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="sec:threats.html"><a href="sec:threats.html#insufficient-precision"><i class="fa fa-check"></i><b>6.2.1</b> Insufficient precision</a></li>
<li class="chapter" data-level="6.2.2" data-path="sec:threats.html"><a href="sec:threats.html#clustering"><i class="fa fa-check"></i><b>6.2.2</b> Clustering</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="sec:threats.html"><a href="sec:threats.html#threats-to-external-validity"><i class="fa fa-check"></i><b>6.3</b> Threats to external validity</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="sec:threats.html"><a href="sec:threats.html#randomization-bias"><i class="fa fa-check"></i><b>6.3.1</b> Randomization bias</a></li>
<li class="chapter" data-level="6.3.2" data-path="sec:threats.html"><a href="sec:threats.html#equilibrium-effects"><i class="fa fa-check"></i><b>6.3.2</b> Equilibrium effects</a></li>
<li class="chapter" data-level="6.3.3" data-path="sec:threats.html"><a href="sec:threats.html#context-effects"><i class="fa fa-check"></i><b>6.3.3</b> Context effects</a></li>
<li class="chapter" data-level="6.3.4" data-path="sec:threats.html"><a href="sec:threats.html#site-selection-bias"><i class="fa fa-check"></i><b>6.3.4</b> Site selection bias</a></li>
<li class="chapter" data-level="6.3.5" data-path="sec:threats.html"><a href="sec:threats.html#publication-bias"><i class="fa fa-check"></i><b>6.3.5</b> Publication bias</a></li>
<li class="chapter" data-level="6.3.6" data-path="sec:threats.html"><a href="sec:threats.html#ethical-and-political-issues"><i class="fa fa-check"></i><b>6.3.6</b> Ethical and political issues</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Additional Topics</b></span></li>
<li class="chapter" data-level="7" data-path="Power.html"><a href="Power.html"><i class="fa fa-check"></i><b>7</b> Power Analysis</a></li>
<li class="chapter" data-level="8" data-path="Placebo.html"><a href="Placebo.html"><i class="fa fa-check"></i><b>8</b> Placebo Tests</a></li>
<li class="chapter" data-level="9" data-path="cluster.html"><a href="cluster.html"><i class="fa fa-check"></i><b>9</b> Clustering</a></li>
<li class="chapter" data-level="10" data-path="LaLonde.html"><a href="LaLonde.html"><i class="fa fa-check"></i><b>10</b> LaLonde Tests</a></li>
<li class="chapter" data-level="11" data-path="Diffusion.html"><a href="Diffusion.html"><i class="fa fa-check"></i><b>11</b> Diffusion effects</a></li>
<li class="chapter" data-level="12" data-path="Distribution.html"><a href="Distribution.html"><i class="fa fa-check"></i><b>12</b> Distributional effects</a></li>
<li class="chapter" data-level="13" data-path="sec:meta.html"><a href="sec:meta.html"><i class="fa fa-check"></i><b>13</b> Meta-analysis and Publication Bias</a>
<ul>
<li class="chapter" data-level="13.1" data-path="sec:meta.html"><a href="sec:meta.html#meta-analysis"><i class="fa fa-check"></i><b>13.1</b> Meta-analysis</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="sec:meta.html"><a href="sec:meta.html#basic-setting"><i class="fa fa-check"></i><b>13.1.1</b> Basic setting</a></li>
<li class="chapter" data-level="13.1.2" data-path="sec:meta.html"><a href="sec:meta.html#why-vote-counting-does-not-work"><i class="fa fa-check"></i><b>13.1.2</b> Why vote-counting does not work</a></li>
<li class="chapter" data-level="13.1.3" data-path="sec:meta.html"><a href="sec:meta.html#MetaWA"><i class="fa fa-check"></i><b>13.1.3</b> Meta-analysis when treatment effects are homogeneous: the fixed effects approach</a></li>
<li class="chapter" data-level="13.1.4" data-path="sec:meta.html"><a href="sec:meta.html#meta-analysis-when-treatment-effects-are-heterogeneous-the-random-effects-approach"><i class="fa fa-check"></i><b>13.1.4</b> Meta-analysis when treatment effects are heterogeneous: the random effects approach</a></li>
<li class="chapter" data-level="13.1.5" data-path="sec:meta.html"><a href="sec:meta.html#meta-regression"><i class="fa fa-check"></i><b>13.1.5</b> Meta-regression</a></li>
<li class="chapter" data-level="13.1.6" data-path="sec:meta.html"><a href="sec:meta.html#constantly-updated-meta-analysis"><i class="fa fa-check"></i><b>13.1.6</b> Constantly updated meta-analysis</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="sec:meta.html"><a href="sec:meta.html#publication-bias-and-site-selection-bias"><i class="fa fa-check"></i><b>13.2</b> Publication bias and site selection bias</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="sec:meta.html"><a href="sec:meta.html#sources-of-publication-bias-and-of-site-selection-bias-and-questionable-research-practices"><i class="fa fa-check"></i><b>13.2.1</b> Sources of publication bias and of site selection bias and Questionable Research Practices</a></li>
<li class="chapter" data-level="13.2.2" data-path="sec:meta.html"><a href="sec:meta.html#detection-of-and-correction-for-publication-bias"><i class="fa fa-check"></i><b>13.2.2</b> Detection of and correction for publication bias</a></li>
<li class="chapter" data-level="13.2.3" data-path="sec:meta.html"><a href="sec:meta.html#getting-rid-of-publication-bias-registered-reports-and-pre-analysis-plans"><i class="fa fa-check"></i><b>13.2.3</b> Getting rid of publication bias: registered reports and pre-analysis plans</a></li>
<li class="chapter" data-level="13.2.4" data-path="sec:meta.html"><a href="sec:meta.html#detection-of-and-correction-for-site-selection-bias"><i class="fa fa-check"></i><b>13.2.4</b> Detection of and correction for site selection bias</a></li>
<li class="chapter" data-level="13.2.5" data-path="sec:meta.html"><a href="sec:meta.html#vote-counting-and-publication-bias"><i class="fa fa-check"></i><b>13.2.5</b> Vote counting and publication bias</a></li>
<li class="chapter" data-level="13.2.6" data-path="sec:meta.html"><a href="sec:meta.html#the-value-of-a-statistically-significant-result"><i class="fa fa-check"></i><b>13.2.6</b> The value of a statistically significant result</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="Bounds.html"><a href="Bounds.html"><i class="fa fa-check"></i><b>14</b> Bounds</a></li>
<li class="chapter" data-level="15" data-path="mediation-analysis.html"><a href="mediation-analysis.html"><i class="fa fa-check"></i><b>15</b> Mediation Analysis</a>
<ul>
<li class="chapter" data-level="15.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-a-framework"><i class="fa fa-check"></i><b>15.1</b> Mediation analysis: a framework</a></li>
<li class="chapter" data-level="15.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#the-fundamental-problem-of-mediation-analysis"><i class="fa fa-check"></i><b>15.2</b> The Fundamental Problem of Mediation Analysis</a></li>
<li class="chapter" data-level="15.3" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-under-unconfoundedness"><i class="fa fa-check"></i><b>15.3</b> Mediation analysis under unconfoundedness</a></li>
<li class="chapter" data-level="15.4" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-panel-data"><i class="fa fa-check"></i><b>15.4</b> Mediation analysis with panel data</a></li>
<li class="chapter" data-level="15.5" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-instruments"><i class="fa fa-check"></i><b>15.5</b> Mediation analysis with instruments</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="proofs.html"><a href="proofs.html"><i class="fa fa-check"></i><b>A</b> Proofs</a>
<ul>
<li class="chapter" data-level="A.1" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-reffpsi"><i class="fa fa-check"></i><b>A.1</b> Proofs of results in Chapter @ref(FPSI)</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="proofs.html"><a href="proofs.html#proofcheb"><i class="fa fa-check"></i><b>A.1.1</b> Proof of Theorem @ref(thm:uppsampnoise)</a></li>
<li class="chapter" data-level="A.1.2" data-path="proofs.html"><a href="proofs.html#proofCLT"><i class="fa fa-check"></i><b>A.1.2</b> Proof of Theorem @ref(thm:asympnoiseWW)</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refrct"><i class="fa fa-check"></i><b>A.2</b> Proofs of results in Chapter @ref(RCT)</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="proofs.html"><a href="proofs.html#proofIdentLATE"><i class="fa fa-check"></i><b>A.2.1</b> Proof of Theorem @ref(thm:IdentLATE)</a></li>
<li class="chapter" data-level="A.2.2" data-path="proofs.html"><a href="proofs.html#proofWaldIV"><i class="fa fa-check"></i><b>A.2.2</b> Proof of Theorem @ref(thm:WaldIV)</a></li>
<li class="chapter" data-level="A.2.3" data-path="proofs.html"><a href="proofs.html#ProofAsymWald"><i class="fa fa-check"></i><b>A.2.3</b> Proof of Theorem @ref(thm:asymWald)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Tools for Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="NE" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Natural Experiments</h1>
<p>Natural Experiments are situations due to the natural course of events that approximate the conditions of a randomized controlled trial.
In the economists’ toolkit, we generally make a distinction between:</p>
<ol style="list-style-type: decimal">
<li>Instrumental variables (IV), that rely on finding a plausibly exogeneous source of variation in treatment intake.</li>
<li>Regression Discontinuity Designs (RDD), that exploit a discontinuity in the eligibility to the treatment.</li>
<li>Difference In Differences (DID), that make use of the differential exposure of some groups to the treatment of interest over time.</li>
</ol>

<div class="remark">
 <span class="remark"><em>Remark. </em></span> The term <em>Natural Experiments</em> seems to be mostly used by economists.
It dates back to Haavelmo (1944)’s paper on the Probability Approach to Econometrics, where he makes a distinction between the experiments we’d like to make as social scientists and the experiments that Nature provides us with, that are in general a subset of the experiments we’d like to make.
This raises the question of our ability to <strong>identify</strong> the relationships of interest from the variation that is present in the data, a traditional problem in classical econometrics that has echoes in treatment effect estimation, where we also try to <em>identify</em> treatment effect parameters.
At the time of Haavelmo, and until the beginning of the 1990s, there was no real discussion of the plausibility of the <em>identifying assumptions</em> (or restrictions) required for identification of certain relations, outside of a discussion of their theoretical plausiblility.
With the credibility revolution brought about by Angrist (1990)’s paper and summarized in Angrist and Krueger (2001)’s review paper, the notion of natural experiment made a come back, with the idea that we might be able to look for specific set of events produced by Nature that more credibly identify a relationship of interest, <em>i.e.</em> that closely approximate true experimental conditions.
</div>

<div class="remark">
 <span class="remark"><em>Remark. </em></span> Outside of economics, Natural Experiments have also flourished, but without the term, and were compiled in the early textbook on research methods by Campbell (1966).
Both Difference In Differences and Regression Discontinuity Designs have been actually developed outside of economics, mostly in education research.
Instrumental Variables have had a separate history in economics and in genetics, were it is called the method of path coefficients.
</div>
<div id="instrumental-variables" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Instrumental Variables</h2>
<p>Instrumental Variables rely on finding a plausibly exogeneous source of variation in treatment intake.
In the simple case of a binary instrument, the identification and estimation parts are actually identical to Encouragements designs in RCTs, that we have already studied in Section <a href="RCT.html#sec:design4">3.4</a>.
As a consequence, unless we make very strong assumptions, an IV design is going to recover a Local Average Treatment Effect.
Our classical assumptions are going to show up again: Independence, Exclusion Restriction, Monotonicity.</p>

<div class="remark">
 <span class="remark"><em>Remark. </em></span> Examples of Instrumental Variables are:
</div>
<ul>
<li>Distance to college or to school for studying the impact of college or school enrollement on education, earnings and other outcomes.</li>
<li>Random draft lottery number for investigating the impact of military experience on earnings and other outcomes.</li>
<li>Randomized encouragement to participate in order to study the impact of a program.</li>
</ul>

<div class="remark">
<p> <span class="remark"><em>Remark. </em></span> The crucial part of an IV design is to justify the credibility of the exclusion restriction and independence assumptions.
It is in general very difficult to justify these assumptions, especially the exclusion restriction assumption.
In the examples above, one could argue that schools or colleges might be built where they are necessary, i.e. close to destitute populations, or, on the contrary, that they are built far from difficult neighbourhoods.
As soon as distance to school becomes correlated with other determinants of schooling, such as parental income and education, the independence assumption is violated.</p>
<p>Even if school placement is truly independent of potential education and earnings outcomes at first, parents, by choosing where to live, will sort themselves such as the parents that pay more attention to education end up located closer to school.
As a consequence, the independence assumption might be violated again.</p>
Even when the instrument is truly random, such as a draft lottery number, and thus the independence assumption seems fine, the instrument may directly affect the outcomes by other ways than the treatment of interest.
For example, receiving a low draft lottery number makes one more likely to be drafted.
In response, one might decide to increase their length of stay in college in order to use the waiver for the draft reserved for students.
If receiving a low draft lottery number increases the number of years of education, and in turn subsequent earnings, then the exclusion restriction assumption is violated.
</div>
<p>In this section, I’m going to denote <span class="math inline">\(Z_i\)</span> a binary instrument that can either take value <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>.
In general, we try to reserve the value <span class="math inline">\(1\)</span> for the instrument value that increases participation in the treatment of interest.
In our examples, that would be when for example, the distance to college is low, the draft lottery number is low, or someone receives an encouragement to enter a program.</p>
<div id="an-example-where-monotonicity-does-not-hold" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> An example where Monotonicity does not hold</h3>
<p>Since Monotonicity is going to play such a particular role, and since we have already explored this assumption a little in Chapter <a href="RCT.html#RCT">3</a>, I am going to use as an example a model where the Monotonicity assumption actually does not hold.
It will, I hope, help us understand better the way Monotonicity works and how it interacts with the other assumptions.
The key component of the model that makes Monotonicity necessary is the fact that treatment effects are heterogeneous and correlated with participation in the treatment.
We’ll see later that Monotonicity is unnecessary when treatment effects are orthogonal to take up.</p>

<div class="example">
<span id="exm:unnamed-chunk-139" class="example"><strong>Example 4.1  </strong></span>Let’s see how we can generate a model without Monotonicity:
</div>
<p><span class="math display">\[\begin{align*}
y_i^1 &amp; = y_i^0+\bar{\alpha}+\theta\mu_i+\eta_i \\
y_i^0 &amp; = \mu_i+\delta+U_i^0 \\
U_i^0 &amp; = \rho U_i^B+\epsilon_i \\
y_i^B &amp; =\mu_i+U_i^B \\
U_i^B &amp; \sim\mathcal{N}(0,\sigma^2_{U}) \\
D_i   &amp; = \uns{y_i^B+\kappa_i Z_i + V_i\leq\bar{y}} \\
\kappa_i &amp; = 
\begin{cases}
-\bar{\kappa} &amp; \text{ if } \xi_i = 1 \\
\underline{\kappa} &amp; \text{ if } \xi_i = 0
\end{cases} \\
\xi &amp; \sim\mathcal{B}(p_{\xi}) \\
V_i   &amp; = \gamma(\mu_i-\bar{\mu}) + \omega_i \\
(\eta_i,\omega_i) &amp; \sim\mathcal{N}(0,0,\sigma^2_{\eta},\sigma^2_{\omega},\rho_{\eta,\omega}) \\
Z_i   &amp; \sim\mathcal{B}(p_Z) \\
Z_i   &amp; \Ind (y_i^0,y_i^1,y_i^B,V_i) \\
\xi_i &amp; \Ind (y_i^0,y_i^1,y_i^B,V_i,Z_i)
\end{align*}\]</span></p>
<p>The key component of the model that generates a failure of Monotonicity is the coefficient <span class="math inline">\(\kappa_i\)</span>, that determines how individuals’ participation into the program reacts to the instrument <span class="math inline">\(Z_i\)</span>.
<span class="math inline">\(\kappa_i\)</span> is a coefficient whose value varies accross the population.
In my simplified model, <span class="math inline">\(\kappa_i\)</span> can take only two values, <span class="math inline">\(-\bar{\kappa}\)</span> or <span class="math inline">\(\underline{\kappa}\)</span>.
When <span class="math inline">\(-\bar{\kappa}\)</span> and <span class="math inline">\(\underline{\kappa}\)</span> have opposite signs (let’s say <span class="math inline">\(-\bar{\kappa}&lt;0\)</span> and <span class="math inline">\(\underline{\kappa}&gt;0\)</span>), then individuals with <span class="math inline">\(\kappa_i=-\bar{\kappa}\)</span> are going to be more likely to enter the program when they receive an encouragement (when <span class="math inline">\(Z_i=1\)</span>) while individuals with <span class="math inline">\(\kappa_i=\underline{\kappa}\)</span> will be less likely to enter the program when <span class="math inline">\(Z_i=1\)</span>.
When <span class="math inline">\(-\bar{\kappa}\)</span> and <span class="math inline">\(\underline{\kappa}\)</span> have different signs, we have four types of reactions when the instrumental variable moves from <span class="math inline">\(Z_i=0\)</span> to <span class="math inline">\(Z_i=1\)</span>, holding everything else constant.
These four types of reactions define four types of individuals:</p>
<ul>
<li><strong>Always takers</strong> (<span class="math inline">\(T_i=a\)</span>): individuals that participate in the program both when <span class="math inline">\(Z_i=0\)</span> and <span class="math inline">\(Z_i=1\)</span>.</li>
<li><strong>Never takers</strong> (<span class="math inline">\(T_i=n\)</span>): individuals that do not participate in the program both when <span class="math inline">\(Z_i=0\)</span> and <span class="math inline">\(Z_i=1\)</span>.</li>
<li><strong>Compliers</strong> (<span class="math inline">\(T_i=c\)</span>): individuals that do not participate in the program when <span class="math inline">\(Z_i=0\)</span> but that participate in the program when <span class="math inline">\(Z_i=1\)</span> .</li>
<li><strong>Defiers</strong> (<span class="math inline">\(T_i=d\)</span>): individuals that participate in the program when <span class="math inline">\(Z_i=0\)</span> but that do not participate in the program when <span class="math inline">\(Z_i=1\)</span> .</li>
</ul>
<p>In our model, these four types are a function of <span class="math inline">\(y_i^B+V_i\)</span> and <span class="math inline">\(\kappa_i\)</span>.
In order to see this let’s define, as in Section <a href="RCT.html#sec:design4">3.4</a>, <span class="math inline">\(D^z_i\)</span> the participation decision of individual <span class="math inline">\(i\)</span> when the instrument is exogenously set to <span class="math inline">\(Z_i=z\)</span>, with <span class="math inline">\(z\in\left\{0,1\right\}\)</span>.
When <span class="math inline">\(\kappa_i=-\bar{\kappa}&lt;0\)</span>, we have three types of reactions to the instrument.
It turns out that each of type can be defined by where <span class="math inline">\(y_i^B+V_i\)</span> lies with respect to a series of thresholds:</p>
<ul>
<li><strong>Always takers</strong> (<span class="math inline">\(T_i=a\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B-\bar{\kappa} + V_i\leq\bar{y}}=1\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=1\)</span>, so that they actually are such that: <span class="math inline">\(y_i^B+V_i\leq\bar{y}\)</span>.
This is because <span class="math inline">\(y_i^B+V_i\leq\bar{y} \Rightarrow y_i^B+V_i\leq\bar{y}+\bar{\kappa}\)</span>, when <span class="math inline">\(\bar{\kappa}&gt;0\)</span>.</li>
<li><strong>Never takers</strong> (<span class="math inline">\(T_i=n\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B-\bar{\kappa} + V_i\leq\bar{y}}=0\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=0\)</span>, so that they actually are such that: <span class="math inline">\(y_i^B+V_i&gt;\bar{y}+\bar{\kappa}\)</span>.
This is because <span class="math inline">\(y_i^B+V_i&gt;\bar{y}+\bar{\kappa} \Rightarrow y_i^B+V_i&gt;\bar{y}\)</span>, when <span class="math inline">\(\bar{\kappa}&gt;0\)</span>.</li>
<li><strong>Compliers</strong> (<span class="math inline">\(T_i=c\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B-\bar{\kappa} + V_i\leq\bar{y}}=1\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=0\)</span>, so that they actually are such that: <span class="math inline">\(\bar{y}&lt;y_i^B+V_i\leq\bar{y}+\bar{\kappa}\)</span>.</li>
</ul>
<p>When <span class="math inline">\(\kappa_i=\underline{\kappa}&gt;0\)</span>, we have three types defined by where <span class="math inline">\(V_i\)</span> lies with respect to a series of thresholds:</p>
<ul>
<li><strong>Always takers</strong> (<span class="math inline">\(T_i=a\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B+\underline{\kappa} + V_i\leq\bar{y}}=1\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=1\)</span>, so that they actually are such that: <span class="math inline">\(y_i^B+V_i\leq\bar{y}-\underline{\kappa}\)</span>.
This is because <span class="math inline">\(y_i^B+V_i\leq\bar{y}-\underline{\kappa} \Rightarrow y_i^B+V_i\leq\bar{y}\)</span>, when <span class="math inline">\(\underline{\kappa}&gt;0\)</span>.</li>
<li><strong>Never takers</strong> (<span class="math inline">\(T_i=n\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B-\bar{\kappa} + V_i\leq\bar{y}}=0\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=0\)</span>, so that they actually are such that: <span class="math inline">\(y_i^B+V_i&gt;\bar{y}\)</span>.
This is because <span class="math inline">\(y_i^B+V_i&gt;\bar{y} \Rightarrow y_i^B+V_i\leq\bar{y}-\underline{\kappa}\)</span>, when <span class="math inline">\(\underline{\kappa}&gt;0\)</span>.</li>
<li><strong>Defiers</strong> (<span class="math inline">\(T_i=d\)</span>) are such that <span class="math inline">\(D^1_i=\uns{y_i^B+\underline{\kappa} + V_i\leq\bar{y}}=0\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=1\)</span>, so that they actually are such that: <span class="math inline">\(\bar{y}-\underline{\kappa}&lt;V_i+y_i^B\leq\bar{y}\)</span>.</li>
</ul>
<p>Let’s visualize how this works in a plot.
Before that, let’s generate some data according to this process.
For that, let’s choose values for the new parameters.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="NE.html#cb127-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">7.98</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.5</span>,<span class="fl">0.9</span>,<span class="fl">0.28</span>,<span class="dv">0</span>)</span>
<span id="cb127-2"><a href="NE.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;theta&quot;</span>,<span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,<span class="st">&quot;delta&quot;</span>,<span class="st">&quot;baralpha&quot;</span>,<span class="st">&quot;gamma&quot;</span>,<span class="st">&quot;baryB&quot;</span>,<span class="st">&quot;pZ&quot;</span>,<span class="st">&quot;barkappa&quot;</span>,<span class="st">&quot;underbarkappa&quot;</span>,<span class="st">&quot;pxi&quot;</span>,<span class="st">&quot;sigma2omega&quot;</span>,<span class="st">&quot;rhoetaomega&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="NE.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb128-2"><a href="NE.html#cb128-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb128-3"><a href="NE.html#cb128-3" aria-hidden="true" tabindex="-1"></a>cov.eta.omega <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(param[<span class="st">&quot;sigma2eta&quot;</span>],param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;sigma2omega&quot;</span>]),<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb128-4"><a href="NE.html#cb128-4" aria-hidden="true" tabindex="-1"></a>eta.omega <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">mvrnorm</span>(N,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),cov.eta.omega))</span>
<span id="cb128-5"><a href="NE.html#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(eta.omega) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;eta&#39;</span>,<span class="st">&#39;omega&#39;</span>)</span>
<span id="cb128-6"><a href="NE.html#cb128-6" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))</span>
<span id="cb128-7"><a href="NE.html#cb128-7" aria-hidden="true" tabindex="-1"></a>UB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb128-8"><a href="NE.html#cb128-8" aria-hidden="true" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UB </span>
<span id="cb128-9"><a href="NE.html#cb128-9" aria-hidden="true" tabindex="-1"></a>YB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yB)</span>
<span id="cb128-10"><a href="NE.html#cb128-10" aria-hidden="true" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb128-11"><a href="NE.html#cb128-11" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,param[<span class="st">&quot;pZ&quot;</span>])</span>
<span id="cb128-12"><a href="NE.html#cb128-12" aria-hidden="true" tabindex="-1"></a>xi <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,param[<span class="st">&quot;pxi&quot;</span>]) </span>
<span id="cb128-13"><a href="NE.html#cb128-13" aria-hidden="true" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(xi<span class="sc">==</span><span class="dv">1</span>,<span class="sc">-</span>param[<span class="st">&quot;barkappa&quot;</span>],param[<span class="st">&quot;underbarkappa&quot;</span>])</span>
<span id="cb128-14"><a href="NE.html#cb128-14" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> param[<span class="st">&quot;gamma&quot;</span>]<span class="sc">*</span>(mu<span class="sc">-</span>param[<span class="st">&quot;barmu&quot;</span>])<span class="sc">+</span>eta.omega<span class="sc">$</span>omega</span>
<span id="cb128-15"><a href="NE.html#cb128-15" aria-hidden="true" tabindex="-1"></a>Ds[yB<span class="sc">+</span>kappa<span class="sc">*</span>Z<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb128-16"><a href="NE.html#cb128-16" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb128-17"><a href="NE.html#cb128-17" aria-hidden="true" tabindex="-1"></a>U0 <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilon</span>
<span id="cb128-18"><a href="NE.html#cb128-18" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0 <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb128-19"><a href="NE.html#cb128-19" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta.omega<span class="sc">$</span>eta</span>
<span id="cb128-20"><a href="NE.html#cb128-20" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y0<span class="sc">+</span>alpha</span>
<span id="cb128-21"><a href="NE.html#cb128-21" aria-hidden="true" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y0)</span>
<span id="cb128-22"><a href="NE.html#cb128-22" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y1)</span>
<span id="cb128-23"><a href="NE.html#cb128-23" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y1<span class="sc">*</span>Ds<span class="sc">+</span>y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span>
<span id="cb128-24"><a href="NE.html#cb128-24" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y1<span class="sc">*</span>Ds<span class="sc">+</span>Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span></code></pre></div>
<p>We can now define the types variable <span class="math inline">\(T_i\)</span>:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="NE.html#cb129-1" aria-hidden="true" tabindex="-1"></a>D1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(yB<span class="sc">+</span>kappa<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-2"><a href="NE.html#cb129-2" aria-hidden="true" tabindex="-1"></a>D0 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(yB<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-3"><a href="NE.html#cb129-3" aria-hidden="true" tabindex="-1"></a>AT <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-4"><a href="NE.html#cb129-4" aria-hidden="true" tabindex="-1"></a>NT <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-5"><a href="NE.html#cb129-5" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-6"><a href="NE.html#cb129-6" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb129-7"><a href="NE.html#cb129-7" aria-hidden="true" tabindex="-1"></a>Type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(AT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;a&#39;</span>,</span>
<span id="cb129-8"><a href="NE.html#cb129-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ifelse</span>(NT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;n&#39;</span>,</span>
<span id="cb129-9"><a href="NE.html#cb129-9" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">ifelse</span>(C<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;c&#39;</span>,</span>
<span id="cb129-10"><a href="NE.html#cb129-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">ifelse</span>(D<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;d&#39;</span>,<span class="st">&quot;&quot;</span>))))</span>
<span id="cb129-11"><a href="NE.html#cb129-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-12"><a href="NE.html#cb129-12" aria-hidden="true" tabindex="-1"></a>data.non.mono <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(Type,C,NT,AT,D1,D0,Y,y,Y1,Y0,y0,y1,yB,alpha,U0,eta.omega<span class="sc">$</span>eta,epsilon,Ds,kappa,xi,Z,mu,UB))</span></code></pre></div>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="NE.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplot(data.non.mono, aes(x=V, y=yB),color(as.factor(Type))) +</span></span>
<span id="cb130-2"><a href="NE.html#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    geom_point(shape=1)+</span></span>
<span id="cb130-3"><a href="NE.html#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    facet_grid(.~ as.factor(kappa))</span></span>
<span id="cb130-4"><a href="NE.html#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="NE.html#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yB[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]]<span class="sc">+</span>V[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],y[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">xlab=</span><span class="st">&#39;yB+V&#39;</span>,<span class="at">ylab=</span><span class="st">&quot;Outcomes&quot;</span>)</span>
<span id="cb130-6"><a href="NE.html#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]]<span class="sc">+</span>V[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],y[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb130-7"><a href="NE.html#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]]<span class="sc">+</span>V[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],y[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-8"><a href="NE.html#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]]<span class="sc">+</span>V[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],y[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==-</span>param[<span class="st">&quot;barkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb130-9"><a href="NE.html#cb130-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-10"><a href="NE.html#cb130-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>],<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-11"><a href="NE.html#cb130-11" aria-hidden="true" tabindex="-1"></a><span class="co">#abline(v=log(param[&quot;barY&quot;])-param[&#39;underbarkappa&#39;],col=&#39;red&#39;)</span></span>
<span id="cb130-12"><a href="NE.html#cb130-12" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>]),<span class="at">y=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>)),<span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>)<span class="sc">+</span><span class="fu">bar</span>(kappa))),<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;red&#39;</span>),<span class="at">lty=</span><span class="fu">c</span>(<span class="st">&#39;solid&#39;</span>,<span class="st">&#39;solid&#39;</span>))</span>
<span id="cb130-13"><a href="NE.html#cb130-13" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">5</span>,<span class="fl">10.5</span>,<span class="fu">c</span>(<span class="st">&#39;AT&#39;</span>,<span class="st">&#39;NT&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>),<span class="at">pch=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;black&#39;</span>,<span class="st">&#39;blue&#39;</span>,<span class="st">&#39;red&#39;</span>,<span class="st">&#39;green&#39;</span>),<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb130-14"><a href="NE.html#cb130-14" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">expression</span>(<span class="at">kappa=</span><span class="fu">bar</span>(kappa)))</span>
<span id="cb130-15"><a href="NE.html#cb130-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-16"><a href="NE.html#cb130-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yB[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]]<span class="sc">+</span>V[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],y[AT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">xlab=</span><span class="st">&#39;yB+V&#39;</span>,<span class="at">ylab=</span><span class="st">&quot;Outcomes&quot;</span>)</span>
<span id="cb130-17"><a href="NE.html#cb130-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]]<span class="sc">+</span>V[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],y[NT<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb130-18"><a href="NE.html#cb130-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]]<span class="sc">+</span>V[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],y[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-19"><a href="NE.html#cb130-19" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]]<span class="sc">+</span>V[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],y[D<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> kappa<span class="sc">==</span>param[<span class="st">&quot;underbarkappa&quot;</span>]],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb130-20"><a href="NE.html#cb130-20" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-21"><a href="NE.html#cb130-21" aria-hidden="true" tabindex="-1"></a><span class="co">#abline(v=log(param[&quot;barY&quot;])-param[&#39;barkappa&#39;],col=&#39;red&#39;)</span></span>
<span id="cb130-22"><a href="NE.html#cb130-22" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">-</span>param[<span class="st">&#39;underbarkappa&#39;</span>],<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb130-23"><a href="NE.html#cb130-23" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">-</span>param[<span class="st">&#39;underbarkappa&#39;</span>]),<span class="at">y=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>)),<span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>)<span class="sc">-</span><span class="fu">underbar</span>(kappa))),<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;red&#39;</span>),<span class="at">lty=</span><span class="fu">c</span>(<span class="st">&#39;solid&#39;</span>,<span class="st">&#39;solid&#39;</span>))</span>
<span id="cb130-24"><a href="NE.html#cb130-24" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">5</span>,<span class="fl">10.5</span>,<span class="fu">c</span>(<span class="st">&#39;AT&#39;</span>,<span class="st">&#39;NT&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>),<span class="at">pch=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;black&#39;</span>,<span class="st">&#39;blue&#39;</span>,<span class="st">&#39;red&#39;</span>,<span class="st">&#39;green&#39;</span>),<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb130-25"><a href="NE.html#cb130-25" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="fu">expression</span>(<span class="at">kappa=</span><span class="fu">underbar</span>(kappa)))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plottypes"></span>
<img src="STCI_files/figure-html/plottypes-1.png" alt="Types" width="50%" /><img src="STCI_files/figure-html/plottypes-2.png" alt="Types" width="50%" />
<p class="caption">
Figure 4.1: Types
</p>
</div>
<p>As Figure <a href="NE.html#fig:plottypes">4.1</a> shows how the different types interact with <span class="math inline">\(\kappa_i\)</span>.
When <span class="math inline">\(\kappa_i=-\bar{\kappa}\)</span>, individuals with <span class="math inline">\(y_i^B+V_i\)</span> below <span class="math inline">\(\bar{y}\)</span> always take the program.
Even when <span class="math inline">\(Z_i=1\)</span> and <span class="math inline">\(\bar{\kappa}\)</span> is subtracted from their index, it is still low enough so that they get to participate.
When <span class="math inline">\(y_i^B+V_i\)</span> is in between <span class="math inline">\(\bar{y}\)</span> and <span class="math inline">\(\bar{y}+\bar{\kappa}\)</span>, the individuals are such that their index without subtracting <span class="math inline">\(\bar{\kappa}\)</span> is above <span class="math inline">\(\bar{y}\)</span>, but it is below <span class="math inline">\(\bar{y}\)</span> when <span class="math inline">\(\bar{\kappa}\)</span> is subtracted from it.
These individuals participate when <span class="math inline">\(Z_i=1\)</span> and do not participate when <span class="math inline">\(Z_i=0\)</span>: they are compliers.
Individuals such that <span class="math inline">\(y_i^B+V_i\)</span> is above <span class="math inline">\(\bar{y}+\bar{\kappa}\)</span> will have an index above <span class="math inline">\(\bar{y}\)</span> whether we substract <span class="math inline">\(\bar{\kappa}\)</span> from it or not.
They are never takers.</p>
<p>When <span class="math inline">\(\kappa_i=\underline{\kappa}\)</span>, individuals with <span class="math inline">\(y_i^B+V_i\)</span> below <span class="math inline">\(\bar{y}-\underline{\kappa}\)</span> always take the program.
Even when <span class="math inline">\(Z_i=0\)</span> and <span class="math inline">\(\underline{\kappa}\)</span> is not subtracted from their index, it is still low enough so that they get to participate.
When <span class="math inline">\(y_i^B+V_i\)</span> is in between <span class="math inline">\(\bar{y}-\underline{\kappa}\)</span> and <span class="math inline">\(\bar{y}\)</span>, the individuals are such that their index without adding <span class="math inline">\(\underline{\kappa}\)</span> is below <span class="math inline">\(\bar{y}\)</span>, but it is above <span class="math inline">\(\bar{y}\)</span> when <span class="math inline">\(\underline{\kappa}\)</span> is added to it.
These individuals participate when <span class="math inline">\(Z_i=0\)</span> and do not participate when <span class="math inline">\(Z_i=1\)</span>: they are defiers.
Individuals such that <span class="math inline">\(y_i^B+V_i\)</span> is above <span class="math inline">\(\bar{y}\)</span> will have an index above <span class="math inline">\(\bar{y}\)</span> whether we add <span class="math inline">\(\underline{\kappa}\)</span> from it or not.
They are never takers.</p>
</div>
<div id="identification-4" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Identification</h3>
<p>We need several assumptions for identification in an Instrumental Variable framework.
We are going to explore two sets of assumption that secure the identification of two different parameters:</p>
<ul>
<li>The Average Treatment Effect on the Treated (<span class="math inline">\(TT\)</span>): identification will happen through the assumption of independence of treatment effects from potential treatment choice</li>
<li>The Local Average Treatment Effect (<span class="math inline">\(LATE\)</span>)</li>
</ul>

<div class="hypothesis">
<p><span id="hyp:FirstStage" class="hypothesis"><strong>Hypothesis 4.1  (First Stage Full Rank)  </strong></span>We assume that the instrument <span class="math inline">\(Z_i\)</span> has a direct effect on treatment participation:</p>
<span class="math display">\[\begin{align*}
\Pr(D_i=1|Z_i=1)\neq\Pr(D_i=1|Z_i=0).
\end{align*}\]</span>
</div>

<div class="example">
<span id="exm:unnamed-chunk-140" class="example"><strong>Example 4.2  </strong></span>Let’s see how this assumption works in our example.
Let’s first compute the average values of <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(D_i\)</span> as a function of <span class="math inline">\(Z_i\)</span>, for later use.
</div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="NE.html#cb131-1" aria-hidden="true" tabindex="-1"></a>means.IV <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(Ds[Z<span class="sc">==</span><span class="dv">0</span>]),<span class="fu">mean</span>(Ds[Z<span class="sc">==</span><span class="dv">1</span>]),<span class="fu">mean</span>(y0[Z<span class="sc">==</span><span class="dv">0</span>]),<span class="fu">mean</span>(y0[Z<span class="sc">==</span><span class="dv">1</span>]),<span class="fu">mean</span>(y[Z<span class="sc">==</span><span class="dv">0</span>]),<span class="fu">mean</span>(y[Z<span class="sc">==</span><span class="dv">1</span>]),<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb131-2"><a href="NE.html#cb131-2" aria-hidden="true" tabindex="-1"></a>means.IV <span class="ot">&lt;-</span> <span class="fu">matrix</span>(means.IV,<span class="at">nrow=</span><span class="dv">2</span>,<span class="at">ncol=</span><span class="dv">4</span>,<span class="at">byrow=</span><span class="cn">FALSE</span>,<span class="at">dimnames=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&#39;Z=0&#39;</span>,<span class="st">&#39;Z=1&#39;</span>),<span class="fu">c</span>(<span class="st">&#39;D&#39;</span>,<span class="st">&#39;y0&#39;</span>,<span class="st">&#39;y&#39;</span>,<span class="st">&#39;Z&#39;</span>)))</span>
<span id="cb131-3"><a href="NE.html#cb131-3" aria-hidden="true" tabindex="-1"></a>means.IV <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(means.IV)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:IVFirstStage"></span>
<img src="STCI_files/figure-html/IVFirstStage-1.png" alt="Proportion of participants as a function of $Z_i$" width="60%" />
<p class="caption">
Figure 4.2: Proportion of participants as a function of <span class="math inline">\(Z_i\)</span>
</p>
</div>
<p>Figure <a href="NE.html#fig:IVFirstStage">4.2</a> shows that the proportion of treated when <span class="math inline">\(Z_i=1\)</span> in our sample is equal to 0.53 while the proportion of treated when <span class="math inline">\(Z_i=0\)</span> is equal to 0.28, in accordance with Assumption <a href="NE.html#hyp:FirstStage">4.1</a>.
In the population, the proportion of treated when <span class="math inline">\(Z_i=1\)</span> depends on the value of <span class="math inline">\(\kappa_i\)</span>.
Let’s derive its value:</p>
<p><span class="math display">\[\begin{align*}
  \Pr(D_i=1|Z_i=1) &amp; = \Pr(y_i^B+\kappa_i Z_i + V_i\leq\bar{y}|Z_i=1) \\
                  &amp; =  \Pr(y_i^B+\kappa_i + V_i\leq\bar{y}) \\
                  &amp; =  \Pr(y_i^B+ V_i\leq\bar{y}+\bar{\kappa}|\xi_i=1)\Pr(\xi_i=1) + \Pr(y_i^B+V_i\leq\bar{y}-\underline{\kappa}|\xi_i=0)\Pr(\xi_i=0) \\
                                    &amp; =  \Pr(y_i^B+ V_i\leq\bar{y}+\bar{\kappa})p_{\xi} + \Pr(y_i^B+ V_i\leq\bar{y}-\underline{\kappa})(1-p_{\xi}) \\
                  &amp; =  p_{\xi}\Phi\left(\frac{\bar{y}+\bar{\kappa}-\bar{\mu}}{\sqrt{(1+\gamma^2)\sigma^2_{\mu}+\sigma^2_{U}+\sigma^2_{\omega}}}\right) + (1-p_{\xi})\Phi\left(\frac{\bar{y}-\underline{\kappa}-\bar{\mu}}{\sqrt{(1+\gamma^2)\sigma^2_{\mu}+\sigma^2_{U}+\sigma^2_{\omega}}}\right)
\end{align*}\]</span></p>
<p>where the second equality follows from <span class="math inline">\(Z_i\)</span> being independent of <span class="math inline">\((y_i^0,y_i^1,y_i^B,V_i)\)</span>, the third equality follows from <span class="math inline">\(\xi_i\)</span> being independent from <span class="math inline">\((y_i^0,y_i^1,y_i^B,V_i,Z_i)\)</span> and the last equality follows from the formula for the cumulative of a normal distribution.
The formula for <span class="math inline">\(\Pr(D_i=1|Z_i=0)\)</span> is the same except for <span class="math inline">\(\bar{\kappa}\)</span> and <span class="math inline">\(\underline{\kappa}\)</span> that are set to zero.</p>
<p>Let’s write two functions to compute these probabilities:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="NE.html#cb132-1" aria-hidden="true" tabindex="-1"></a>prob.D.Z<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(param){</span>
<span id="cb132-2"><a href="NE.html#cb132-2" aria-hidden="true" tabindex="-1"></a>  part<span class="fl">.1</span> <span class="ot">&lt;-</span> param[<span class="st">&#39;pxi&#39;</span>]<span class="sc">*</span><span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>]<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&quot;sigma2U&quot;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>]))</span>
<span id="cb132-3"><a href="NE.html#cb132-3" aria-hidden="true" tabindex="-1"></a>  part<span class="fl">.2</span> <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>param[<span class="st">&#39;pxi&#39;</span>])<span class="sc">*</span><span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">-</span>param[<span class="st">&#39;underbarkappa&#39;</span>]<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&quot;sigma2U&quot;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>]))</span>
<span id="cb132-4"><a href="NE.html#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(part<span class="fl">.1</span><span class="sc">+</span>part<span class="fl">.2</span>)</span>
<span id="cb132-5"><a href="NE.html#cb132-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-6"><a href="NE.html#cb132-6" aria-hidden="true" tabindex="-1"></a>prob.D.Z<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(param){</span>
<span id="cb132-7"><a href="NE.html#cb132-7" aria-hidden="true" tabindex="-1"></a>  part<span class="fl">.1</span> <span class="ot">&lt;-</span> param[<span class="st">&#39;pxi&#39;</span>]<span class="sc">*</span><span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&quot;sigma2U&quot;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>]))</span>
<span id="cb132-8"><a href="NE.html#cb132-8" aria-hidden="true" tabindex="-1"></a>  part<span class="fl">.2</span> <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>param[<span class="st">&#39;pxi&#39;</span>])<span class="sc">*</span><span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&quot;sigma2U&quot;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>]))</span>
<span id="cb132-9"><a href="NE.html#cb132-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(part<span class="fl">.1</span><span class="sc">+</span>part<span class="fl">.2</span>)</span>
<span id="cb132-10"><a href="NE.html#cb132-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>With these functions, we know that, in the population, <span class="math inline">\(\Pr(D_i=1|Z_i=1)=\)</span> 0.57 and <span class="math inline">\(\Pr(D_i=1|Z_i=0)=\)</span> 0.25, which is not far from what we have found in our sample.</p>
<p>Our next set of assumptions imposes that the instrument has no direct effect on the outcome and that it is not correlated with all the potential outcomes.
Let’s start with the exclusion restriction:</p>

<div class="hypothesis">
<p><span id="hyp:ExclusionRestriction" class="hypothesis"><strong>Hypothesis 4.2  (Exclusion Restriction)  </strong></span>We assume that there is no direct effect of <span class="math inline">\(Z_i\)</span> on outcomes:</p>
<span class="math display">\[\begin{align*}
\forall d,z \in \left\{0,1\right\}\text{, } Y_i^{d,z} = Y_i^d.
\end{align*}\]</span>
</div>

<div class="example">
<span id="exm:unnamed-chunk-141" class="example"><strong>Example 4.3  </strong></span>In our example, this assumption is automatically satisfied.
</div>
<p>Indeed, <span class="math inline">\(y_i^{d,z}=y_i^0 + d(y_i^1-y_i^0)\)</span> which is parameterized as <span class="math inline">\(y_i^{d,z}=\mu_i+\delta+U_i^0+d(\bar{\alpha}+\theta\mu_i+\eta_i)\)</span>.
Since <span class="math inline">\(y_i^{d,z}\)</span> does not depend on <span class="math inline">\(z\)</span>, we have <span class="math inline">\(y_i^{d,z} = y_i^d\)</span>, <span class="math inline">\(\forall d,z \in \left\{0,1\right\}\)</span>.
The assumption would not be satisfied if <span class="math inline">\(Z_i\)</span> entered the equations for <span class="math inline">\(y_i^0\)</span> or <span class="math inline">\(y_i^1\)</span>.
For example, if <span class="math inline">\(Z_i\)</span> is the Vietnam draft lottery number (high or low) used by Angrist to study the impact of army experience on earnings, the exclusion restriction would not work if <span class="math inline">\(Z_i\)</span> was directly influencing outcomes, independent of miitary experience, by example by generating a higher education level.
In that case, we could have <span class="math inline">\(E_i=\alpha+\beta Z_i + v_i\)</span>, where <span class="math inline">\(E_i\)</span> is education, and, for example, <span class="math inline">\(y_i^0=\mu_i+\delta+\lambda E_i+U_i^0\)</span>.
We then have <span class="math inline">\(y_i^{d,z}=\mu_i+\delta +\lambda(\alpha+\beta z + v_i) +U_i^0+d(\bar{\alpha}+\theta\mu_i+\eta_i)\)</span> which depends on <span class="math inline">\(z\)</span> and thus the exclusion restriction does not hold any more.</p>
<p>Let us now state the independence assumption:</p>

<div class="hypothesis">
<p><span id="hyp:Independence" class="hypothesis"><strong>Hypothesis 4.3  (Independence)  </strong></span>We assume that <span class="math inline">\(Z_i\)</span> is independent from the other determinants of <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(D_i\)</span>:</p>
<span class="math display">\[\begin{align*}
(Y_i^1,Y_i^0,D_i^1,D_i^0)\Ind Z_i.
\end{align*}\]</span>
</div>

<div class="remark">
 <span class="remark"><em>Remark. </em></span> Why do we say that independence from the potential outcomes is the same as independence from the other determinants of <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(D_i\)</span>?
Because the only sources of variation that remain in <span class="math inline">\(Y_i^d\)</span> and <span class="math inline">\(D_i^z\)</span> are the other sources of variations (that is not the treatment <span class="math inline">\(D_i=d\)</span> nor the instrument variable <span class="math inline">\(Z_i=z\)</span>).
</div>

<div class="example">
<span id="exm:unnamed-chunk-143" class="example"><strong>Example 4.4  </strong></span>In our example, this assumption is also satisfied.
</div>
<p>If we assumed that unobserved determinants of earnings contained in <span class="math inline">\(U^0_i\)</span> are correlated with the instrument value, then we would have a problem.
For example, if children that leave close to college have also rich parents, or parents that spend a lot of time with them, or parents with large networks, there probably is a correlation between distance to college and earnings in the absence of the program.
For the draft lottery example, you might have that people with a high draft lottery number who have well-connected parents obtain discharges on special medical grounds.
Is that a violation of the independence assumption?
Actually no.
Indeed, these individuals are simply going to become never takers (they avoid the draft whatever their lottery number).
But <span class="math inline">\(Z_i\)</span> is still independent from the level of connections of the parents.
For the independence assumption to fail in the draft lottery number example, you would need that children of well-connected parents obtain lower lottery numbers because the lottery is rigged.
In that case, since well-connected individuals would have had higher earnings even absent the lottery, there is a negative correlation between <span class="math inline">\(y_i^0\)</span> and having a high draft lottery number (<span class="math inline">\(Z_i\)</span>).</p>
<p>The last assumption we need in order to identify the Local Average Treatment Effect is that of Monotonicity.
We already know this assumption:</p>

<div class="hypothesis">
<p><span id="hyp:MonotonicityIV" class="hypothesis"><strong>Hypothesis 4.4  (Monotonicity)  </strong></span>We assume that the instrument moves everyone in the population in the same direction:</p>
<span class="math display">\[\begin{align*}
\forall i\text{, either } D^1_i\geq D_i^0 \text{ or } D^1_i\leq D_i^0.
\end{align*}\]</span>
</div>
<p>Without loss of generality, we generally assume that <span class="math inline">\(\forall i\)</span>, <span class="math inline">\(D^1_i\geq D_i^0\)</span>.
As a consequence, there are no defiers.</p>

<div class="example">
<span id="exm:unnamed-chunk-144" class="example"><strong>Example 4.5  </strong></span>In our example, this assumption is not satisfied.
</div>
<p>There are defiers, as Figure <a href="NE.html#fig:plottypes">4.1</a> shows, when <span class="math inline">\(\xi_i = 0\)</span> and thus <span class="math inline">\(\kappa_i=\underline{\kappa}\)</span>.
Indeed, in that case, for the individuals who are such that <span class="math inline">\(\bar{y}-\underline{\kappa}&lt;y_i^B+V_i\leq\bar{y}\)</span>, we have <span class="math inline">\(D^1_i=\uns{y_i^B+\underline{\kappa} + V_i\leq\bar{y}}=0\)</span> and <span class="math inline">\(D^0_i=\uns{y_i^B + V_i\leq\bar{y}}=1\)</span>.
This would happen for example if some people would go to college less if their house is located closer to the college, maybe for example because they have a preference not to stay at their parents’ house.</p>

<div class="remark">
 <span class="remark"><em>Remark. </em></span> Why are defiers a problem for the instrumental variable strategy?
Because the Intention to Treat Effect that measures the difference in expected outcomes at the two levels of the instrument is going to be characterized by two-way flows in and out of the program, as we have already seen with Theorem <a href="RCT.html#thm:ITELATE">3.10</a>.
This means that some treatment effects will have negative weights in the ITE formula.
In that case, you might have a negative Intention to Treat Effect despite the treatment having positive effects for everyone, or you might under estimate the true effect of the treatment.
This matters only when the treatment effects are heterogeneous.
</div>

<div class="example">
<span id="exm:unnamed-chunk-146" class="example"><strong>Example 4.6  </strong></span>Let us detail how non-monotonicity and the existence defiers act on the ITE in our example, since we now have defiers.
The first very important thing to understand is that all the problems we have happend because treatment effects are heterogeneous <strong>AND</strong> they are correlated with the type of individuals: defiers and compliers do not have the same distribution of treatment effects and, case in point, they do not have the same average treatment effects.
The average effects of the treatment on compliers and defiers are not the same.
Let us first look at the distribution of treatment effects among compliers and defiers in the sample and in the population.
</div>
<p>In order to derive the distribution of <span class="math inline">\(\alpha_i\)</span> conditional on Type in the population, we need to derive the joint distribution of <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(y_i^B+V_i\)</span> and use the <strong>trmtvnorm</strong> package to recover its density when it is truncated.
This distribution is normal and fully characterized by its mean and covariance matrix.</p>
<p><span class="math display">\[\begin{align*}
  (\alpha_i,y_i^B+V_i) &amp; \sim \mathcal{N}\left(\bar{\alpha}+\theta\bar{\mu},\bar{\mu},
                                        \left(\begin{array}{cc}
                                              \theta^2\sigma^2_{\mu}+\sigma^2_{\eta} &amp; (\theta+\gamma)\sigma^2_{\mu}+\rho_{\eta,\omega}\sigma^2_{\eta}\sigma^2_{\omega}\\
                                              (\theta+\gamma)\sigma^2_{\mu}+\rho_{\eta,\omega}\sigma^2_{\eta}\sigma^2_{\omega} &amp;  (1+\gamma^2)\sigma^2_{\mu}+\sigma^2_U+\sigma^2_{\omega}\\
                                              \end{array}
                                        \right)
                                      \right)
\end{align*}\]</span></p>
<p>Let us write a function to generate them.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="NE.html#cb133-1" aria-hidden="true" tabindex="-1"></a>mean.alpha.yBV <span class="ot">&lt;-</span> <span class="fu">c</span>(param[<span class="st">&#39;baralpha&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;theta&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;barmu&#39;</span>],param[<span class="st">&#39;barmu&#39;</span>])</span>
<span id="cb133-2"><a href="NE.html#cb133-2" aria-hidden="true" tabindex="-1"></a>cov.alpha.yBV <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>((param[<span class="st">&#39;theta&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2eta&#39;</span>],</span>
<span id="cb133-3"><a href="NE.html#cb133-3" aria-hidden="true" tabindex="-1"></a>                          (param[<span class="st">&#39;theta&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rhoetaomega&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2eta&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2omega&#39;</span>],</span>
<span id="cb133-4"><a href="NE.html#cb133-4" aria-hidden="true" tabindex="-1"></a>                            (param[<span class="st">&#39;theta&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rhoetaomega&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2eta&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2omega&#39;</span>],</span>
<span id="cb133-5"><a href="NE.html#cb133-5" aria-hidden="true" tabindex="-1"></a>                            (<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>]),<span class="dv">2</span>,<span class="dv">2</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-6"><a href="NE.html#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="co"># density of alpha for compliers</span></span>
<span id="cb133-7"><a href="NE.html#cb133-7" aria-hidden="true" tabindex="-1"></a>lower.cut.comp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>]))</span>
<span id="cb133-8"><a href="NE.html#cb133-8" aria-hidden="true" tabindex="-1"></a>upper.cut.comp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>])</span>
<span id="cb133-9"><a href="NE.html#cb133-9" aria-hidden="true" tabindex="-1"></a>d.alpha.compliers <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb133-10"><a href="NE.html#cb133-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">dtmvnorm.marginal</span>(<span class="at">xn=</span>x,<span class="at">n=</span><span class="dv">1</span>,<span class="at">mean=</span>mean.alpha.yBV,<span class="at">sigma=</span>cov.alpha.yBV,<span class="at">lower=</span>lower.cut.comp,<span class="at">upper=</span>upper.cut.comp))</span>
<span id="cb133-11"><a href="NE.html#cb133-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb133-12"><a href="NE.html#cb133-12" aria-hidden="true" tabindex="-1"></a><span class="co"># density of alpha for defiers</span></span>
<span id="cb133-13"><a href="NE.html#cb133-13" aria-hidden="true" tabindex="-1"></a>lower.cut.def <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>]<span class="sc">-</span>param[<span class="st">&#39;underbarkappa&#39;</span>]))</span>
<span id="cb133-14"><a href="NE.html#cb133-14" aria-hidden="true" tabindex="-1"></a>upper.cut.def <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>]))</span>
<span id="cb133-15"><a href="NE.html#cb133-15" aria-hidden="true" tabindex="-1"></a>d.alpha.defiers <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb133-16"><a href="NE.html#cb133-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">dtmvnorm.marginal</span>(<span class="at">xn=</span>x,<span class="at">n=</span><span class="dv">1</span>,<span class="at">mean=</span>mean.alpha.yBV,<span class="at">sigma=</span>cov.alpha.yBV,<span class="at">lower=</span>lower.cut.def,<span class="at">upper=</span>upper.cut.def))</span>
<span id="cb133-17"><a href="NE.html#cb133-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let us now plot the empirical and theoretical distributions of the treatment effects for compliers and defiers.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="NE.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># building the data frame</span></span>
<span id="cb134-2"><a href="NE.html#cb134-2" aria-hidden="true" tabindex="-1"></a>alpha.types <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(alpha,C,D,AT,NT)) <span class="sc">%&gt;%</span></span>
<span id="cb134-3"><a href="NE.html#cb134-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(</span>
<span id="cb134-4"><a href="NE.html#cb134-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Type =</span> <span class="fu">ifelse</span>(AT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;Always Takers&quot;</span>,</span>
<span id="cb134-5"><a href="NE.html#cb134-5" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(NT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;Never Takers&quot;</span>,</span>
<span id="cb134-6"><a href="NE.html#cb134-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">ifelse</span>(C<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;Compliers&quot;</span>,<span class="st">&quot;Defiers&quot;</span>)))</span>
<span id="cb134-7"><a href="NE.html#cb134-7" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span></span>
<span id="cb134-8"><a href="NE.html#cb134-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">Type =</span> <span class="fu">as.factor</span>(Type))</span>
<span id="cb134-9"><a href="NE.html#cb134-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-10"><a href="NE.html#cb134-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">filter</span>(alpha.types,Type<span class="sc">==</span><span class="st">&quot;Compliers&quot;</span> <span class="sc">|</span> Type<span class="sc">==</span><span class="st">&quot;Defiers&quot;</span>), <span class="fu">aes</span>(<span class="at">x=</span>alpha, <span class="at">colour=</span>Type)) <span class="sc">+</span> </span>
<span id="cb134-11"><a href="NE.html#cb134-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb134-12"><a href="NE.html#cb134-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> d.alpha.compliers, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb134-13"><a href="NE.html#cb134-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> d.alpha.defiers, <span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb134-14"><a href="NE.html#cb134-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;density&#39;</span>) <span class="sc">+</span></span>
<span id="cb134-15"><a href="NE.html#cb134-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:AlphaTypesPlot"></span>
<img src="STCI_files/figure-html/AlphaTypesPlot-1.png" alt="Distribution of treatment effects by Type in the sample (dashed line) and in the population (full line)" width="50%" />
<p class="caption">
Figure 4.3: Distribution of treatment effects by Type in the sample (dashed line) and in the population (full line)
</p>
</div>
<p>Figure <a href="NE.html#fig:AlphaTypesPlot">4.3</a> shows that the two distributions are actually very similar in our example.
The distribution for the compliers is slightly above that for the defiers, meaning that the defiers should have lower expected outcomes in the population.
Let us check that by computing the average outcomes of compliers and defiers both in the sample and in the population.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="NE.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sample means</span></span>
<span id="cb135-2"><a href="NE.html#cb135-2" aria-hidden="true" tabindex="-1"></a>mean.alpha.compliers.samp <span class="ot">&lt;-</span> <span class="fu">mean</span>(alpha[C<span class="sc">==</span><span class="dv">1</span>]) </span>
<span id="cb135-3"><a href="NE.html#cb135-3" aria-hidden="true" tabindex="-1"></a>mean.alpha.defiers.samp <span class="ot">&lt;-</span> <span class="fu">mean</span>(alpha[D<span class="sc">==</span><span class="dv">1</span>]) </span>
<span id="cb135-4"><a href="NE.html#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="NE.html#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co"># population means</span></span>
<span id="cb135-6"><a href="NE.html#cb135-6" aria-hidden="true" tabindex="-1"></a>mean.alpha.compliers.pop <span class="ot">&lt;-</span> <span class="fu">mtmvnorm</span>(<span class="at">mean=</span>mean.alpha.yBV,<span class="at">sigma=</span>cov.alpha.yBV,<span class="at">lower=</span>lower.cut.comp,<span class="at">upper=</span>upper.cut.comp,<span class="at">doComputeVariance=</span><span class="cn">FALSE</span>)[[<span class="dv">1</span>]]</span>
<span id="cb135-7"><a href="NE.html#cb135-7" aria-hidden="true" tabindex="-1"></a>mean.alpha.defiers.pop <span class="ot">&lt;-</span>  <span class="fu">mtmvnorm</span>(<span class="at">mean=</span>mean.alpha.yBV,<span class="at">sigma=</span>cov.alpha.yBV,<span class="at">lower=</span>lower.cut.def,<span class="at">upper=</span>upper.cut.def,<span class="at">doComputeVariance=</span><span class="cn">FALSE</span>)[[<span class="dv">1</span>]]</span></code></pre></div>
<p>In the population, the average treatment effect for compliers is equal to 0.17 and the average treatment effect for defiers is equal to 0.14.
In the sample, the average treatment effect for compliers is equal to 0.2 and the average treatment effect for defiers is equal to 0.16.</p>
<p>The difference between the treatment effect for compliers and defiers is a problem for the Wald estimator.
Let’s look at how the Wald estimator behaves in the population (in order to avoid considerations due to sampling noise).
By Theorem <a href="RCT.html#thm:ITELATE">3.10</a>, the numerator of the Wald estimator is equal to the difference between the average treatment on compliers and the average treatment effect on defiers weighted by their respective proportions in the population.
In order to be able to compute the Wald estimator, we need to compute the proportion of compliers and of defiers in the population.
These proportions are equal to:</p>
<p><span class="math display">\[\begin{align*}
  \Pr(T_i=c) &amp; = \Pr(\bar{y}&lt; y_i^B+V_i\leq\bar{y}+\bar{\kappa}\cap\kappa_i=-\bar{\kappa}) \\
              &amp; = \Pr(\bar{y}&lt; y_i^B+V_i\leq\bar{y}+\bar{\kappa})p_{\xi} \\
  \Pr(T_i=d) &amp; = \Pr(\bar{y}-\underline{\kappa}&lt; y_i^B+V_i\leq\bar{y}\cap\kappa_i=\underline{\kappa}) \\
              &amp; = \Pr(\bar{y}-\underline{\kappa}&lt; y_i^B+V_i\leq\bar{y})(1-p_{\xi}),
\end{align*}\]</span></p>
<p>where the second equality follows from the fact that <span class="math inline">\(\xi\)</span> is independent from <span class="math inline">\(y_i^B+V_i\)</span> and uses the fact that <span class="math inline">\(\Pr(A\cap B)=\Pr(A|B)\Pr(B)\)</span>.
Since <span class="math inline">\(y_i^B+V_i\)</span> is normally distributed and we know its mean and variance, these proportions can be computed as:</p>
<p><span class="math display">\[\begin{align*}
  \Pr(T_i=c) &amp; = p_{\xi}\left(\Phi\left(\frac{\bar{y}+\bar{\kappa}-\bar{\mu}}{\sqrt{(1+\gamma^2)\sigma^2_{\mu}+\sigma^2_U+\sigma^2_{\omega}}}\right)
                  -\Phi\left(\frac{\bar{y}-\bar{\mu}}{\sqrt{(1+\gamma^2)\sigma^2_{\mu}+\sigma^2_U+\sigma^2_{\omega}}}\right)\right) \\
  \Pr(T_i=d) &amp; = (1-p_{\xi})\left(\Phi\left(\frac{\bar{y}-\bar{\mu}}{\sqrt{(1+\gamma^2)\sigma^2_{\mu}+\sigma^2_U+\sigma^2_{\omega}}}\right)
                  -\Phi\left(\frac{\bar{y}-\underline{\kappa}-\bar{\mu}}{\sqrt{(1+\gamma^2)\sigma^2_{\mu}+\sigma^2_U+\sigma^2_{\omega}}}\right)\right).
\end{align*}\]</span></p>
<p>Let’s write functions to compute these objects:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="NE.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion compliers</span></span>
<span id="cb136-2"><a href="NE.html#cb136-2" aria-hidden="true" tabindex="-1"></a>Prop.Comp <span class="ot">&lt;-</span> <span class="cf">function</span>(param){</span>
<span id="cb136-3"><a href="NE.html#cb136-3" aria-hidden="true" tabindex="-1"></a>  first <span class="ot">&lt;-</span> <span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>]<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span>(<span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>])))</span>
<span id="cb136-4"><a href="NE.html#cb136-4" aria-hidden="true" tabindex="-1"></a>  second <span class="ot">&lt;-</span> <span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span>(<span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>])))</span>
<span id="cb136-5"><a href="NE.html#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(param[<span class="st">&#39;pxi&#39;</span>]<span class="sc">*</span>(first <span class="sc">-</span> second))  </span>
<span id="cb136-6"><a href="NE.html#cb136-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb136-7"><a href="NE.html#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="NE.html#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion defiers</span></span>
<span id="cb136-9"><a href="NE.html#cb136-9" aria-hidden="true" tabindex="-1"></a>Prop.Def <span class="ot">&lt;-</span> <span class="cf">function</span>(param){</span>
<span id="cb136-10"><a href="NE.html#cb136-10" aria-hidden="true" tabindex="-1"></a>  first <span class="ot">&lt;-</span> <span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span>(<span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>])))</span>
<span id="cb136-11"><a href="NE.html#cb136-11" aria-hidden="true" tabindex="-1"></a>  second <span class="ot">&lt;-</span> <span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">-</span>param[<span class="st">&#39;underbarkappa&#39;</span>]<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span>(<span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>])))</span>
<span id="cb136-12"><a href="NE.html#cb136-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((<span class="dv">1</span><span class="sc">-</span>param[<span class="st">&#39;pxi&#39;</span>])<span class="sc">*</span>(first <span class="sc">-</span> second))  </span>
<span id="cb136-13"><a href="NE.html#cb136-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In our example, the proportion of compliers is equal to 0.33 and the proportion of defiers is equal to 0.01.
As a consequence, the population value of the numerator of the Wald estimator is equal to 0.05.
In the Wald estimator, this quantity is divided by the difference between the proportion of participants when <span class="math inline">\(Z_i=1\)</span> and when <span class="math inline">\(Z_i=0\)</span>.
We have already computed this quantity earlier, but it is nice to try to compute it in a different way using the types.
The difference in the proportion of participants when <span class="math inline">\(Z_i=1\)</span> and when <span class="math inline">\(Z_i=0\)</span> is indeed equal to the difference in the proportion of compliers and the proportion of defiers.
The difference between the proportion of compliers and the proportion of defiers is equal to 0.32, while the difference between the proportion of participants when <span class="math inline">\(Z_i=1\)</span> and when <span class="math inline">\(Z_i=0\)</span> is equal to 0.32.
It is reassuring that we find the same thing (actually, full disclosure, I did not find the same thing at first, and this help me spot a mistake in the formulas for the proportions of participants: mistakes are normal and natural and that is how we learn and grow).</p>
<p>So we are now equipped to compute the value of the Wald estimator in the population in our model without monotonicity.
It is equal to 0.172.
In practice, the bias of the Wald estimator is rather small for the average treatment effect on the compliers (remember that it is equal to 0.171).
In order to understand why, it is useful to see that the bias of the Wald estimator for the average treatment effect on the compliers is equal to:</p>
<p><span class="math display">\[\begin{align*}
  \esp{\Delta_i^Y|T_i=c}-\Delta^Y_{Wald} &amp; = \esp{\Delta_i^Y|T_i=c} + (\esp{\Delta_i^Y|T_i=c}-\esp{\Delta_i^Y|T_i=d})\frac{\Pr(T_i=d)}{\Pr(T_i=c)-\Pr(T_i=d)},
\end{align*}\]</span></p>
<p>where the equality follows from Theorem <a href="RCT.html#thm:ITELATE">3.10</a> and some algebra.
In the absence of Monotonicity, when the impact on defiers is smaller than the impact of compliers, the Wald estimator is baised upward for the effect on the compliers (as it happens in our example).
In a model in which the effect of the treatment is larger on defiers than on compliers, the Wald estimator is biased downwards for the effect on compliers because defiers make the outcome of the control group seem too good.
In the extreme, when <span class="math inline">\(\esp{\Delta_i^Y|T_i=d}&gt;\esp{\Delta_i^Y|T_i=c}(1+\frac{\Pr(T_i=c)-\Pr(T_i=d)}{\Pr(T_i=d)})\)</span>, the Wald estimator can be negative whereas the effects on compliers and on defiers are both positive.
This happens when the effect on defiers is <span class="math inline">\(1+\frac{\Pr(T_i=c)-\Pr(T_i=d)}{\Pr(T_i=d)}\)</span> times larger than the effect on compliers.
In our case, that means that the effect on defiers should be 26 times larger than the effect on compliers for the Wald estimator to be negative, that is to say the effect on defiers should be equal to 4.41, really much much much larger than the effect on compliers.</p>
<p>From there, we are going to explore three strategies in order to identify some true effect of the treatment using the Wald estimator:</p>
<ul>
<li>The first strategy has been recently proposed by <a href="https://drive.google.com/file/d/16XWlDECIvreM7l_NHe-JkXgyuPhFT1QG/view">de Chaisemartin (2017)</a>.
It is valid in a model without monotonicity.</li>
<li>The second strategy assumes that the heterogeneity in treatment effects is uncorrelated to the treatment.</li>
<li>The last strategy is due to Imbens and Angrist (1994) and assumes that Monotonicity holds.</li>
</ul>
<p>Let’s review these solutions in turn.</p>
<div id="identification-without-monotonicity" class="section level4" number="4.1.2.1">
<h4><span class="header-section-number">4.1.2.1</span> Identification without Monotonicity</h4>
<p>The approach delineated by <a href="https://drive.google.com/file/d/16XWlDECIvreM7l_NHe-JkXgyuPhFT1QG/view">de Chaisemartin (2017)</a> does not assume away non-monotonicity.
Clement instead assumes that we can divide the population of compliers in two-subpopulations: the <strong>compliers-defiers</strong> (<span class="math inline">\(T_i=cd\)</span>) and the <strong>surviving-compliers</strong> (<span class="math inline">\(T_i=sc\)</span>).
The main assumption in Clement’s approach is that <em>(i)</em> the compliers-defiers are in the same proportion as the defiers and <em>(ii)</em> that the average effect of the treatment on the compliers defiers is equal as the average effect of the treatment on the defiers.
These two assumptions can be formalized as follows:</p>

<div class="hypothesis">
<p><span id="hyp:CD" class="hypothesis"><strong>Hypothesis 4.5  (Compliers-defiers)  </strong></span>We assume that there exists as subpopulation of compliers that are in the same proportion as the defiers and for whom the average effect of the treatment is equal as the average effect of the treatment on the defiers:</p>
<span class="math display">\[\begin{align*}
(T_i=c) &amp; = (T_i=cd)\cup (T_i=sc) \\
\Pr(T_i=cd) &amp; = \Pr(T_i=d) \\
\esp{Y^1_i-Y^0_i|T_i=cd} &amp; = \esp{Y^1_i-Y^0_i|T_i=d}.
\end{align*}\]</span>
</div>
<p>The first equation in Assumption <a href="NE.html#hyp:CD">4.5</a> imposes that the compliers-defiers and the surviving-compliers are a partition of the population of compliers.
From Assumption <a href="NE.html#hyp:CD">4.5</a>, we can prove the following theorem:</p>

<div class="theorem">
<p><span id="thm:deChaise" class="theorem"><strong>Theorem 4.1  (Identification of the effect on the surviving-compliers)  </strong></span>Under Assumptions <a href="NE.html#hyp:FirstStage">4.1</a>, <a href="NE.html#hyp:ExclusionRestriction">4.2</a>, <a href="NE.html#hyp:Independence">4.3</a> and <a href="NE.html#hyp:CD">4.5</a>, the Wald estimator identifies the effect of the treatment on the surviving-compliers:</p>
<span class="math display">\[\begin{align*}
  \Delta^Y_{Wald} &amp; = \Delta^Y_{sc},
\end{align*}\]</span>
</div>
<p>with:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{Wald} &amp; = \frac{\esp{Y_i|Z_i=1} - \esp{Y_i|Z_i=0}}{\Pr(D_i=1|Z_i=1)-\Pr(D_i=1|Z_i=0)}\\
  \Delta^Y_{sc} &amp; = \esp{Y^1_i-Y^0_i|T_i=sc}.
\end{align*}\]</span></p>

<div class="proof">
<p> <span class="proof"><em>Proof. </em></span> Under Assumptions <a href="NE.html#hyp:ExclusionRestriction">4.2</a> and <a href="NE.html#hyp:Independence">4.3</a>, Theorems <a href="RCT.html#thm:ITELATE">3.10</a> and <a href="RCT.html#thm:ITEEncourag">3.12</a> imply that the numerator of the Wald estimator is equal to <span class="math inline">\(\Delta^Y_{ITE}\)</span> with:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{ITE}  &amp; = \esp{Y_i^{1}-Y_i^{0}|T_i=c}\Pr(T_i=c)-\esp{Y_i^{1}-Y_i^{0}|T_i=d}\Pr(T_i=d).
\end{align*}\]</span></p>
<p>Now, we have that the effect on compliers can be decomposed in the effect on surviving-compliers and the effect on compliers-defiers using the Law of Iterated Expectations and the fact that <span class="math inline">\(T_i=sc \Rightarrow T_i=c\)</span> and <span class="math inline">\(T_i=cd \Rightarrow T_i=c\)</span>:</p>
<p><span class="math display">\[\begin{align*}
\Delta^Y_{c} &amp; = \esp{Y_i^{1}-Y_i^{0}|T_i=sc}\Pr(T_i=sc|T_i=c)+\esp{Y_i^{1}-Y_i^{0}|T_i=cd}\Pr(T_i=cd|T_i=c),
\end{align*}\]</span></p>
<p>Now, using the fact that <span class="math inline">\(\Pr(T_i=sc|T_i=c)\Pr(T_i=c)=\Pr(T_i=sc)\)</span> and <span class="math inline">\(\Pr(T_i=cd|T_i=c)\Pr(T_i=c)=\Pr(T_i=cd)\)</span> (because <span class="math inline">\(\Pr(A|B)\Pr(B)=\Pr(A\cap B)\)</span> and <span class="math inline">\(\Pr(A\cap B)=\Pr(A)\)</span> if <span class="math inline">\(A \Rightarrow B\)</span>), we have:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{ITE} &amp; = \esp{Y_i^{1}-Y_i^{0}|T_i=sc}\Pr(T_i=sc)\\
                &amp; \phantom{=}+\esp{Y_i^{1}-Y_i^{0}|T_i=cd}\Pr(T_i=cd)-\esp{Y_i^{1}-Y_i^{0}|T_i=d}\Pr(T_i=d).
\end{align*}\]</span></p>
The second part of the right-hand side of the above equation is equal to zero by virtue of Assumption <a href="NE.html#hyp:CD">4.5</a>.
Now, under Assumptions <a href="NE.html#hyp:FirstStage">4.1</a>, <a href="NE.html#hyp:ExclusionRestriction">4.2</a> and <a href="NE.html#hyp:Independence">4.3</a>, we know, from the proof of Theorem <a href="RCT.html#thm:IdentLATE">3.9</a>, that <span class="math inline">\(\Pr(D_i=1|Z_i=1)-\Pr(D_i=1|Z_i=0)=\Pr(T_i=c)-\Pr(T_i=d)\)</span>.
Under Assumption <a href="NE.html#hyp:CD">4.5</a>, we have <span class="math inline">\(\Pr(T_i=c)=\Pr((T_i=cd)\cup(T_i=sc))=\Pr(T_i=cd)+\Pr(T_i=sc)\)</span>.
Replacing <span class="math inline">\(\Pr(T_i=c)\)</span> gives <span class="math inline">\(\Pr(D_i=1|Z_i=1)-\Pr(D_i=1|Z_i=0)=\Pr(T_i=sc)\)</span>.
Dividing <span class="math inline">\(\Delta^Y_{ITE}\)</span> by <span class="math inline">\(\Pr(T_i=sc)\)</span> gives the result.
</div>

<div class="remark">
 <span class="remark"><em>Remark. </em></span> <a href="https://drive.google.com/file/d/16XWlDECIvreM7l_NHe-JkXgyuPhFT1QG/view">de Chaisemartin (2017)</a> shows in his Theorem 2.1 that the reciprocal of Theorem <a href="NE.html#thm:deChaise">4.1</a> is actually valid: if there exists surviving-compliers such that their effect is estimated by the Wald estimator and their proportion is equal to the denominator of the Wald estimator, then it has to be that there exists a sub-population of compliers-defiers that are in the same proportion as the defiers and have the same average treatment effect.
</div>

<div class="example">
<span id="exm:unnamed-chunk-149" class="example"><strong>Example 4.7  </strong></span>Let us now see if the conditions in <a href="https://drive.google.com/file/d/16XWlDECIvreM7l_NHe-JkXgyuPhFT1QG/view">de Chaisemartin (2017)</a> are verified in our numerical example.
</div>
<p>I have bad news: they are not.
It is not super easy to see why, but an intuitive explanation is that the average effect on the defiers in our model is taken conditional on <span class="math inline">\(y^B_i+V_i\in]\bar{y}-\underline{\kappa},\bar{y}]\)</span> while the effect on compliers is taken conditional on <span class="math inline">\(y^B_i+V_i\in]\bar{y},\bar{y}+\bar{\kappa}]\)</span>.
These two intervals do not overlap.
Since the expected value of the treatment effect conditional on <span class="math inline">\(y^B_i+V_i=v\)</span> is monotonous in <span class="math inline">\(v\)</span> (because both variables come from a bivariate normal distribution), then all the effects on the defiers interval are either smaller or larger than all the effects on the compliers interval, making it impossible to find a sub-population of compliers that have the same average effect of the treatment as the defiers.</p>
<p>More formally, it is possible to prove this result by using the concept of Marginal Treatment Effect developed by <a href="https://www.pnas.org/content/pnas/96/8/4730.full.pdf">Heckman and Vytlacil (1999)</a>.
I might devote a specific section of the book to the MTE and its derivations.
For now, I let it as a possibility.</p>
<p>What can we do then?
Probably the best that we can do is to find <span class="math inline">\(\kappa^*\)</span> such that <span class="math inline">\(\Pr(\bar{y}&lt;y_i^B+V\leq\bar{y}+\kappa^*)p_{\xi}=\Pr(T_i=d)\)</span>, that is the value such that the interval of values of <span class="math inline">\(y_i^B+V\)</span> that are for compliers and closest to the interval for defiers and that contains the same proportion of compliers as there are defiers.
This value is going to produce an average effect for compliers-defiers as close as possible to the average effect on defiers.
It can be computed as follows:</p>
<p><span class="math display">\[\begin{align*}
  \kappa^* &amp; = \bar{\mu}-\bar{y}+\sqrt{(1+\gamma^2)\sigma^2_{\mu}+\sigma^2_U+\sigma^2_{\omega}}
                                  \Phi^{-1}\Bigg(\Phi\left(\frac{\bar{y}-\bar{\mu}}{\sqrt{(1+\gamma^2)\sigma^2_{\mu}+\sigma^2_U+\sigma^2_{\omega}}}\right)\\
           &amp; \phantom{=}+\frac{1-p_{\xi}}{p_{\xi}}\left(\Phi\left(\frac{\bar{y}-\bar{\mu}}{\sqrt{(1+\gamma^2)\sigma^2_{\mu}+\sigma^2_U+\sigma^2_{\omega}}}\right)-\Phi\left(\frac{\bar{y}-\underline{\kappa}-\bar{\mu}}{\sqrt{(1+\gamma^2)\sigma^2_{\mu}+\sigma^2_U+\sigma^2_{\omega}}}\right)\right)\Bigg)
 \end{align*}\]</span></p>
<p>Let’s write functions to compute <span class="math inline">\(\kappa^*\)</span>, the implied proportion of compliers-defiers and the average effect of the treatment on compliers-defiers and on surviving-compliers:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="NE.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kappa star</span></span>
<span id="cb137-2"><a href="NE.html#cb137-2" aria-hidden="true" tabindex="-1"></a>KappaStar <span class="ot">&lt;-</span> <span class="cf">function</span>(param){</span>
<span id="cb137-3"><a href="NE.html#cb137-3" aria-hidden="true" tabindex="-1"></a>  prop.def <span class="ot">&lt;-</span> <span class="fu">Prop.Def</span>(param)</span>
<span id="cb137-4"><a href="NE.html#cb137-4" aria-hidden="true" tabindex="-1"></a>  prop.below.bary <span class="ot">&lt;-</span> <span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span>(<span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>])))</span>
<span id="cb137-5"><a href="NE.html#cb137-5" aria-hidden="true" tabindex="-1"></a>  st.dev.yB.V <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>])</span>
<span id="cb137-6"><a href="NE.html#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(param[<span class="st">&#39;barmu&#39;</span>]<span class="sc">-</span><span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>st.dev.yB.V<span class="sc">*</span><span class="fu">qnorm</span>(prop.below.bary<span class="sc">+</span>prop.def<span class="sc">/</span>param[<span class="st">&#39;pxi&#39;</span>]))</span>
<span id="cb137-7"><a href="NE.html#cb137-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb137-8"><a href="NE.html#cb137-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-9"><a href="NE.html#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of compliers-defiers</span></span>
<span id="cb137-10"><a href="NE.html#cb137-10" aria-hidden="true" tabindex="-1"></a>Prop.Comp.Def <span class="ot">&lt;-</span> <span class="cf">function</span>(param){</span>
<span id="cb137-11"><a href="NE.html#cb137-11" aria-hidden="true" tabindex="-1"></a>  first <span class="ot">&lt;-</span> <span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span><span class="fu">KappaStar</span>(param)<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span>(<span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>])))</span>
<span id="cb137-12"><a href="NE.html#cb137-12" aria-hidden="true" tabindex="-1"></a>  second <span class="ot">&lt;-</span> <span class="fu">pnorm</span>((<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">-</span>param[<span class="st">&#39;barmu&#39;</span>])<span class="sc">/</span>(<span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>])))</span>
<span id="cb137-13"><a href="NE.html#cb137-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(param[<span class="st">&#39;pxi&#39;</span>]<span class="sc">*</span>(first <span class="sc">-</span> second))  </span>
<span id="cb137-14"><a href="NE.html#cb137-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb137-15"><a href="NE.html#cb137-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-16"><a href="NE.html#cb137-16" aria-hidden="true" tabindex="-1"></a><span class="co"># mean impact on compliers-defiers</span></span>
<span id="cb137-17"><a href="NE.html#cb137-17" aria-hidden="true" tabindex="-1"></a>lower.cut.comp.def <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>]))</span>
<span id="cb137-18"><a href="NE.html#cb137-18" aria-hidden="true" tabindex="-1"></a>upper.cut.comp.def <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span><span class="fu">KappaStar</span>(param))</span>
<span id="cb137-19"><a href="NE.html#cb137-19" aria-hidden="true" tabindex="-1"></a>mean.alpha.comp.def.pop <span class="ot">&lt;-</span> <span class="fu">mtmvnorm</span>(<span class="at">mean=</span>mean.alpha.yBV,<span class="at">sigma=</span>cov.alpha.yBV,<span class="at">lower=</span>lower.cut.comp.def,<span class="at">upper=</span>upper.cut.comp.def,<span class="at">doComputeVariance=</span><span class="cn">FALSE</span>)[[<span class="dv">1</span>]]</span>
<span id="cb137-20"><a href="NE.html#cb137-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-21"><a href="NE.html#cb137-21" aria-hidden="true" tabindex="-1"></a><span class="co"># mean impact on surviving compliers</span></span>
<span id="cb137-22"><a href="NE.html#cb137-22" aria-hidden="true" tabindex="-1"></a>lower.cut.surv.comp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span><span class="fu">KappaStar</span>(param))</span>
<span id="cb137-23"><a href="NE.html#cb137-23" aria-hidden="true" tabindex="-1"></a>upper.cut.surv.comp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>])</span>
<span id="cb137-24"><a href="NE.html#cb137-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-25"><a href="NE.html#cb137-25" aria-hidden="true" tabindex="-1"></a>mean.alpha.surv.comp.pop <span class="ot">&lt;-</span> <span class="fu">mtmvnorm</span>(<span class="at">mean=</span>mean.alpha.yBV,<span class="at">sigma=</span>cov.alpha.yBV,<span class="at">lower=</span>lower.cut.surv.comp,<span class="at">upper=</span>upper.cut.surv.comp,<span class="at">doComputeVariance=</span><span class="cn">FALSE</span>)[[<span class="dv">1</span>]]</span></code></pre></div>
<p>The first have that <span class="math inline">\(\kappa^*=\)</span> 0.0452.
For this value of <span class="math inline">\(\kappa^*\)</span>, we have that <span class="math inline">\(\Pr(T_i=cd)=\)</span> 0.0128.
As expected, this is very close to the proportion of compliers in the population: <span class="math inline">\(\Pr(T_i=d)=\)</span> 0.0128.
Finally, the average treatment effect on the compliers-defiers is equal to: <span class="math inline">\(\Delta^y_{cd}=\)</span> 0.1457.
As expected, but luckily enough, since it was absolutely not sure, it is very close to the to the average treatment effect on the defiers: <span class="math inline">\(\Delta^y_{d}=\)</span> 0.1445.
So, in our model, Assumption <a href="NE.html#hyp:CD">4.5</a> is almost satisfied, and so does Theorem <a href="NE.html#thm:deChaise">4.1</a>.
As a consequence, the Wald estimator is very close to the effect on the surviving-compliers.
Indeed, the Wald estimator, in the population, is equal to <span class="math inline">\(\Delta^y_{Wald}=\)</span> 0.172156, while the average effect on surviving-compliers is equal to <span class="math inline">\(\Delta^y_{sc}=\)</span> 0.172108.</p>
</div>
<div id="identification-under-independence-of-treatment-effects" class="section level4" number="4.1.2.2">
<h4><span class="header-section-number">4.1.2.2</span> Identification under Independence of treatment effects</h4>
<p>Another way to get around the issue of Non-Monotonicity is simply to assume away any meaningful role for treatment effect heterogeneity.
One approach to that would simply be to assume that treatment effects are constant across individuals.
I leave to the reader to prove that in that case, the Wald estimator would recover the treatment effect under only Independence and Exclusion Restriction.
We are going to use a slightly more general approach here by assuming that treatment effect heterogeneity is unrelated to the reaction to the instrument:</p>

<div class="hypothesis">
<p><span id="hyp:IndepTreatEffect" class="hypothesis"><strong>Hypothesis 4.6  (Independent Treatment Effects)  </strong></span>We assume that the treatment effect is independent from potential reactions to the instrument:</p>
<span class="math display">\[\begin{align*}
\Delta^Y_i\Ind (D^1_i,D^0_i).
\end{align*}\]</span>
</div>
<p>We can now prove that, under Assumption <a href="NE.html#hyp:IndepTreatEffect">4.6</a>, the Wald estimator identifies the Average Treatment Effect (ATE), the average effect of the Treatment on the Treated (TT) and the average effect on compliers and on defiers.
The first thing to know before we state the result is that, under Assumption <a href="NE.html#hyp:IndepTreatEffect">4.6</a>, all these average treatment effects are equal to each other.
This is a direct implication of the following lemma:</p>

<div class="lemma">
<p><span id="lem:IndepTreatEffectType" class="lemma"><strong>Lemma 4.1  (Independence of Treatment Effects from Types)  </strong></span>Under Assumption <a href="NE.html#hyp:IndepTreatEffect">4.6</a>, the treatment effect is independent from types:</p>
<span class="math display">\[\begin{align*}
\Delta^Y_i\Ind T_i.
\end{align*}\]</span>
</div>

<div class="proof">
 <span class="proof"><em>Proof. </em></span> Lemma (4.2) in <a href="https://rss.onlinelibrary.wiley.com/doi/10.1111/j.2517-6161.1979.tb01052.x">Dawid (1979)</a> states that if <span class="math inline">\(X \Ind Y|Z\)</span> and <span class="math inline">\(U\)</span> is a function of <span class="math inline">\(X\)</span>, then <span class="math inline">\(U \Ind Y|Z\)</span>.
Since <span class="math inline">\(T_i\)</span> is a function of <span class="math inline">\((D^1_i,D^0_i)\)</span> under Assumption <a href="NE.html#hyp:IndepTreatEffect">4.6</a>, Lemma <a href="NE.html#lem:IndepTreatEffectType">4.1</a> follows.
</div>
<p>A direct corollary of Lemma <a href="NE.html#lem:IndepTreatEffectType">4.1</a> is:</p>

<div class="corollary">
<p><span id="cor:IndepTreatEffectAve" class="corollary"><strong>Corollary 4.1  (Independence of Treatment Effects and Average Effects)  </strong></span>Under Assumption <a href="NE.html#hyp:IndepTreatEffect">4.6</a>, the Average Treatment Effect (ATE), the average effect of the Treatment on the Treated (TT) and the average effect on compliers and on defiers are all equal:</p>
<span class="math display">\[\begin{align*}
\Delta^Y_{ATE} = \Delta^Y_{TT(1)} = \Delta^Y_{TT(0)} = \Delta^Y_{c} = \Delta^Y_{d}.
\end{align*}\]</span>
</div>
<p>with:
<span class="math display">\[\begin{align*}
\Delta^Y_{TT(z)} = \esp{Y_i^1-Y_i^0|D_i=1,Z_i=z}.
\end{align*}\]</span></p>

<div class="proof">
<p> <span class="proof"><em>Proof. </em></span> Using Lemma <a href="NE.html#lem:IndepTreatEffectType">4.1</a>, we have that:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{c} = \Delta^Y_{d} = \Delta^Y_{at} =\Delta^Y_{nt}.
\end{align*}\]</span></p>
Because <span class="math inline">\(T_i\)</span> is a partition, we have <span class="math inline">\(\Delta^Y_{ATE}=\Delta^Y_{c}\Pr(T_i=c)+\Delta^Y_{d}\Pr(T_i=d)+\Delta^Y_{at}\Pr(T_i=at)+\Delta^Y_{nt}\Pr(T_i=nt)=\Delta^Y_{c}\)</span> (since <span class="math inline">\(\Pr(T_i=c)+\Pr(T_i=d)+\Pr(T_i=at)+\Pr(T_i=nt)=1\)</span>).
Finally, we also have that <span class="math inline">\(\Delta^Y_{TT(1)}=\Delta^Y_{c}\Pr(T_i=c|D_i=1,Z_i=1)+\Delta^Y_{at}\Pr(T_i=at|D_i=1,Z_i=1)=\Delta^Y_{c}\)</span> and <span class="math inline">\(\Delta^Y_{TT(0)}=\Delta^Y_{d}\Pr(T_i=d|D_i=1,Z_i=0)+\Delta^Y_{at}\Pr(T_i=at|D_i=1,Z_i=0)=\Delta^Y_{c}\)</span>, since <span class="math inline">\((D_i=1)\cap(Z_i=1)\Rightarrow (T_i=c)\cup(T_i=at)\)</span> and <span class="math inline">\((D_i=1)\cap(Z_i=0)\Rightarrow (T_i=d)\cup(T_i=at)\)</span>.
</div>
<p>We are now equioped to state the final result of this section:</p>

<div class="theorem">
<p><span id="thm:IdentIndepTreatEffect" class="theorem"><strong>Theorem 4.2  (Identification under Independent Treatment Effect)  </strong></span>Under Assumptions <a href="NE.html#hyp:FirstStage">4.1</a>, <a href="NE.html#hyp:ExclusionRestriction">4.2</a>, <a href="NE.html#hyp:Independence">4.3</a> and <a href="NE.html#hyp:IndepTreatEffect">4.6</a>, the Wald estimator identifies the average effect of the Treatment on the Treated:</p>
<span class="math display">\[\begin{align*}
  \Delta^Y_{Wald} &amp; = \Delta^Y_{TT}.
\end{align*}\]</span>
</div>

<div class="proof">
<p> <span class="proof"><em>Proof. </em></span> Using the formula for the Wald estimator, we have, for the two components of its numerator:</p>
<p><span class="math display">\[\begin{align*}
\esp{Y_i|Z_i=1} &amp; = \esp{Y_i^0+(Y_i^1-Y_i^0)D_i|Z_i=1} \\
                &amp; = \esp{Y_i^0|Z_i=1}+\esp{\Delta^Y_i|D_i=1,Z_i=1}\Pr(D_i=1|Z_i=1)\\
                &amp; = \esp{Y_i^0|Z_i=1}+\Delta^Y_{TT(1)}\Pr(D_i=1|Z_i=1)\\
\esp{Y_i|Z_i=0} &amp; = \esp{Y_i^0+(Y_i^1-Y_i^0)D_i|Z_i=0} \\
                &amp; = \esp{Y_i^0|Z_i=0}+\esp{\Delta^Y_i|D_i=0,Z_i=1}\Pr(D_i=1|Z_i=0)\\
                &amp; = \esp{Y_i^0|Z_i=0}+\Delta^Y_{TT(0)}\Pr(D_i=1|Z_i=0),\\
\end{align*}\]</span></p>
<p>where the first equalities use Assumption <a href="NE.html#hyp:ExclusionRestriction">4.2</a>.
Now, under Assumption <a href="NE.html#hyp:IndepTreatEffect">4.6</a>, Corollary <a href="NE.html#cor:IndepTreatEffectAve">4.1</a> implies that <span class="math inline">\(\Delta^Y_{TT(0)}=\Delta^Y_{TT(1)}=\Delta^Y_{TT}\)</span>.
We thus have that the numerator of the Wald estimator is equal to:</p>
<p><span class="math display">\[\begin{align*}
\esp{Y_i|Z_i=1}-\esp{Y_i|Z_i=0} &amp; = \Delta^Y_{TT}(\Pr(D_i=1|Z_i=1)-\Pr(D_i=1|Z_i=0))\\
                                &amp; \phantom{=}+\esp{Y_i^0|Z_i=1}-\esp{Y_i^0|Z_i=0}.
\end{align*}\]</span></p>
Assumption <a href="NE.html#hyp:Independence">4.3</a> implies that <span class="math inline">\(\esp{Y_i^0|Z_i=1}=\esp{Y_i^0|Z_i=0}\)</span>.
Using Assumption <a href="NE.html#hyp:FirstStage">4.1</a> proves the result.
</div>
</div>
<div id="identification-under-monotonicity" class="section level4" number="4.1.2.3">
<h4><span class="header-section-number">4.1.2.3</span> Identification under Monotonicity</h4>
<p>The classical approach to identification using instrumental variables is due to <a href="https://www.jstor.org/stable/2951620">Imbens and Angrist (1994)</a> and <a href="https://www.jstor.org/stable/2291629">Angrist, Imbens and Rubin (1996)</a>.
It rests on Assumption <a href="NE.html#hyp:MonotonicityIV">4.4</a> or Monotonicity that we are now familiar with, that requires that the effect of the instrument on treatment participation moves everyone in the same direction.</p>

<div class="remark">
 <span class="remark"><em>Remark. </em></span> For the rest of the section, we will assume that <span class="math inline">\(\forall i\)</span>, <span class="math inline">\(D^1_i\geq D_i^0\)</span>.
It is without loss of generality, since if the initial treatment does not comply with this requirement, you can simply redefine a new treatment equal to <span class="math inline">\(-D_i\)</span>.
</div>
<p>Under Monotonicity, there are no defiers.
This is what the following lemma shows:</p>

<div class="lemma">
<p><span id="lem:NoDefiers" class="lemma"><strong>Lemma 4.2  </strong></span>Under Assumption <a href="NE.html#hyp:MonotonicityIV">4.4</a>, there are no defiers a.s.:</p>
<span class="math display">\[\begin{align*}
  \Pr(T_i=c) &amp; = 0.
\end{align*}\]</span>
</div>

<div class="proof">
 <span class="proof"><em>Proof. </em></span> Under Assumption <a href="NE.html#hyp:MonotonicityIV">4.4</a>, <span class="math inline">\(\forall i\)</span>, <span class="math inline">\(D^1_i\geq D_i^0\)</span>.
As a consequence, <span class="math inline">\(\Pr(D^1_i &lt; D_i^0)=0\)</span>.
Since defiers are defined as <span class="math inline">\(D^1_i &lt; D_i^0\)</span>, the result follows.
</div>
<p>In the absence of defiers, the Wald estimator identifies the average effect of the treatment on the compliers, also called the Local Average Treatment Effect:</p>

<div class="theorem">
<p><span id="thm:IdentLATEIV" class="theorem"><strong>Theorem 4.3  </strong></span>Under Assumptions <a href="NE.html#hyp:FirstStage">4.1</a>, <a href="NE.html#hyp:ExclusionRestriction">4.2</a>, <a href="NE.html#hyp:Independence">4.3</a> and <a href="NE.html#hyp:MonotonicityIV">4.4</a>, the Wald estimator identifies the average effect of the treatment on the compliers, also called the Local Average Treatment Effect:</p>
<span class="math display">\[\begin{align*}
  \Delta^Y_{Wald}&amp; = \Delta^Y_{LATE}.
\end{align*}\]</span>
</div>

<div class="proof">
 <span class="proof"><em>Proof. </em></span> Using Theorem <a href="RCT.html#thm:IdentLATE">3.9</a> directly proves the result.
</div>

<div class="remark">
 <span class="remark"><em>Remark. </em></span> The magic of the instrumental variables setting applies again.
By moving the instrument, we are able to learn something about the causal effect of the treatment.
Monotonicity is a very strong assumption though, as are Independence and Exclusion Restriction.
They are very rarely met in practice.
Even the case of RCTs with encouragement design, where Independence holds by design, might be affected by failures of Exclusion Restriction and/or Monotonicity.
</div>

<div class="example">
<span id="exm:unnamed-chunk-157" class="example"><strong>Example 4.8  </strong></span>Let’s see how monotonicity works in our example.
</div>
<p>First, we have to generate a model in which monotonicity holds.
For that, we need to shut down heterogeneous reactions to the instrument.
In practice, we are going to replace the participation equation in our model, which was characterized by a random coefficient, by the following one, which has a constant coefficient:</p>
<p><span class="math display">\[\begin{align*}
  D_i &amp; = \uns{y_i^B+\bar{\kappa} Z_i + V_i\leq\bar{y}} 
\end{align*}\]</span></p>
<p>As a consequence, we have no more defiers and monotonicity holds.
Let us now generate the data from the model with monotonicity:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="NE.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb138-2"><a href="NE.html#cb138-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb138-3"><a href="NE.html#cb138-3" aria-hidden="true" tabindex="-1"></a>cov.eta.omega <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(param[<span class="st">&quot;sigma2eta&quot;</span>],param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;sigma2omega&quot;</span>]),<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb138-4"><a href="NE.html#cb138-4" aria-hidden="true" tabindex="-1"></a>eta.omega <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">mvrnorm</span>(N,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),cov.eta.omega))</span>
<span id="cb138-5"><a href="NE.html#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(eta.omega) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;eta&#39;</span>,<span class="st">&#39;omega&#39;</span>)</span>
<span id="cb138-6"><a href="NE.html#cb138-6" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))</span>
<span id="cb138-7"><a href="NE.html#cb138-7" aria-hidden="true" tabindex="-1"></a>UB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb138-8"><a href="NE.html#cb138-8" aria-hidden="true" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UB </span>
<span id="cb138-9"><a href="NE.html#cb138-9" aria-hidden="true" tabindex="-1"></a>YB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yB)</span>
<span id="cb138-10"><a href="NE.html#cb138-10" aria-hidden="true" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb138-11"><a href="NE.html#cb138-11" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,param[<span class="st">&quot;pZ&quot;</span>])</span>
<span id="cb138-12"><a href="NE.html#cb138-12" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> param[<span class="st">&quot;gamma&quot;</span>]<span class="sc">*</span>(mu<span class="sc">-</span>param[<span class="st">&quot;barmu&quot;</span>])<span class="sc">+</span>eta.omega<span class="sc">$</span>omega</span>
<span id="cb138-13"><a href="NE.html#cb138-13" aria-hidden="true" tabindex="-1"></a>Ds[yB<span class="sc">-</span>param[<span class="st">&quot;barkappa&quot;</span>]<span class="sc">*</span>Z<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb138-14"><a href="NE.html#cb138-14" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb138-15"><a href="NE.html#cb138-15" aria-hidden="true" tabindex="-1"></a>U0 <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilon</span>
<span id="cb138-16"><a href="NE.html#cb138-16" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0 <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb138-17"><a href="NE.html#cb138-17" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta.omega<span class="sc">$</span>eta</span>
<span id="cb138-18"><a href="NE.html#cb138-18" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y0<span class="sc">+</span>alpha</span>
<span id="cb138-19"><a href="NE.html#cb138-19" aria-hidden="true" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y0)</span>
<span id="cb138-20"><a href="NE.html#cb138-20" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(y1)</span>
<span id="cb138-21"><a href="NE.html#cb138-21" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y1<span class="sc">*</span>Ds<span class="sc">+</span>y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span>
<span id="cb138-22"><a href="NE.html#cb138-22" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y1<span class="sc">*</span>Ds<span class="sc">+</span>Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)</span></code></pre></div>
<p>We can now define the types variable <span class="math inline">\(T_i\)</span>:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="NE.html#cb139-1" aria-hidden="true" tabindex="-1"></a>D1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(yB<span class="sc">-</span>param[<span class="st">&quot;barkappa&quot;</span>]<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb139-2"><a href="NE.html#cb139-2" aria-hidden="true" tabindex="-1"></a>D0 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(yB<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb139-3"><a href="NE.html#cb139-3" aria-hidden="true" tabindex="-1"></a>AT <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb139-4"><a href="NE.html#cb139-4" aria-hidden="true" tabindex="-1"></a>NT <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb139-5"><a href="NE.html#cb139-5" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb139-6"><a href="NE.html#cb139-6" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(D1<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> D0<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb139-7"><a href="NE.html#cb139-7" aria-hidden="true" tabindex="-1"></a>Type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(AT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;a&#39;</span>,</span>
<span id="cb139-8"><a href="NE.html#cb139-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ifelse</span>(NT<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;n&#39;</span>,</span>
<span id="cb139-9"><a href="NE.html#cb139-9" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">ifelse</span>(C<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;c&#39;</span>,</span>
<span id="cb139-10"><a href="NE.html#cb139-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">ifelse</span>(D<span class="sc">==</span><span class="dv">1</span>,<span class="st">&#39;d&#39;</span>,<span class="st">&quot;&quot;</span>))))</span>
<span id="cb139-11"><a href="NE.html#cb139-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-12"><a href="NE.html#cb139-12" aria-hidden="true" tabindex="-1"></a>data.mono <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(Type,C,NT,AT,D1,D0,Y,y,Y1,Y0,y0,y1,yB,alpha,U0,eta.omega<span class="sc">$</span>eta,epsilon,Ds,xi,Z,mu,UB))</span></code></pre></div>
<p>The first thing we can check is that there are no defiers.
For that, let’s count the number of individuals who have <span class="math inline">\(T_i=1\)</span>.
It is equal to 0.</p>
<p>One thing that helped me understand how the IV approach under monotonicity works is the following graph:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="NE.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yB[AT<span class="sc">==</span><span class="dv">1</span>]<span class="sc">+</span>V[AT<span class="sc">==</span><span class="dv">1</span>],y[AT<span class="sc">==</span><span class="dv">1</span>],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="at">xlab=</span><span class="st">&quot;yB+V&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;Outcomes&quot;</span>)</span>
<span id="cb140-2"><a href="NE.html#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[NT<span class="sc">==</span><span class="dv">1</span>]<span class="sc">+</span>V[NT<span class="sc">==</span><span class="dv">1</span>],y[NT<span class="sc">==</span><span class="dv">1</span>],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb140-3"><a href="NE.html#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Ds<span class="sc">==</span><span class="dv">1</span>]<span class="sc">+</span>V[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Ds<span class="sc">==</span><span class="dv">1</span>],y[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Ds<span class="sc">==</span><span class="dv">1</span>],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb140-4"><a href="NE.html#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(yB[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Ds<span class="sc">==</span><span class="dv">0</span>]<span class="sc">+</span>V[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Ds<span class="sc">==</span><span class="dv">0</span>],y[C<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Ds<span class="sc">==</span><span class="dv">0</span>],<span class="at">pch=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb140-5"><a href="NE.html#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb140-6"><a href="NE.html#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>],<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb140-7"><a href="NE.html#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>]),<span class="at">y=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>)),<span class="fu">expression</span>(<span class="fu">bar</span>(<span class="st">&#39;y&#39;</span>)<span class="sc">+</span><span class="fu">bar</span>(kappa))),<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;red&quot;</span>))</span>
<span id="cb140-8"><a href="NE.html#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">5</span>,<span class="fl">10.5</span>,<span class="fu">c</span>(<span class="st">&#39;AT&#39;</span>,<span class="st">&#39;NT&#39;</span>,<span class="st">&#39;C|D=1&#39;</span>,<span class="st">&#39;C|D=0&#39;</span>),<span class="at">pch=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&#39;blue&#39;</span>,<span class="st">&quot;red&quot;</span>,<span class="st">&#39;green&#39;</span>),<span class="at">ncol=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plottypesMono"></span>
<img src="STCI_files/figure-html/plottypesMono-1.png" alt="Types under Monotonicity" width="50%" />
<p class="caption">
Figure 4.4: Types under Monotonicity
</p>
</div>
<p>What <a href="NE.html#fig:plottypesMono">4.4</a> shows is that the IV acts as a randomized controlled trial among compliers.
Within the population of compliers, whether one receives the treatment or not is as good as random.
If we actually knew who the compliers were, we could directly estimate the effect of the treatment by comparing the outcomes of the treated compliers to the outcomes of the untreated compliers.
Actually, this approach, applied in our sample, yields an estimated treatment effect on the compliers of 0.07, whereas the simple comparison of participants and non participants would give an estimate of -0.97.
In our sample, the average effect of the treatment on compliers is actually equal to 0.19.</p>
<p>Let us finally check that Theorem <a href="NE.html#thm:IdentLATEIV">4.3</a> works in the population in our new model.
We need to compute the various parts of the Wald estimator and the average effect of the treatment on the compliers.
The key to understand the Wald estimator is to see that its numerator is composed of the difference between two means, with both means containing the average outcomes of always takers and never takers weighted by their respective proportions in the population, as shown in the proof of Theorem <a href="NE.html#thm:IdentLATEIV">4.3</a>.
These two means cancel out, leaving only the differences in the means of the compliers in and out of the treatment, weighted by their proportion in the population.
The denominator of the Wald estimator simply provides an estimate of the proportion of compliers.
In order to illustrate these intuitions in our example, I am going to use the formula for a truncated multivariate normal variable and the package <code>tmvtnorm</code>.
The most important thing to notice here is that <span class="math inline">\((y^0_i,y^1_i,y_i^B+V_i) \sim \mathcal{N}\left(\bar{\mu}+\delta,\bar{\mu}(1+\theta)+\delta+\bar{\alpha},\bar{\mu},\mathbf{C}\right)\)</span> with:</p>
<p><span class="math display">\[\begin{align*}
  \mathbf{C} &amp;=                    \left(\begin{array}{ccc}
                                              \sigma^2_{\mu}+\rho^2\sigma^2_{U} +\sigma^2_{\epsilon} &amp;
                                              (1+\theta)\sigma^2_{\mu}+\rho^2\sigma^2_U + \sigma^2_{\epsilon} &amp;
                                              (1+\gamma)\sigma^2_{\mu}+\rho\sigma^2_U \\
                                              (1+\theta)\sigma^2_{\mu}+\rho^2\sigma^2_U + \sigma^2_{\epsilon} &amp;
                                              (1+\theta^2)\sigma^2_{\mu}+\rho^2\sigma^2_{U} +\sigma^2_{\epsilon} + \sigma^2_{\eta} &amp;
                                              (1+\theta+\gamma)\sigma^2_{\mu}+\rho\sigma^2_U+\rho_{\eta,\omega}\sigma^2_{\eta}\sigma^2_{\omega} \\
                                              (1+\gamma)\sigma^2_{\mu}+\rho\sigma^2_U &amp;
                                              (1+\theta+\gamma)\sigma^2_{\mu}+\rho\sigma^2_U+\rho_{\eta,\omega}\sigma^2_{\eta}\sigma^2_{\omega} &amp;
                                              (1+\gamma^2)\sigma^2_{\mu}+\sigma^2_U+\sigma^2_{\omega} \\
                                              \end{array}
                                        \right)
\end{align*}\]</span></p>
<p>We now simply have to derive the mean outcomes and proportions of each type in the population in order to form the Wald estimator.
Let me first derive the joint distribution of the portential outcomes and the means and proportions of each type in the population.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="NE.html#cb141-1" aria-hidden="true" tabindex="-1"></a>mean.y0.y1.yBV <span class="ot">&lt;-</span> <span class="fu">c</span>(param[<span class="st">&#39;barmu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;delta&#39;</span>],param[<span class="st">&#39;barmu&#39;</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;theta&#39;</span>])<span class="sc">+</span>param[<span class="st">&#39;delta&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;baralpha&#39;</span>],param[<span class="st">&#39;barmu&#39;</span>])</span>
<span id="cb141-2"><a href="NE.html#cb141-2" aria-hidden="true" tabindex="-1"></a>cov.y0.y1.yBV <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rho&#39;</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2epsilon&#39;</span>],</span>
<span id="cb141-3"><a href="NE.html#cb141-3" aria-hidden="true" tabindex="-1"></a>                          (<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;theta&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rho&#39;</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2epsilon&#39;</span>],</span>
<span id="cb141-4"><a href="NE.html#cb141-4" aria-hidden="true" tabindex="-1"></a>                          (<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rho&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2U&#39;</span>],</span>
<span id="cb141-5"><a href="NE.html#cb141-5" aria-hidden="true" tabindex="-1"></a>                          (<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;theta&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rho&#39;</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2epsilon&#39;</span>],</span>
<span id="cb141-6"><a href="NE.html#cb141-6" aria-hidden="true" tabindex="-1"></a>                          (<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;theta&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rho&#39;</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2epsilon&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2eta&#39;</span>],</span>
<span id="cb141-7"><a href="NE.html#cb141-7" aria-hidden="true" tabindex="-1"></a>                          (<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;theta&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rho&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rhoetaomega&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2eta&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2omega&#39;</span>],</span>
<span id="cb141-8"><a href="NE.html#cb141-8" aria-hidden="true" tabindex="-1"></a>                          (<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rho&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2U&#39;</span>],</span>
<span id="cb141-9"><a href="NE.html#cb141-9" aria-hidden="true" tabindex="-1"></a>                          (<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;theta&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>])<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rho&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;rhoetaomega&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2eta&#39;</span>]<span class="sc">*</span>param[<span class="st">&#39;sigma2omega&#39;</span>],</span>
<span id="cb141-10"><a href="NE.html#cb141-10" aria-hidden="true" tabindex="-1"></a>                          (<span class="dv">1</span><span class="sc">+</span>param[<span class="st">&#39;gamma&#39;</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>param[<span class="st">&#39;sigma2mu&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2U&#39;</span>]<span class="sc">+</span>param[<span class="st">&#39;sigma2omega&#39;</span>]),<span class="dv">3</span>,<span class="dv">3</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb141-11"><a href="NE.html#cb141-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-12"><a href="NE.html#cb141-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-13"><a href="NE.html#cb141-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-14"><a href="NE.html#cb141-14" aria-hidden="true" tabindex="-1"></a><span class="co"># cuts</span></span>
<span id="cb141-15"><a href="NE.html#cb141-15" aria-hidden="true" tabindex="-1"></a><span class="co">#always takers</span></span>
<span id="cb141-16"><a href="NE.html#cb141-16" aria-hidden="true" tabindex="-1"></a>lower.cut.at <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="sc">-</span><span class="cn">Inf</span>,<span class="sc">-</span><span class="cn">Inf</span>)</span>
<span id="cb141-17"><a href="NE.html#cb141-17" aria-hidden="true" tabindex="-1"></a>upper.cut.at <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>]))</span>
<span id="cb141-18"><a href="NE.html#cb141-18" aria-hidden="true" tabindex="-1"></a><span class="co"># compliers</span></span>
<span id="cb141-19"><a href="NE.html#cb141-19" aria-hidden="true" tabindex="-1"></a>lower.cut.comp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="sc">-</span><span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>]))</span>
<span id="cb141-20"><a href="NE.html#cb141-20" aria-hidden="true" tabindex="-1"></a>upper.cut.comp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>])</span>
<span id="cb141-21"><a href="NE.html#cb141-21" aria-hidden="true" tabindex="-1"></a><span class="co"># never takers</span></span>
<span id="cb141-22"><a href="NE.html#cb141-22" aria-hidden="true" tabindex="-1"></a>lower.cut.nt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="sc">-</span><span class="cn">Inf</span>,<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>])</span>
<span id="cb141-23"><a href="NE.html#cb141-23" aria-hidden="true" tabindex="-1"></a>upper.cut.nt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="cn">Inf</span>)</span>
<span id="cb141-24"><a href="NE.html#cb141-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-25"><a href="NE.html#cb141-25" aria-hidden="true" tabindex="-1"></a><span class="co"># means by types</span></span>
<span id="cb141-26"><a href="NE.html#cb141-26" aria-hidden="true" tabindex="-1"></a><span class="co">#always takers</span></span>
<span id="cb141-27"><a href="NE.html#cb141-27" aria-hidden="true" tabindex="-1"></a>mean.y1.at.pop <span class="ot">&lt;-</span> <span class="fu">mtmvnorm</span>(<span class="at">mean=</span>mean.y0.y1.yBV,<span class="at">sigma=</span>cov.y0.y1.yBV,<span class="at">lower=</span>lower.cut.at,<span class="at">upper=</span>upper.cut.at,<span class="at">doComputeVariance=</span><span class="cn">FALSE</span>)[[<span class="dv">1</span>]][[<span class="dv">2</span>]]</span>
<span id="cb141-28"><a href="NE.html#cb141-28" aria-hidden="true" tabindex="-1"></a>mean.y0.at.pop <span class="ot">&lt;-</span> <span class="fu">mtmvnorm</span>(<span class="at">mean=</span>mean.y0.y1.yBV,<span class="at">sigma=</span>cov.y0.y1.yBV,<span class="at">lower=</span>lower.cut.at,<span class="at">upper=</span>upper.cut.at,<span class="at">doComputeVariance=</span><span class="cn">FALSE</span>)[[<span class="dv">1</span>]][[<span class="dv">1</span>]]</span>
<span id="cb141-29"><a href="NE.html#cb141-29" aria-hidden="true" tabindex="-1"></a><span class="co"># never takers</span></span>
<span id="cb141-30"><a href="NE.html#cb141-30" aria-hidden="true" tabindex="-1"></a>mean.y1.nt.pop <span class="ot">&lt;-</span> <span class="fu">mtmvnorm</span>(<span class="at">mean=</span>mean.y0.y1.yBV,<span class="at">sigma=</span>cov.y0.y1.yBV,<span class="at">lower=</span>lower.cut.nt,<span class="at">upper=</span>upper.cut.nt,<span class="at">doComputeVariance=</span><span class="cn">FALSE</span>)[[<span class="dv">1</span>]][[<span class="dv">2</span>]]</span>
<span id="cb141-31"><a href="NE.html#cb141-31" aria-hidden="true" tabindex="-1"></a>mean.y0.nt.pop <span class="ot">&lt;-</span> <span class="fu">mtmvnorm</span>(<span class="at">mean=</span>mean.y0.y1.yBV,<span class="at">sigma=</span>cov.y0.y1.yBV,<span class="at">lower=</span>lower.cut.nt,<span class="at">upper=</span>upper.cut.nt,<span class="at">doComputeVariance=</span><span class="cn">FALSE</span>)[[<span class="dv">1</span>]][[<span class="dv">1</span>]]</span>
<span id="cb141-32"><a href="NE.html#cb141-32" aria-hidden="true" tabindex="-1"></a><span class="co">#compliers</span></span>
<span id="cb141-33"><a href="NE.html#cb141-33" aria-hidden="true" tabindex="-1"></a>mean.y1.comp.pop <span class="ot">&lt;-</span> <span class="fu">mtmvnorm</span>(<span class="at">mean=</span>mean.y0.y1.yBV,<span class="at">sigma=</span>cov.y0.y1.yBV,<span class="at">lower=</span>lower.cut.comp,<span class="at">upper=</span>upper.cut.comp,<span class="at">doComputeVariance=</span><span class="cn">FALSE</span>)[[<span class="dv">1</span>]][[<span class="dv">2</span>]]</span>
<span id="cb141-34"><a href="NE.html#cb141-34" aria-hidden="true" tabindex="-1"></a>mean.y0.comp.pop <span class="ot">&lt;-</span> <span class="fu">mtmvnorm</span>(<span class="at">mean=</span>mean.y0.y1.yBV,<span class="at">sigma=</span>cov.y0.y1.yBV,<span class="at">lower=</span>lower.cut.comp,<span class="at">upper=</span>upper.cut.comp,<span class="at">doComputeVariance=</span><span class="cn">FALSE</span>)[[<span class="dv">1</span>]][[<span class="dv">1</span>]]</span>
<span id="cb141-35"><a href="NE.html#cb141-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-36"><a href="NE.html#cb141-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of each types</span></span>
<span id="cb141-37"><a href="NE.html#cb141-37" aria-hidden="true" tabindex="-1"></a><span class="co"># always takers</span></span>
<span id="cb141-38"><a href="NE.html#cb141-38" aria-hidden="true" tabindex="-1"></a>prop.at.pop <span class="ot">&lt;-</span> <span class="fu">ptmvnorm.marginal</span>(<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>]),<span class="at">n=</span><span class="dv">3</span>,<span class="at">mean=</span>mean.y0.y1.yBV,<span class="at">sigma=</span>cov.y0.y1.yBV)[[<span class="dv">1</span>]]</span>
<span id="cb141-39"><a href="NE.html#cb141-39" aria-hidden="true" tabindex="-1"></a><span class="co"># never takers</span></span>
<span id="cb141-40"><a href="NE.html#cb141-40" aria-hidden="true" tabindex="-1"></a>prop.nt.pop <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">ptmvnorm.marginal</span>(<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>],<span class="at">n=</span><span class="dv">3</span>,<span class="at">mean=</span>mean.y0.y1.yBV,<span class="at">sigma=</span>cov.y0.y1.yBV)[[<span class="dv">1</span>]]</span>
<span id="cb141-41"><a href="NE.html#cb141-41" aria-hidden="true" tabindex="-1"></a><span class="co"># compliers</span></span>
<span id="cb141-42"><a href="NE.html#cb141-42" aria-hidden="true" tabindex="-1"></a>prop.comp.pop <span class="ot">&lt;-</span> <span class="fu">ptmvnorm.marginal</span>(<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>])<span class="sc">+</span>param[<span class="st">&#39;barkappa&#39;</span>],<span class="at">n=</span><span class="dv">3</span>,<span class="at">mean=</span>mean.y0.y1.yBV,<span class="at">sigma=</span>cov.y0.y1.yBV)[[<span class="dv">1</span>]]<span class="sc">-</span><span class="fu">ptmvnorm.marginal</span>(<span class="fu">log</span>(param[<span class="st">&#39;barY&#39;</span>]),<span class="at">n=</span><span class="dv">3</span>,<span class="at">mean=</span>mean.y0.y1.yBV,<span class="at">sigma=</span>cov.y0.y1.yBV)[[<span class="dv">1</span>]]</span></code></pre></div>
<p>We are now equipped to compute the Wald estimator in the population.
Before that, let us compute the LATE.
We have <span class="math inline">\(\Delta^Y_{LATE} =\)</span> 0.179.
The Wald estimator is equal to <span class="math inline">\(\Delta^Y_{Wald} =\)</span> 0.179.
They are obviously equal.
This is because the numerator of the Wald is equal to the product of the LATE multiplied by the proportion of compliers (which is equal to 0.066).
This is because the outcomes of never takers and always takers cancel out on each separate term of the numerator of the Wald estimator.
Indeed, we have that the numerator of the Wald estimator is equal to: 0.066.</p>
</div>
</div>
<div id="estimation" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Estimation</h3>
</div>
<div id="estimation-of-sampling-noise" class="section level3" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Estimation of sampling noise</h3>
</div>
</div>
<div id="regression-discontinuity-designs" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Regression Discontinuity Designs</h2>
</div>
<div id="difference-in-differences" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Difference In Differences</h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="RCT.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec:OM.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/chabefer/STCI/blob/master/04_NE.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["STCI.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 1
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
