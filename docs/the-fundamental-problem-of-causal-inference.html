<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Statistical Tools for Causal Inference</title>
  <meta name="description" content="This is an open source collaborative book.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Statistical Tools for Causal Inference" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is an open source collaborative book." />
  <meta name="github-repo" content="chabefer/STCI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Statistical Tools for Causal Inference" />
  
  <meta name="twitter:description" content="This is an open source collaborative book." />
  

<meta name="author" content="The SKY Community">


<meta name="date" content="2019-04-13">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







$$
\newcommand{\uns}[1]{\mathbf{1}[#1]}
$$


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Tools for Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>I The Two Fundamental Problems of Inference</b></span></li>
<li class="chapter" data-level="1" data-path="the-fundamental-problem-of-causal-inference.html"><a href="the-fundamental-problem-of-causal-inference.html"><i class="fa fa-check"></i><b>1</b> The Fundamental Problem of Causal Inference</a><ul>
<li class="chapter" data-level="1.1" data-path="the-fundamental-problem-of-causal-inference.html"><a href="the-fundamental-problem-of-causal-inference.html#rubin-causal-model"><i class="fa fa-check"></i><b>1.1</b> Rubin Causal Model</a><ul>
<li class="chapter" data-level="1.1.1" data-path="the-fundamental-problem-of-causal-inference.html"><a href="the-fundamental-problem-of-causal-inference.html#the-treatment-allocation-rule"><i class="fa fa-check"></i><b>1.1.1</b> The treatment allocation rule</a></li>
<li class="chapter" data-level="1.1.2" data-path="the-fundamental-problem-of-causal-inference.html"><a href="the-fundamental-problem-of-causal-inference.html#the-potential-outcomes"><i class="fa fa-check"></i><b>1.1.2</b> The potential outcomes</a></li>
<li class="chapter" data-level="1.1.3" data-path="the-fundamental-problem-of-causal-inference.html"><a href="the-fundamental-problem-of-causal-inference.html#the-switching-equation"><i class="fa fa-check"></i><b>1.1.3</b> The switching equation</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Tools for Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-fundamental-problem-of-causal-inference" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> The Fundamental Problem of Causal Inference</h1>
<p>In order to state the FPCI, we are going to describe the basic language to encode causality set up by Rubin, and named <a href="RCM.html">Rubin Causal Model (RCM)</a>. RCM being about partly observed random variables, it is hard to make these notions concrete with real data. That’s why we are going to use simulations from a simple model in order to make it clear how these variables are generated. The second virtue of this model is that it is going to make it clear the source of selection into the treatment. This is going to be useful when understanding biases of intuitive comparisons, but also to discuss the methods of causal inference. A third virtue of this approach is that it makes clear the connexion between the treatment effects literature and models. Finally, a fourth reason that it is useful is that it is going to give us a source of sampling variation that we are going to use to visualize and explore the properties of our estimators.</p>
<p>I use <span class="math inline">\(X_i\)</span> to denote random variable <span class="math inline">\(X\)</span> all along the notes. I assume that we have access to a sample of <span class="math inline">\(N\)</span> observations indexed by <span class="math inline">\(i\in\left\{1,\dots,N\right\}\)</span>. ‘’<span class="math inline">\(i\)</span>’’ will denote the basic sampling units when we are in a sample, and a basic element of the probability space when we are in populations. Introducing rigorous measure-theoretic notations for the population is feasible but is not necessary for comprehension.</p>
<p>When the sample size is infinite, we say that we have a population. A population is a very useful fiction for two reasons. First, in a population, there is no sampling noise: we observe an infinite amount of observations, and our estimators are infinitely precise. This is useful to study phenomena independently of sampling noise. For example, it is in general easier to prove that an estimator is equal to <span class="math inline">\(TT\)</span> under some conditions in the population. Second, we are most of the time much more interested in estimating the values of parameters in the population rather than in the sample. The population parameter, independent of sampling noise, gives a much better idea of the causal parameter for the population of interest than the parameter in the sample. In general, the estimator for both quantities will be the same, but the estimators for the effetc of sampling noise on these estimators will differ. Sampling noise for the population parameter will generally be larger, since it is affected by another source of variability (sample choice).</p>
<div id="rubin-causal-model" class="section level2">
<h2><span class="header-section-number">1.1</span> Rubin Causal Model</h2>
<p>The RCM is made of three distinct building blocks: a treatment allocation rule, that decides who receives the treatment; potential outcomes, that measure how each individual reacts to the treatment; the switching equation that relates potential outcomes to observed outcomes through the allocation rule.</p>
<div id="the-treatment-allocation-rule" class="section level3">
<h3><span class="header-section-number">1.1.1</span> The treatment allocation rule</h3>
<p>The first building block of the RCM is the treatment allocation rule. Throughout this class, we are going to be interested in inferring the causal effect of only one treatment with respect to a control condition. Extensions to multi-valued treatments are in general self-explanatory.</p>
<p>In the RCM, treatment allocation is captured by the variable <span class="math inline">\(D_i\)</span>. <span class="math inline">\(D_i=1\)</span> if unit <span class="math inline">\(i\)</span> receives the treatment and <span class="math inline">\(D_i=0\)</span> if unit <span class="math inline">\(i\)</span> does not receive the treatment and thus remains in the control condition.</p>
<p>The treatment allocation rule is critical for several reasons. First, because it switches the treatment on or off for each unit, it is going to be at the source of the FPCI. Second, the specific properties of the treatment allocatoin rule are going to matter for the feasibility and bias of the various econometric methods that we are going to study.</p>
<p>Let’s take a few examples of allocation rules. These allocation rules are just examples. They do not cover the space of all possible allocation rules. They are especially useful as concrete devices to understand the sources of biases and the nature of the allocation rule. In reality, there exists even more complex allocation rules (awareness, eligibility, application, acceptance, active participation). Awareness seems especially important for program participation and has only been tackled recently by economists.</p>
<p>First, some notation. Let’s imagine a treatment that is given to individuals. Whether each individual receives the treatment partly depends on the level of her outcome before receiving the treatment. Let’s denote this variable <span class="math inline">\(Y^B_i\)</span>, with <span class="math inline">\(B\)</span> standing for “Before”. It can be the health status assessed by a professional before deciding to give a drug to a patient. It can be the poverty level of a household used to assess its eligibilty to a cash transfer program.</p>
<div id="the-sharp-cutoff-rule" class="section level4">
<h4><span class="header-section-number">1.1.1.1</span> The sharp cutoff rule</h4>
<p>The sharp cutoff rule means that everyone below some threshold <span class="math inline">\(\bar{Y}\)</span> is going to receive the treatment. Everyone whose outcome before the treatment lies above <span class="math inline">\(\bar{Y}\)</span> does not receive the treatment. Such rules can be found in reality in a lot of situations. They might be generated by administrative rules. One very simple way to model this rule is as follows:</p>
<span class="math display">\[\begin{align}\label{eq:cutoff}
  D_i &amp; = \uns{Y_i^B\leq\bar{Y}},
\end{align}\]</span>
<p>where <span class="math inline">\(\uns{A}\)</span> is the indicator function, taking value <span class="math inline">\(1\)</span> when <span class="math inline">\(A\)</span> is true and <span class="math inline">\(0\)</span> otherwise.</p>

<div class="example">
<span id="exm:unnamed-chunk-1" class="example"><strong>Example 1.1  (Sharp cutoff rule)  </strong></span>Imagine that <span class="math inline">\(Y_i^B=\exp(y_i^B)\)</span>, with <span class="math inline">\(y_i^B=\mu_i+U_i^B\)</span>, <span class="math inline">\(\mu_i\sim\mathcal{N}(\bar{\mu},\sigma^2_{\mu})\)</span> and <span class="math inline">\(U_i^B\sim\mathcal{N}(0,\sigma^2_{U})\)</span>. Now, let’s choose some values for these parameters so that we can generate a sample of individuals and allocate the treatment among them. I’m going to switch to R for that.
</div>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">param &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>)
<span class="kw">names</span>(param) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>)
param</code></pre></div>
<pre><code>##    barmu sigma2mu  sigma2U     barY 
##     8.00     0.50     0.28  1500.00</code></pre>
<p>Now, I have choosen values for the parameters in my model. For example, <span class="math inline">\(\bar{\mu}=\)</span> 8 and <span class="math inline">\(\bar{Y}=\)</span> 1500. What remains to be done is to generate <span class="math inline">\(Y_i^B\)</span> and then <span class="math inline">\(D_i\)</span>. For this, I have to choose a sample size (<span class="math inline">\(N=1000\)</span>) and then generate the shocks from a normal.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for reproducibility, I choose a seed that will give me the same random sample each time I run the program</span>
<span class="kw">set.seed</span>(<span class="dv">1234</span>)
N &lt;-<span class="dv">1000</span>
mu &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="kw">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))
UB &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N,<span class="dv">0</span>,<span class="kw">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))
yB &lt;-<span class="st"> </span>mu <span class="op">+</span><span class="st"> </span>UB 
YB &lt;-<span class="st"> </span><span class="kw">exp</span>(yB)
Ds &lt;-<span class="st"> </span><span class="kw">ifelse</span>(YB<span class="op">&lt;=</span>param[<span class="st">&quot;barY&quot;</span>],<span class="dv">1</span>,<span class="dv">0</span>) </code></pre></div>
<p>Let’s now build a histogram of the data that we have just generated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># building histogram of yB with cutoff point at ybar</span>
<span class="co"># Number of steps</span>
Nsteps.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="dv">15</span>
<span class="co">#step width</span>
step.<span class="dv">1</span> &lt;-<span class="st"> </span>(<span class="kw">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="op">-</span><span class="kw">min</span>(yB[Ds<span class="op">==</span><span class="dv">1</span>]))<span class="op">/</span>Nsteps.<span class="dv">1</span>
Nsteps.<span class="dv">0</span> &lt;-<span class="st"> </span>(<span class="op">-</span><span class="kw">log</span>(param[<span class="st">&quot;barY&quot;</span>])<span class="op">+</span><span class="kw">max</span>(yB[Ds<span class="op">==</span><span class="dv">0</span>]))<span class="op">/</span>step.<span class="dv">1</span>
breaks &lt;-<span class="st"> </span><span class="kw">cumsum</span>(<span class="kw">c</span>(<span class="kw">min</span>(yB[Ds<span class="op">==</span><span class="dv">1</span>]),<span class="kw">c</span>(<span class="kw">rep</span>(step.<span class="dv">1</span>,Nsteps.<span class="dv">1</span><span class="op">+</span>Nsteps.<span class="dv">0</span><span class="op">+</span><span class="dv">1</span>))))
<span class="kw">hist</span>(yB,<span class="dt">breaks=</span>breaks,<span class="dt">main=</span><span class="st">&quot;&quot;</span>)
<span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:histyb"></span>
<img src="STCI_files/figure-html/histyb-1.png" alt="Histogram of $y_B$" width="672" />
<p class="caption">
Figure 1.1: Histogram of <span class="math inline">\(y_B\)</span>
</p>
</div>
<p>You can see on Figure <a href="the-fundamental-problem-of-causal-inference.html#fig:histyb">1.1</a> a histogram of <span class="math inline">\(y_i^B\)</span> with the red line indicating the cutoff point: <span class="math inline">\(\bar{y}=\ln(\bar{Y})=\)</span> 7.3. All the observations below the red line are treated according to the sharp rule while all the one located above are not. In order to see how many observations eventually receive the treatment with this allocation rule, let’s build a contingency table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table.D.sharp &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">table</span>(Ds))
knitr<span class="op">::</span><span class="kw">kable</span>(table.D.sharp,<span class="dt">caption=</span><span class="st">&#39;Treatment allocation with sharp cutoff rule&#39;</span>,<span class="dt">booktabs=</span><span class="ot">TRUE</span>)</code></pre></div>
<table>
<caption><span id="tab:tableDsharp">Table 1.1: </span>Treatment allocation with sharp cutoff rule</caption>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">771</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">229</td>
</tr>
</tbody>
</table>
<p>We can see on Table <a href="the-fundamental-problem-of-causal-inference.html#tab:tableDsharp">1.1</a> that there are 229 treated observations.</p>
</div>
<div id="the-fuzzy-cutoff-rule" class="section level4">
<h4><span class="header-section-number">1.1.1.2</span> The fuzzy cutoff rule</h4>
<p>This rule is less sharp than the sharp cutoff rule. Here, other criteria than <span class="math inline">\(Y_i^B\)</span> enter into the decision to allocate the treatment. The doctor might measure the health status of a patient following official guidelines, but he might also measure other factors that will also influence his decision of giving the drug to the patient. The officials administering a program might measure the official income level of a household, but they might also consider other features of the household situation when deciding to enroll the household into the program or not. If these additional criteria are unobserved to the econometrician, then we have the fuzzy cutoff rule. A very simple way to model this rule is as follows:</p>
<span class="math display">\[\begin{align}\label{eq:fuzzcutoff}
  D_i &amp; = \uns{Y_i^B+V_i\leq\bar{Y}},
\end{align}\]</span>
<p>where <span class="math inline">\(V_i\)</span> is a random variable unobserved to the econometrician and standing for the other influences that might drive the allocation of the treatment. <span class="math inline">\(V_i\)</span> is distributed according to a, for the moment, unspecified cumulative distribution function <span class="math inline">\(F_V\)</span>. When <span class="math inline">\(V_i\)</span> is degenerate ( it has only one point of support: it is a constant), the fuzzy cutoff rule becomes the sharp cutoff rule.</p>
</div>
<div id="the-eligibility-self-selection-rule" class="section level4">
<h4><span class="header-section-number">1.1.1.3</span> The eligibility <span class="math inline">\(+\)</span> self-selection rule</h4>
<p>It is also possible that households, once they have been made eligible to the treatment, can decide whether they want to receive it or not. A patient might be able to refuse the drug that the doctor suggests she should take. A household might refuse to participate in a cash transfer program to which it has been made eligible. Not all programs have this feature, but most of them have some room for decisions by the agents themselves of whether they want to receive the treatment or not. One simple way to model this rule is as follows:</p>
<span class="math display">\[\begin{align}\label{eq:eligself}
  D_i &amp; = \uns{D^*_i\geq0}E_i,
\end{align}\]</span>
<p>where <span class="math inline">\(D^*_i\)</span> is individual <span class="math inline">\(i\)</span>’s valuation of the treatment and <span class="math inline">\(E_i\)</span> is whether or not she is deemed eligible for the treatment. <span class="math inline">\(E_i\)</span> might be choosen according to the sharp cutoff rule of to the fuzzy cutoff rule, or to any other eligibility rule. We will be more explicit about <span class="math inline">\(D_i^*\)</span> in what follows.</p>
<p><strong>SIMULATIONS ARE MISSING FOR THESE LAST TWO RULES</strong></p>
</div>
</div>
<div id="the-potential-outcomes" class="section level3">
<h3><span class="header-section-number">1.1.2</span> The potential outcomes</h3>
<p>The second main building block of the RCM are potential outcomes. Let’s say that we are interested in the effect of a treatment on an outcome <span class="math inline">\(Y\)</span>. Each unit <span class="math inline">\(i\)</span> can thus be in two potential states: treated or non treated. Before the allocation of the treatment is decided, both of these states are feasible for each unit.</p>

<div class="definition">
<span id="def:unnamed-chunk-2" class="definition"><strong>Definition 1.1  (Potential outcomes)  </strong></span>For each unit <span class="math inline">\(i\)</span>, we define two potential outcomes:
</div>

<ul>
<li><span class="math inline">\(Y_i^1\)</span>: the outcome that unit <span class="math inline">\(i\)</span> is going to have if it receives the treatment,</li>
<li><span class="math inline">\(Y_i^0\)</span>: the outcome that unit <span class="math inline">\(i\)</span> is going to have if it <strong>does not</strong> receive the treatment.</li>
</ul>

<div class="example">
<span id="exm:unnamed-chunk-3" class="example"><strong>Example 1.2  </strong></span>Let’s choose functional forms for our potential outcomes. For simplicity, all lower case letters will denote log outcomes. <span class="math inline">\(y_i^0=\mu_i+\delta+U_i^0\)</span>, with <span class="math inline">\(\delta\)</span> a time shock common to all the observations and <span class="math inline">\(U_i^0=\rho U_i^B+\epsilon_i\)</span>, with <span class="math inline">\(|\rho|&lt;1\)</span>. In the absence of the treatment, part of the shocks <span class="math inline">\(U_i^B\)</span> that the individuals experienced in the previous period persist, while some part vanish. <span class="math inline">\(y_i^1=y_i^0+\bar{\alpha}+\theta\mu_i+\eta_i\)</span>. In order to generate the potential outcomes, one has to define the laws for the shocks and to choose parameter values. Let’s assume that <span class="math inline">\(\epsilon_i\sim\mathcal{N}(0,\sigma^2_{\epsilon})\)</span> and <span class="math inline">\(\eta_i\sim\mathcal{N}(0,\sigma^2_{\eta})\)</span>. Now let’s choose some parameter values:
</div>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l &lt;-<span class="st"> </span><span class="kw">length</span>(param)
param &lt;-<span class="st"> </span><span class="kw">c</span>(param,<span class="fl">0.9</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>)
<span class="kw">names</span>(param)[(l<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">length</span>(param)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;theta&quot;</span>,<span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,<span class="st">&quot;delta&quot;</span>,<span class="st">&quot;baralpha&quot;</span>)
param</code></pre></div>
<pre><code>##         barmu      sigma2mu       sigma2U          barY           rho 
##          8.00          0.50          0.28       1500.00          0.90 
##         theta sigma2epsilon     sigma2eta         delta      baralpha 
##          0.01          0.05          0.05          0.05          0.10</code></pre>
<p>We can finally generate the potential outcomes;</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">epsilon &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N,<span class="dv">0</span>,<span class="kw">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))
eta&lt;-<span class="st"> </span><span class="kw">rnorm</span>(N,<span class="dv">0</span>,<span class="kw">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]))
U0 &lt;-<span class="st"> </span>param[<span class="st">&quot;rho&quot;</span>]<span class="op">*</span>UB <span class="op">+</span><span class="st"> </span>epsilon
y0 &lt;-<span class="st"> </span>mu <span class="op">+</span><span class="st">  </span>U0 <span class="op">+</span><span class="st"> </span>param[<span class="st">&quot;delta&quot;</span>]
alpha &lt;-<span class="st"> </span>param[<span class="st">&quot;baralpha&quot;</span>]<span class="op">+</span><span class="st">  </span>param[<span class="st">&quot;theta&quot;</span>]<span class="op">*</span>mu <span class="op">+</span><span class="st"> </span>eta
y1 &lt;-<span class="st"> </span>y0<span class="op">+</span>alpha
Y0 &lt;-<span class="st"> </span><span class="kw">exp</span>(y0)
Y1 &lt;-<span class="st"> </span><span class="kw">exp</span>(y1)</code></pre></div>
<p>Now, I would like to visualize my potential outcomes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(y0,y1)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:histpotout"></span>
<img src="STCI_files/figure-html/histpotout-1.png" alt="Potential outcomes" width="672" />
<p class="caption">
Figure 1.2: Potential outcomes
</p>
</div>
<p>You can see on the resulting Figure <a href="the-fundamental-problem-of-causal-inference.html#fig:histpotout">1.2</a> that both potential outcomes are positively correlated. Those with a large potential outcome when untreated (<em>e.g.</em> in good health without the treatment) also have a positive health with the treatment. It is also true that individuals with bad health in the absence of the treatment also have bad health with the treatment.</p>
</div>
<div id="the-switching-equation" class="section level3">
<h3><span class="header-section-number">1.1.3</span> The switching equation</h3>
<p>The last building block of the RCM is the switching equation. It links the observed outcome to the potential outcomes through the allocation rule:</p>
<span class="math display" id="eq:switch">\[\begin{align}
 \tag{1.1}
  Y_i &amp; = 
    \begin{cases}
    Y_i^1 &amp; \text{if } D_i=1\\
    Y_i^0 &amp; \text{if } D_i=0
    \end{cases} \\
    &amp; = Y_i^1D_i + Y_i^0(1-D_i) \nonumber
\end{align}\]</span>

<div class="example">
<span id="exm:unnamed-chunk-4" class="example"><strong>Example 1.3  </strong></span>In order to generate observed outcomes in our numerical example, we simply have to enforce the switching equation:
</div>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span>y1<span class="op">*</span>Ds<span class="op">+</span>y0<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>Ds)
Y &lt;-<span class="st"> </span>Y1<span class="op">*</span>Ds<span class="op">+</span>Y0<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>Ds)</code></pre></div>
<p>What the switching equation <a href="the-fundamental-problem-of-causal-inference.html#eq:switch">(1.1)</a> means is that, for each individual <span class="math inline">\(i\)</span>, we get to observe only one of the two potential outcomes. When individual <span class="math inline">\(i\)</span> belongs to the treatment group (<em>i.e.</em> <span class="math inline">\(D_i=1\)</span>), we get to observe <span class="math inline">\(Y_i^1\)</span>. When individual <span class="math inline">\(i\)</span> belongs to the control group (<em>i.e.</em> <span class="math inline">\(D_i=0\)</span>), we get to observe <span class="math inline">\(Y_i^0\)</span>. Because the same individual cannot be at the same time in both groups, we can NEVER see both potential outcomes for the same individual at the same time.</p>
<p>For each of the individuals, one of the two potential outcomes is unobserved. We say that it is a <strong>counterfactual</strong>. A counterfactual quantity is a quantity that is, according to Hume’s definition, contrary to the observed facts. A counterfactual cannot be observed, but it can be conceived by an effort of reason: it is the consequence of what would have happened had some action not been taken.</p>
<p>One very nice way of visualising the switching equation has been proposed by Jerzy Neyman in a 1923 prescient paper. Neyman proposes to imagine two urns, each one filled with <span class="math inline">\(N\)</span> balls. One urn is the treatment urn and contains balls with the id of the unit and the value of its potential outcome <span class="math inline">\(Y_i^1\)</span>. The other urn is the control urn, and it contains balls with the value of the potential outcome <span class="math inline">\(Y_i^0\)</span> for each unit <span class="math inline">\(i\)</span>. Following the allocation rule <span class="math inline">\(D_i\)</span>, we decide whether unit <span class="math inline">\(i\)</span> is in the treatment or control group. When unit <span class="math inline">\(i\)</span> is in the treatment group, we take the corresponding ball from the first urn and observe the potential outcome on it. But, at the same time, the urns are connected so that the corresponding ball with the potential outcome of unit <span class="math inline">\(i\)</span> in the control urn disappears as soon as we draw ball <span class="math inline">\(i\)</span> from the treatment urn.</p>
<p>The switching equation works a lot like Schrodinger’s cat paradox. Schrodinger’s cat is placed in a sealed box and receives a dose of poison when an atom emits a radiation. As long as the box is sealed, there is no way we can know whether the cat is dead or alive. When we open the box, we observe either a dead cat or a living cat, but we cannot observe the cat both alice and dead at the same time. The switching equation is like opening the box, it collapses the observed outcome into one of the two potential ones.</p>

<div class="example">
<span id="exm:unnamed-chunk-5" class="example"><strong>Example 1.4  </strong></span>One way to visualize the inner workings of the switching equation is to plot the potential outcomes along with the criteria driving the allocation rule. In our simple example, it simply amounts to plotting observed (<span class="math inline">\(y_i\)</span>) and potential outcomes (<span class="math inline">\(y_i^1\)</span> and <span class="math inline">\(y_i^0\)</span>) along <span class="math inline">\(y_i^B\)</span>.
</div>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(yB[Ds<span class="op">==</span><span class="dv">0</span>],y0[Ds<span class="op">==</span><span class="dv">0</span>],<span class="dt">pch=</span><span class="dv">1</span>,<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="dt">xlab=</span><span class="st">&quot;yB&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Outcomes&quot;</span>)
<span class="kw">points</span>(yB[Ds<span class="op">==</span><span class="dv">1</span>],y1[Ds<span class="op">==</span><span class="dv">1</span>],<span class="dt">pch=</span><span class="dv">3</span>)
<span class="kw">points</span>(yB[Ds<span class="op">==</span><span class="dv">0</span>],y1[Ds<span class="op">==</span><span class="dv">0</span>],<span class="dt">pch=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&#39;red&#39;</span>)
<span class="kw">points</span>(yB[Ds<span class="op">==</span><span class="dv">1</span>],y0[Ds<span class="op">==</span><span class="dv">1</span>],<span class="dt">pch=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="st">&#39;red&#39;</span>)
test &lt;-<span class="st"> </span><span class="fl">5.8</span>
i.test &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">abs</span>(yB<span class="op">-</span>test)<span class="op">==</span><span class="kw">min</span>(<span class="kw">abs</span>(yB<span class="op">-</span>test)))
<span class="kw">points</span>(yB[<span class="kw">abs</span>(yB<span class="op">-</span>test)<span class="op">==</span><span class="kw">min</span>(<span class="kw">abs</span>(yB<span class="op">-</span>test))],y1[<span class="kw">abs</span>(yB<span class="op">-</span>test)<span class="op">==</span><span class="kw">min</span>(<span class="kw">abs</span>(yB<span class="op">-</span>test))],<span class="dt">col=</span><span class="st">&#39;green&#39;</span>,<span class="dt">pch=</span><span class="dv">3</span>)
<span class="kw">points</span>(yB[<span class="kw">abs</span>(yB<span class="op">-</span>test)<span class="op">==</span><span class="kw">min</span>(<span class="kw">abs</span>(yB<span class="op">-</span>test))],y0[<span class="kw">abs</span>(yB<span class="op">-</span>test)<span class="op">==</span><span class="kw">min</span>(<span class="kw">abs</span>(yB<span class="op">-</span>test))],<span class="dt">col=</span><span class="st">&#39;green&#39;</span>)
<span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)
<span class="kw">legend</span>(<span class="dv">5</span>,<span class="dv">11</span>,<span class="kw">c</span>(<span class="st">&#39;y0|D=0&#39;</span>,<span class="st">&#39;y1|D=1&#39;</span>,<span class="st">&#39;y0|D=1&#39;</span>,<span class="st">&#39;y1|D=0&#39;</span>,<span class="kw">paste</span>(<span class="st">&#39;y0&#39;</span>,i.test,<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),<span class="kw">paste</span>(<span class="st">&#39;y1&#39;</span>,i.test,<span class="dt">sep=</span><span class="st">&#39;&#39;</span>)),<span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">3</span>),<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;black&#39;</span>,<span class="st">&#39;black&#39;</span>,<span class="st">&#39;red&#39;</span>,<span class="st">&#39;red&#39;</span>,<span class="st">&#39;green&#39;</span>,<span class="st">&#39;green&#39;</span>),<span class="dt">ncol=</span><span class="dv">3</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:plotyyB"></span>
<img src="STCI_files/figure-html/plotyyB-1.png" alt="Potential outcomes" width="672" />
<p class="caption">
Figure 1.3: Potential outcomes
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(yB[Ds<span class="op">==</span><span class="dv">0</span>],y0[Ds<span class="op">==</span><span class="dv">0</span>],<span class="dt">pch=</span><span class="dv">1</span>,<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">11</span>),<span class="dt">xlab=</span><span class="st">&quot;yB&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Outcomes&quot;</span>)
<span class="kw">points</span>(yB[Ds<span class="op">==</span><span class="dv">1</span>],y1[Ds<span class="op">==</span><span class="dv">1</span>],<span class="dt">pch=</span><span class="dv">3</span>)
<span class="kw">legend</span>(<span class="dv">5</span>,<span class="dv">11</span>,<span class="kw">c</span>(<span class="st">&#39;y|D=0&#39;</span>,<span class="st">&#39;y|D=1&#39;</span>),<span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))
<span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">log</span>(param[<span class="st">&quot;barY&quot;</span>]),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:ploty1y0yB"></span>
<img src="STCI_files/figure-html/ploty1y0yB-1.png" alt="Observed outcomes" width="672" />
<p class="caption">
Figure 1.4: Observed outcomes
</p>
</div>
<p>Figure <a href="the-fundamental-problem-of-causal-inference.html#fig:ploty1y0yB">1.4</a> plots the observed outcomes <span class="math inline">\(y_i\)</span> that results from applying the switching equation. Figure <a href="the-fundamental-problem-of-causal-inference.html#fig:ploty1y0yB">1.4</a> shows that each individual in the sample is endowed with two potential outcomes, represented by a circle and a cross. Figure <a href="the-fundamental-problem-of-causal-inference.html#fig:plotyyB">1.3</a> plots the observed outcomes <span class="math inline">\(y_i\)</span> along with the unobserved potential outcomes. Only one of the two potential outcomes is observed (the cross for the treated group and the circle for the untreated group) and the other is not. The observed sample in Figure <a href="the-fundamental-problem-of-causal-inference.html#fig:plotyyB">1.3</a> only shows observed outcomes, and is thus silent on the values of the missing potential outcomes.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/chabefer/STCI/01_FPI.Rmd",
"text": "Edit"
},
"download": ["STCI.pdf", "STCI.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
