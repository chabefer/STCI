<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 15 Mediation Analysis | Statistical Tools for Causal Inference</title>
  <meta name="description" content="This is an open source collaborative book." />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 15 Mediation Analysis | Statistical Tools for Causal Inference" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is an open source collaborative book." />
  <meta name="github-repo" content="chabefer/STCI" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 15 Mediation Analysis | Statistical Tools for Causal Inference" />
  
  <meta name="twitter:description" content="This is an open source collaborative book." />
  

<meta name="author" content="Sylvain Chabé-Ferret" />


<meta name="date" content="2025-03-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Bounds.html"/>
<link rel="next" href="stratification.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
$$
\newcommand{\uns}[1]{\mathbf{1}[#1]}
\newcommand{\unsi}[2]{\mathbf{1}_{#1}(#2)}
\newcommand{\N}{\mathbf{N}}
\newcommand{\R}{\mathbf{R}}
\newcommand{\esp}[1]{\mathbf{E}[#1]}
\newcommand{\espsub}[2]{\mathbf{E}_{#2}[#1]}
\newcommand{\hatesp}[1]{\hat{\mathbf{E}}[ #1 ]}
\newcommand{\espE}{\mathbf{E}}
\newcommand{\Ind}{\perp\kern-5pt\perp}
\newcommand{\var}[1]{\mathbf{V}[ #1 ]}
\newcommand{\hatvar}[1]{\hat{\mathbf{V}}[ #1 ]}
\newcommand{\cov}[1]{\mathbf{C}[ #1 ]}
\newcommand{\plim}[1]{\text{plim}_{ #1 \rightarrow \infty}}
\newcommand{\plims}{\text{plim}}
\newcommand{\distr}{\stackrel{d}{\rightarrow}}
\newcommand{\probconv}{\stackrel{p}{\rightarrow}}
\newcommand{\partder}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\partdersq}[2]{\frac{\partial^2 #1}{\partial #2^2}}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\asym}{Asym}
$$


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Tools for Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>I Fundamental Problems of Inference</b></span></li>
<li class="chapter" data-level="" data-path="introduction-the-two-fundamental-problems-of-inference.html"><a href="introduction-the-two-fundamental-problems-of-inference.html"><i class="fa fa-check"></i>Introduction: the Two Fundamental Problems of Inference</a></li>
<li class="chapter" data-level="1" data-path="FPCI.html"><a href="FPCI.html"><i class="fa fa-check"></i><b>1</b> Fundamental Problem of Causal Inference</a>
<ul>
<li class="chapter" data-level="1.1" data-path="FPCI.html"><a href="FPCI.html#rubin-causal-model"><i class="fa fa-check"></i><b>1.1</b> Rubin Causal Model</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="FPCI.html"><a href="FPCI.html#treatment-allocation-rule"><i class="fa fa-check"></i><b>1.1.1</b> Treatment allocation rule</a></li>
<li class="chapter" data-level="1.1.2" data-path="FPCI.html"><a href="FPCI.html#potential-outcomes"><i class="fa fa-check"></i><b>1.1.2</b> Potential outcomes</a></li>
<li class="chapter" data-level="1.1.3" data-path="FPCI.html"><a href="FPCI.html#switching-equation"><i class="fa fa-check"></i><b>1.1.3</b> Switching equation</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="FPCI.html"><a href="FPCI.html#treatment-effects"><i class="fa fa-check"></i><b>1.2</b> Treatment effects</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="FPCI.html"><a href="FPCI.html#individual-level-treatment-effects"><i class="fa fa-check"></i><b>1.2.1</b> Individual level treatment effects</a></li>
<li class="chapter" data-level="1.2.2" data-path="FPCI.html"><a href="FPCI.html#average-treatment-effect-on-the-treated"><i class="fa fa-check"></i><b>1.2.2</b> Average treatment effect on the treated</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="FPCI.html"><a href="FPCI.html#fundamental-problem-of-causal-inference"><i class="fa fa-check"></i><b>1.3</b> Fundamental problem of causal inference</a></li>
<li class="chapter" data-level="1.4" data-path="FPCI.html"><a href="FPCI.html#intuitive-estimators-confounding-factors-and-selection-bias"><i class="fa fa-check"></i><b>1.4</b> Intuitive estimators, confounding factors and selection bias</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="FPCI.html"><a href="FPCI.html#withwithout-comparison-selection-bias-and-cross-sectional-confounders"><i class="fa fa-check"></i><b>1.4.1</b> With/Without comparison, selection bias and cross-sectional confounders</a></li>
<li class="chapter" data-level="1.4.2" data-path="FPCI.html"><a href="FPCI.html#the-beforeafter-comparison-temporal-confounders-and-time-trend-bias"><i class="fa fa-check"></i><b>1.4.2</b> The before/after comparison, temporal confounders and time trend bias</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="FPSI.html"><a href="FPSI.html"><i class="fa fa-check"></i><b>2</b> Fundamental Problem of Statistical Inference</a>
<ul>
<li class="chapter" data-level="2.1" data-path="FPSI.html"><a href="FPSI.html#sec:sampnoise"><i class="fa fa-check"></i><b>2.1</b> What is sampling noise? Definition and illustration</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="FPSI.html"><a href="FPSI.html#sec:definitionnoise"><i class="fa fa-check"></i><b>2.1.1</b> Sampling noise, a definition</a></li>
<li class="chapter" data-level="2.1.2" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisepop"><i class="fa fa-check"></i><b>2.1.2</b> Sampling noise for the population treatment effect</a></li>
<li class="chapter" data-level="2.1.3" data-path="FPSI.html"><a href="FPSI.html#sec:illusnoisesamp"><i class="fa fa-check"></i><b>2.1.3</b> Sampling noise for the sample treatment effect</a></li>
<li class="chapter" data-level="2.1.4" data-path="FPSI.html"><a href="FPSI.html#sec:confinterv"><i class="fa fa-check"></i><b>2.1.4</b> Building confidence intervals from estimates of sampling noise</a></li>
<li class="chapter" data-level="2.1.5" data-path="FPSI.html"><a href="FPSI.html#reporting-sampling-noise-a-proposal"><i class="fa fa-check"></i><b>2.1.5</b> Reporting sampling noise: a proposal</a></li>
<li class="chapter" data-level="2.1.6" data-path="FPSI.html"><a href="FPSI.html#sec:effectsize"><i class="fa fa-check"></i><b>2.1.6</b> Using effect sizes to normalize the reporting of treatment effects and their precision</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="FPSI.html"><a href="FPSI.html#sec:estimsampnoise"><i class="fa fa-check"></i><b>2.2</b> Estimating sampling noise</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="FPSI.html"><a href="FPSI.html#sec:assumptions"><i class="fa fa-check"></i><b>2.2.1</b> Assumptions</a></li>
<li class="chapter" data-level="2.2.2" data-path="FPSI.html"><a href="FPSI.html#sec:cheb"><i class="fa fa-check"></i><b>2.2.2</b> Using Chebyshev’s inequality</a></li>
<li class="chapter" data-level="2.2.3" data-path="FPSI.html"><a href="FPSI.html#sec:CLT"><i class="fa fa-check"></i><b>2.2.3</b> Using the Central Limit Theorem</a></li>
<li class="chapter" data-level="2.2.4" data-path="FPSI.html"><a href="FPSI.html#sec:resamp"><i class="fa fa-check"></i><b>2.2.4</b> Using resampling methods</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Methods of Causal Inference</b></span></li>
<li class="chapter" data-level="3" data-path="RCT.html"><a href="RCT.html"><i class="fa fa-check"></i><b>3</b> Randomized Controlled Trials</a>
<ul>
<li class="chapter" data-level="3.1" data-path="RCT.html"><a href="RCT.html#sec:design1"><i class="fa fa-check"></i><b>3.1</b> Brute Force Design</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="RCT.html"><a href="RCT.html#identification"><i class="fa fa-check"></i><b>3.1.1</b> Identification</a></li>
<li class="chapter" data-level="3.1.2" data-path="RCT.html"><a href="RCT.html#estimating-ate"><i class="fa fa-check"></i><b>3.1.2</b> Estimating ATE</a></li>
<li class="chapter" data-level="3.1.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise"><i class="fa fa-check"></i><b>3.1.3</b> Estimating Sampling Noise</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="RCT.html"><a href="RCT.html#sec:design2"><i class="fa fa-check"></i><b>3.2</b> Self-Selection design</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="RCT.html"><a href="RCT.html#identification-1"><i class="fa fa-check"></i><b>3.2.1</b> Identification</a></li>
<li class="chapter" data-level="3.2.2" data-path="RCT.html"><a href="RCT.html#estimating-tt"><i class="fa fa-check"></i><b>3.2.2</b> Estimating TT</a></li>
<li class="chapter" data-level="3.2.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-1"><i class="fa fa-check"></i><b>3.2.3</b> Estimating Sampling Noise</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="RCT.html"><a href="RCT.html#sec:design3"><i class="fa fa-check"></i><b>3.3</b> Eligibility design</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="RCT.html"><a href="RCT.html#identification-2"><i class="fa fa-check"></i><b>3.3.1</b> Identification</a></li>
<li class="chapter" data-level="3.3.2" data-path="RCT.html"><a href="RCT.html#estimating-the-ite-and-the-tt"><i class="fa fa-check"></i><b>3.3.2</b> Estimating the ITE and the TT</a></li>
<li class="chapter" data-level="3.3.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-2"><i class="fa fa-check"></i><b>3.3.3</b> Estimating sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="RCT.html"><a href="RCT.html#sec:design4"><i class="fa fa-check"></i><b>3.4</b> Encouragement Design</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="RCT.html"><a href="RCT.html#identification-3"><i class="fa fa-check"></i><b>3.4.1</b> Identification</a></li>
<li class="chapter" data-level="3.4.2" data-path="RCT.html"><a href="RCT.html#IVRCT"><i class="fa fa-check"></i><b>3.4.2</b> Estimating the Local Average Treatment Effect and the Intention to Treat Effect</a></li>
<li class="chapter" data-level="3.4.3" data-path="RCT.html"><a href="RCT.html#estimating-sampling-noise-3"><i class="fa fa-check"></i><b>3.4.3</b> Estimating sampling noise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="NE.html"><a href="NE.html"><i class="fa fa-check"></i><b>4</b> Natural Experiments</a>
<ul>
<li class="chapter" data-level="4.1" data-path="NE.html"><a href="NE.html#instrumental-variables"><i class="fa fa-check"></i><b>4.1</b> Instrumental Variables</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="NE.html"><a href="NE.html#an-example-where-monotonicity-does-not-hold"><i class="fa fa-check"></i><b>4.1.1</b> An example where Monotonicity does not hold</a></li>
<li class="chapter" data-level="4.1.2" data-path="NE.html"><a href="NE.html#identification-4"><i class="fa fa-check"></i><b>4.1.2</b> Identification</a></li>
<li class="chapter" data-level="4.1.3" data-path="NE.html"><a href="NE.html#estimation"><i class="fa fa-check"></i><b>4.1.3</b> Estimation</a></li>
<li class="chapter" data-level="4.1.4" data-path="NE.html"><a href="NE.html#estimation-of-sampling-noise"><i class="fa fa-check"></i><b>4.1.4</b> Estimation of sampling noise</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="NE.html"><a href="NE.html#regression-discontinuity-designs"><i class="fa fa-check"></i><b>4.2</b> Regression Discontinuity Designs</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="NE.html"><a href="NE.html#sharp-regression-discontinuity-designs"><i class="fa fa-check"></i><b>4.2.1</b> Sharp Regression Discontinuity Designs</a></li>
<li class="chapter" data-level="4.2.2" data-path="NE.html"><a href="NE.html#fuzzy-regression-discontinuity-designs"><i class="fa fa-check"></i><b>4.2.2</b> Fuzzy Regression Discontinuity Designs</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="NE.html"><a href="NE.html#DID"><i class="fa fa-check"></i><b>4.3</b> Difference In Differences</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="NE.html"><a href="NE.html#sec:DIDbasic"><i class="fa fa-check"></i><b>4.3.1</b> Difference In Differences with two time periods</a></li>
<li class="chapter" data-level="4.3.2" data-path="NE.html"><a href="NE.html#sec:DIDr"><i class="fa fa-check"></i><b>4.3.2</b> Reverse Difference In Differences designs with two time periods</a></li>
<li class="chapter" data-level="4.3.3" data-path="NE.html"><a href="NE.html#DIDStaggered"><i class="fa fa-check"></i><b>4.3.3</b> Difference In Differences with multiple time periods</a></li>
<li class="chapter" data-level="4.3.4" data-path="NE.html"><a href="NE.html#difference-in-differences-with-instrumental-variables"><i class="fa fa-check"></i><b>4.3.4</b> Difference In Differences with Instrumental Variables</a></li>
<li class="chapter" data-level="4.3.5" data-path="NE.html"><a href="NE.html#difference-in-differences-with-continuous-treatment-variables-and-staggered-adoption"><i class="fa fa-check"></i><b>4.3.5</b> Difference In Differences with Continuous Treatment Variables and Staggered Adoption</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="OM.html"><a href="OM.html"><i class="fa fa-check"></i><b>5</b> Observational Methods</a>
<ul>
<li class="chapter" data-level="5.1" data-path="OM.html"><a href="OM.html#parametric-methods"><i class="fa fa-check"></i><b>5.1</b> Parametric methods</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="OM.html"><a href="OM.html#assuming-espy_i0x_i-is-known"><i class="fa fa-check"></i><b>5.1.1</b> Assuming <span class="math inline">\(\esp{Y_i^0|X_i}\)</span> is known</a></li>
<li class="chapter" data-level="5.1.2" data-path="OM.html"><a href="OM.html#assuming-espy_i1x_i-is-known"><i class="fa fa-check"></i><b>5.1.2</b> Assuming <span class="math inline">\(\esp{Y_i^1|X_i}\)</span> is known</a></li>
<li class="chapter" data-level="5.1.3" data-path="OM.html"><a href="OM.html#BiasOLS"><i class="fa fa-check"></i><b>5.1.3</b> Properties of the OLS estimator under Conditional Independence</a></li>
<li class="chapter" data-level="5.1.4" data-path="OM.html"><a href="OM.html#problems-with-parametric-methods"><i class="fa fa-check"></i><b>5.1.4</b> Problems with parametric methods</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="OM.html"><a href="OM.html#nonparametric-methods"><i class="fa fa-check"></i><b>5.2</b> Nonparametric methods</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="OM.html"><a href="OM.html#identification-13"><i class="fa fa-check"></i><b>5.2.1</b> Identification</a></li>
<li class="chapter" data-level="5.2.2" data-path="OM.html"><a href="OM.html#estimation-9"><i class="fa fa-check"></i><b>5.2.2</b> Estimation</a></li>
<li class="chapter" data-level="5.2.3" data-path="OM.html"><a href="OM.html#estimating-precision-2"><i class="fa fa-check"></i><b>5.2.3</b> Estimating precision</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="OM.html"><a href="OM.html#imputation-methods"><i class="fa fa-check"></i><b>5.3</b> Imputation methods</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="threats.html"><a href="threats.html"><i class="fa fa-check"></i><b>6</b> Threats to the validity of Causal Inference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="threats.html"><a href="threats.html#threats-to-internal-validity"><i class="fa fa-check"></i><b>6.1</b> Threats to internal validity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="threats.html"><a href="threats.html#survey-bias"><i class="fa fa-check"></i><b>6.1.1</b> Survey bias</a></li>
<li class="chapter" data-level="6.1.2" data-path="threats.html"><a href="threats.html#experimenter-bias"><i class="fa fa-check"></i><b>6.1.2</b> Experimenter bias</a></li>
<li class="chapter" data-level="6.1.3" data-path="threats.html"><a href="threats.html#substitution-bias"><i class="fa fa-check"></i><b>6.1.3</b> Substitution bias</a></li>
<li class="chapter" data-level="6.1.4" data-path="threats.html"><a href="threats.html#diffusion-bias"><i class="fa fa-check"></i><b>6.1.4</b> Diffusion bias</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="threats.html"><a href="threats.html#threats-to-the-measurement-of-precision"><i class="fa fa-check"></i><b>6.2</b> Threats to the measurement of precision</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="threats.html"><a href="threats.html#insufficient-precision"><i class="fa fa-check"></i><b>6.2.1</b> Insufficient precision</a></li>
<li class="chapter" data-level="6.2.2" data-path="threats.html"><a href="threats.html#clustering"><i class="fa fa-check"></i><b>6.2.2</b> Clustering</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="threats.html"><a href="threats.html#threats-to-external-validity"><i class="fa fa-check"></i><b>6.3</b> Threats to external validity</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="threats.html"><a href="threats.html#randomization-bias"><i class="fa fa-check"></i><b>6.3.1</b> Randomization bias</a></li>
<li class="chapter" data-level="6.3.2" data-path="threats.html"><a href="threats.html#equilibrium-effects"><i class="fa fa-check"></i><b>6.3.2</b> Equilibrium effects</a></li>
<li class="chapter" data-level="6.3.3" data-path="threats.html"><a href="threats.html#context-effects"><i class="fa fa-check"></i><b>6.3.3</b> Context effects</a></li>
<li class="chapter" data-level="6.3.4" data-path="threats.html"><a href="threats.html#site-selection-bias"><i class="fa fa-check"></i><b>6.3.4</b> Site selection bias</a></li>
<li class="chapter" data-level="6.3.5" data-path="threats.html"><a href="threats.html#publication-bias"><i class="fa fa-check"></i><b>6.3.5</b> Publication bias</a></li>
<li class="chapter" data-level="6.3.6" data-path="threats.html"><a href="threats.html#ethical-and-political-issues"><i class="fa fa-check"></i><b>6.3.6</b> Ethical and political issues</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Additional Topics</b></span></li>
<li class="chapter" data-level="7" data-path="Power.html"><a href="Power.html"><i class="fa fa-check"></i><b>7</b> Power Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Power.html"><a href="Power.html#basics-of-traditional-power-analysis-using-test-statistics"><i class="fa fa-check"></i><b>7.1</b> Basics of traditional power analysis using test statistics</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="Power.html"><a href="Power.html#power"><i class="fa fa-check"></i><b>7.1.1</b> Power</a></li>
<li class="chapter" data-level="7.1.2" data-path="Power.html"><a href="Power.html#minimum-detectable-effect"><i class="fa fa-check"></i><b>7.1.2</b> Minimum Detectable Effect</a></li>
<li class="chapter" data-level="7.1.3" data-path="Power.html"><a href="Power.html#minimum-required-sample-size"><i class="fa fa-check"></i><b>7.1.3</b> Minimum Required Sample Size</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="Power.html"><a href="Power.html#traditional-power-analysis-in-practice"><i class="fa fa-check"></i><b>7.2</b> Traditional power analysis in practice</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="Power.html"><a href="Power.html#power-analysis-for-randomized-controlled-trials"><i class="fa fa-check"></i><b>7.2.1</b> Power Analysis for Randomized Controlled Trials</a></li>
<li class="chapter" data-level="7.2.2" data-path="Power.html"><a href="Power.html#power-analysis-for-natural-experiments"><i class="fa fa-check"></i><b>7.2.2</b> Power Analysis for Natural Experiments</a></li>
<li class="chapter" data-level="7.2.3" data-path="Power.html"><a href="Power.html#power-analysis-for-observational-methods"><i class="fa fa-check"></i><b>7.2.3</b> Power Analysis for Observational Methods</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="Power.html"><a href="Power.html#limitations-of-and-alternatives-to-traditional-power-analysis"><i class="fa fa-check"></i><b>7.3</b> Limitations of and alternatives to traditional power analysis</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="Power.html"><a href="Power.html#limitations-of-traditional-power-analysis"><i class="fa fa-check"></i><b>7.3.1</b> Limitations of traditional power analysis</a></li>
<li class="chapter" data-level="7.3.2" data-path="Power.html"><a href="Power.html#an-alternative-to-traditional-power-analysis"><i class="fa fa-check"></i><b>7.3.2</b> An alternative to traditional power analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="placebo.html"><a href="placebo.html"><i class="fa fa-check"></i><b>8</b> Placebo Tests</a>
<ul>
<li class="chapter" data-level="8.1" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-randomized-controlled-trials"><i class="fa fa-check"></i><b>8.1</b> Placebo tests for randomized controlled trials</a></li>
<li class="chapter" data-level="8.2" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-natural-experiments"><i class="fa fa-check"></i><b>8.2</b> Placebo tests for natural experiments</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-instrumental-variables"><i class="fa fa-check"></i><b>8.2.1</b> Placebo tests for Instrumental Variables</a></li>
<li class="chapter" data-level="8.2.2" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-regression-discontinuity-designs"><i class="fa fa-check"></i><b>8.2.2</b> Placebo tests for Regression Discontinuity Designs</a></li>
<li class="chapter" data-level="8.2.3" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-difference-in-differences"><i class="fa fa-check"></i><b>8.2.3</b> Placebo tests for Difference in Differences</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="placebo.html"><a href="placebo.html#placebo-tests-for-observational-methods"><i class="fa fa-check"></i><b>8.3</b> Placebo tests for observational methods</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cluster.html"><a href="cluster.html"><i class="fa fa-check"></i><b>9</b> Clustering</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cluster.html"><a href="cluster.html#ClusterRCT"><i class="fa fa-check"></i><b>9.1</b> Clustering in Randomized Controlled Trials</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="cluster.html"><a href="cluster.html#an-example"><i class="fa fa-check"></i><b>9.1.1</b> An example</a></li>
<li class="chapter" data-level="9.1.2" data-path="cluster.html"><a href="cluster.html#design-effect"><i class="fa fa-check"></i><b>9.1.2</b> Design effect</a></li>
<li class="chapter" data-level="9.1.3" data-path="cluster.html"><a href="cluster.html#estimating-sampling-noise-accounting-for-clustering"><i class="fa fa-check"></i><b>9.1.3</b> Estimating sampling noise accounting for clustering</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="cluster.html"><a href="cluster.html#clustering-in-panel-data"><i class="fa fa-check"></i><b>9.2</b> Clustering in panel data</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="cluster.html"><a href="cluster.html#an-example-1"><i class="fa fa-check"></i><b>9.2.1</b> An example</a></li>
<li class="chapter" data-level="9.2.2" data-path="cluster.html"><a href="cluster.html#design-effect-in-panel-data"><i class="fa fa-check"></i><b>9.2.2</b> Design effect in panel data</a></li>
<li class="chapter" data-level="9.2.3" data-path="cluster.html"><a href="cluster.html#estimating-sampling-noise-in-panel-data-with-autocorrelated-error-terms"><i class="fa fa-check"></i><b>9.2.3</b> Estimating sampling noise in panel data with autocorrelated error terms</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cluster.html"><a href="cluster.html#spatial-correlation"><i class="fa fa-check"></i><b>9.3</b> Spatial correlation</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="cluster.html"><a href="cluster.html#an-example-2"><i class="fa fa-check"></i><b>9.3.1</b> An example</a></li>
<li class="chapter" data-level="9.3.2" data-path="cluster.html"><a href="cluster.html#design-effect-in-spatially-autocorrelated-data"><i class="fa fa-check"></i><b>9.3.2</b> Design effect in spatially autocorrelated data</a></li>
<li class="chapter" data-level="9.3.3" data-path="cluster.html"><a href="cluster.html#estimating-sampling-noise-with-spatially-autocorrelated-data"><i class="fa fa-check"></i><b>9.3.3</b> Estimating sampling noise with spatially autocorrelated data</a></li>
<li class="chapter" data-level="9.3.4" data-path="cluster.html"><a href="cluster.html#testing-for-spatial-autocorrelation"><i class="fa fa-check"></i><b>9.3.4</b> Testing for spatial autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="cluster.html"><a href="cluster.html#clustering-on-a-network"><i class="fa fa-check"></i><b>9.4</b> Clustering on a network</a></li>
<li class="chapter" data-level="9.5" data-path="cluster.html"><a href="cluster.html#multi-way-clustering"><i class="fa fa-check"></i><b>9.5</b> Multi-way clustering</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="cluster.html"><a href="cluster.html#at-which-level-should-we-cluster"><i class="fa fa-check"></i><b>9.5.1</b> At which level should we cluster?</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="cluster.html"><a href="cluster.html#what-to-do-when-there-are-few-clusters"><i class="fa fa-check"></i><b>9.6</b> What to do when there are few clusters?</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="cluster.html"><a href="cluster.html#aggregation"><i class="fa fa-check"></i><b>9.6.1</b> Aggregation</a></li>
<li class="chapter" data-level="9.6.2" data-path="cluster.html"><a href="cluster.html#permutation-tests"><i class="fa fa-check"></i><b>9.6.2</b> Permutation tests</a></li>
<li class="chapter" data-level="9.6.3" data-path="cluster.html"><a href="cluster.html#wild-bootstrap"><i class="fa fa-check"></i><b>9.6.3</b> Wild bootstrap</a></li>
<li class="chapter" data-level="9.6.4" data-path="cluster.html"><a href="cluster.html#ibragimov-and-muller-2010-group-based-inference"><i class="fa fa-check"></i><b>9.6.4</b> Ibragimov and Muller (2010) group-based inference</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="cluster.html"><a href="cluster.html#CLTDD"><i class="fa fa-check"></i><b>9.7</b> Central Limit Theorems for Dependent Data</a></li>
<li class="chapter" data-level="9.8" data-path="cluster.html"><a href="cluster.html#DesignBasedClusters"><i class="fa fa-check"></i><b>9.8</b> Sampling-based and design-based approaches to clustering</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="LaLonde.html"><a href="LaLonde.html"><i class="fa fa-check"></i><b>10</b> LaLonde Tests</a></li>
<li class="chapter" data-level="11" data-path="Diffusion.html"><a href="Diffusion.html"><i class="fa fa-check"></i><b>11</b> Diffusion effects</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Diffusion.html"><a href="Diffusion.html#allowing-for-diffusion-effects-in-rubin-causal-model"><i class="fa fa-check"></i><b>11.1</b> Allowing for diffusion effects in Rubin Causal Model</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="Diffusion.html"><a href="Diffusion.html#potential-outcomes-and-treatment-effects-with-diffusion-effects"><i class="fa fa-check"></i><b>11.1.1</b> Potential outcomes and treatment effects with diffusion effects</a></li>
<li class="chapter" data-level="11.1.2" data-path="Diffusion.html"><a href="Diffusion.html#encoding-the-absence-of-diffusion-effects"><i class="fa fa-check"></i><b>11.1.2</b> Encoding the absence of diffusion effects</a></li>
<li class="chapter" data-level="11.1.3" data-path="Diffusion.html"><a href="Diffusion.html#TreatmentExposure"><i class="fa fa-check"></i><b>11.1.3</b> Treatment exposure</a></li>
<li class="chapter" data-level="11.1.4" data-path="Diffusion.html"><a href="Diffusion.html#fundamental-problem-of-causal-inference-for-diffusion-effects"><i class="fa fa-check"></i><b>11.1.4</b> Fundamental problem of causal inference for diffusion effects</a></li>
<li class="chapter" data-level="11.1.5" data-path="Diffusion.html"><a href="Diffusion.html#bias-of-one-step-randomized-controlled-trials"><i class="fa fa-check"></i><b>11.1.5</b> Bias of one-step randomized controlled trials</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="Diffusion.html"><a href="Diffusion.html#diffusion-effects-with-coarse-networks"><i class="fa fa-check"></i><b>11.2</b> Diffusion effects with coarse networks</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="Diffusion.html"><a href="Diffusion.html#optimal-treatment-allocation-under-monotone-response"><i class="fa fa-check"></i><b>11.2.1</b> Optimal treatment allocation under monotone response</a></li>
<li class="chapter" data-level="11.2.2" data-path="Diffusion.html"><a href="Diffusion.html#identifying-optimal-treatment-levels"><i class="fa fa-check"></i><b>11.2.2</b> Identifying optimal treatment levels</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="Diffusion.html"><a href="Diffusion.html#diffusion-effects-with-detailed-networks"><i class="fa fa-check"></i><b>11.3</b> Diffusion effects with detailed networks</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="Diffusion.html"><a href="Diffusion.html#setting"><i class="fa fa-check"></i><b>11.3.1</b> Setting</a></li>
<li class="chapter" data-level="11.3.2" data-path="Diffusion.html"><a href="Diffusion.html#identification-of-causal-effects"><i class="fa fa-check"></i><b>11.3.2</b> Identification of causal effects</a></li>
<li class="chapter" data-level="11.3.3" data-path="Diffusion.html"><a href="Diffusion.html#estimation-of-causal-effects"><i class="fa fa-check"></i><b>11.3.3</b> Estimation of causal effects</a></li>
<li class="chapter" data-level="11.3.4" data-path="Diffusion.html"><a href="Diffusion.html#estimation-of-sampling-noise-6"><i class="fa fa-check"></i><b>11.3.4</b> Estimation of sampling noise</a></li>
<li class="chapter" data-level="11.3.5" data-path="Diffusion.html"><a href="Diffusion.html#nonparametric-tests-for-the-existence-of-diffusion-effects-based-on-randomization-inference"><i class="fa fa-check"></i><b>11.3.5</b> Nonparametric tests for the existence of diffusion effects based on randomization inference</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="Diffusion.html"><a href="Diffusion.html#diffusion-effects-with-did"><i class="fa fa-check"></i><b>11.4</b> Diffusion effects with DID</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="Distribution.html"><a href="Distribution.html"><i class="fa fa-check"></i><b>12</b> Distributional effects</a></li>
<li class="chapter" data-level="13" data-path="meta.html"><a href="meta.html"><i class="fa fa-check"></i><b>13</b> Meta-analysis and Publication Bias</a>
<ul>
<li class="chapter" data-level="13.1" data-path="meta.html"><a href="meta.html#meta-analysis"><i class="fa fa-check"></i><b>13.1</b> Meta-analysis</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="meta.html"><a href="meta.html#basic-setting"><i class="fa fa-check"></i><b>13.1.1</b> Basic setting</a></li>
<li class="chapter" data-level="13.1.2" data-path="meta.html"><a href="meta.html#why-vote-counting-does-not-work"><i class="fa fa-check"></i><b>13.1.2</b> Why vote-counting does not work</a></li>
<li class="chapter" data-level="13.1.3" data-path="meta.html"><a href="meta.html#MetaWA"><i class="fa fa-check"></i><b>13.1.3</b> Meta-analysis when treatment effects are homogeneous: the fixed effects approach</a></li>
<li class="chapter" data-level="13.1.4" data-path="meta.html"><a href="meta.html#meta-analysis-when-treatment-effects-are-heterogeneous-the-random-effects-approach"><i class="fa fa-check"></i><b>13.1.4</b> Meta-analysis when treatment effects are heterogeneous: the random effects approach</a></li>
<li class="chapter" data-level="13.1.5" data-path="meta.html"><a href="meta.html#meta-regression"><i class="fa fa-check"></i><b>13.1.5</b> Meta-regression</a></li>
<li class="chapter" data-level="13.1.6" data-path="meta.html"><a href="meta.html#constantly-updated-meta-analysis"><i class="fa fa-check"></i><b>13.1.6</b> Constantly updated meta-analysis</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="meta.html"><a href="meta.html#publication-bias-and-site-selection-bias"><i class="fa fa-check"></i><b>13.2</b> Publication bias and site selection bias</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="meta.html"><a href="meta.html#sources-of-publication-bias-and-of-site-selection-bias-and-questionable-research-practices"><i class="fa fa-check"></i><b>13.2.1</b> Sources of publication bias and of site selection bias and Questionable Research Practices</a></li>
<li class="chapter" data-level="13.2.2" data-path="meta.html"><a href="meta.html#detection-of-and-correction-for-publication-bias"><i class="fa fa-check"></i><b>13.2.2</b> Detection of and correction for publication bias</a></li>
<li class="chapter" data-level="13.2.3" data-path="meta.html"><a href="meta.html#getting-rid-of-publication-bias-registered-reports-and-pre-analysis-plans"><i class="fa fa-check"></i><b>13.2.3</b> Getting rid of publication bias: registered reports and pre-analysis plans</a></li>
<li class="chapter" data-level="13.2.4" data-path="meta.html"><a href="meta.html#detection-of-and-correction-for-site-selection-bias"><i class="fa fa-check"></i><b>13.2.4</b> Detection of and correction for site selection bias</a></li>
<li class="chapter" data-level="13.2.5" data-path="meta.html"><a href="meta.html#vote-counting-and-publication-bias"><i class="fa fa-check"></i><b>13.2.5</b> Vote counting and publication bias</a></li>
<li class="chapter" data-level="13.2.6" data-path="meta.html"><a href="meta.html#the-value-of-a-statistically-significant-result"><i class="fa fa-check"></i><b>13.2.6</b> The value of a statistically significant result</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="Bounds.html"><a href="Bounds.html"><i class="fa fa-check"></i><b>14</b> Bounds</a></li>
<li class="chapter" data-level="15" data-path="mediation-analysis.html"><a href="mediation-analysis.html"><i class="fa fa-check"></i><b>15</b> Mediation Analysis</a>
<ul>
<li class="chapter" data-level="15.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-a-framework"><i class="fa fa-check"></i><b>15.1</b> Mediation analysis: a framework</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#defining-mediated-and-unmediated-treatment-effects"><i class="fa fa-check"></i><b>15.1.1</b> Defining mediated and unmediated treatment effects</a></li>
<li class="chapter" data-level="15.1.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#decomposing-mediated-and-unmediated-effects"><i class="fa fa-check"></i><b>15.1.2</b> Decomposing mediated and unmediated effects</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#the-fundamental-problem-of-mediation-analysis"><i class="fa fa-check"></i><b>15.2</b> The Fundamental Problem of Mediation Analysis</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#the-fundamental-problem-of-mediation-analysis-1"><i class="fa fa-check"></i><b>15.2.1</b> The Fundamental Problem of Mediation Analysis</a></li>
<li class="chapter" data-level="15.2.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#biases-of-intuitive-comparisons"><i class="fa fa-check"></i><b>15.2.2</b> Biases of Intuitive Comparisons</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-experimental-data"><i class="fa fa-check"></i><b>15.3</b> Mediation analysis with experimental data</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-in-the-parallel-design"><i class="fa fa-check"></i><b>15.3.1</b> Mediation analysis in the Parallel design</a></li>
<li class="chapter" data-level="15.3.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-in-the-sequential-self-selection-design"><i class="fa fa-check"></i><b>15.3.2</b> Mediation analysis in the Sequential Self-Selection design</a></li>
<li class="chapter" data-level="15.3.3" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-in-the-crossover-design"><i class="fa fa-check"></i><b>15.3.3</b> Mediation analysis in the Crossover design</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-under-unconfoundedness"><i class="fa fa-check"></i><b>15.4</b> Mediation analysis under unconfoundedness</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#non-parametric-identification-under-sequential-ignorability"><i class="fa fa-check"></i><b>15.4.1</b> Non-parametric identification under sequential ignorability</a></li>
<li class="chapter" data-level="15.4.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-under-sequential-ignorability-in-linear-models"><i class="fa fa-check"></i><b>15.4.2</b> Mediation analysis under sequential ignorability in linear models</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-panel-data"><i class="fa fa-check"></i><b>15.5</b> Mediation analysis with panel data</a></li>
<li class="chapter" data-level="15.6" data-path="mediation-analysis.html"><a href="mediation-analysis.html#mediation-analysis-with-instruments"><i class="fa fa-check"></i><b>15.6</b> Mediation analysis with instruments</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="stratification.html"><a href="stratification.html"><i class="fa fa-check"></i><b>16</b> Stratification</a>
<ul>
<li class="chapter" data-level="16.1" data-path="stratification.html"><a href="stratification.html#ClassicalStratification"><i class="fa fa-check"></i><b>16.1</b> Analysis of classical stratified experiments</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="stratification.html"><a href="stratification.html#an-example-3"><i class="fa fa-check"></i><b>16.1.1</b> An example</a></li>
<li class="chapter" data-level="16.1.2" data-path="stratification.html"><a href="stratification.html#estimating-treatment-effects-with-stratified-randomized-controlled-trials"><i class="fa fa-check"></i><b>16.1.2</b> Estimating treatment effects with stratified randomized controlled trials</a></li>
<li class="chapter" data-level="16.1.3" data-path="stratification.html"><a href="stratification.html#estimating-sampling-noise-in-stratified-randomized-controlled-trials"><i class="fa fa-check"></i><b>16.1.3</b> Estimating sampling noise in stratified randomized controlled trials</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="stratification.html"><a href="stratification.html#PairRCT"><i class="fa fa-check"></i><b>16.2</b> Analysis of pairwise randomized controlled trials</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="stratification.html"><a href="stratification.html#building-a-sample-of-pairs"><i class="fa fa-check"></i><b>16.2.1</b> Building a sample of pairs</a></li>
<li class="chapter" data-level="16.2.2" data-path="stratification.html"><a href="stratification.html#estimating-treatment-effects-in-pairwise-randomized-controlled-trials"><i class="fa fa-check"></i><b>16.2.2</b> Estimating treatment effects in pairwise randomized controlled trials</a></li>
<li class="chapter" data-level="16.2.3" data-path="stratification.html"><a href="stratification.html#estimating-sampling-noise-in-pairwise-randomized-controlled-trials"><i class="fa fa-check"></i><b>16.2.3</b> Estimating sampling noise in pairwise randomized controlled trials</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="proofs.html"><a href="proofs.html"><i class="fa fa-check"></i><b>A</b> Proofs</a>
<ul>
<li class="chapter" data-level="A.1" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-reffpsi"><i class="fa fa-check"></i><b>A.1</b> Proofs of results in Chapter @ref(FPSI)</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="proofs.html"><a href="proofs.html#proofcheb"><i class="fa fa-check"></i><b>A.1.1</b> Proof of Theorem @ref(thm:uppsampnoise)</a></li>
<li class="chapter" data-level="A.1.2" data-path="proofs.html"><a href="proofs.html#proofCLT"><i class="fa fa-check"></i><b>A.1.2</b> Proof of Theorem @ref(thm:asympnoiseWW)</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refrct"><i class="fa fa-check"></i><b>A.2</b> Proofs of results in Chapter @ref(RCT)</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="proofs.html"><a href="proofs.html#proofIdentLATE"><i class="fa fa-check"></i><b>A.2.1</b> Proof of Theorem @ref(thm:IdentLATE)</a></li>
<li class="chapter" data-level="A.2.2" data-path="proofs.html"><a href="proofs.html#proofWaldIV"><i class="fa fa-check"></i><b>A.2.2</b> Proof of Theorem @ref(thm:WaldIV)</a></li>
<li class="chapter" data-level="A.2.3" data-path="proofs.html"><a href="proofs.html#ProofAsymWald"><i class="fa fa-check"></i><b>A.2.3</b> Proof of Theorem @ref(thm:asymWald)</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refne"><i class="fa fa-check"></i><b>A.3</b> Proofs of results in Chapter @ref(NE)</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="proofs.html"><a href="proofs.html#proofEstimDID"><i class="fa fa-check"></i><b>A.3.1</b> Proof of Theorem @ref(thm:EstimDID)</a></li>
<li class="chapter" data-level="A.3.2" data-path="proofs.html"><a href="proofs.html#proofasympnoiseDIDCross"><i class="fa fa-check"></i><b>A.3.2</b> Proof of Theorem @ref(thm:asympnoiseDIDCross)</a></li>
<li class="chapter" data-level="A.3.3" data-path="proofs.html"><a href="proofs.html#proofEquivDIDSApop"><i class="fa fa-check"></i><b>A.3.3</b> Proof of Theorem @ref(thm:EquivDIDSApop)</a></li>
<li class="chapter" data-level="A.3.4" data-path="proofs.html"><a href="proofs.html#proofEquivDIDSAsamp"><i class="fa fa-check"></i><b>A.3.4</b> Proof of Theorem @ref(thm:EquivDIDSAsamp)</a></li>
<li class="chapter" data-level="A.3.5" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSACross"><i class="fa fa-check"></i><b>A.3.5</b> Proof of Theorem @ref(thm:asympnoiseSACross)</a></li>
<li class="chapter" data-level="A.3.6" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSATTCross"><i class="fa fa-check"></i><b>A.3.6</b> Proof of Theorem @ref(thm:asympnoiseSATTCross)</a></li>
<li class="chapter" data-level="A.3.7" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSAPanel"><i class="fa fa-check"></i><b>A.3.7</b> Proof of Theorem @ref(thm:asympnoiseSAPanel)</a></li>
<li class="chapter" data-level="A.3.8" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSATTPanel"><i class="fa fa-check"></i><b>A.3.8</b> Proof of Theorem @ref(thm:asympnoiseSATTPanel)</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refom"><i class="fa fa-check"></i><b>A.4</b> Proofs of results in Chapter @ref(OM)</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="proofs.html"><a href="proofs.html#proofAsympWWOLS10"><i class="fa fa-check"></i><b>A.4.1</b> Proof of Theorem @ref(thm:AsympWWOLS10)</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refcluster"><i class="fa fa-check"></i><b>A.5</b> Proofs of results in Chapter @ref(cluster)</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="proofs.html"><a href="proofs.html#proofVarWWClus"><i class="fa fa-check"></i><b>A.5.1</b> Proof of Theorem @ref(thm:VarWWClus)</a></li>
<li class="chapter" data-level="A.5.2" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSATTPanelAR1"><i class="fa fa-check"></i><b>A.5.2</b> Proof of Theorem @ref(thm:asympnoiseSATTPanelAR1)</a></li>
<li class="chapter" data-level="A.5.3" data-path="proofs.html"><a href="proofs.html#proofVarWWSpatial"><i class="fa fa-check"></i><b>A.5.3</b> Proof of Theorem @ref(thm:VarWWSpatial)</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refdiffusion"><i class="fa fa-check"></i><b>A.6</b> Proofs of results in Chapter @ref(Diffusion)</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="proofs.html"><a href="proofs.html#proofSmoothSymAlloc"><i class="fa fa-check"></i><b>A.6.1</b> Proof of Theorem @ref(thm:SmoothSymAlloc)</a></li>
<li class="chapter" data-level="A.6.2" data-path="proofs.html"><a href="proofs.html#proofIdentSmoothSymAlloc"><i class="fa fa-check"></i><b>A.6.2</b> Proof of Theorem @ref(thm:IdentSmoothSymAlloc)</a></li>
<li class="chapter" data-level="A.6.3" data-path="proofs.html"><a href="proofs.html#proofContagionDiffusionSmoothSymAlloc"><i class="fa fa-check"></i><b>A.6.3</b> Proof of Theorem @ref(thm:ContagionDiffusionSmoothSymAlloc)</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="proofs.html"><a href="proofs.html#proofs-of-results-in-chapter-refstratification"><i class="fa fa-check"></i><b>A.7</b> Proofs of results in Chapter @ref(stratification)</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="proofs.html"><a href="proofs.html#proofSFEdecomp"><i class="fa fa-check"></i><b>A.7.1</b> Proof of Theorem @ref(thm:SFEdecomp)</a></li>
<li class="chapter" data-level="A.7.2" data-path="proofs.html"><a href="proofs.html#proofSFEconsistent"><i class="fa fa-check"></i><b>A.7.2</b> Proof of Theorem @ref(thm:SFEconsistent)</a></li>
<li class="chapter" data-level="A.7.3" data-path="proofs.html"><a href="proofs.html#proofSATUnbiasedConsistent"><i class="fa fa-check"></i><b>A.7.3</b> Proof of Theorem @ref(thm:SATUnbiasedConsistent)</a></li>
<li class="chapter" data-level="A.7.4" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSATStrata"><i class="fa fa-check"></i><b>A.7.4</b> Proof of Theorem @ref(thm:asympnoiseSATStrata)</a></li>
<li class="chapter" data-level="A.7.5" data-path="proofs.html"><a href="proofs.html#proofasympnoiseSFEStrata"><i class="fa fa-check"></i><b>A.7.5</b> Proof of Theorem @ref(thm:asympnoiseSFEStrata)</a></li>
<li class="chapter" data-level="A.7.6" data-path="proofs.html"><a href="proofs.html#proofPairUnbiasedConsistent"><i class="fa fa-check"></i><b>A.7.6</b> Proof of Theorem @ref(thm:PairUnbiasedConsistent)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Tools for Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mediation-analysis" class="section level1 hasAnchor" number="15">
<h1><span class="header-section-number">Chapter 15</span> Mediation Analysis<a href="mediation-analysis.html#mediation-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>When we have estimated the treatment effect of a program, we sometimes wonder by which channels the program impact has been obtained.
For example, has a Job Training Program been successful because it has increased the human capital of an agent, or simply by signalling to employers her motivation?
The question of separating between the various channels into which a program impact can be decomposed becomes especially important when a program has several components, and we wish to ascertain which one is the more important.
Another reason why we might be interested in which channel precisely is responsible for the program impact is because which channel dominates might give us indications about which theoretical mechanism is at play.</p>
<p>In this chapter, I am going to first delineate the general framework for mediation analysis and the way mediation analysis can be undertaken in the ideal case of a Randomized Controlled Trial.
Then, I am going to present the fundamental problem of mediation analysis (which turns out to be one version of the confounders problem we know all too well) and the various techniques that have been developed in order to solve for it.</p>
<div id="mediation-analysis-a-framework" class="section level2 hasAnchor" number="15.1">
<h2><span class="header-section-number">15.1</span> Mediation analysis: a framework<a href="mediation-analysis.html#mediation-analysis-a-framework" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Mediation analysis posits the existence of a mediator, <span class="math inline">\(M_i\)</span>, which is driving part or the totality of the effect of the treatment on outcome <span class="math inline">\(Y_i\)</span>.
One way to understand how a mediator works is to draw a Direct Acyclic Graph or DAG which represents the relationship between the variables.
The <code>ggdag</code> package helps to draw a DAG easily.
Let’s give it a try:</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:DAGMediation"></span>
<img src="STCI_files/figure-html/DAGMediation-1.png" alt="DAG of the impact of D on Y partially mediated through M" width="50%" />
<p class="caption">
Figure 15.1: DAG of the impact of D on Y partially mediated through M
</p>
</div>
<p>We are first going to define mediated and unmediated treatment effects and see how they work in our example and we’ll then try to understand better how exactly mediation works and the mechanisms that are behind these treatment effects.</p>
<div id="defining-mediated-and-unmediated-treatment-effects" class="section level3 hasAnchor" number="15.1.1">
<h3><span class="header-section-number">15.1.1</span> Defining mediated and unmediated treatment effects<a href="mediation-analysis.html#defining-mediated-and-unmediated-treatment-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s start with a binary mediator, in order to keep things simple: <span class="math inline">\(M_i\in\left\{0,1\right\}\)</span>.
We can define four potential outcomes <span class="math inline">\(Y_i^{d,m}\)</span>, <span class="math inline">\((d,m)\in\left\{0,1\right\}^2\)</span>.
We can also define two potential outcomes for the mediator: <span class="math inline">\(M^d_i\)</span>, <span class="math inline">\(d\in\left\{0,1\right\}\)</span>.</p>
<p>The switching equation can now be written as follows:</p>
<p><span class="math display">\[\begin{align*}
  Y_i &amp; =
    \begin{cases}
    Y_i^{1,1} &amp; \text{if } D_i=1 \text{ and }M_i=1\\
    Y_i^{1,0} &amp; \text{if } D_i=1 \text{ and }M_i=0\\
    Y_i^{0,1} &amp; \text{if } D_i=0 \text{ and }M_i=1\\
    Y_i^{0,0} &amp; \text{if } D_i=0 \text{ and }M_i=0
    \end{cases} \\
    &amp; = Y_i^{1,1}D_iM_i + Y_i^{0,1}(1-D_i)M_i  + Y_i^{1,0}D_i(1-M_i)+ Y_i^{0,0}(1-D_i)(1-M_i).
\end{align*}\]</span></p>
<p>We are now equipped to define two sets of causal mediation effects: the mediated (or indirect) effect and the unmediated (or direct) effect (we follow <a href="https://imai.fas.harvard.edu/research/files/BaronKenny.pdf">Imai, Keene and Tingley (2010)</a>):</p>
<p><span class="math display">\[\begin{align*}
  \Delta^{Y_{m(d)}}_{i} &amp; = Y_i^{d,M_i^1}-Y_i^{d,M_i^0}\\
  \Delta^{Y_{u(d)}}_{i} &amp; = Y_i^{1,M_i^d}-Y_i^{0,M_i^d}.
\end{align*}\]</span></p>
<p><span class="math inline">\(\Delta^{Y_{m(d)}}_{i}\)</span> is the causal effect of the treatment on the outcome acting through the mediator only, while keeping the value of the treatment fixed at <span class="math inline">\(d\)</span>.
<span class="math inline">\(\Delta^{Y_{u(d)}}_{i}\)</span> is the causal effect of the treatment on the outcome acting through the treatment only, while keeping the value of the mediator fixed at <span class="math inline">\(M_i(d)\)</span>.
In the absence of interaction effects between the treatment and the mediator, we have <span class="math inline">\(\Delta^{Y_{m(0)}}_{i}=\Delta^{Y_{m(1)}}_{i}=\Delta^{Y_{m}}_{i}\)</span> and <span class="math inline">\(\Delta^{Y_{u(0)}}_{i}=\Delta^{Y_{u(1)}}_{i}=\Delta^{Y_{u}}_{i}\)</span>.</p>
<p>What is nice is that the individual effect of the treatment can be decomposed in these two components:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{i} &amp; = Y_i^{1,M_i^1}-Y_i^{0,M_i^0}\\
                 &amp; = Y_i^{1,M_i^1}-Y_i^{1,M_i^0}+Y_i^{1,M_i^0}-Y_i^{0,M_i^0}=\Delta^{Y_{m(1)}}_{i}+\Delta^{Y_{u(0)}}_{i}\\
                 &amp; = Y_i^{1,M_i^1}-Y_i^{0,M_i^1}+Y_i^{0,M_i^1}-Y_i^{0,M_i^0}=\Delta^{Y_{u(1)}}_{i}+\Delta^{Y_{m(0)}}_{i}.
\end{align*}\]</span></p>
<p>In the absence of interaction effects between the mediator and the treatment, this decomposition is unique.
The decomposition can also be applied to the TT parameter:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{TT} &amp; = \esp{Y_i^{1,M_i^1}-Y_i^{0,M_i^0}|D_i=1}\\
             &amp; = \Delta^{Y_{m(1)}}_{TT}+\Delta^{Y_{u(0)}}_{TT}\\
            &amp; = \Delta^{Y_{u(1)}}_{TT}+\Delta^{Y_{m(0)}}_{TT},
\end{align*}\]</span></p>
<p>with:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^{Y_{m(d)}}_{TT} &amp; = \esp{\Delta^{Y_{m(d)}}_{i}|D_i=1}\\
  \Delta^{Y_{u(d)}}_{TT} &amp; = \esp{\Delta^{Y_{u(d)}}_{i}|D_i=1}.
\end{align*}\]</span></p>
<p>Here again, the decomposition will be unique if there are no interactions between the treatment and the mediator variable.</p>
<p>Some authors use an alternative definition of the unmediated or direct treatment effect: the controlled direct effect.
It is defined as the average effect of the treatment while keeping the mediator at a predefined value:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^{Y_u(m)}_{TT_c} &amp; = \esp{Y_i^{1,m}-Y_i^{0,m}|D_i=1}.
\end{align*}\]</span></p>
<div class="example">
<p><span id="exm:unnamed-chunk-511" class="example"><strong>Example 15.1  </strong></span>Let’s see how this works in our example.</p>
</div>
<p>The first order of business is to set up a model:</p>
<p><span class="math display">\[\begin{align*}
    y_i^{1,1} &amp; = y_i^0+\bar{\alpha}+ \tau_1 +\theta\mu_i+\eta_i \\
    y_i^{1,0} &amp; = y_i^0+\bar{\alpha}+\theta\mu_i+\eta_i \\
    y_i^{0,1} &amp; = \mu_i+\delta + \tau_0+U_i^0 \\
    y_i^{0,0} &amp; = \mu_i+\delta+U_i^0 \\
    U_i^0 &amp; = \rho U_i^B+\epsilon_i \\
    y_i^B &amp; =\mu_i+U_i^B \\
    U_i^B &amp; \sim\mathcal{N}(0,\sigma^2_{U}) \\
    M_i   &amp; = \uns{\xi y_i^B + \psi D_i+ V^M_i\leq\bar{y}_M} \\
    V^M_i &amp; = \gamma_M(\mu_i-\bar{\mu}) + \omega^M_i \\
    D_i   &amp; = \uns{y_i^B+ V_i\leq\bar{y}} \\
    V_i   &amp; = \gamma(\mu_i-\bar{\mu}) + \omega_i \\
    (\eta_i,\omega_i,\omega^M_i) &amp; \sim\mathcal{N}(0,0,0,\sigma^2_{\eta},\sigma^2_{\omega},\sigma^2_{\omega_M},\rho_{\eta,\omega},\rho_{\eta,\omega_M},\rho_{\omega,\omega_M})
\end{align*}\]</span></p>
<p>Let us choose some parameter values and simulate the model.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="mediation-analysis.html#cb501-1" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,.<span class="dv">5</span>,.<span class="dv">28</span>,<span class="dv">1500</span>,<span class="dv">1500</span>,<span class="fl">0.9</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="sc">-</span><span class="fl">0.25</span>,<span class="fl">0.1</span>,<span class="fl">0.05</span>,<span class="fl">7.98</span>,<span class="fl">0.28</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb501-2"><a href="mediation-analysis.html#cb501-2" tabindex="-1"></a><span class="fu">names</span>(param) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;barmu&quot;</span>,<span class="st">&quot;sigma2mu&quot;</span>,<span class="st">&quot;sigma2U&quot;</span>,<span class="st">&quot;barY&quot;</span>,<span class="st">&quot;barYM&quot;</span>,<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;theta&quot;</span>,<span class="st">&quot;sigma2epsilon&quot;</span>,<span class="st">&quot;sigma2eta&quot;</span>,<span class="st">&quot;delta&quot;</span>,<span class="st">&quot;baralpha&quot;</span>,<span class="st">&quot;tau1&quot;</span>,<span class="st">&quot;tau0&quot;</span>,<span class="st">&quot;xi&quot;</span>,<span class="st">&quot;psi&quot;</span>,<span class="st">&quot;gamma&quot;</span>,<span class="st">&quot;gammaM&quot;</span>,<span class="st">&quot;baryB&quot;</span>,<span class="st">&quot;sigma2omega&quot;</span>,<span class="st">&quot;sigma2omegaM&quot;</span>,<span class="st">&quot;rhoetaomega&quot;</span>,<span class="st">&quot;rhoetaomegaM&quot;</span>,<span class="st">&quot;rhoomegaomegaM&quot;</span>)</span></code></pre></div>
<p>Let us now simulate the data:</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="mediation-analysis.html#cb502-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb502-2"><a href="mediation-analysis.html#cb502-2" tabindex="-1"></a>N <span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb502-3"><a href="mediation-analysis.html#cb502-3" tabindex="-1"></a>cov.eta.omega.omegaM <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(param[<span class="st">&quot;sigma2eta&quot;</span>],param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;rhoetaomegaM&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omegaM&quot;</span>]),</span>
<span id="cb502-4"><a href="mediation-analysis.html#cb502-4" tabindex="-1"></a>                                 param[<span class="st">&quot;rhoetaomega&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omega&quot;</span>]),param[<span class="st">&quot;sigma2omega&quot;</span>],param[<span class="st">&quot;rhoomegaomegaM&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2omega&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omegaM&quot;</span>]),</span>
<span id="cb502-5"><a href="mediation-analysis.html#cb502-5" tabindex="-1"></a>                                 param[<span class="st">&quot;rhoetaomegaM&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2eta&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omegaM&quot;</span>]),param[<span class="st">&quot;rhoomegaomegaM&quot;</span>]<span class="sc">*</span><span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2omega&quot;</span>]<span class="sc">*</span>param[<span class="st">&quot;sigma2omegaM&quot;</span>]),param[<span class="st">&quot;sigma2omegaM&quot;</span>]),<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">3</span>)</span>
<span id="cb502-6"><a href="mediation-analysis.html#cb502-6" tabindex="-1"></a>eta.omega <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">mvrnorm</span>(N,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),cov.eta.omega.omegaM))</span>
<span id="cb502-7"><a href="mediation-analysis.html#cb502-7" tabindex="-1"></a><span class="fu">colnames</span>(eta.omega) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;eta&#39;</span>,<span class="st">&#39;omega&#39;</span>,<span class="st">&#39;omegaM&#39;</span>)</span>
<span id="cb502-8"><a href="mediation-analysis.html#cb502-8" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,param[<span class="st">&quot;barmu&quot;</span>],<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2mu&quot;</span>]))</span>
<span id="cb502-9"><a href="mediation-analysis.html#cb502-9" tabindex="-1"></a>UB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2U&quot;</span>]))</span>
<span id="cb502-10"><a href="mediation-analysis.html#cb502-10" tabindex="-1"></a>yB <span class="ot">&lt;-</span> mu <span class="sc">+</span> UB </span>
<span id="cb502-11"><a href="mediation-analysis.html#cb502-11" tabindex="-1"></a>YB <span class="ot">&lt;-</span> <span class="fu">exp</span>(yB)</span>
<span id="cb502-12"><a href="mediation-analysis.html#cb502-12" tabindex="-1"></a>Ds <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb502-13"><a href="mediation-analysis.html#cb502-13" tabindex="-1"></a>V <span class="ot">&lt;-</span> param[<span class="st">&quot;gamma&quot;</span>]<span class="sc">*</span>(mu<span class="sc">-</span>param[<span class="st">&quot;barmu&quot;</span>])<span class="sc">+</span>eta.omega<span class="sc">$</span>omega</span>
<span id="cb502-14"><a href="mediation-analysis.html#cb502-14" tabindex="-1"></a>Ds[yB<span class="sc">+</span>V<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barY&quot;</span>])] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb502-15"><a href="mediation-analysis.html#cb502-15" tabindex="-1"></a>VM <span class="ot">&lt;-</span> param[<span class="st">&quot;gammaM&quot;</span>]<span class="sc">*</span>(mu<span class="sc">-</span>param[<span class="st">&quot;barmu&quot;</span>])<span class="sc">+</span>eta.omega<span class="sc">$</span>omegaM</span>
<span id="cb502-16"><a href="mediation-analysis.html#cb502-16" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb502-17"><a href="mediation-analysis.html#cb502-17" tabindex="-1"></a>M[param[<span class="st">&#39;xi&#39;</span>]<span class="sc">*</span>yB<span class="sc">+</span>param[<span class="st">&#39;psi&#39;</span>]<span class="sc">*</span>Ds<span class="sc">+</span>VM<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barYM&quot;</span>])] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb502-18"><a href="mediation-analysis.html#cb502-18" tabindex="-1"></a>M1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb502-19"><a href="mediation-analysis.html#cb502-19" tabindex="-1"></a>M1[param[<span class="st">&#39;xi&#39;</span>]<span class="sc">*</span>yB<span class="sc">+</span>param[<span class="st">&#39;psi&#39;</span>]<span class="sc">+</span>VM<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barYM&quot;</span>])] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb502-20"><a href="mediation-analysis.html#cb502-20" tabindex="-1"></a>M0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb502-21"><a href="mediation-analysis.html#cb502-21" tabindex="-1"></a>M0[param[<span class="st">&#39;xi&#39;</span>]<span class="sc">*</span>yB<span class="sc">+</span>VM<span class="sc">&lt;=</span><span class="fu">log</span>(param[<span class="st">&quot;barYM&quot;</span>])] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb502-22"><a href="mediation-analysis.html#cb502-22" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="fu">sqrt</span>(param[<span class="st">&quot;sigma2epsilon&quot;</span>]))</span>
<span id="cb502-23"><a href="mediation-analysis.html#cb502-23" tabindex="-1"></a>U0 <span class="ot">&lt;-</span> param[<span class="st">&quot;rho&quot;</span>]<span class="sc">*</span>UB <span class="sc">+</span> epsilon</span>
<span id="cb502-24"><a href="mediation-analysis.html#cb502-24" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> param[<span class="st">&quot;baralpha&quot;</span>]<span class="sc">+</span>  param[<span class="st">&quot;theta&quot;</span>]<span class="sc">*</span>mu <span class="sc">+</span> eta.omega<span class="sc">$</span>eta</span>
<span id="cb502-25"><a href="mediation-analysis.html#cb502-25" tabindex="-1"></a>y00 <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0 <span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb502-26"><a href="mediation-analysis.html#cb502-26" tabindex="-1"></a>y01 <span class="ot">&lt;-</span> mu <span class="sc">+</span>  U0 <span class="sc">+</span> param[<span class="st">&#39;tau0&#39;</span>]<span class="sc">+</span> param[<span class="st">&quot;delta&quot;</span>]</span>
<span id="cb502-27"><a href="mediation-analysis.html#cb502-27" tabindex="-1"></a>y10 <span class="ot">&lt;-</span> y00<span class="sc">+</span>alpha</span>
<span id="cb502-28"><a href="mediation-analysis.html#cb502-28" tabindex="-1"></a>y11 <span class="ot">&lt;-</span> y00<span class="sc">+</span>alpha<span class="sc">+</span>param[<span class="st">&#39;tau1&#39;</span>]</span>
<span id="cb502-29"><a href="mediation-analysis.html#cb502-29" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y11<span class="sc">*</span>M1<span class="sc">+</span>y10<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>M1)</span>
<span id="cb502-30"><a href="mediation-analysis.html#cb502-30" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> y01<span class="sc">*</span>M0<span class="sc">+</span>y00<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>M0)</span>
<span id="cb502-31"><a href="mediation-analysis.html#cb502-31" tabindex="-1"></a>y1M1 <span class="ot">&lt;-</span> y00<span class="sc">+</span>alpha<span class="sc">+</span>param[<span class="st">&#39;tau1&#39;</span>]<span class="sc">*</span>M1</span>
<span id="cb502-32"><a href="mediation-analysis.html#cb502-32" tabindex="-1"></a>y1M0 <span class="ot">&lt;-</span> y00<span class="sc">+</span>alpha<span class="sc">+</span>param[<span class="st">&#39;tau1&#39;</span>]<span class="sc">*</span>M0</span>
<span id="cb502-33"><a href="mediation-analysis.html#cb502-33" tabindex="-1"></a>y0M1 <span class="ot">&lt;-</span> y00 <span class="sc">+</span> param[<span class="st">&#39;tau0&#39;</span>]<span class="sc">*</span>M1</span>
<span id="cb502-34"><a href="mediation-analysis.html#cb502-34" tabindex="-1"></a>y0M0 <span class="ot">&lt;-</span> y00 <span class="sc">+</span> param[<span class="st">&#39;tau0&#39;</span>]<span class="sc">*</span>M0</span>
<span id="cb502-35"><a href="mediation-analysis.html#cb502-35" tabindex="-1"></a>y <span class="ot">&lt;-</span> y11<span class="sc">*</span>Ds<span class="sc">*</span>M<span class="sc">+</span>y10<span class="sc">*</span>Ds<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>M)<span class="sc">+</span>y01<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)<span class="sc">*</span>M<span class="sc">+</span>y00<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Ds)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>M)</span></code></pre></div>
<p>Let us finally compute the values of TT and of the mediated and unmediated average treatment effects on the treated in the sample.</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="mediation-analysis.html#cb503-1" tabindex="-1"></a><span class="co"># treatment on the treated</span></span>
<span id="cb503-2"><a href="mediation-analysis.html#cb503-2" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">mean</span>(y1[Ds<span class="sc">==</span><span class="dv">1</span>]<span class="sc">-</span>y0[Ds<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb503-3"><a href="mediation-analysis.html#cb503-3" tabindex="-1"></a><span class="co"># mediated treatment effects</span></span>
<span id="cb503-4"><a href="mediation-analysis.html#cb503-4" tabindex="-1"></a>TTm1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y1M1[Ds<span class="sc">==</span><span class="dv">1</span>]<span class="sc">-</span>y1M0[Ds<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb503-5"><a href="mediation-analysis.html#cb503-5" tabindex="-1"></a>TTm0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y0M1[Ds<span class="sc">==</span><span class="dv">1</span>]<span class="sc">-</span>y0M0[Ds<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb503-6"><a href="mediation-analysis.html#cb503-6" tabindex="-1"></a><span class="co"># unmediated treatment effects</span></span>
<span id="cb503-7"><a href="mediation-analysis.html#cb503-7" tabindex="-1"></a>TTu1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y1M1[Ds<span class="sc">==</span><span class="dv">1</span>]<span class="sc">-</span>y0M1[Ds<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb503-8"><a href="mediation-analysis.html#cb503-8" tabindex="-1"></a>TTu0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y1M0[Ds<span class="sc">==</span><span class="dv">1</span>]<span class="sc">-</span>y0M0[Ds<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb503-9"><a href="mediation-analysis.html#cb503-9" tabindex="-1"></a></span>
<span id="cb503-10"><a href="mediation-analysis.html#cb503-10" tabindex="-1"></a><span class="co"># preparing graph</span></span>
<span id="cb503-11"><a href="mediation-analysis.html#cb503-11" tabindex="-1"></a>mediation.example <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">TT=</span><span class="fu">c</span>(TTm1,TTu0,TTm0,TTu1),<span class="at">Effect=</span><span class="fu">c</span>(<span class="st">&quot;TTm1&quot;</span>,<span class="st">&quot;TTu0&quot;</span>,<span class="st">&quot;TTm0&quot;</span>,<span class="st">&quot;TTu1&quot;</span>),<span class="at">Type=</span><span class="fu">c</span>(<span class="st">&quot;Mediated&quot;</span>,<span class="st">&quot;Unmediated&quot;</span>,<span class="st">&quot;Mediated&quot;</span>,<span class="st">&quot;Unmediated&quot;</span>),<span class="at">Decomposition=</span><span class="fu">c</span>(<span class="st">&quot;m1u0&quot;</span>,<span class="st">&quot;m1u0&quot;</span>,<span class="st">&quot;m0u1&quot;</span>,<span class="st">&quot;m0u1&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb503-12"><a href="mediation-analysis.html#cb503-12" tabindex="-1"></a>                      <span class="fu">mutate</span>(</span>
<span id="cb503-13"><a href="mediation-analysis.html#cb503-13" tabindex="-1"></a>                        <span class="at">Effect=</span><span class="fu">factor</span>(Effect,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;TTm1&quot;</span>,<span class="st">&quot;TTu0&quot;</span>,<span class="st">&quot;TTm0&quot;</span>,<span class="st">&quot;TTu1&quot;</span>)),</span>
<span id="cb503-14"><a href="mediation-analysis.html#cb503-14" tabindex="-1"></a>                        <span class="at">Type=</span><span class="fu">factor</span>(Type,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;Mediated&quot;</span>,<span class="st">&quot;Unmediated&quot;</span>)),</span>
<span id="cb503-15"><a href="mediation-analysis.html#cb503-15" tabindex="-1"></a>                        <span class="at">Decomposition=</span><span class="fu">factor</span>(Decomposition,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;m1u0&quot;</span>,<span class="st">&quot;m0u1&quot;</span>))</span>
<span id="cb503-16"><a href="mediation-analysis.html#cb503-16" tabindex="-1"></a>                      )</span></code></pre></div>
<p>The average effect of the treatment on the treated is equal to 0.243.
It can be decomposed in two ways.
First, the impact mediated through the mediator <span class="math inline">\(M_i\)</span> when <span class="math inline">\(D_i\)</span> is fixed at 1 (0.014) and the effect not mediated through <span class="math inline">\(M_i\)</span> (with <span class="math inline">\(M_i\)</span> fixed at <span class="math inline">\(M_i^0\)</span>) (0.228).
Second, the impact mediated through the mediator <span class="math inline">\(M_i\)</span> when <span class="math inline">\(D_i\)</span> is fixed at 0 (0.007) and the effect not mediated through <span class="math inline">\(M_i\)</span> (with <span class="math inline">\(M_i\)</span> fixed at <span class="math inline">\(M_i^1\)</span>) (0.235).
Let us plot the results:</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="mediation-analysis.html#cb504-1" tabindex="-1"></a><span class="co"># plotting the result</span></span>
<span id="cb504-2"><a href="mediation-analysis.html#cb504-2" tabindex="-1"></a><span class="fu">ggplot</span>(mediation.example, <span class="fu">aes</span>(<span class="at">x=</span>Decomposition, <span class="at">y=</span>TT,<span class="at">fill=</span>Type)) <span class="sc">+</span></span>
<span id="cb504-3"><a href="mediation-analysis.html#cb504-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb504-4"><a href="mediation-analysis.html#cb504-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:PlotMediationExample"></span>
<img src="STCI_files/figure-html/PlotMediationExample-1.png" alt="Decomposition of the Average Treatment Effect on the Treated in Mediated and Unmediated Effect" width="50%" />
<p class="caption">
Figure 15.2: Decomposition of the Average Treatment Effect on the Treated in Mediated and Unmediated Effect
</p>
</div>
<p>As Figure <a href="mediation-analysis.html#fig:PlotMediationExample">15.2</a> shows, most of the effect of the treatment on the outcome is not mediated through <span class="math inline">\(M_i\)</span> in our example.
We can also see that there seems to be limited interaction between the treatment and the mediator since both decompositions yield similar quantities.</p>
</div>
<div id="decomposing-mediated-and-unmediated-effects" class="section level3 hasAnchor" number="15.1.2">
<h3><span class="header-section-number">15.1.2</span> Decomposing mediated and unmediated effects<a href="mediation-analysis.html#decomposing-mediated-and-unmediated-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to understand better how mediation works, it is very useful to decompose the mediated and unmediated effects using the classical typology of <a href="https://www.jstor.org/stable/2951620">Imbens and Angrist (1994)</a>.
Let’s define four types by the reactions of their mediators to the treatment:</p>
<ul>
<li><strong>Always takers</strong>, who always have the mediator set to 1: <span class="math inline">\(M_i^{1}=M_i^{0}=1\)</span>.
I denote them <span class="math inline">\(T_i=a\)</span>.</li>
<li><strong>Never takers</strong>, who always have the mediator set to 0: <span class="math inline">\(M_i^{1}=M_i^{0}=0\)</span>.
I denote them <span class="math inline">\(T_i=n\)</span>.</li>
<li><strong>Compliers</strong>, whose value of the mediator moves from 0 to 1 when the value of the treatment variable changes from 0 to 1: <span class="math inline">\(M_i^{1}=1\)</span> and <span class="math inline">\(M_i^{0}=0\)</span>.
I denote them <span class="math inline">\(T_i=c\)</span>.</li>
<li><strong>Defiers</strong>, whose value of the mediator switches from 1 to 0 when the value of the treatment variable changes from 0 to 1: <span class="math inline">\(M_i^{1}=0\)</span> and <span class="math inline">\(M_i^{0}=1\)</span>.
I denote them <span class="math inline">\(T_i=d\)</span>.</li>
</ul>
<p><span class="math inline">\(T_i\)</span> spans all the potential reactions of the mediator to the treatment, and thus <span class="math inline">\(\cup_{t\in\{a,n,c,d\}}\{T_i=t\}\)</span> is a partition of the sampling space.
It is very interesting to decompose both the full treatment effect on the treated but also the mediated and unmediated treatment effects on the treated in terms of the <span class="math inline">\(T_i\)</span> variable.
Let’s go.
The Treatment on the Treated parameter first:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{TT} &amp; = \esp{Y_i^{1,M_i^1}-Y_i^{0,M_i^0}|D_i=1}\\
                &amp; = \sum_{t\in\{a,n,c,d\}}\esp{Y_i^{1,M_i^1}-Y_i^{0,M_i^0}|T_i=t,D_i=1}\Pr(T_i=t|D_i=1)\\
                &amp; = \esp{Y_i^{1,1}-Y_i^{0,1}|T_i=a,D_i=1}\Pr(T_i=a|D_i=1)\\
                &amp; \phantom{=}+\esp{Y_i^{1,0}-Y_i^{0,0}|T_i=n,D_i=1}\Pr(T_i=n|D_i=1)\\
                &amp; \phantom{=}+\esp{Y_i^{1,1}-Y_i^{0,0}|T_i=c,D_i=1}\Pr(T_i=c|D_i=1)\\
                &amp; \phantom{=}+\esp{Y_i^{1,0}-Y_i^{0,1}|T_i=d,D_i=1}\Pr(T_i=d|D_i=1).
\end{align*}\]</span></p>
<p>Let us now look at the average mediated effect on the treated:</p>
<p><span class="math display">\[\begin{align*}
\Delta^{Y_{m(1)}}_{TT} &amp; = \esp{Y_i^{1,M_i^1}-Y_i^{1,M_i^0}|D_i=1}\\
                &amp; = \sum_{t\in\{a,n,c,d\}}\esp{Y_i^{1,M_i^1}-Y_i^{1,M_i^0}|T_i=t,D_i=1}\Pr(T_i=t|D_i=1)\\
                &amp; = \esp{Y_i^{1,1}-Y_i^{1,1}|T_i=a,D_i=1}\Pr(T_i=a|D_i=1)\\
                &amp; \phantom{=}+\esp{Y_i^{1,0}-Y_i^{1,0}|T_i=n,D_i=1}\Pr(T_i=n|D_i=1)\\
                &amp; \phantom{=}+\esp{Y_i^{1,1}-Y_i^{1,0}|T_i=c,D_i=1}\Pr(T_i=c|D_i=1)\\
                &amp; \phantom{=}+\esp{Y_i^{1,0}-Y_i^{1,1}|T_i=d,D_i=1}\Pr(T_i=d|D_i=1)\\
                &amp; = \esp{Y_i^{1,1}-Y_i^{1,0}|T_i=c,D_i=1}\Pr(T_i=c|D_i=1)\\
                &amp; \phantom{=}-\esp{Y_i^{1,1}-Y_i^{1,0}|T_i=d,D_i=1}\Pr(T_i=d|D_i=1).
\end{align*}\]</span></p>
<p>The result above is very useful and provides several fruitful insights.
First, the average mediated effect on the treated only involves the effects on the compliers and the defiers.
That is, only units whose value of the mediator is affected by the treatment are part of the mediated treatment effect.
Second, their importance in the mediated treatment effect depends on their proportion in the (treated) population.
That is, if few units have their value of the mediator affected by the treatment, the size of the mediated treatment effect decreases.
Finally, the impact of the mediator on the defiers enters with a negative weight in the definition of the mediated treatment effect.
This makes sense, since the treatment makes these units experience lower values of the mediator.</p>
<p>Finally, let us decompose the unmediated treatment effect on the treated:</p>
<p><span class="math display">\[\begin{align*}
\Delta^{Y_{u(0)}}_{TT} &amp; = \esp{Y_i^{1,M_i^0}-Y_i^{0,M_i^0}|D_i=1}\\
                &amp; = \sum_{t\in\{a,n,c,d\}}\esp{Y_i^{1,M_i^0}-Y_i^{0,M_i^0}|T_i=t,D_i=1}\Pr(T_i=t|D_i=1)\\
                &amp; = \esp{Y_i^{1,1}-Y_i^{0,1}|T_i=a,D_i=1}\Pr(T_i=a|D_i=1)\\
                &amp; \phantom{=}+\esp{Y_i^{1,0}-Y_i^{0,0}|T_i=n,D_i=1}\Pr(T_i=n|D_i=1)\\
                &amp; \phantom{=}+\esp{Y_i^{1,0}-Y_i^{0,0}|T_i=c,D_i=1}\Pr(T_i=c|D_i=1)\\
                &amp; \phantom{=}+\esp{Y_i^{1,1}-Y_i^{0,1}|T_i=d,D_i=1}\Pr(T_i=d|D_i=1).
\end{align*}\]</span></p>
<p>The unmediated treatment effect on the treated is equal to the direct effect of the treatment on each of the types multiplied by their proportion in the (treated) population, keeping the value of the mediator at its default value when the treatment is equal to 0.</p>
</div>
</div>
<div id="the-fundamental-problem-of-mediation-analysis" class="section level2 hasAnchor" number="15.2">
<h2><span class="header-section-number">15.2</span> The Fundamental Problem of Mediation Analysis<a href="mediation-analysis.html#the-fundamental-problem-of-mediation-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, we state the Fundamental Problem of Mediation Analysis (FPMA) and we then move on to examining the biases of intuitive comparisons that could be used to recover the mediated and unmediated effects of the treatment.</p>
<div id="the-fundamental-problem-of-mediation-analysis-1" class="section level3 hasAnchor" number="15.2.1">
<h3><span class="header-section-number">15.2.1</span> The Fundamental Problem of Mediation Analysis<a href="mediation-analysis.html#the-fundamental-problem-of-mediation-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Mediation analysis is hard.
It is even harder than identification and estimation of treatment effects.
The following theorem shows formally why this is the case:</p>
<div class="theorem">
<p><span id="thm:FPMA" class="theorem"><strong>Theorem 15.1  (Fundamental Problem of Mediation Analysis) </strong></span>The mediated and unmediated treatment effects are fundamentally unobservable.</p>
</div>
<div class="proof">
<p><span id="unlabeled-div-319" class="proof"><em>Proof</em>. </span>Let’s look at the mediated treatment effect first.
It can be decomposed as follows:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^{Y_{m(1)}}_{TT} &amp; = \esp{Y_i^{1,M_i^1}-Y_i^{1,M_i^0}|D_i=1}\\
                        &amp;  = \esp{Y_i^{1,M_i^1}-Y_i^{1,M_i^0}|D_i=1,M_i=1}\Pr(M_i=1|D_i=1)\\
                        &amp; \phantom{=} + \esp{Y_i^{1,M_i^1}-Y_i^{1,M_i^0}|D_i=1,M_i=0}\Pr(M_i=0|D_i=1)\\
                        &amp; = \esp{Y^{1,1}_i-Y_i^{1,M_i^0}|D_i=1,M_i=1}\Pr(M_i=1|D_i=1)\\
                        &amp; \phantom{=} + \esp{Y^{1,0}_i-Y_i^{1,M_i^0}|D_i=1,M_i=0}\Pr(M_i=0|D_i=1)\\
                        &amp; = (\esp{Y_i|D_i=1,M_i=1}-\esp{Y_i^{1,M_i^0}|D_i=1,M_i=1})\Pr(M_i=1|D_i=1)\\
                        &amp; \phantom{=} + (\esp{Y_i|D_i=1,M_i=0}-\esp{Y_i^{1,M_i^0}|D_i=1,M_i=0})\Pr(M_i=0|D_i=1),
\end{align*}\]</span></p>
<p>where the second and third inequalities follow from the switching equation.
Note that both <span class="math inline">\(\esp{Y_i^{1,M_i^0}|D_i=1,M_i=1}\)</span> and <span class="math inline">\(\esp{Y_i^{1,M_i^0}|D_i=1,M_i=0}\)</span> are counterfactual values that cannot be observed (they depend on the value of the mediator when <span class="math inline">\(D_i=0\)</span>, which is unobserved when <span class="math inline">\(D_i=1\)</span>).</p>
<p>Let us look at the unmediated treatment effect now:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^{Y_{u(1)}}_{TT} &amp; = \esp{Y_i^{1,M_i^1}-Y_i^{0,M_i^1}|D_i=1}\\
                         &amp;  = \esp{Y_i^{1,M_i^1}-Y_i^{0,M_i^1}|D_i=1,M_i=1}\Pr(M_i=1|D_i=1)\\
                        &amp; \phantom{=} + \esp{Y_i^{1,M_i^1}-Y_i^{0,M_i^1}|D_i=1,M_i=0}\Pr(M_i=0|D_i=1)\\
                        &amp; = \esp{Y^{1,1}_i-Y_i^{0,M_i^1}|D_i=1,M_i=1}\Pr(M_i=1|D_i=1)\\
                        &amp; \phantom{=} + \esp{Y^{1,0}_i-Y_i^{0,M_i^1}|D_i=1,M_i=0}\Pr(M_i=0|D_i=1)\\
                        &amp; = (\esp{Y_i|D_i=1,M_i=1}-\esp{Y_i^{0,M_i^1}|D_i=1,M_i=1})\Pr(M_i=1|D_i=1)\\
                        &amp; \phantom{=} + (\esp{Y_i|D_i=1,M_i=0}-\esp{Y_i^{0,M_i^1}|D_i=1,M_i=0})\Pr(M_i=0|D_i=1),
\end{align*}\]</span></p>
<p>Note that both <span class="math inline">\(\esp{Y_i^{0,M_i^1}|D_i=1,M_i=1}\)</span> and <span class="math inline">\(\esp{Y_i^{0,M_i^1}|D_i=1,M_i=0}\)</span> are counterfactual values that cannot be observed (they depend on the value of the outcome when <span class="math inline">\(D_i=0\)</span>, which is unobserved when <span class="math inline">\(D_i=1\)</span>).</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-320" class="remark"><em>Remark</em>. </span>The key to understanding Theorem <a href="mediation-analysis.html#thm:FPMA">15.1</a> is to see that the potential value of the mediator is unknown and this combines with the fact that the potential value of the outcome had the mediator or the treatment changed value is also unobserved.</p>
</div>
</div>
<div id="biases-of-intuitive-comparisons" class="section level3 hasAnchor" number="15.2.2">
<h3><span class="header-section-number">15.2.2</span> Biases of Intuitive Comparisons<a href="mediation-analysis.html#biases-of-intuitive-comparisons" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Usual intuitive proxies for the mediated and unmediated effects are usually biased because of confounders.
We can visualize the problem in a DAG, with the arcs indicating the existence of confounders between two variables:</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:DAGMediationConfounded"></span>
<img src="STCI_files/figure-html/DAGMediationConfounded-1.png" alt="DAG of a confounded mediating relationship" width="50%" />
<p class="caption">
Figure 15.3: DAG of a confounded mediating relationship
</p>
</div>
<p>The most obvious intuitive comparison that could try to recover mediated and unmediated treatment effects is the conditional With/Without comparison:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{WW|D_i=d} &amp; = \esp{Y_i|D_i=d,M_i=1}-\esp{Y_i|D_i=d,M_i=0}\\
  \Delta^Y_{WW|M_i=m} &amp; = \esp{Y_i|D_i=1,M_i=m}-\esp{Y_i|D_i=0,M_i=m}.
\end{align*}\]</span></p>
<p>Our hope is that <span class="math inline">\(\Delta^Y_{WW|D_i=d}\)</span> recovers the mediated treatment effect and <span class="math inline">\(\Delta^Y_{WW|M_i=d}\)</span> recovers the unmediated treatment effect.
Unfortunately, that is not generally the case.
The following theorem makes this point clear:</p>
<div class="theorem">
<p><span id="thm:WWBiasMed" class="theorem"><strong>Theorem 15.2  (Bias of the Conditional With/Without Comparisons) </strong></span>The conditional With/Without comparisons are biased estimators of the mediated and unmediated average effects of the treatment on the treated:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{WW|D_i=1} &amp; = \Delta^{Y_{m(1)}}_{TT|M_i=1}+\Delta^{Y^{1,0}}_{SB^{m(1)}|D_i=1}\\
  \Delta^Y_{WW|M_i=1} &amp; = \Delta^{Y_{u(1)}}_{TT|M_i=1}+\Delta^{Y^{0,1}}_{SB^{u(1)}|M_i=1}.
\end{align*}\]</span></p>
<p>with</p>
<p><span class="math display">\[\begin{align*}
  \Delta^{Y_{m(1)}}_{TT|M_i=1} &amp; = \esp{Y_i^{1,1}-Y_i^{1,0}|D_i=1,M_i=1}\\
  \Delta^{Y^{1,0}}_{SB^{m(1)}|D_i=1} &amp; = \esp{Y^{1,0}_i|D_i=1,M_i=1}-\esp{Y^{1,0}_i|D_i=1,M_i=0}\\
  \Delta^{Y_{u(1)}}_{TT|M_i=1} &amp; = \esp{Y_i^{1,1}-Y_i^{0,1}|D_i=1,M_i=1}\\
  \Delta^{Y^{0,1}}_{SB^{u(1)}|M_i=1} &amp; = \esp{Y^{0,1}_i|D_i=1,M_i=1}-\esp{Y^{0,1}_i|D_i=0,M_i=0}.
\end{align*}\]</span></p>
</div>
<div class="proof">
<p><span id="unlabeled-div-321" class="proof"><em>Proof</em>. </span>The proof is straightforward using the switching equation and adding and subtracting the counterfactual part of the treatment effects.</p>
</div>
<p>According to Theorem <a href="mediation-analysis.html#thm:WWBiasMed">15.2</a>, Selection Bias biases the conditional With/Without estimators of the mediated and unmediated treatment effects.
As Figure @(ref:DAGMediationConfounded) suggests, this is because confounders are correlated with both treatment, mediator and outcome.
The most important confounder in our example is <span class="math inline">\(\mu_i\)</span>, which is correlated with all three variables.</p>
<div class="remark">
<p><span id="unlabeled-div-322" class="remark"><em>Remark</em>. </span>Note that Theorem <a href="mediation-analysis.html#thm:WWBiasMed">15.2</a> shows the bias for the mediated and unmediated treatment effects conditional on <span class="math inline">\(M_i=1\)</span>.
The same results with the unconditional version of the treatment effects would be somewhat more intricate since it would involve weights.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-323" class="remark"><em>Remark</em>. </span>Note also that Theorem <a href="mediation-analysis.html#thm:WWBiasMed">15.2</a> shows the bias for the mediated and unmediated treatment effects with <span class="math inline">\(m(1)\)</span> and <span class="math inline">\(u(1)\)</span> as indices.
The same results with <span class="math inline">\(m(0)\)</span> and <span class="math inline">\(u(0)\)</span> are similar.</p>
</div>
<div class="example">
<p><span id="exm:unnamed-chunk-517" class="example"><strong>Example 15.2  </strong></span>Let’s see how that works our in our example.</p>
</div>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="mediation-analysis.html#cb505-1" tabindex="-1"></a><span class="co"># mediated treatment effect for M=1</span></span>
<span id="cb505-2"><a href="mediation-analysis.html#cb505-2" tabindex="-1"></a>TTm1M1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y11[Ds<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">1</span>])<span class="sc">-</span><span class="fu">mean</span>(y10[Ds<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb505-3"><a href="mediation-analysis.html#cb505-3" tabindex="-1"></a><span class="co"># unmediated treatment effect for M==1</span></span>
<span id="cb505-4"><a href="mediation-analysis.html#cb505-4" tabindex="-1"></a>TTu1M1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y11[Ds<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">1</span>])<span class="sc">-</span><span class="fu">mean</span>(y01[Ds<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb505-5"><a href="mediation-analysis.html#cb505-5" tabindex="-1"></a></span>
<span id="cb505-6"><a href="mediation-analysis.html#cb505-6" tabindex="-1"></a><span class="co"># selection bias for the mediated treatment effect</span></span>
<span id="cb505-7"><a href="mediation-analysis.html#cb505-7" tabindex="-1"></a>SBm1D1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y10[Ds<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">1</span>])<span class="sc">-</span><span class="fu">mean</span>(y10[Ds<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb505-8"><a href="mediation-analysis.html#cb505-8" tabindex="-1"></a><span class="co"># selection bias for the unmediated treatment effect</span></span>
<span id="cb505-9"><a href="mediation-analysis.html#cb505-9" tabindex="-1"></a>SBu1M1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y01[Ds<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">1</span>])<span class="sc">-</span><span class="fu">mean</span>(y01[Ds<span class="sc">==</span><span class="dv">0</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb505-10"><a href="mediation-analysis.html#cb505-10" tabindex="-1"></a></span>
<span id="cb505-11"><a href="mediation-analysis.html#cb505-11" tabindex="-1"></a><span class="co"># with/without comparison for the mediated treatment effect for M=1</span></span>
<span id="cb505-12"><a href="mediation-analysis.html#cb505-12" tabindex="-1"></a>WWD1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y[Ds<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">1</span>])<span class="sc">-</span><span class="fu">mean</span>(y[Ds<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb505-13"><a href="mediation-analysis.html#cb505-13" tabindex="-1"></a><span class="co"># unmediated treatment effect for M==1</span></span>
<span id="cb505-14"><a href="mediation-analysis.html#cb505-14" tabindex="-1"></a>WWM1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y[Ds<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">1</span>])<span class="sc">-</span><span class="fu">mean</span>(y[Ds<span class="sc">==</span><span class="dv">0</span><span class="sc">&amp;</span>M<span class="sc">==</span><span class="dv">1</span>])</span></code></pre></div>
<p>In our example, the With/Without estimator of the mediated treatment effect is equal to -0.239 (for <span class="math inline">\(D_i=1\)</span>).
The true mediated treatment effect for <span class="math inline">\(D_i=1\)</span> and <span class="math inline">\(M_i=1\)</span> is equal to 0.2.
Selection bias for the mediated treatment effect for <span class="math inline">\(D_i=1\)</span> is thus equal to -0.439.
The With/Without estimator of the unmediated treatment effect is equal to -0.571 (for <span class="math inline">\(M_i=1\)</span>).
The true unmediated treatment effect for <span class="math inline">\(D_i=1\)</span> and <span class="math inline">\(M_i=1\)</span> is equal to 0.253.
Selection bias for the unmediated treatment effect for <span class="math inline">\(M_i=1\)</span> is thus equal to -0.824.</p>
</div>
</div>
<div id="mediation-analysis-with-experimental-data" class="section level2 hasAnchor" number="15.3">
<h2><span class="header-section-number">15.3</span> Mediation analysis with experimental data<a href="mediation-analysis.html#mediation-analysis-with-experimental-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1467-985X.2012.01032.x">Imai, Tingleu and Yamamoto (2013)</a> propose two experimental designs to recover the mediated and unmediated treatment effects: the parallel design and the crossover design.
We are going to also study identification in a Sequential Self-Selection design, which I find slightly simpler.
Let’s examine these approaches in turn.</p>
<div id="mediation-analysis-in-the-parallel-design" class="section level3 hasAnchor" number="15.3.1">
<h3><span class="header-section-number">15.3.1</span> Mediation analysis in the Parallel design<a href="mediation-analysis.html#mediation-analysis-in-the-parallel-design" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the parallel design, we run a three-step experiment.
In the first step, we randomly allocate units either to the first or the second arm of the experiment.
We denote <span class="math inline">\(R^1_i=0\)</span> the first arm and <span class="math inline">\(R^1_i=1\)</span> the second arm.</p>
<p>In the first arm, we randomly allocate the treatment among units and we let the mediator take the corresponding value without interferring.
We denote <span class="math inline">\(R^2_i=1\)</span> when unit <span class="math inline">\(i\)</span> is assigned to the treatment and <span class="math inline">\(R^2_i=0\)</span> when unit <span class="math inline">\(i\)</span> us not assigned to the treatment.
In this design, we assume that units fully comply with the assignment.
One way to do that is to run the whole parallel design only on units that are selected into the treatment (<span class="math inline">\(D_i=1\)</span>).</p>
<p>In the second arm, we run a two-step experiment.
In the first step, we randomly allocate units either to the treatment or to the control.
We denote <span class="math inline">\(R_i^2=1\)</span> when unit <span class="math inline">\(i\)</span> is assigned to the treatment and <span class="math inline">\(R_i^2=0\)</span> when it is assigned to the control.
In the second step, we randomly allocate units to the mediator.
We denote <span class="math inline">\(R_i^3=1\)</span> when unit <span class="math inline">\(i\)</span> is assigned to the mediator value <span class="math inline">\(M_i=1\)</span> and <span class="math inline">\(R_i^3=0\)</span> when unit <span class="math inline">\(i\)</span> is assigned to the mediator value of <span class="math inline">\(M_i=0\)</span>.</p>
<p>In order to recover the treatment effect on the treated, we are going to assume that the experiment takes place among the units selected to participate in the treatment, <em>i.e.</em> among units with <span class="math inline">\(D_i=1\)</span>.
If we abstract from this, the parameter we recover is the average effect of the treatment, ATE.</p>
<p>Let us formalize the assumptions we make on the Parallel design</p>
<div class="hypothesis">
<p><span id="hyp:parindepss" class="hypothesis"><strong>Hypothesis 15.1  (Sequential Independence in the Parallel Design) </strong></span>We assume that the sequential randomized allocation of the program among applicants is well done:</p>
<p><span class="math display">\[\begin{align*}
  R^1_i &amp; \Ind(Y_i^{00},Y_i^{01},Y_i^{10},Y_i^{11},M^1_i,M^0_i)|D_i=1\\
  R^2_i &amp; \Ind(Y_i^{00},Y_i^{01},Y_i^{10},Y_i^{11},M^1_i,M^0_i)|R_i^1,D_i=1\\
  R^3_i &amp; \Ind(Y_i^{00},Y_i^{01},Y_i^{10},Y_i^{11},M^1_i,M^0_i)|R_i^2,R_i^1=1,D_i=1.
\end{align*}\]</span></p>
</div>
<p>We need a second assumption:</p>
<div class="hypothesis">
<p><span id="hyp:parrassval" class="hypothesis"><strong>Hypothesis 15.2  (Validity of the Sequential Parallel Design) </strong></span>We assume that the sequential randomized allocation of the program does not interfere with how potential outcomes and potential treatment and mediator choices are generated:</p>
<p><span class="math display">\[\begin{align*}
Y_i &amp; =
  \begin{cases}
    Y_i^{11} &amp; \text{ if } D_i=1 \text{ and } ((R^1_i=0 \text{ and } R^2_i=1 \text{ and } M_i=1) \text{ or } (R^1_i=1 \text{ and } R^2_i=1 \text{ and } R^3_i=1))   \\
    Y_i^{10} &amp; \text{ if } D_i=1 \text{ and } ((R^1_i=0 \text{ and } R^2_i=1 \text{ and } M_i=0) \text{ or } (R^1_i=1 \text{ and } R^2_i=1 \text{ and } R^3_i=0))   \\
    Y_i^{01} &amp; \text{ if } D_i=1 \text{ and } ((R^1_i=0 \text{ and } R^2_i=0 \text{ and } M_i=1) \text{ or } (R^1_i=1 \text{ and } R^2_i=0 \text{ and } R^3_i=1))   \\
    Y_i^{00} &amp; \text{ if } D_i=1 \text{ and } ((R^1_i=0 \text{ and } R^2_i=0 \text{ and } M_i=0) \text{ or } (R^1_i=1 \text{ and } R^2_i=0 \text{ and } R^3_i=0))   \\
  \end{cases}\\
M_i &amp; =
  \begin{cases}
    M_i^{1} &amp; \text{ if } D_i=1 \text{ and }R^1_i=0\text{ and } R^2_i=1\\
    M_i^{0} &amp; \text{ if } D_i=1 \text{ and }R^1_i=0\text{ and } R^2_i=0
  \end{cases},
\end{align*}\]</span></p>
<p>with <span class="math inline">\((Y_i^{00},Y_i^{01},Y_i^{10},Y_i^{11},M^1_i,M^0_i)\)</span> the same potential outcomes and potential treatment and mediator choices as in a routine allocation of the treatment.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-324" class="remark"><em>Remark</em>. </span>Assumption <a href="mediation-analysis.html#hyp:parrassval">15.2</a> imposes that the experimental setting does not alter the treatment, mediator and outcomes of the agents.</p>
</div>
<p>For identification of the mediated and unmediated effects to go through, we need a final (strong) assumption: the absence of interaction effects:</p>
<div class="hypothesis">
<p><span id="hyp:ParNoInteract" class="hypothesis"><strong>Hypothesis 15.3  (Absence of Interaction Effects) </strong></span>We assume that the treatment and the mediator do not interact: <span class="math inline">\(Y_i^{d,m}-Y_i^{d,m&#39;}=Y_i^{d&#39;,m}-Y_i^{d&#39;,m&#39;}\)</span>, <span class="math inline">\(\forall (d,m,d&#39;m&#39;)\in\{0,1\}^4\)</span>, <span class="math inline">\(d\neq d&#39;\)</span>, <span class="math inline">\(m\neq m&#39;\)</span>.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-325" class="remark"><em>Remark</em>. </span>Assumption <a href="mediation-analysis.html#hyp:ParNoInteract">15.3</a> is actually too strong for our result.
We only need that the assumption holds for the average effects on the <em>never takers</em>, <em>defiers</em> and <em>compliers</em>.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-326" class="remark"><em>Remark</em>. </span>Under Assumption <a href="mediation-analysis.html#hyp:ParNoInteract">15.3</a>, <span class="math inline">\(\Delta^{Y_{u(1)}}_{TT}=\Delta^{Y_{u(0)}}_{TT}\)</span>, which we denote <span class="math inline">\(\Delta^{Y_{u(d)}}_{TT}\)</span> and <span class="math inline">\(\Delta^{Y_{m(1)}}_{TT}=\Delta^{Y_{m(0)}}_{TT}\)</span>, which we denote <span class="math inline">\(\Delta^{Y_{m(d)}}_{TT}\)</span>.</p>
</div>
<p>Under these assumptions, we have the following result:</p>
<div class="theorem">
<p><span id="thm:idParMed" class="theorem"><strong>Theorem 15.3  (Identification of Total, Mediated and Unmediated Effects in the Parallel Design) </strong></span>Under Assumptions <a href="mediation-analysis.html#hyp:parindepss">15.1</a>, <a href="mediation-analysis.html#hyp:parrassval">15.2</a> and <a href="mediation-analysis.html#hyp:ParNoInteract">15.3</a>, the treatment effect on the treated and the mediated and unmediated effects on the treated are identified in the Parallel Design:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{TT} &amp; = \esp{Y_i|D_i=1,R^1_i=0,R_i^2=1}-\esp{Y_i|D_i=1,R^1_i=0,R_i^2=0}\\
  \Delta^{Y_{u(d)}}_{TT} &amp; = \esp{Y_i|D_i=1,R^1_i=1,R_i^2=1,R_i^3=1}-\esp{Y_i|D_i=1,R^1_i=1,R_i^2=0,R_i^3=1}\\
                        &amp; =\esp{Y_i|D_i=1,R^1_i=1,R_i^2=1,R_i^3=0}-\esp{Y_i|D_i=1,R^1_i=1,R_i^2=0,R_i^3=0}\\
  \Delta^{Y_{m(d)}}_{TT} &amp; = \esp{Y_i|D_i=1,R^1_i=0,R_i^2=1}-\esp{Y_i|D_i=1,R^1_i=0,R_i^2=0}\\
                        &amp; \phantom{=}-\esp{Y_i|D_i=1,R^1_i=1,R_i^2=1,R_i^3=1}-\esp{Y_i|D_i=1,R^1_i=1,R_i^2=0,R_i^3=1}\\
                         &amp; = \esp{Y_i|D_i=1,R^1_i=0,R_i^2=1}-\esp{Y_i|D_i=1,R^1_i=0,R_i^2=0}\\
                        &amp; \phantom{=}-\esp{Y_i|D_i=1,R^1_i=1,R_i^2=1,R_i^3=0}-\esp{Y_i|D_i=1,R^1_i=1,R_i^2=0,R_i^3=0}.
\end{align*}\]</span></p>
</div>
<div class="proof">
<p><span id="unlabeled-div-327" class="proof"><em>Proof</em>. </span>I omit conditioning on <span class="math inline">\(D_i=1\)</span> to save notation.
Let us start with the total effect: <span class="math inline">\(\esp{Y_i|R^1_i=0,R_i^2=1}-\esp{Y_i|R^1_i=0,R_i^2=0}\)</span> is a With/Without estimator where the treatment has been randomized among a random sample of the units selected to receive the treatment.
Theorem <a href="RCT.html#thm:idrass">3.2</a> proves that it identifies <span class="math inline">\(\Delta^Y_{TT}\)</span> under Assumptions <a href="mediation-analysis.html#hyp:parindepss">15.1</a> and <a href="mediation-analysis.html#hyp:parrassval">15.2</a>.
The unmediated treatment effect can be recovered as follows:</p>
<p><span class="math display">\[\begin{align*}
\esp{Y_i|R^1_i=1,R_i^2=1,R_i^3=1} &amp; -\esp{Y_i|R^1_i=1,R_i^2=0,R_i^3=1} \\
                        &amp; = \sum_{t\in\{a,n,c,d\}}\esp{Y_i^{1,1}-Y_i^{0,1}|T_i=t}\Pr(T_i=t)\\
\esp{Y_i|R^1_i=1,R_i^2=1,R_i^3=0} &amp; -\esp{Y_i|R^1_i=1,R_i^2=0,R_i^3=0} \\
                        &amp; = \sum_{t\in\{a,n,c,d\}}\esp{Y_i^{1,0}-Y_i^{0,0}|T_i=t}\Pr(T_i=t),
\end{align*}\]</span></p>
<p>using Assumptions <a href="mediation-analysis.html#hyp:parindepss">15.1</a> and <a href="mediation-analysis.html#hyp:parrassval">15.2</a>.
Using the decomposition of <span class="math inline">\(\Delta^Y_{TT}\)</span> in the effects on each type, we have:</p>
<p><span class="math display">\[\begin{align*}
\esp{Y_i|R^1_i=0,R_i^2=1} &amp; -\esp{Y_i|R^1_i=0,R_i^2=0}\\
  &amp; - (\esp{Y_i|R^1_i=1,R_i^2=1,R_i^3=1} -\esp{Y_i|R^1_i=1,R_i^2=0,R_i^3=1}) \\
  &amp; = \esp{Y_i^{0,1}-Y_i^{0,0}|T_i=c}\Pr(T_i=c) \\
  &amp; \phantom{=}-\esp{Y_i^{1,1}-Y_i^{1,0}|T_i=d}\Pr(T_i=d)\\
  &amp; \phantom{=}+(\esp{Y_i^{1,0}-Y_i^{0,0}|T_i=n}-\esp{Y_i^{1,1}-Y_i^{0,1}|T_i=n})\Pr(T_i=n).
\end{align*}\]</span></p>
<p>and</p>
<p><span class="math display">\[\begin{align*}
\esp{Y_i|R^1_i=0,R_i^2=1} &amp; -\esp{Y_i|R^1_i=0,R_i^2=0}\\
  &amp; - (\esp{Y_i|R^1_i=1,R_i^2=1,R_i^3=0} -\esp{Y_i|R^1_i=1,R_i^2=0,R_i^3=0}) \\
  &amp; = \esp{Y_i^{1,1}-Y_i^{1,0}|T_i=c}\Pr(T_i=c) \\
  &amp; \phantom{=}-\esp{Y_i^{0,1}-Y_i^{0,0}|T_i=d}\Pr(T_i=d)\\
  &amp; \phantom{=}+(\esp{Y_i^{1,1}-Y_i^{0,1}|T_i=a}-\esp{Y_i^{1,0}-Y_i^{0,0}|T_i=a})\Pr(T_i=a).
\end{align*}\]</span></p>
<p>Using Assumption <a href="mediation-analysis.html#hyp:ParNoInteract">15.3</a> and the decomposition formulae for the mediated and unmediated treatment effects on the treated gives the result.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-328" class="remark"><em>Remark</em>. </span>The proof of Theorem <a href="mediation-analysis.html#thm:idParMed">15.3</a> is more detailed and explanatory than the one in <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1467-985X.2012.01032.x">Imai, Tingleu and Yamamoto (2013)</a>.
We understand why we need Assumption <a href="mediation-analysis.html#hyp:ParNoInteract">15.3</a>: the effects on the <em>always takers</em> and on the <em>never takers</em> estimated in the two treatment arms do not cancel out and the effects of the mediator on the <em>compliers</em> and <em>defiers</em> are not the correct combination in both comparisons unless we make Assumption <a href="mediation-analysis.html#hyp:ParNoInteract">15.3</a>.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-329" class="remark"><em>Remark</em>. </span>Note that the model is overidentified under Assumptions <a href="mediation-analysis.html#hyp:parindepss">15.1</a>, <a href="mediation-analysis.html#hyp:parrassval">15.2</a> and <a href="mediation-analysis.html#hyp:ParNoInteract">15.3</a>.
There are two different ways to estimate the unmediated treatment effect and thus one can test Assumption <a href="mediation-analysis.html#hyp:ParNoInteract">15.3</a> by comparing these two estimates.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-330" class="remark"><em>Remark</em>. </span>Since the model is overidentified under Assumptions <a href="mediation-analysis.html#hyp:parindepss">15.1</a>, <a href="mediation-analysis.html#hyp:parrassval">15.2</a> and <a href="mediation-analysis.html#hyp:ParNoInteract">15.3</a>, one wonders what can exactly be identified on the mediated and unmediated treatment effects under these assumptions.
Maybe it is possible to bound the treatment effects.
This is, to my knowledge, still an open question.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-331" class="remark"><em>Remark</em>. </span><a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1467-985X.2012.01032.x">Imai, Tingleu and Yamamoto (2013)</a> also discuss a Parallel Encouragement design where units are not forced to take the assigned value of the mediator but can be randomly encouraged to do so.
They derive sharp bounds on the mediated effect on the compliers in that design.</p>
</div>
</div>
<div id="mediation-analysis-in-the-sequential-self-selection-design" class="section level3 hasAnchor" number="15.3.2">
<h3><span class="header-section-number">15.3.2</span> Mediation analysis in the Sequential Self-Selection design<a href="mediation-analysis.html#mediation-analysis-in-the-sequential-self-selection-design" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In a Sequential Self-Selection design, researchers run a Randomized Controlled Trial (RCT) in two-steps.
In the first step, the treatment is randomized among those who applied for it.
In the second step, the mediator is randomized among those who applied for it.
We thus have two random variables <span class="math inline">\(R_i^1\)</span> and <span class="math inline">\(R_i^2\)</span> which take values zero or one for observations for which <span class="math inline">\(D_i=1\)</span> for the first and <span class="math inline">\(D_i=1\)</span> and <span class="math inline">\(M_i=1\)</span> for the second.</p>
<p>Let us formalize how the Sequential Self-Selection design works.</p>
<div class="hypothesis">
<p><span id="hyp:seqindepss" class="hypothesis"><strong>Hypothesis 15.4  (Sequential Independence Among Self-Selected) </strong></span>We assume that the sequential randomized allocation of the program among applicants is well done:</p>
<p><span class="math display">\[\begin{align*}
  R^1_i &amp; \Ind(Y_i^{00},Y_i^{01},Y_i^{10},Y_i^{11},M^1_i,M^0_i)|D_i=1\\
  R^2_i &amp; \Ind(Y_i^{00},Y_i^{01},Y_i^{10},Y_i^{11},M^1_i,M^0_i)|R^1_i,M_i=1,D_i=1
\end{align*}\]</span></p>
</div>
<p>We need a second assumption:</p>
<div class="hypothesis">
<p><span id="hyp:seqrassval" class="hypothesis"><strong>Hypothesis 15.5  (Validity of the Sequential Self-Selection design) </strong></span>We assume that the sequential randomized allocation of the program does not interfere with how potential outcomes and self-selection are generated:</p>
<p><span class="math display">\[\begin{align*}
Y_i &amp; =
  \begin{cases}
    Y_i^{11} &amp; \text{ if } (D_i=1 \text{ and } R^1_i=1 \text{ and } M_i=1 \text{ and } R^2_i=1)   \\
    Y_i^{10} &amp; \text{ if } ((D_i=1 \text{ and } R^1_i=1) \text{ and } ((M_i=1 \text{ and } R^2_i=0) \text{ or } M_i=0))    \\
    Y_i^{01} &amp; \text{ if } (D_i=1 \text{ and } R^1_i=0 \text{ and } M_i=1 \text{ and } R^2_i=1)   \\
    Y_i^{00} &amp; \text{ if } ((D_i=1 \text{ and } R^1_i=0) \text{ and } ((M_i=1 \text{ and } R^2_i=0) \text{ or } M_i=0))   
  \end{cases}\\
M_i &amp; =
  \begin{cases}
    M_i^{1} &amp; \text{ if } D_i=1 \text{ and } R^1_i=1\\
    M_i^{0} &amp; \text{ if } D_i=1 \text{ and } R^1_i=0
  \end{cases}
\end{align*}\]</span></p>
</div>
<p>with <span class="math inline">\((Y_i^{00},Y_i^{01},Y_i^{10},Y_i^{11},M^1_i,M^0_i)\)</span> the same potential outcomes and self-selection decisions as in a routine allocation of the treatment.</p>
<p>We finally need a monotonicity assumption:</p>
<div class="hypothesis">
<p><span id="hyp:seqMono" class="hypothesis"><strong>Hypothesis 15.6  (Monotonicity of the Effect of the Treatment on the Mediator) </strong></span>We assume that the effect of the treatment on the mediator is monotonous:</p>
<p><span class="math display">\[\begin{align*}
  \Pr(M_i^1-M_i^0&lt;0) &amp; =0.
\end{align*}\]</span></p>
</div>
<div class="remark">
<p><span id="unlabeled-div-332" class="remark"><em>Remark</em>. </span>Assumption <a href="mediation-analysis.html#hyp:seqMono">15.6</a> is equivalent to the absence of <em>defiers</em>: <span class="math inline">\(\Pr(T_i=d)=0\)</span>.</p>
</div>
<p>Under these assumptions, we have the following result:</p>
<div class="theorem">
<p><span id="thm:idrassMed" class="theorem"><strong>Theorem 15.4  (Identification of Total, Mediated and Unmediated Effects in a Sequential Self-Selection design) </strong></span>Under Assumptions <a href="mediation-analysis.html#hyp:seqindepss">15.4</a>, <a href="mediation-analysis.html#hyp:seqrassval">15.5</a> and <a href="mediation-analysis.html#hyp:seqMono">15.6</a>, the treatment effect on the treated and the mediated and unmediated effects are identified in a Sequential Self-Selection Design:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{TT} &amp; = \esp{Y_i|D_i=1,R_i^1=1,M_i=1,R_i^2=1}\Pr(M_i=1|D_i=1,R_i^1=1)\\
                &amp; \phantom{=}+\esp{Y_i|D_i=1,R_i^1=1,M_i=0}\Pr(M_i=0|D_i=1,R_i^1=1)\\
                &amp; \phantom{=}-\left(\esp{Y_i|D_i=1,R_i^1=0,M_i=1,R_i^2=1}\Pr(M_i=1|D_i=1,R_i^1=0)\right.\\
                &amp; \phantom{=-(}\left.+\esp{Y_i|D_i=1,R_i^1=0,M_i=0}\Pr(M_i=0|D_i=1,R_i^1=0)\right)\\
   \Delta^{Y_{m(1)}}_{TT} &amp; =\left(\esp{Y_i|D_i=1,R_i^1=1,M_i=1,R_i^2=1}\right.\\
                          &amp;\phantom{=-(}\left.-\esp{Y_i|D_i=1,R_i^1=1,M_i=1,R_i^2=0}\right)\Pr(M_i=1|D_i=1,R_i^1=1)\\
                          &amp; \phantom{=}-\left(\esp{Y_i|D_i=1,R_i^1=0,M_i=1,R_i^2=1}\right.\\
                          &amp;\phantom{=-(}\left.-\esp{Y_i|D_i=1,R_i^1=0,M_i=1,R_i^2=0}\right)\Pr(M_i=1|D_i=1,R_i^1=0)\\
   \Delta^{Y_{u(0)}}_{TT} &amp; =\Delta^Y_{TT}-\Delta^{Y_{m(1)}}_{TT}.
\end{align*}\]</span></p>
</div>
<div class="proof">
<p><span id="unlabeled-div-333" class="proof"><em>Proof</em>. </span>I omit conditioning on <span class="math inline">\(D_i=1\)</span> all along to save on notation.
Note that:</p>
<p><span class="math display">\[\begin{align*}  
  \esp{Y_i|R_i^1=1,M_i=1,R_i^2=1} &amp; = \esp{Y^{1,M_i^1}_i|R_i^1=1,M^1_i=1,R_i^2=1}\\
                                  &amp; = \esp{Y^{1,M_i^1}_i|M^1_i=1}\\
  \esp{Y_i|R_i^1=1,M_i=0} &amp; = \esp{Y^{1,M_i^1}_i|M^1_i=0}\\
  \esp{Y_i|R_i^1=0,M_i=1,R_i^2=1} &amp; = \esp{Y^{0,M_i^0}_i|M^0_i=1}\\
  \esp{Y_i|R_i^1=0,M_i=0} &amp; = \esp{Y^{0,M_i^0}_i|M^0_i=0}\\
  \Pr(M_i=1|R_i^1=1) &amp; = \Pr(M^1_i=1)\\
  \Pr(M_i=0|R_i^1=1) &amp; = \Pr(M^1_i=0)\\
  \Pr(M_i=1|R_i^1=0) &amp; = \Pr(M^0_i=1)\\
  \Pr(M_i=0|R_i^1=0) &amp; = \Pr(M^0_i=0),
\end{align*}\]</span></p>
<p>using Assumptions <a href="mediation-analysis.html#hyp:seqindepss">15.4</a> and <a href="mediation-analysis.html#hyp:seqrassval">15.5</a>.
Because <span class="math inline">\(M_i^1\)</span> and <span class="math inline">\(M_i^0\)</span> are both partitions of the sampling space, we can use the Law of Iterated Expectations to find:</p>
<p><span class="math display">\[\begin{align*}
  \esp{Y^{1,M_i^1}_i} &amp;=  \esp{Y^{1,M_i^1}_i|M^1_i=1}\Pr(M^1_i=1)+\esp{Y^{1,M_i^1}_i|M^1_i=1}\Pr(M^1_i=0)\\
  \esp{Y^{0,M_i^0}_i} &amp;=  \esp{Y^{0,M_i^0}_i|M^0_i=1}\Pr(M^0_i=1)+\esp{Y^{0,M_i^0}_i|M^1_i=1}\Pr(M^0_i=0)
\end{align*}\]</span></p>
<p>The difference between the two terms is the definition of <span class="math inline">\(\Delta^Y_{TT}\)</span>.
This proves the first part of the theorem.</p>
<p>Note that, under Assumptions <a href="mediation-analysis.html#hyp:seqindepss">15.4</a>, <a href="mediation-analysis.html#hyp:seqrassval">15.5</a> and especially <a href="mediation-analysis.html#hyp:seqMono">15.6</a>:</p>
<p><span class="math display">\[\begin{align*}
  \esp{Y_i|R_i^1=1,M_i=1,R_i^2=1} &amp; -\esp{Y_i|R_i^1=1,M_i=1,R_i^2=0}\\
     &amp; =  \esp{Y^{11}_i|M^1_i=1} -\esp{Y^{10}_i|M^1_i=1}\\
     &amp; =  \esp{Y^{11}_i|T_i=a}\Pr(T_i=a|M_i^1=1)+\esp{Y^{11}_i|T_i=c}\Pr(T_i=c|M_i^1=1)\\
      &amp; \phantom{=}-\esp{Y^{10}_i|T_i=a}\Pr(T_i=a|M^1_i=1)-\esp{Y^{10}_i|T_i=c}\Pr(T_i=c|M^1_i=1)\\
     &amp; =  \esp{Y^{11}_i-Y^{10}_i|T_i=a}\Pr(T_i=a|M_i^1=1)\\
      &amp; \phantom{=}+\esp{Y^{11}_i-Y^{10}_i|T_i=c}\Pr(T_i=c|M_i^1=1).
\end{align*}\]</span></p>
<p>By the same reasoning, we also have:</p>
<p><span class="math display">\[\begin{align*}
  \esp{Y_i|R_i^1=0,M_i=1,R_i^2=1} &amp; -\esp{Y_i|R_i^1=0,M_i=1,R_i^2=0}\\
     &amp; =  \esp{Y^{11}_i|M^0_i=1} -\esp{Y^{10}_i|M^0_i=1}\\
     &amp; =  \esp{Y^{11}_i-Y^{10}_i|T_i=a}.
\end{align*}\]</span></p>
<p>Finally, using Bayes Law and the fact that:</p>
<p><span class="math display">\[\begin{align*}
  \Pr(M_i=1|R_i^1=1) &amp; = \Pr(M^1_i=1) = \Pr(T_i=a)+\Pr(T_i=c)\\
  \Pr(M_i=1|R_i^1=0) &amp; = \Pr(M^0_i=1) = \Pr(T_i=a),
\end{align*}\]</span></p>
<p>we have that <span class="math inline">\(\Pr(T_i=a|M_i^1=1)=\frac{\Pr(T_i=a)}{\Pr(T_i=a)+\Pr(T_i=c)}\)</span> and <span class="math inline">\(\Pr(T_i=c|M_i^1=1)=\frac{\Pr(T_i=c)}{\Pr(T_i=a)+\Pr(T_i=c)}\)</span>.
Combining the results with the decomposition of <span class="math inline">\(\Delta^{Y_{m(1)}}_{TT}\)</span> under Assumption <a href="mediation-analysis.html#hyp:seqMono">15.6</a> proves the identification of <span class="math inline">\(\Delta^{Y_{m(1)}}_{TT}\)</span>.
The identification of <span class="math inline">\(\Delta^{Y_{u(0)}}_{TT}\)</span> comes directly from the decompositions of <span class="math inline">\(\Delta^Y_{TT}\)</span>, <span class="math inline">\(\Delta^{Y_{m(1)}}_{TT}\)</span> and <span class="math inline">\(\Delta^{Y_{u(0)}}_{TT}\)</span> under Assumption <a href="mediation-analysis.html#hyp:seqMono">15.6</a>.
This proves the result.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-334" class="remark"><em>Remark</em>. </span>Intuitively, Theorem <a href="mediation-analysis.html#thm:idrassMed">15.4</a> works by using what happens in the voluntary parts of both experimental arms (the parts where the mediator value chosen by the units is given to them) to recover the treatment effect on the treated.
Then, the With/Without estimators using <span class="math inline">\(R_i^2\)</span> in each arm give the effect of the mediator, on the <em>always treated</em> and the <em>compliers</em> in the arm where <span class="math inline">\(R_i^1=1\)</span> and on the compliers alone in the arm where <span class="math inline">\(R_i^1=0\)</span>.
Taking the difference between these two estimators, appropriately reweighted, gives the effect of the mediator on the compliers times their proportion among the treated, which is equal to the mediated effect of the treatment on the treated.</p>
</div>
</div>
<div id="mediation-analysis-in-the-crossover-design" class="section level3 hasAnchor" number="15.3.3">
<h3><span class="header-section-number">15.3.3</span> Mediation analysis in the Crossover design<a href="mediation-analysis.html#mediation-analysis-in-the-crossover-design" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Crossover Design has been proposed by <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1467-985X.2012.01032.x">Imai, Tingleu and Yamamoto (2013)</a>.
In the Crossover Design, each experimental unit is exposed both to the treatment and control conditions sequentially, over two periods, <span class="math inline">\(t\in\{1,2\}\)</span>.
The experimenter first randomly chooses the order in which each unit is assigned to the treatment and control conditions with <span class="math inline">\(R_i=1\)</span> when the treatment is given in the first period and <span class="math inline">\(R_i=0\)</span> when the treatment is given in the second period.
After measuring the value of the mediator and of the outcome in the first period, each unit is assigned in the second period to the treatment status value opposite to the one they had in the first period but to the same mediator value that they had in the first period.
Let’s see how this design identifies the effects of interest.</p>
<p>Let us formalize how the Crossover design works.</p>
<div class="hypothesis">
<p><span id="hyp:CrossOverIndep" class="hypothesis"><strong>Hypothesis 15.7  (Independence in the Crossover Design) </strong></span>We assume that the randomized allocation of the program among applicants is well done:</p>
<p><span class="math display">\[\begin{align*}
  R_i &amp; \Ind\left(\left\{Y_{i,t}^{00},Y_{i,t}^{01},Y_{i,t}^{10},Y_{i,t}^{11},M^1_{i,t},M^0_{i,t}\right\}_{t\in\{1,2\}}\right)|D_i=1.
\end{align*}\]</span></p>
</div>
<p>We need a second assumption:</p>
<div class="hypothesis">
<p><span id="hyp:CrossOverVal" class="hypothesis"><strong>Hypothesis 15.8  (Validity of the Crossover Design) </strong></span>We assume that the randomized allocation of the program does not interfere with how potential outcomes and self-selection are generated:</p>
<p><span class="math display">\[\begin{align*}
Y_{i,t} &amp; =
  \begin{cases}
    Y_{i,t}^{11} &amp; \text{ if } D_i=1 \text{ and } R_i=1 \text{ and } M_{i}=1   \\
    Y_{i,t}^{10} &amp; \text{ if } D_i=1 \text{ and } R_i=1 \text{ and } M_{i}=0    \\
    Y_{i,t}^{01} &amp; \text{ if } D_i=1 \text{ and } R_i=0 \text{ and } M_{i}=1  \\
    Y_{i,t}^{00} &amp; \text{ if } D_i=1 \text{ and } R_i=0 \text{ and } M_{i}=0
  \end{cases}\\
M_{i} &amp; =
  \begin{cases}
    M_{i,1}^{1} &amp; \text{ if } D_i=1 \text{ and } R_i=1\\
    M_{i,1}^{0} &amp; \text{ if } D_i=1 \text{ and } R_i=0.
  \end{cases}
\end{align*}\]</span></p>
</div>
<p>with <span class="math inline">\((Y_{i,t}^{00},Y_{i,t}^{01},Y_{i,t}^{10},Y_{i,t}^{11},M^1_{i,t},M^0_{i,t})\)</span> the same potential outcomes and self-selection decisions as in a routine allocation of the treatment.</p>
<div class="remark">
<p><span id="unlabeled-div-335" class="remark"><em>Remark</em>. </span>Note that Assumption <a href="mediation-analysis.html#hyp:CrossOverVal">15.8</a> implicitely assumes that the potential outcomes are period <span class="math inline">\(t\)</span> only depend on the treatment and mediator value at period <span class="math inline">\(t\)</span>.
This is a huge assumption that there are no persistent effects of either the treatment or the mediator value over time.</p>
</div>
<p>We finally need a third assumption:</p>
<div class="hypothesis">
<p><span id="hyp:NoTimeChange" class="hypothesis"><strong>Hypothesis 15.9  (No Changes in Potential Outcomes Over Time) </strong></span>We assume that time does not not interfere with how potential outcomes are generated:</p>
<p><span class="math display">\[\begin{align*}
\esp{Y_{i,1}^{d,m}|D_i=1} &amp; = \esp{Y_{i,2}^{d,m}|D_i=1}\text{, }\forall (d,m)\in\{0,1\}^2.
\end{align*}\]</span></p>
</div>
<p>We can now prove identification under these assumptions:</p>
<div class="theorem">
<p><span id="thm:idCrossOver" class="theorem"><strong>Theorem 15.5  (Identification of Total, Mediated and Unmediated Effects in a Crossover design) </strong></span>Under Assumptions <a href="mediation-analysis.html#hyp:CrossOverIndep">15.7</a>, <a href="mediation-analysis.html#hyp:CrossOverVal">15.8</a> and <a href="mediation-analysis.html#hyp:NoTimeChange">15.9</a>, the treatment effect on the treated and the mediated and unmediated effects are identified in a Crossover Design:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{TT} &amp; = \esp{Y_{i,1}|D_i=1,R_i=1}-\esp{Y_{i,1}|D_i=1,R_i=0}\\
   \Delta^{Y_{m(1)}}_{TT} &amp; =\esp{Y_{i,1}|D_i=1,R_i=1}-\esp{Y_{i,2}|D_i=1,R_i=0}\\
   \Delta^{Y_{u(0)}}_{TT} &amp; =\esp{Y_{i,2}|D_i=1,R_i=0}-\esp{Y_{i,1}|D_i=1,R_i=0}.
\end{align*}\]</span></p>
</div>
<div class="proof">
<p><span id="unlabeled-div-336" class="proof"><em>Proof</em>. </span>I omit the conditioning on <span class="math inline">\(D_i=1\)</span> for simplicity.
Let us start with the first result:</p>
<p><span class="math display">\[\begin{align*}
\esp{Y_{i,1}|R_i=1}-\esp{Y_{i,1}|R_i=0} &amp; = \esp{Y^{1,M_{i,1}^1}_{i,1}|R_i=1}-\esp{Y^{0,M_{i,1}^0}_{i,1}|R_i=0} \\
                                        &amp; = \esp{Y^{1,M_{i,1}^1}_{i,1}-Y^{0,M_{i,1}^0}_{i,1}} \\
                                        &amp; = \Delta^{Y_1}_{TT}
                                        &amp; = \Delta^{Y}_{TT},
\end{align*}\]</span></p>
<p>where the first equality uses Assumption <a href="mediation-analysis.html#hyp:CrossOverVal">15.8</a>, the second uses Assumption <a href="mediation-analysis.html#hyp:CrossOverIndep">15.7</a> and the third uses Assumption <a href="mediation-analysis.html#hyp:NoTimeChange">15.9</a>.
Let us now move on to the second result:</p>
<p><span class="math display">\[\begin{align*}
\esp{Y_{i,1}|R_i=1}-\esp{Y_{i,2}|R_i=0} &amp; = \esp{Y^{1,M_{i,1}^1}_{i,1}|R_i=1}-\esp{Y^{1,M_{i,1}^0}_{i,2}|R_i=0} \\
                                        &amp; = \esp{Y^{1,M_{i,1}^1}_{i,1}-Y^{1,M_{i,1}^0}_{i,1}} \\
                                        &amp; = \Delta^{Y_{m(1)}}_{TT},
\end{align*}\]</span></p>
<p>where the first equality uses Assumption <a href="mediation-analysis.html#hyp:CrossOverVal">15.8</a> and the second uses Assumptions <a href="mediation-analysis.html#hyp:CrossOverIndep">15.7</a> and <a href="mediation-analysis.html#hyp:NoTimeChange">15.9</a>.
Let us now move on to the third result:</p>
<p><span class="math display">\[\begin{align*}
\esp{Y_{i,2}|R_i=0}-\esp{Y_{i,1}|R_i=0} &amp; = \esp{Y^{1,M_{i,1}^0}_{i,2}|R_i=0}-\esp{Y^{0,M_{i,1}^0}_{i,1}|R_i=0} \\
                                        &amp; = \esp{Y^{1,M_{i,1}^0}_{i,1}-Y^{0,M_{i,1}^0}_{i,1}} \\
                                        &amp; = \Delta^{Y_{u(0)}}_{TT},
\end{align*}\]</span>
where the first equality uses Assumption <a href="mediation-analysis.html#hyp:CrossOverVal">15.8</a> and the second uses Assumptions <a href="mediation-analysis.html#hyp:CrossOverIndep">15.7</a> and <a href="mediation-analysis.html#hyp:NoTimeChange">15.9</a>.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-337" class="remark"><em>Remark</em>. </span>There seems to be some sense of a Brute Force design in the Crossover design.
Indeed, this designs imposes the value of the mediator in the second period, contrary to the one some units would have chosen if left to their own choice.
There does not seem to be another way of obtaining the mediated and unmediated effects.
Note that this is similar to randomizing the mediator value in the Sequential Self-Selection Design.
<a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1467-985X.2012.01032.x">Imai, Tingleu and Yamamoto (2013)</a> propose an Crossover Encouragement design to allow for only encouraging the units to change their value of the mediator.
In that case, they prove identification of the mediated treatment effect for a subpopulation of units.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-338" class="remark"><em>Remark</em>. </span><a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1467-985X.2012.01032.x">Imai, Tingleu and Yamamoto (2013)</a> offer a nice discussion of how the Crossover design could be used to help identify the effect of race not mediated through qualifications in audit studies.
They also discuss an application of the Crossover Encouragement design to framing effects on preferences for immigration.</p>
</div>
</div>
</div>
<div id="mediation-analysis-under-unconfoundedness" class="section level2 hasAnchor" number="15.4">
<h2><span class="header-section-number">15.4</span> Mediation analysis under unconfoundedness<a href="mediation-analysis.html#mediation-analysis-under-unconfoundedness" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Mediation analysis under unconfoundedness is covered in <a href="https://projecteuclid.org/journals/statistical-science/volume-25/issue-1/Identification-Inference-and-Sensitivity-Analysis-for-Causal-Mediation-Effects/10.1214/10-STS321.full">Imai, Keele and Yamamoto (2010)</a> and summarized in <a href="https://imai.fas.harvard.edu/research/files/BaronKenny.pdf">Imai, Keene and Tingley (2010)</a>.
The key assumption that the authors make is that of sequential ignorability, which is equivalent to the Conditional Independence Assumption used to establish matching methods in Chapter <a href="OM.html#OM">5</a>.
We study first general non-parametric identification under sequential ignorability before looking at the special case of linear models.</p>
<div id="non-parametric-identification-under-sequential-ignorability" class="section level3 hasAnchor" number="15.4.1">
<h3><span class="header-section-number">15.4.1</span> Non-parametric identification under sequential ignorability<a href="mediation-analysis.html#non-parametric-identification-under-sequential-ignorability" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s make the assumption of sequential ignorability clearer:</p>
<div class="hypothesis">
<p><span id="hyp:SeqIgnor" class="hypothesis"><strong>Hypothesis 15.10  (Sequential Ignorability) </strong></span>We assume that potential outcomes are sequentially ignorable conditional on observed covariates <span class="math inline">\(X_i\)</span>, <span class="math inline">\(\forall (d,d&#39;,m)\in \left\{0,1\right\}^3\)</span> and <span class="math inline">\(\forall x\in\mathcal{X}\)</span>:</p>
<p><span class="math display">\[\begin{align*}
  \left(Y_i^{d,m},M_i^{d&#39;}\right) &amp; \Ind D_i|X_i\\
  Y_i^{d,m} &amp; \Ind M_i|D_i,X_i.
\end{align*}\]</span></p>
</div>
<p>Assumption <a href="mediation-analysis.html#hyp:SeqIgnor">15.10</a> imposes that the potential outcomes and potential mediator values are independent of the treatment conditional on observed covariates.
That means that treatment is as good as randomly assigned.
It also imposes that the potential outcomes are independent of the mediator conditional on the treatment and on observed covariates.
That means that the mediator is as good as randomly assigned conditional on the treatment and on observed covariates.</p>
<p>We also need a common support assumption in order to prove identification non-parametrically:</p>
<div class="hypothesis">
<p><span id="hyp:SeqCS" class="hypothesis"><strong>Hypothesis 15.11  (Sequential Common Support) </strong></span>We assume that the probability of the treatment and of the mediator taking a given value are always positive conditional on observables, <span class="math inline">\(\forall (d,m)\in \left\{0,1\right\}^2\)</span>:</p>
<p><span class="math display">\[\begin{align*}
  \Pr(D_i=d|X_i) &amp; &gt;0\\
  \Pr(M_i=m|D_i,X_i) &amp; &gt;0.
\end{align*}\]</span></p>
</div>
<p>Under these assumptions, the mediated and unmediated effects of the treatment are identified:</p>
<div class="theorem">
<p><span id="thm:idIgnor" class="theorem"><strong>Theorem 15.6  (Identification of Total, Mediated and Unmediated Effects under Sequential Ignorability) </strong></span>Under Assumptions <a href="mediation-analysis.html#hyp:SeqIgnor">15.10</a> and <a href="mediation-analysis.html#hyp:SeqCS">15.11</a>, the treatment effect on the treated and the mediated and unmediated effects are identified:</p>
<p><span class="math display">\[\begin{align*}
  \Delta^Y_{TT} &amp; = \esp{Y_i|D_i=1}-\esp{\esp{Y_i|X_i,D_i=0}|D_i=1} \\
   \Delta^{Y_{m(1)}}_{TT} &amp; =\mathbb{E}\left[\left(\esp{Y_i|X_i,D_i=1,M_i=1}-\esp{Y_i|X_i,D_i=1,M_i=0}\right)\right.\\
                          &amp; \phantom{=\mathbb{E}}\left.\left(\Pr(M_i=1|X_i,D_i=1)-\Pr(M_i=1|X_i,D_i=0)\right)|D_i=1\right]\\
   \Delta^{Y_{u(0)}}_{TT} &amp; =\esp{\esp{Y_i|X_i,D_i=1,M_i}-\esp{Y_i|X_i,D_i=0,M_i}|D_i=1}.
\end{align*}\]</span></p>
</div>
<div class="proof">
<p><span id="unlabeled-div-339" class="proof"><em>Proof</em>. </span>The proof of identification of the total average treatment effect on the treated is straightforward, using results from Chapter <a href="OM.html#OM">5</a>.
The proof of the identification of the mediated treatment effect in <a href="https://projecteuclid.org/journals/statistical-science/volume-25/issue-1/Identification-Inference-and-Sensitivity-Analysis-for-Causal-Mediation-Effects/10.1214/10-STS321.full">Imai, Keele and Yamamoto (2010)</a> is not very intuitive.
I am following a different route based on types <span class="math inline">\(T_i\)</span>, using a somewhat stronger set of assumptions: <span class="math inline">\((Y_i^{d,m},T_i)\Ind D_i|X_i\)</span>, which follows from the first part of Assumption <a href="mediation-analysis.html#hyp:SeqIgnor">15.10</a>, and <span class="math inline">\(Y_i^{d,m}\Ind T_i|X_i\)</span>.
This second assumption is somewhat stronger than the second part of Assumption <a href="mediation-analysis.html#hyp:SeqIgnor">15.10</a>, but not much more.</p>
<p>Let us now prove the identification of <span class="math inline">\(\Delta^{Y_{m(1)}}_{TT}\)</span>.
In what follows, I omit conditioning on <span class="math inline">\(X_i\)</span>.
Following Assumption <a href="mediation-analysis.html#hyp:SeqIgnor">15.10</a>, we have:</p>
<p><span class="math display">\[\begin{align*}
  \esp{Y_i|D_i,M_i=1} &amp; = \esp{Y_i^{1,1}}\\
  \esp{Y_i|D_i,M_i=0} &amp; = \esp{Y_i^{1,0}}.
\end{align*}\]</span></p>
<p>We also have, under the same assumption (and the fact that it implies <span class="math inline">\(T_i\Ind D_i|X_i\)</span>):</p>
<p><span class="math display">\[\begin{align*}
  \Pr(M_i=1|D_i=1)-\Pr(M_i=1|D_i=0) &amp; =\Pr(T_i=a) + \Pr(T_i=c)-(\Pr(T_i=a)+\Pr(T_i=d)) \\
                                    &amp; =\Pr(T_i=c)-\Pr(T_i=d).
\end{align*}\]</span></p>
<p>As a consequence, we have:</p>
<p><span class="math display">\[\begin{align*}
  \esp{Y_i|D_i,M_i=1}-\esp{Y_i|D_i,M_i=0} &amp; = \esp{Y_i^{1,1}-Y_i^{1,0}}(\Pr(T_i=c)-\Pr(T_i=d)) \\
                                          &amp; = \esp{Y_i^{1,1}-Y_i^{1,0}|T_i=c}\Pr(T_i=c)-\esp{Y_i^{1,1}-Y_i^{1,0}|T_i=d}\Pr(T_i=d)\\
                                          &amp; = \esp{Y_i^{1,1}-Y_i^{1,0}|T_i=c,D_i=1}\Pr(T_i=c|D_i=1)\\
                                          &amp; \phantom{=}-\esp{Y_i^{1,1}-Y_i^{1,0}|T_i=d,D_i=1}\Pr(T_i=d|D_i=1)\\
                                          &amp; = \Delta^{Y_{m(1)}}_{TT},
\end{align*}\]</span></p>
<p>where the second equality uses <span class="math inline">\(Y_i^{d,m}\Ind T_i|X_i\)</span>, the third <span class="math inline">\((Y_i^{d,m},T_i)\Ind D_i|X_i\)</span> and the fourth the decomposition of <span class="math inline">\(\Delta^{Y_{m(1)}}_{TT}\)</span> by type.
The expression is implicitely conditional on <span class="math inline">\(X_i\)</span>.
Assumption <a href="mediation-analysis.html#hyp:SeqCS">15.11</a> and the Law of Iterated Expectations prove the unconditional result.</p>
<p>Let us now prove the identification of <span class="math inline">\(\Delta^{Y_{u(0)}}_{TT}\)</span>.
We have:</p>
<p><span class="math display">\[\begin{align*}
  \esp{Y_i|D_i=1,M_i=d} &amp; = \esp{Y^{1,d}}\\
  \esp{Y_i|D_i=0,M_i=d} &amp; = \esp{Y^{0,d}}
\end{align*}\]</span></p>
<p>because of Assumption <a href="mediation-analysis.html#hyp:SeqIgnor">15.10</a>.
Using the Law of Iterated Expectations finalizes the proof.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-340" class="remark"><em>Remark</em>. </span>Under Assumption <a href="mediation-analysis.html#hyp:SeqIgnor">15.10</a>, the comparison of the outcomes in the treated groups between the individuals with <span class="math inline">\(M_i=1\)</span> and <span class="math inline">\(M_i=0\)</span> identifies the controlled mediated effect <span class="math inline">\(\esp{Y_i^{1,1}-Y_i^{1,0}}\)</span>.
This is not the mediated effect thought, since we need to account for the fact that the treatment only alters the effect of the mediator for a subset of the population.
The impact of the treatment on the value of the mediator is estiamted y comparing the value of the mediator in the treated and control group.</p>
</div>
</div>
<div id="mediation-analysis-under-sequential-ignorability-in-linear-models" class="section level3 hasAnchor" number="15.4.2">
<h3><span class="header-section-number">15.4.2</span> Mediation analysis under sequential ignorability in linear models<a href="mediation-analysis.html#mediation-analysis-under-sequential-ignorability-in-linear-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One classical and simple way to represent mediation analysis is to use a simple parametric linear structural model.
Let’s write the mediator and the outcome equations in the following way:</p>
<p><span class="math display">\[\begin{align*}
  Y_i &amp; = \alpha_1 + \beta_1 D_i + \gamma_1 M_i + \epsilon^1_{i}\\
  M_i &amp; = \alpha_2 + \beta_2 D_i + \epsilon^2_i,
\end{align*}\]</span></p>
<p>where <span class="math inline">\((\epsilon^1_{i},\epsilon^2_{i})\)</span> are orthogonal i.i.d. random shocks.
Note that this structural equation implies that <span class="math inline">\(M_i\)</span> is not binary.
We will study this case shortly after.
Note also that the reduced form combining both equations yields the following equation for <span class="math inline">\(Y_i\)</span>:</p>
<p><span class="math display">\[\begin{align*}
  Y_i &amp; = \alpha_1 +\gamma_1\alpha_2  + (\beta_1+\gamma_1\beta_2)D_i + \epsilon^1_{i}+\gamma_1\epsilon^2_i.
\end{align*}\]</span></p>
<p>In this model, the total effect of the treatment on <span class="math inline">\(Y_i\)</span> is equal to <span class="math inline">\(\beta_1+\gamma_1\beta_2\)</span>.
It can be decomposed between the direct (unmediated) effect of the treatment, <span class="math inline">\(\beta_1\)</span>, and the indirect (mediated) effect of the treatment, <span class="math inline">\(\gamma_1\beta_2\)</span>.
Under sequential ignorability, running both structural equations enables to identify the required parameters to identify these effects.
Running the reduced form gives the total effect.
Adding the mediator gives the unmediated effect.
These usual practices are thus consistent, but only under these very stringent assumptions.</p>
</div>
</div>
<div id="mediation-analysis-with-panel-data" class="section level2 hasAnchor" number="15.5">
<h2><span class="header-section-number">15.5</span> Mediation analysis with panel data<a href="mediation-analysis.html#mediation-analysis-with-panel-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Mediation analysis with panel data has scarcely been studied up to know.
The only attack on this issue that I know of stems from <a href="https://www.tandfonline.com/doi/abs/10.1080/07350015.2017.1419139">Deuchert, Huber and Schelker (2017)</a>.</p>
</div>
<div id="mediation-analysis-with-instruments" class="section level2 hasAnchor" number="15.6">
<h2><span class="header-section-number">15.6</span> Mediation analysis with instruments<a href="mediation-analysis.html#mediation-analysis-with-instruments" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Bounds.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stratification.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/chabefer/STCI/blob/master/14_Mediation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["STCI.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 1
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
